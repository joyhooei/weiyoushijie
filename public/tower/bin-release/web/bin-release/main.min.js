var application;!function(t){function e(e){t.main=e,egret.getOption("wysj_development")&&(t.development=1);var i=egret.getOption("wysj_server");i&&i.length>1?t.baseUrl=i:t.baseUrl=window.location.protocol+"//"+window.location.hostname+(window.location.port?":"+window.location.port:"")+"/",t.dao=new Dao(t.baseUrl+"api/"),t.channel=Channel.create(),t.characters=Character.createAll(),t.pool=new EntityPool,t.stopwatch=new egret.EventDispatcher;var n=new egret.Timer(1e3,0);n.addEventListener(egret.TimerEvent.TIMER,function(e){t.ticks++,t.stopwatch.dispatchEventWith("second",!0,t.ticks),t.ticks%60==0&&(t.stopwatch.dispatchEventWith("minute",!0,t.ticks/60),t.ticks%3600==0&&t.stopwatch.dispatchEventWith("hour",!0,t.ticks/3600))},this),n.start(),window.onunload=function(){t.me&&t.me.saveNow()}}function i(e){return t.me=e,Q.Promise(function(e,i,n){t.skills=[],t.armies=[],t.dao.fetch("Skill",{customer_id:t.me.attrs.id}).then(function(i){for(var n=0;n<i.length;n++)t.skills.push(new Skill(i[n]));t.dao.fetch("Army",{customer_id:t.me.attrs.id}).then(function(i){for(var n=0;n<i.length;n++)t.armies.push(new Army(i[n]));e(i)})})})}function n(e){return t.token=e.token,Q.Promise(function(i,n,s){t.dao.fetch("Customer",{id:e.customer_id},{limit:1}).then(function(e){e.length>0?(t.me=new Customer(e[0]),t.channel.track(TRACK_CATEGORY_PLAYER,TRACK_ACTION_ENTER),i(e[0]),0==t.me.attrs.metal&&(t.guideUI=new GuideUI)):Toast.launch("获取账号信息失败,请重新进入")})})}function s(e,i,n,s){n&&s?(e.x=n-e.width/2,e.y=s-e.height/2):(e.horizontalCenter=0,e.verticalCenter=0);var a=new BlockUI;return a.addChild(e),t.guideUI?i?i.contains(t.guideUI)?i.addChildAt(a,i.getChildIndex(t.guideUI)):i.addChild(a):t.main.homeUI.addChildAt(a,i.getChildIndex(t.guideUI)):i?i.addChild(a):t.main.homeUI.addChild(a),e}function a(t){return t&&t.parent&&("BlockUI"==egret.getQualifiedClassName(t.parent)&&t.parent.parent&&t.parent.parent.removeChild(t.parent),t.parent.removeChild(t)),t}t.skills=[],t.armies=[],t.frameRate=36,t.ticks=0,t.version="1.1.1",t.game="tower",t.token="",t.development=0,t.init=e,t.loadCustomer=i,t.logined=n,t.showUI=s,t.hideUI=a}(application||(application={}));var CHANNEL_1758_IN_EGRET="10016",CHANNEL_HUHUH5="huhuh5",CHANNEL_51H5="51h5",TRACK_CATEGORY_PLAYER="player",TRACK_CATEGORY_DIAMOND="diamond",TRACK_CATEGORY_GOLD="gold",TRACK_CATEGORY_ACTIVITY="activity",TRACK_CATEGORY_GUIDE="guide",TRACK_CATEGORY_RESOURCE="resource",TRACK_ACTION_DEC="dec",TRACK_ACTION_INC="inc",TRACK_ACTION_JOIN="join",TRACK_ACTION_ENTER="enter",TRACK_ACTION_LEAVE="leave",TRACK_ACTION_LOAD="load",Channel=function(){function t(t){this._deferred=null,this._standalone=t}var e=(__define,t),i=e.prototype;return t.create=function(){var t=egret.getOption("wysj_channel")||egret.getOption("channelId")||egret.getOption("egret.runtime.spid")||"egret";return t===CHANNEL_1758_IN_EGRET?(console.info("using channel 1758"),new Channel1758(!1)):t===CHANNEL_HUHUH5?(console.info("using channel huhuh5"),new ChannelHuHuH5(!0)):t===CHANNEL_51H5?(console.info("using channel huhuh5"),new Channel51H5(!0)):(console.info("using default channel"),new ChannelEgret(!0))},i.standalone=function(){return this._standalone},i.require=function(t){return Utility.require(t)},i.rest=function(t,e,i){var n=application.baseUrl+"channels/"+e+"?wysj_channel="+t+"&game="+application.game;return console.log("rest "+n+" "+JSON.stringify(i)),application.dao.restWithUrl(n,i)},i.promise=function(){return this._timer=new egret.Timer(6e4,1),this._timer.addEventListener(egret.TimerEvent.TIMER,function(t){this.reject("操作超时")},this),this._timer.start(),this._promiseWithoutTimeout()},i._promiseWithoutTimeout=function(){return this.reject(""),this._deferred=Q.defer(),this._deferred.promise},i.resolvedPromise=function(){var t=this._promiseWithoutTimeout();return this._deferred.resolve(),t},i.rejectedPromise=function(){var t=this._promiseWithoutTimeout();return this._deferred.reject("目前不支持"),t},i.resolve=function(t){this._deferred&&this._deferred.resolve(t),this._timer&&this._timer.stop(),this._deferred=null},i.reject=function(t){this._deferred&&this._deferred.reject(t),this._timer&&this._timer.stop(),this._deferred=null},i.openScreen=function(t){this._loadingUI=new LoadingUI,t.addChild(this._loadingUI)},i.setOpenScreenProgress=function(t,e,i){this._loadingUI.setProgress(t,e),t==e&&this._loadingUI.parent&&this._loadingUI.parent.removeChild(this._loadingUI)},i.loginQuietly=function(){var t=this;return t.rejectedPromise()},i.login=function(){return this.rejectedPromise()},i.pay=function(t){return this.rejectedPromise()},i.share=function(t){return this.rejectedPromise()},i.attention=function(t){return this.rejectedPromise()},i.track=function(t,e,i,n){switch(t){case TRACK_CATEGORY_PLAYER:return;case TRACK_CATEGORY_DIAMOND:return;case TRACK_CATEGORY_GOLD:return;case TRACK_CATEGORY_ACTIVITY:return;case TRACK_CATEGORY_GUIDE:return;case TRACK_CATEGORY_RESOURCE:return}},t}();egret.registerClass(Channel,"Channel");var Dao=function(t){function e(e){t.call(this),this._url=e}__extends(e,t);var i=(__define,e),n=i.prototype;return n.fetch=function(t,e,i){return e=e||{},i=i||{},this.rest("select/"+t,{conditions:e,filters:i})},n.save=function(t,e){var i=this;if(e.game=application.game,e.id)var n=this.rest("update/"+t+"/"+e.id,e);else var n=this.rest("create/"+t,e);return n.then(function(n){e=n,i.dispatchEventWith(t,!0,e)},function(t){Toast.launch(t)}),n},n.rest=function(t,e){return this.restWithUrl(this._url+t+"?game="+application.game+"&token="+application.token,e)},n.restWithUrl=function(t,e){var i=this;return Q.Promise(function(n,s,a){var r=new egret.HttpRequest;r.responseType=egret.HttpResponseType.TEXT,r.open(t,egret.HttpMethod.POST),r.setRequestHeader("Content-Type","application/json"),r.addEventListener(egret.Event.COMPLETE,function(t){var e,i=t.currentTarget;try{e=JSON.parse(i.response)}catch(s){e=i.response}n(e)},i),r.addEventListener(egret.IOErrorEvent.IO_ERROR,function(e){console.error("restWithUrl "+t+" failed "+e.$target.response),s(e.$target.response)},i),r.addEventListener(egret.ProgressEvent.PROGRESS,function(t){a(Math.floor(100*t.bytesLoaded/t.bytesTotal))},i),r.send(JSON.stringify(e))})},e}(egret.EventDispatcher);egret.registerClass(Dao,"Dao");var GameEvents=function(){function t(){}var e=(__define,t);e.prototype;return t.EVT_RETURN="EVT_RETURN",t.EVT_LOAD_PAGE="EVT_LOAD_PAGE",t.EVT_CLOSE_ABOUT="EVT_CLOSE_ABOUT",t.EVT_LOGIN_IN_SUCCESS="EVT_LOGIN_IN_SUCCESS",t.EVT_LOGIN_OUT_SUCCESS="EVT_LOGIN_OUT_SUCCESS",t.EVT_REFRESH_CUSTOMER="EVT_REFRESH_CUSTOMER",t}();egret.registerClass(GameEvents,"GameEvents");var GamePages=function(){function t(){}var e=(__define,t);e.prototype;return t.HOME="home",t.RANK="rank",t.TOOL="tool",t.AUCTION="auction",t.HELP="help",t.OFFLINEGOLD="offline gold",t.CHARGEBONUS="charge bonus",t.GIFT="gift",t}();egret.registerClass(GamePages,"GamePages");var Main=function(t){function e(){t.apply(this,arguments),this._isThemeLoadEnd=!1,this._isResourceLoadEnd=!1}__extends(e,t);var i=(__define,e),n=i.prototype;return n.createChildren=function(){t.prototype.createChildren.call(this),egret.TextField.default_fontFamily="STXihei",egret.Capabilities.isMobile||(this.stage.scaleMode=egret.StageScaleMode.SHOW_ALL,this.stage.orientation=egret.OrientationMode.AUTO),this.stage.registerImplementation("eui.IAssetAdapter",new AssetAdapter),this.stage.registerImplementation("eui.IThemeAdapter",new ThemeAdapter),application.init(this),application.channel.openScreen(this.stage),application.channel.track(TRACK_CATEGORY_RESOURCE,TRACK_ACTION_LOAD,"开始加载配置文件",1),RES.addEventListener(RES.ResourceEvent.CONFIG_COMPLETE,this.onConfigComplete,this),RES.loadConfig("resource/default.res.json","resource/")},n.onConfigComplete=function(t){application.channel.track(TRACK_CATEGORY_RESOURCE,TRACK_ACTION_LOAD,"开始加载皮肤主题资源",2),RES.removeEventListener(RES.ResourceEvent.CONFIG_COMPLETE,this.onConfigComplete,this);var e=new eui.Theme("resource/default.thm.json",this.stage);e.addEventListener(eui.UIEvent.COMPLETE,this.onThemeLoadComplete,this),RES.addEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.onResourceLoadComplete,this),RES.addEventListener(RES.ResourceEvent.GROUP_LOAD_ERROR,this.onResourceLoadError,this),RES.addEventListener(RES.ResourceEvent.GROUP_PROGRESS,this.onResourceProgress,this),RES.addEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,this.onItemLoadError,this),RES.loadGroup("loading")},n.onThemeLoadComplete=function(){this._isThemeLoadEnd=!0,this.createScene()},n.onResourceLoadComplete=function(t){var e=this;switch(t.groupName){case"loading":Toast.init(this,RES.getRes("toast-bg_png")),this._trueLoadingUI=new TrueLoadingUI,application.channel.track(TRACK_CATEGORY_RESOURCE,TRACK_ACTION_LOAD,"开始加载着陆页面",3),1==application.development?(application.loadCustomer(new Customer({id:"12345678",charge:0})),this.loadPage("home")):this.loadPage("landing");break;case"landing":this.addChild(new LandingUI),this.addEventListener(GameEvents.EVT_LOGIN_IN_SUCCESS,function(t){e.loadPage("home")},this);break;case"home":this._trueLoadingUI.removeBgImage(),this._isResourceLoadEnd=!0,this.createScene();break;default:console.log("	page["+t.groupName+"]ok:",egret.getTimer()),this.pageLoadedHandler(t.groupName)}},n.clearRESEvents=function(){},n.createScene=function(){this._isThemeLoadEnd&&this._isResourceLoadEnd&&this.startCreateScene()},n.onItemLoadError=function(t){console.warn("Url:"+t.resItem.url+" has failed to load")},n.onResourceLoadError=function(t){console.warn("Group:"+t.groupName+" has failed to load"),this.onResourceLoadComplete(t)},n.onResourceProgress=function(t){switch(t.groupName){case"loading":application.channel.setOpenScreenProgress(t.itemsLoaded,t.itemsTotal,"");break;default:this._trueLoadingUI.setProgress(t.itemsLoaded,t.itemsTotal)}},n.startCreateScene=function(){var t=this;this.pageLoadedHandler("home"),this.homeUI=new HomeUI,this.homeUI.addEventListener(GameEvents.EVT_LOAD_PAGE,function(e){t.loadPage(e.data)},this),this.addChild(this.homeUI)},n.loadPage=function(t){this.addChild(this._trueLoadingUI),this._idLoading=t,RES.loadGroup(t)},n.pageLoadedHandler=function(t){this._trueLoadingUI.parent&&this._trueLoadingUI.parent.removeChild(this._trueLoadingUI)},e}(eui.UILayer);egret.registerClass(Main,"Main");var ChannelEgret=function(t){function e(e){t.call(this,e),esa.EgretSA.init({gameId:"536E77465847413D",chanId:egret.getOption("egret.runtime.spid"),debug:!1})}__extends(e,t);var i=(__define,e),n=i.prototype;return n.login=function(){var t=this;return nest.easyuser.startup({egretAppId:90359,version:2,debug:!0},function(e){if(0==e.result){var i=nest.easyuser.getLoginTypes();if(i.length>0){var n=new LoginUI(i,function(e){nest.easyuser.login(e,function(e){0==e.result?t.rest("egret","login",{token:e.token}).then(function(e){t.resolve(e)},function(e){t.reject("登录失败")}):t.reject("登录失败")})});application.showUI(n)}else nest.easyuser.login({},function(e){0==e.result?t.rest("egret","login",{token:e.token}).then(function(e){t.resolve(e)},function(e){t.reject("登录失败")}):t.reject("登录失败")})}else t.reject("初始化失败")}),t.promise()},n.pay=function(t){var e=this,i={goodsId:t.goodsId,goodsNumber:t.goodsNumber,serverId:"1",ext:t.orderId};return nest.iap.pay(i,function(t){0==t.result?e.resolve(t):-1==t.result?e.reject("用户取消了支付"):e.reject("支付失败")}),e.promise()},n.share=function(t){var e=this;return nest.share.isSupport({},function(i){1==i.share?nest.share.share(t,function(t){0==t.result?e.resolve(""):-1==t.result?e.reject("取消了分享"):e.reject("分享失败")}):e.reject("当前平台不支持分享")}),e.promise()},n.attention=function(t){var e=this;return nest.app.isSupport({},function(t){1==t.attention?nest.app.attention({},function(t){0==t.result?e.resolve():-1==t.result?e.reject("取消了关注"):e.reject("关注失败")}):e.reject("当前平台不支持关注")}),e.promise()},n.track=function(e,i,n,s){switch(t.prototype.track.call(this,e,i,n,s),e){case TRACK_CATEGORY_PLAYER:return void(i==TRACK_ACTION_ENTER?esa.EgretSA.player.init({egretId:application.me.attrs.uid,level:1,serverId:1,playerName:application.me.attrs.name}):esa.EgretSA.onLeave());case TRACK_CATEGORY_DIAMOND:return void(i==TRACK_ACTION_INC?esa.EgretSA.onDiamondReward(s,n):esa.EgretSA.onDiamondUse(n,1,s));case TRACK_CATEGORY_GOLD:return void(i==TRACK_ACTION_INC?esa.EgretSA.onGoldOutput(s,n):esa.EgretSA.onGoldUse(n,1,s));case TRACK_CATEGORY_ACTIVITY:return void esa.EgretSA.onJoinActivity(n);case TRACK_CATEGORY_GUIDE:return void esa.EgretSA.newUsersGuideSet(s,n);case TRACK_CATEGORY_RESOURCE:return void esa.EgretSA.loadingSet(s,n)}},e}(Channel);egret.registerClass(ChannelEgret,"ChannelEgret"),window.onShareTimeline=function(){console.log("onShareTimeline"),application.channel.resolve()};var Channel1758=function(t){function e(e){t.call(this,e),this.url="http://wx.1758.com/static/common/js/hlmy1758.js"}__extends(e,t);var i=(__define,e),n=i.prototype;return n.share=function(t){var e=this;return e.require(e.url).then(function(){hlmy.setShareInfo()}),e.promise()},e}(ChannelEgret);egret.registerClass(Channel1758,"Channel1758");var Channel51H5=function(t){function e(e){t.call(this,e),this.appId="fg40249b"}__extends(e,t);var i=(__define,e),n=i.prototype;return n.loginQuietly=function(){var t=this;return egret.getOption("code")?(t.rest("51h5","login",{token:egret.getOption("code")}).then(function(e){t.resolve(e)},function(e){t.reject("登录失败")}),t.promise()):t.rejectedPromise()},n.login=function(){var t=this;return location.href="http://web.51h5.com/sso.html?appid="+this.appId+"&redirect="+encodeURIComponent(application.baseUrl+"/headline/bin-release/web/bin-release/index.html?wysj_channel=51h5"),t.promise()},n.pay=function(t){var e=this;return t.customerId=application.me.attrs.id,e.rest("51h5","51h5_pay_url",t).then(function(t){location.href=t},function(t){e.reject("支付失败")}),e.promise()},e}(Channel);egret.registerClass(Channel51H5,"Channel51H5"),window.huhuh5_loginCallBcak=function(t,e,i,n,s){var a={token:s,userId:t,userName:e,userImage:i,userPosition:n};console.log("huhuh5_loginCallBcak"+JSON.stringify(a));var r=application.channel;r.rest("huhuh5","login",a).then(function(t){r.resolve(t)},function(t){console.error("huhuh5_loginCallBcak login failed "),r.reject("登录失败")})},window.huhuh5_shareCallBcak=function(){application.channel.resolve()},window.huhuh5_payCallBcak=function(t,e){console.log("huhuh5_payCallBcak"+t+" "+e);var i=application.channel;"SUCCESS"==e?i.resolve():"CANCEL"==e?i.reject("取消了支付"):i.reject("支付失败")};var ChannelHuHuH5=function(t){function e(e){t.call(this,e),this.url="http://server.huhuh5.com:8081/3HGame/jsFile/h5Game.js"}__extends(e,t);var i=(__define,e),n=i.prototype;return n.login=function(){var t=this;return t.require(t.url).then(function(){h5Game.login("huhuh5_loginCallBcak")}),t.promise()},n.pay=function(t){var e=this,i={goodsId:t.goodsId,goodsName:t.goodsName,goodsNum:t.goodsNumber,money:t.money,orderId:t.orderId};return h5Game.pay(i,"huhuh5_payCallBcak"),e.promise()},n.share=function(t){var e=this;return h5Game.share("huhuh5_shareCallBcak"),e.promise()},n.track=function(e,i,n,s){switch(t.prototype.track.call(this,e,i,n,s),e){case TRACK_CATEGORY_PLAYER:return void(i==TRACK_ACTION_ENTER?h5Game.gameStart():h5Game.setGameStatus());case TRACK_CATEGORY_DIAMOND:return;case TRACK_CATEGORY_GOLD:return;case TRACK_CATEGORY_ACTIVITY:return;case TRACK_CATEGORY_GUIDE:return;case TRACK_CATEGORY_RESOURCE:return}},e}(Channel);egret.registerClass(ChannelHuHuH5,"ChannelHuHuH5");var AssetAdapter=function(){function t(){}var e=(__define,t),i=e.prototype;return i.getAsset=function(t,e,i){function n(n){e.call(i,n,t)}if(RES.hasRes(t)){var s=RES.getRes(t);s?n(s):RES.getResAsync(t,n,this)}else RES.getResByUrl(t,n,this,RES.ResourceItem.TYPE_IMAGE)},t}();egret.registerClass(AssetAdapter,"AssetAdapter",["eui.IAssetAdapter"]);var ThemeAdapter=function(){function t(){}var e=(__define,t),i=e.prototype;return i.getTheme=function(t,e,i,n){function s(t){e.call(n,t)}function a(e){e.resItem.url==t&&(RES.removeEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,a,null),i.call(n))}RES.addEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,a,null),RES.getResByUrl(t,s,this,RES.ResourceItem.TYPE_TEXT)},t}();egret.registerClass(ThemeAdapter,"ThemeAdapter",["eui.IThemeAdapter"]);var Army=function(){function t(t){this.attrs=t}var e=(__define,t),i=e.prototype;return i.save=function(){return application.dao.save("Army",this.attrs)},t.getHero=function(t){for(var e=0;e<t.length;e++)if(1==t[e].attrs.role)return t[e];return null},t}();egret.registerClass(Army,"Army");var Audit=function(){function t(){}var e=(__define,t);e.prototype;return t.claim=function(t){return t.claimed=1,application.dao.save("Audit",t)},t.hasRewards=function(t){for(var e=0;e<t.length;e++)if(t[e].rewards>0&&0==t[e].claimed)return!0;return!1},t.check=function(t){return Q.Promise(function(e,i,n){application.dao.fetch("Audit",{customer_id:t.attrs.id,category:"users",operator:"login",rewards:{$ne:0}},{order:"create_time DESC",limit:7}).then(function(t){var i=[];if(t.length>0){i.push(t[0]);for(var n=1;n<t.length&&t[n].rewards<t[n-1].rewards;n++)i.push(t[n])}e(i)},function(t){i(t)})})},t}();egret.registerClass(Audit,"Audit");var Character=function(){function t(t){this._properties=t}var e=(__define,t),i=e.prototype;return i.getProperties=function(){return this._properties},t.createAll=function(){for(var e=new Array,i=[{name:"Battle1",properties:{lives:20,golds:1e3,heroWinned:"Sunwukong"}},{name:"Battle2",properties:{lives:20,golds:1e4,heroWinned:"Zhubajie"}},{name:"Battle3",properties:{lives:20,golds:1e3}},{name:"Battle4",properties:{lives:20,golds:1e3}},{name:"Battle5",properties:{lives:20,golds:1e3,heroWinned:"Shaseng",boss:"Boss1"}},{name:"Battle6",properties:{lives:20,golds:1e3}},{name:"Battle7",properties:{lives:20,golds:1e3}},{name:"Battle8",properties:{lives:20,golds:1e3}},{name:"Battle9",properties:{lives:20,golds:1e3}},{name:"Battle10",properties:{lives:20,golds:1e3}},{name:"Battle11",properties:{lives:20,golds:1e3}},{name:"Battle12",properties:{lives:20,golds:1e3}},{name:"Battle13",properties:{lives:20,golds:1e3}},{name:"Battle14",properties:{lives:20,golds:1e3}},{name:"Battle15",properties:{lives:20,golds:1e3}},{name:"Sunwukong",properties:{hp:245,forceHigh:10,forceLow:6,resistance:5,armor:15,magicArmor:15,cureSpeed:1,moveSpeed:1,idleTicks:0,dyingTicks:application.frameRate,guardRadius:50,guardAltitude:[-1,0]}},{name:"Zhubajie",properties:{hp:245,forceHigh:10,forceLow:6,resistance:5,armor:15,magicArmor:15,cureSpeed:1,moveSpeed:1,idleTicks:0,dyingTicks:application.frameRate,guardRadius:50,guardAltitude:[-1,0]}},{name:"Shaseng",properties:{hp:245,forceHigh:10,forceLow:6,resistance:5,armor:15,magicArmor:15,cureSpeed:1,moveSpeed:1,idleTicks:0,dyingTicks:application.frameRate,guardRadius:50,guardAltitude:[-1,0]}},{name:"Reinforce",properties:{hp:100,force:6,armor:0,magicArmor:0,cureSpeed:1,moveSpeed:1,idleTicks:0,liveTicks:20*application.frameRate,dyingTicks:application.frameRate,guardRadius:40,guardAltitude:[-1,0]}},{name:"Warrior",properties:{hp:100,force:6,armor:0,magicArmor:0,cureSpeed:1,moveSpeed:1,idleTicks:0,liveTicks:8*application.frameRate,dyingTicks:application.frameRate,guardRadius:40,guardAltitude:[-1,0]}},{name:"Ghost",properties:{hp:40,forceHigh:6,forceLow:1,armor:0,magicArmor:0,cureSpeed:1,moveSpeed:1,idleTicks:0,dyingTicks:application.frameRate,guardRadius:40,guardAltitude:[-1,0]}},{name:"WhiteImpermanence",properties:{hp:80,forceHigh:10,forceLow:2,armor:20,magicArmor:0,cureSpeed:1,idleTicks:0,dyingTicks:application.frameRate,moveSpeed:1,guardRadius:40,guardAltitude:[-1,0]}},{name:"BlackImpermanence",properties:{hp:250,forceHigh:10,forceLow:5,armor:40,magicArmor:0,cureSpeed:1,idleTicks:0,dyingTicks:application.frameRate,moveSpeed:1,guardRadius:40,guardAltitude:[-1,0]}},{name:"Soldier1",properties:{hp:50,force:3,armor:0,magicArmor:0,cureSpeed:1,moveSpeed:1,guardRadius:50,guardAltitude:[-1,0],idleTicks:0,dyingTicks:application.frameRate}},{name:"Soldier2",properties:{hp:50,force:6,armor:0,magicArmor:3,cureSpeed:1,moveSpeed:1,guardRadius:50,guardAltitude:[-1,0],idleTicks:0,dyingTicks:application.frameRate}},{name:"Soldier3",properties:{hp:50,force:9,armor:0,magicArmor:6,cureSpeed:1,moveSpeed:1,guardRadius:50,guardAltitude:[-1,0],idleTicks:0,dyingTicks:application.frameRate}},{name:"Soldier4",properties:{hp:50,force:12,armor:0,magicArmor:9,cureSpeed:1,moveSpeed:1,guardRadius:50,guardAltitude:[-1,0],idleTicks:0,dyingTicks:application.frameRate}},{name:"Boss1",properties:{bonus:5,livesTaken:10,hp:[4e3,6e3,7800],forceHigh:60,forceLow:20,armor:0,magicArmor:0,cureSpeed:0,moveSpeed:1}},{name:"Enemy1",properties:{bonus:5,livesTaken:1,hp:[40,60,78],forceHigh:6,forceLow:2,armor:0,magicArmor:0,cureSpeed:0,moveSpeed:1,idleTicks:0,dyingTicks:application.frameRate}},{name:"Enemy2",properties:{bonus:16,livesTaken:1,hp:[140,200,260],forceHigh:10,forceLow:6,armor:20,magicArmor:0,cureSpeed:0,moveSpeed:1,idleTicks:0,dyingTicks:application.frameRate}},{name:"Enemy3",properties:{bonus:12,livesTaken:1,hp:[130,180,234],forceHigh:20,forceLow:10,armor:0,magicArmor:20,cureSpeed:0,moveSpeed:1,idleTicks:0,dyingTicks:application.frameRate}},{name:"Enemy4",properties:{bonus:5,livesTaken:1,hp:[25,35,46],forceHigh:3,forceLow:1,armor:0,magicArmor:0,cureSpeed:0,moveSpeed:1,idleTicks:0,dyingTicks:application.frameRate}},{name:"Enemy5",properties:{bonus:10,livesTaken:1,hp:[90,120,156],forceHigh:18,forceLow:12,armor:0,magicArmor:40,cureSpeed:0,moveSpeed:1,idleTicks:0,dyingTicks:application.frameRate}},{name:"Enemy6",properties:{bonus:24,livesTaken:2,hp:[260,360,468],forceHigh:28,forceLow:12,armor:50,magicArmor:0,cureSpeed:0,moveSpeed:1,idleTicks:0,dyingTicks:application.frameRate}},{name:"Enemy7",properties:{bonus:0,livesTaken:1,hp:[90,110,143],forceHigh:28,forceLow:12,armor:0,magicArmor:0,cureSpeed:0,moveSpeed:1,idleTicks:0,dyingTicks:application.frameRate}},{name:"Enemy8",properties:{bonus:130,livesTaken:5,hp:[1e3,1400,2600],forceHigh:69,forceLow:30,armor:0,magicArmor:0,cureSpeed:0,moveSpeed:1,idleTicks:0,dyingTicks:application.frameRate}},{name:"Enemy9",properties:{bonus:28,livesTaken:2,hp:[350,500,650],forceHigh:500,forceLow:350,armor:85,magicArmor:0,cureSpeed:0,moveSpeed:1,idleTicks:0,dyingTicks:application.frameRate}},{name:"Enemy10",properties:{bonus:8,livesTaken:1,hp:[60,80,104],forceHigh:0,forceLow:0,armor:0,magicArmor:0,cureSpeed:0,moveSpeed:1,altitude:1,idleTicks:0,dyingTicks:application.frameRate}},{name:"Enemy11",properties:{bonus:40,livesTaken:5,hp:[320,320,416],forceHigh:0,forceLow:0,armor:0,magicArmor:0,cureSpeed:0,moveSpeed:1,idleTicks:0,dyingTicks:application.frameRate}},{name:"Enemy12",properties:{bonus:10,livesTaken:1,hp:[100,100,130],forceHigh:8,forceLow:4,armor:0,magicArmor:0,cureSpeed:0,moveSpeed:1,altitude:-1,idleTicks:0,dyingTicks:application.frameRate}},{name:"Enemy13",properties:{bonus:100,livesTaken:1,hp:[700,1e3,1300],forceHigh:60,forceLow:30,armor:0,magicArmor:0,cureSpeed:0,moveSpeed:1,idleTicks:0,dyingTicks:application.frameRate}},{name:"Enemy14",properties:{bonus:8,livesTaken:1,hp:[80,80,104],forceHigh:20,forceLow:10,armor:0,magicArmor:0,cureSpeed:0,moveSpeed:1,idleTicks:0,dyingTicks:application.frameRate}},{name:"Enemy15",properties:{bonus:8,livesTaken:1,hp:[400,400,520],forceHigh:40,forceLow:20,armor:0,magicArmor:0,cureSpeed:0,moveSpeed:1,idleTicks:0,dyingTicks:application.frameRate}},{name:"Enemy16",properties:{bonus:15,livesTaken:1,hp:[200,200,260],forceHigh:16,forceLow:10,armor:0,magicArmor:0,cureSpeed:0,moveSpeed:1,idleTicks:0,dyingTicks:application.frameRate}},{name:"Enemy17",properties:{bonus:15,livesTaken:1,hp:[120,120,156],forceHigh:17,forceLow:10,armor:0,magicArmor:0,cureSpeed:0,moveSpeed:1,idleTicks:0,dyingTicks:application.frameRate}},{name:"Enemy18",properties:{bonus:50,livesTaken:1,hp:[420,600,780],forceHigh:22,forceLow:14,armor:80,magicArmor:0,cureSpeed:0,moveSpeed:1,idleTicks:0,dyingTicks:application.frameRate}},{name:"Enemy19",properties:{bonus:50,livesTaken:1,hp:[420,600,780],forceHigh:23,forceLow:14,armor:0,magicArmor:0,cureSpeed:0,moveSpeed:1,idleTicks:0,dyingTicks:application.frameRate}},{name:"Enemy20",properties:{bonus:50,livesTaken:1,hp:[420,600,780],forceHigh:24,forceLow:14,armor:0,magicArmor:80,cureSpeed:0,moveSpeed:1,idleTicks:0,dyingTicks:application.frameRate}},{name:"Enemy21",properties:{bonus:15,livesTaken:1,hp:[560,800,1040],forceHigh:30,forceLow:15,armor:0,magicArmor:0,cureSpeed:0,moveSpeed:1,idleTicks:0,dyingTicks:application.frameRate}},{name:"Enemy22",properties:{bonus:0,livesTaken:1,hp:[400,400,520],forceHigh:50,forceLow:30,armor:0,magicArmor:0,cureSpeed:0,moveSpeed:1,idleTicks:0,dyingTicks:application.frameRate}},{name:"Enemy23",properties:{bonus:160,livesTaken:5,hp:[1960,2800,3640],forceHigh:80,forceLow:40,armor:0,magicArmor:0,cureSpeed:0,moveSpeed:1,idleTicks:0,dyingTicks:application.frameRate}},{name:"Enemy24",properties:{bonus:25,livesTaken:1,hp:[160,250,325],forceHigh:80,forceLow:40,armor:0,magicArmor:0,cureSpeed:0,moveSpeed:1,idleTicks:0,dyingTicks:application.frameRate}},{name:"Enemy25",properties:{bonus:5,livesTaken:1,hp:[120,120,156],forceHigh:20,forceLow:10,armor:0,magicArmor:60,cureSpeed:0,moveSpeed:1,idleTicks:0,dyingTicks:application.frameRate}},{name:"Enemy26",properties:{bonus:10,livesTaken:1,hp:[400,400,520],forceHigh:60,forceLow:30,armor:0,magicArmor:60,cureSpeed:0,moveSpeed:1,idleTicks:0,dyingTicks:application.frameRate}},{name:"Enemy27",properties:{bonus:10,livesTaken:1,hp:[70,100,130],forceHigh:0,forceLow:0,armor:0,magicArmor:0,cureSpeed:0,moveSpeed:1,altitude:1,idleTicks:0,dyingTicks:application.frameRate}},{name:"Enemy28",properties:{bonus:100,livesTaken:1,hp:[300,500,650],forceHigh:0,forceLow:0,armor:0,magicArmor:0,cureSpeed:0,moveSpeed:1,altitude:1,idleTicks:0,dyingTicks:application.frameRate}},{name:"Enemy29",properties:{bonus:12,livesTaken:1,hp:[210,300,390],forceHigh:22,forceLow:8,armor:0,magicArmor:0,cureSpeed:0,moveSpeed:1,idleTicks:0,dyingTicks:application.frameRate}},{name:"Enemy30",properties:{bonus:50,livesTaken:1,hp:[560,600,780],forceHigh:34,forceLow:16,armor:0,magicArmor:0,cureSpeed:0,moveSpeed:1,idleTicks:0,dyingTicks:application.frameRate}},{name:"Enemy31",properties:{bonus:40,livesTaken:1,hp:[420,600,780],forceHigh:22,forceLow:18,armor:0,magicArmor:80,cureSpeed:0,moveSpeed:1,idleTicks:0,dyingTicks:application.frameRate}},{name:"Enemy32",properties:{bonus:25,livesTaken:1,hp:[280,280,336],forceHigh:42,forceLow:28,armor:0,magicArmor:40,cureSpeed:0,moveSpeed:1,idleTicks:0,dyingTicks:application.frameRate}},{name:"Enemy33",properties:{bonus:20,livesTaken:1,hp:[200,200,240],forceHigh:22,forceLow:18,armor:0,magicArmor:0,cureSpeed:0,moveSpeed:1,idleTicks:0,dyingTicks:application.frameRate}},{name:"Enemy34",properties:{hitType:HitType.damage,bonus:200,livesTaken:5,hp:[3080,4400,5280],forceHigh:120,forceLow:60,armor:0,magicArmor:0,cureSpeed:0,moveSpeed:1,idleTicks:0,dyingTicks:application.frameRate}},{name:"Enemy35",properties:{bonus:100,livesTaken:1,hp:[700,1e3,1200],forceHigh:66,forceLow:34,armor:0,magicArmor:0,cureSpeed:0,moveSpeed:1,idleTicks:0,dyingTicks:application.frameRate}},{name:"Enemy36",properties:{bonus:10,livesTaken:1,hp:[40,60,78],forceHigh:6,forceLow:2,armor:0,magicArmor:0,cureSpeed:0,moveSpeed:1,idleTicks:0,dyingTicks:application.frameRate}},{name:"SoldierTower1",properties:{force:3,guardRadius:160,price:100,upgradePrice:100}},{name:"SoldierTower2",properties:{force:6,guardRadius:160,price:200,upgradePrice:100}},{name:"SoldierTower3",properties:{force:9,guardRadius:160,price:300,upgradePrice:100}},{name:"SoldierTower4",properties:{force:12,guardRadius:160,price:530}},{name:"BombTower1",properties:{force:20,guardRadius:160,shootSpeed:Math.round(1.5*application.frameRate),price:120,upgradePrice:150}},{name:"BombTower2",properties:{force:30,guardRadius:180,shootSpeed:Math.round(1.5*application.frameRate),price:270,upgradePrice:150}},{name:"BombTower3",properties:{force:40,guardRadius:200,shootSpeed:Math.round(1.5*application.frameRate),price:320,upgradePrice:230}},{name:"BombTower4",properties:{force:30,guardRadius:220,shootSpeed:Math.round(1.5*application.frameRate),price:550}},{name:"ArrowTower1",properties:{force:8,guardRadius:160,price:70,upgradePrice:100}},{name:"ArrowTower2",properties:{force:12,guardRadius:200,price:170,upgradePrice:150}},{name:"ArrowTower3",properties:{force:16,guardRadius:240,price:320,upgradePrice:230}},{name:"ArrowTower4",properties:{force:24,guardRadius:200,price:550}},{name:"ArrowTower5",properties:{force:24,guardRadius:200,price:550}},{name:"MagicTower1",properties:{forceHigh:17,forceLow:9,shootSpeed:Math.round(1.5*application.frameRate),guardRadius:160,price:100,upgradePrice:160}},{name:"MagicTower2",properties:{forceHigh:43,forceLow:23,shootSpeed:Math.round(1.5*application.frameRate),guardRadius:180,price:160,upgradePrice:240}},{name:"MagicTower3",properties:{forceHigh:74,forceLow:40,shootSpeed:Math.round(1.5*application.frameRate),guardRadius:250,price:240,upgradePrice:300}},{name:"MagicTower4",properties:{forceHigh:70,forceLow:20,shootSpeed:Math.round(.8*application.frameRate),guardRadius:220,price:300}},{name:"Fireball",properties:{force:500,hitType:HitType.normal,hitRadius:50,moveSpeed:10,idleTicks:0,fightingTicks:10,dyingTicks:0}},{name:"Freeze",properties:{force:5,hitType:HitType.normal,hitRadius:800,moveSpeed:10,idleTicks:0,fightingTicks:10,dyingTicks:0,curseTicks:3*application.frameRate}},{name:"Thunder",properties:{force:500,hitType:HitType.damage,hitRadius:50,moveSpeed:10,idleTicks:0,fightingTicks:10,dyingTicks:0}},{name:"Bomb1",properties:{force:20,hitType:HitType.normal,hitRadius:50,moveSpeed:10,idleTicks:0,fightingTicks:10,dyingTicks:0}},{name:"Bomb2",properties:{force:30,hitType:HitType.normal,hitRadius:50,moveSpeed:10,idleTicks:0,fightingTicks:10,dyingTicks:0}},{name:"Bomb3",properties:{force:40,hitType:HitType.normal,hitRadius:50,moveSpeed:10,idleTicks:0,fightingTicks:10,dyingTicks:3*application.frameRate}},{name:"Bomb4",properties:{force:30,hitType:HitType.normal,hitRadius:50,moveSpeed:10,idleTicks:0,fightingTicks:10,dyingTicks:0}},{name:"ScorchedEarth",properties:{hitType:HitType.normal,moveSpeed:10,force:20,fightingTicks:0,idleTicks:0,dyingTicks:0}},{name:"ScorchedEarthBomblet",properties:{hitType:HitType.normal,moveSpeed:10,force:20,fightingTicks:0,idleTicks:0,dyingTicks:0}},{name:"Spike",properties:{hitType:HitType.normal,moveSpeed:10,force:20,fightingTicks:10,idleTicks:0,dyingTicks:0}},{name:"Arrow1",properties:{force:8,hitType:HitType.normal,moveSpeed:10,idleTicks:0,fightingTicks:10,dyingTicks:0}},{name:"Arrow4",properties:{force:24,hitType:HitType.normal,moveSpeed:10,idleTicks:0,fightingTicks:10,dyingTicks:0}},{name:"Arrow5",properties:{force:24,hitType:HitType.normal,moveSpeed:10,idleTicks:0,fightingTicks:10,dyingTicks:0}},{name:"Arrow6",properties:{force:24,hitType:HitType.normal,moveSpeed:10,idleTicks:0,fightingTicks:10,dyingTicks:0}},{name:"WeakCurse",properties:{force:5,hitType:HitType.magic,moveSpeed:0,idleTicks:0,fightingTicks:10,dyingTicks:0}},{name:"MiscastCurse",properties:{force:1,hitType:HitType.magic,moveSpeed:0,idleTicks:0,fightingTicks:10,dyingTicks:0}},{name:"Magic1",properties:{hitType:HitType.magic,moveSpeed:10,idleTicks:0,fightingTicks:10,dyingTicks:0}},{name:"Magic2",properties:{hitType:HitType.magic,moveSpeed:10,idleTicks:0,fightingTicks:10,dyingTicks:0}},{name:"Magic3",properties:{hitType:HitType.magic,moveSpeed:10,idleTicks:0,fightingTicks:10,dyingTicks:0}},{name:"Magic4",properties:{hitType:HitType.magic,moveSpeed:10,idleTicks:0,fightingTicks:10,dyingTicks:0}},{name:"BlackWater",properties:{hitType:HitType.magic,moveSpeed:0,force:5,idleTicks:0,dyingTicks:0}}],n=0;n<i.length;n++){var s=i[n];e[s.name]=new t(s.properties)}return e},t}();egret.registerClass(Character,"Character");var Customer=function(){function t(t){this.saveSeconds=0,this.attrs=t,this.attrs.earned_gold||(this.attrs.earned_gold=0),this.vip=Vip.create(this.attrs.charge),this.checkTicket()}var e=(__define,t),i=e.prototype;return i.resetTicket=function(t){if(this.attrs.vip=t,0==t||2==t)this.attrs.ticket="";
else{var e=new Date;e=new Date(e.getTime()+2592e6),this.attrs.ticket=e.toString()}this.saveNow()},i.checkTicket=function(){if(1==this.attrs.vip)if(this.attrs.ticket&&this.attrs.ticket.length>1){var t=new Date(this.attrs.ticket),e=new Date;t.getTime()<e.getTime()&&this.resetTicket(0)}else this.resetTicket(1)},i.save=function(){var t=(new Date).getTime()/1e3;t-this.saveSeconds>=120?this.saveNow():application.dao.dispatchEventWith("Customer",!0,this.attrs)},i.saveNow=function(){var t=this;t.saveSeconds=(new Date).getTime()/1e3;var e=t.attrs.charge;t.attrs.version=application.version,t.attrs.gold=Math.max(0,t.attrs.gold),t.attrs.earned_gold=Math.max(0,t.attrs.earned_gold),t.attrs.accumulated_gold=Math.max(t.attrs.accumulated_gold,t.attrs.gold),t.attrs.diamond=Math.max(0,t.attrs.diamond),application.dao.save("Customer",t.attrs).then(function(i){i.charge!=e&&(t.vip=Vip.create(i.charge))})},i.earnOfflineGold=function(){this.attrs.offline_gold>0&&(this.earnGold(this.attrs.offline_gold),this.saveNow())},i.earnGold=function(t){this.attrs.earned_gold+=t;var e=this.attrs.gold;this.attrs.gold+=this.attrs.earned_gold,e!=this.attrs.gold&&(this.attrs.accumulated_gold+=this.attrs.earned_gold,this.attrs.earned_gold=0),this.save()},i.useGold=function(t){this.attrs.earned_gold>t?this.attrs.earned_gold-=t:(this.attrs.gold=this.attrs.gold+this.attrs.earned_gold-t,this.attrs.earned_gold=0),this.saveNow()},i.usableGold=function(){return Math.max(0,this.attrs.gold+this.attrs.earned_gold)},i.buyOutput=function(t,e,i){t=Math.abs(t),e=Math.abs(e),i=Math.abs(i),this.attrs.diamond-=e,this.attrs.output+=i,this.useGold(t),this.attrs.output>=100&&Utility.log10(this.attrs.output)>Utility.log10(this.attrs.output-i)&&application.dao.fetch("Gift",{customer_id:this.attrs.id,category:7},{limit:1}).then(function(t){if(t.length>0){var e=t[0];e.locked=0,application.dao.save("Gift",e)}})},t.avatarUrl=function(t){if(t.avatar&&t.avatar.length>1)return t.avatar;var e=application.baseUrl+"headline/resource/art/";return 1==t.sex?e+"headM.png":2==t.sex?e+"headF.png":e+"head.png"},t}();egret.registerClass(Customer,"Customer");var GiftCategory;!function(t){t[t.Login=1]="Login",t[t.Online=2]="Online",t[t.Bid=3]="Bid",t[t.Ticket=4]="Ticket",t[t.Share=5]="Share",t[t.Charge=6]="Charge",t[t.Output=7]="Output",t[t.Attention=8]="Attention"}(GiftCategory||(GiftCategory={}));var Gift=function(){function t(){}var e=(__define,t);e.prototype;return t.notify=function(){application.dao.dispatchEventWith("Gift",!0,null)},t.hasGift=function(t){for(var e=0;e<t.length;e++)if(0==t[e].locked)return!0;return!1},t.check=function(t){return Q.Promise(function(e,i,n){application.dao.fetch("Gift",{customer_id:t.attrs.id},{order:"category ASC"}).then(function(n){if(n.length>0){for(var s=864e5,a=new Date,r=a.getDate(),o=0;o<n.length;o++){var h=n[o];if(0!=h.locked){if(h.last_pick_day)var l=new Date(h.last_pick_day).getDate();else{var c=new Date;c.setTime(a.getTime()-s);var l=c.getDate()}if(h.category!=GiftCategory.Charge&&h.category!=GiftCategory.Attention&&r!=l)if(h.category==GiftCategory.Online){var d=new Date(t.attrs.last_login),g=Math.floor((a.getTime()-d.getTime())/1e3);g>=3600?h.locked=0:(h.data=(3600-g).toString(),h.locked=1)}else if(h.category==GiftCategory.Ticket)t.checkTicket(),t.attrs.vip>0?h.locked=0:h.locked=1;else if(h.category==GiftCategory.Output){var u=+h.data,_=Utility.log10(u),p=Utility.log10(t.attrs.output);p>=_&&(h.locked=0)}else h.locked=1}}e(n)}else i("没有礼物")},function(t){i(t)})})},t}();egret.registerClass(Gift,"Gift");var Order=function(){function t(){}var e=(__define,t);e.prototype;return t.buy=function(e,i,n,s){var a=0==e.attrs.charge,r={customer_id:e.attrs.id,product:i,price:s,state:0};application.dao.save("Order",r).then(function(i){e.saveNow(),application.channel.pay({goodsId:n,goodsName:n,goodsNumber:"1",money:s,orderId:i.id}).then(function(t){},function(t){Toast.launch(t)}),t.checkOrderPayed(e,i,20,a)},function(t){Toast.launch("保存订单失败，请稍后再试")})},t.checkOrderPayed=function(e,i,n,s){Utility.delay(function(){application.dao.fetch("Order",{id:i.id,state:1},{}).then(function(a){if(a.length>0){var r=a[0];if("Diamond"==r.product){var o=400;5==r.price?o=1200:10==r.price?o=2600:30==r.price?o=9e3:100==r.price?o=36e3:500==r.price&&(o=2e5),e.attrs.diamond+=o,e.saveNow(),s?(Toast.launch("购买了"+o.toString()+"钻石,并获得了1500钻，1000k金币和1个奖章的首充礼物"),Gift.notify()):Toast.launch("购买了"+o.toString()+"钻石")}else application.dao.fetch("Order",{customer_id:e.attrs.id,product:"Ticket",state:1},{}).then(function(t){if("Ticket"==r.product){if(t.length>=2)var i=0;else var i=1;e.attrs.diamond+=2e3,e.attrs.metal+=i,e.resetTicket(1),s?(Toast.launch("购买了月票,并获得了1500钻，1000k金币和1个奖章的首充礼物"),Gift.notify()):Toast.launch("购买了月票")}else{if(t.length>=1)var i=2;else var i=3;e.attrs.diamond+=5e3,e.attrs.metal+=i,e.resetTicket(2),s?(Toast.launch("购买了VIP,并获得了1500钻，1000k金币和1个奖章的首充礼物"),Gift.notify()):Toast.launch("购买了VIP")}})}else n-=1,n>0?t.checkOrderPayed(e,i,n,s):Toast.launch("支付超时，请稍后再试")})},1e3)},t.charge=function(e,i,n){t.buy(e,"Diamond",i,n)},t.buyTicket=function(e){t.buy(e,"Ticket","ticket",19)},t.buyVIP=function(e){t.buy(e,"VIP","vip",49)},t}();egret.registerClass(Order,"Order");var Result=function(){function t(t){this.attrs=t}var e=(__define,t),i=e.prototype;return i.save=function(){application.dao.save("Result",this.attrs)},t}();egret.registerClass(Result,"Result");var Skill=function(){function t(t){this.attrs=t}var e=(__define,t),i=e.prototype;return i.save=function(){return application.dao.save("Skill",this.attrs)},t.get=function(t,e,i){for(var n=0;n<t.length;n++)if(t[n].attrs.claz==e&&t[n].attrs.skill==i)return t[n];return null},t}();egret.registerClass(Skill,"Skill");var Vip=function(){function t(t,e,i,n,s,a,r){this._level=0,this._charge=0,this._output=0,this._hit=10,this._time=0,this._upgrade=0,this._patch=0,this._level=t,this._charge=e,this._output=i,this._hit=n,this._time=s,this._upgrade=a,this._patch=r}var e=(__define,t),i=e.prototype;return t.create=function(e){for(var i=[[0,0,0,10,0,0,0],[1,2,.2,10,0,0,0],[2,10,.5,10,0,0,0],[3,20,1,15,0,0,.03],[4,30,2,20,0,0,.05],[5,50,5,25,.5,0,.1],[6,100,10,30,.7,.9,.12],[7,200,50,35,1,.99,.15],[8,300,100,40,1.2,.999,.17],[9,500,500,45,1.5,.9999,.2],[10,800,800,50,1.7,.99999,.23],[11,1e3,1e3,55,2,.999999,.25],[12,2e3,5e3,60,2.2,.9999999,.3],[13,5e3,5e4,65,2.5,.99999999,.4],[14,1e4,1e6,70,3,.999999999,.5],[15,15e3,1e7,75,3.5,.9999999999,.65]],n=null,s=0;s<i.length&&e>=i[s][1];s++)n=i[s];return new t(n[0],n[1],n[2],n[3],n[4],n[5],n[6])},i.getOutput=function(t){return t*(1+this._output)},i.getHit=function(t){return t*this._hit},i.getHitRatio=function(){return this._hit},i.getTime=function(t){return t*(1+this._time)},i.getUpgrade=function(t){return t*(1-this._upgrade)},i.getLevel=function(){return this._level},t}();egret.registerClass(Vip,"Vip");var EntityState;!function(t){t[t.idle=0]="idle",t[t.building=1]="building",t[t.moving=2]="moving",t[t.guarding=3]="guarding",t[t.fighting=4]="fighting",t[t.dying=5]="dying",t[t.dead=6]="dead"}(EntityState||(EntityState={}));var EntityDirection;!function(t){t[t.north=0]="north",t[t.northeast=1]="northeast",t[t.east=2]="east",t[t.southeast=3]="southeast",t[t.south=4]="south",t[t.southwest=5]="southwest",t[t.west=6]="west",t[t.northwest=7]="northwest"}(EntityDirection||(EntityDirection={}));var Entity=function(t){function e(){t.call(this),this._displays=new EntityDisplays,this._displaySprite=new egret.Sprite,this.addChild(this._displaySprite),this._sounds=new EntitySounds}__extends(e,t);var i=(__define,e),n=i.prototype;return n.initialize=function(t){this._direction=this._get(t,"direction",EntityDirection.east),this._state=this._get(t,"state",EntityState.idle),this._ticks=0,this._displaySprite.removeChildren(),this._clip=null,this._clipPlaying=!1},n._get=function(t,e,i){return t&&t[e]?t[e]:i},n.getClaz=function(){return egret.getQualifiedClassName(this)},n.getSuperClaz=function(){return egret.getQualifiedSuperclassName(this)},n.setCenterX=function(t){this.x=t-(this.width>>1)},n.setCenterY=function(t){this.y=t-(this.height>>1)},n.getCenterX=function(){return this.x+(this.width>>1)},n.getCenterY=function(){return this.y+(this.height>>1)},n.setBottomY=function(t){this.y=t-this.height},n.getBottomY=function(){return this.y+this.height},n.stain=function(){this.paint()},n.build=function(){this._do(EntityState.building)},n.move=function(){this._do(EntityState.moving)},n.guard=function(){this._do(EntityState.guarding)},n.fight=function(){this._do(EntityState.fighting)},n.kill=function(){this._do(EntityState.dying)},n.erase=function(){this._do(EntityState.dead)},n.active=function(){return this._state<EntityState.dying},n.dead=function(){return this._state==EntityState.dead},n.select=function(t){},n.deselect=function(){},n.update=function(){switch(this._state){case EntityState.idle:this._idle();break;case EntityState.building:this._building();break;case EntityState.moving:this._moving();break;case EntityState.guarding:this._guarding();break;case EntityState.fighting:this._fighting();break;case EntityState.dying:this._dying()}return this.dead()},n.paint=function(){if(this._state>EntityState.idle&&this._state<EntityState.dead){var t=this._render();"egret.MovieClip"==egret.getQualifiedClassName(t)?(this._clip=t,this._play()):this._act()}else this._clip&&(this._clip.stop(),this._clip.removeEventListener(egret.Event.COMPLETE,this._playCompleted,this)),this._displaySprite.removeChildren(),this._clip=null,this._clipPlaying=!1},n.addBitmap=function(t,e){var i=this._displays.addBitmap(t,e);return i&&i.width>0&&i.height>0&&(this.width=i.width,this.height=i.height),this},n.addClip=function(t,e){var i=this._displays.addClip(t,e);return i&&i.width>0&&i.height>0&&(this.width=i.width,this.height=i.height),this},n._play=function(){this._clip&&(this._clip.addEventListener(egret.Event.COMPLETE,this._playCompleted,this),this._clipPlaying=!0,this._clip.gotoAndPlay(0,1))},n._playCompleted=function(){this._act()?(this._clipPlaying=!0,this._clip.gotoAndPlay(0,1)):(this._clipPlaying=!1,this._clip&&this._clip.removeEventListener(egret.Event.COMPLETE,this._playCompleted,this))},n._render=function(t,i,n){void 0===t&&(t=0),void 0===i&&(i=0),void 0===n&&(n=0);var s=this._displays.getDisplay(this._direction,this._state,n);return s?("egret.MovieClip"==egret.getQualifiedClassName(s)?(this._displaySprite.x=(s.width>>1)+t,this._displaySprite.y=(s.height>>1)+i):(this._displaySprite.x=t,this._displaySprite.y=i),this.width!=s.width&&(this.x-=s.width-this.width>>1,this.y-=s.height-this.height>>1),this.width=s.width,this.height=s.height,this._displaySprite.removeChildren(),s.x=s.y=0,this._displaySprite.addChild(s)):console.error("display dosn't exist for "+this.getClaz()+" direction = "+e.directionName(this._direction)+" state = "+e.stateName(this._state)),s},n._do=function(t){if(t!=this._state){if(this._state==EntityState.dead||this._state==EntityState.dying&&t!=EntityState.dead)return;this._ticks=0,this._state=t,this._sounds.play(this._state),this.stain()}},n._turn=function(t){t!=this._direction&&(this._direction=t,this.stain())},n._act=function(){return!0},n._idle=function(){},n._building=function(){},n._moving=function(){},n._guarding=function(){},n._fighting=function(){},n._dying=function(){},n.within=function(t,i,n){if(e.intersect(this.x,this.y,this.width,this.height,t-n,i-n,n+n,n+n)){var s=this.getCenterX()-t,a=this.getBottomY()-i;return n*n>=s*s+a*a}return!1},n.collide=function(t){return e.intersect(t.x,t.y,t.width,t.height,this.x,this.y,this.width,this.height)},e.intersect=function(t,e,i,n,s,a,r,o){return!(t>s+r||s>t+i||e>a+o||a>e+n)},n._directionAt=function(t,i){return e.direction8(this.x,this.y,t,i)},e.random=function(t,e){return Math.random()*(e-t)+t},e.direction4=function(t,i,n,s){return e.direction(t,i,n,s,[45,135,225,315,360],[EntityDirection.east,EntityDirection.north,EntityDirection.west,EntityDirection.south,EntityDirection.east])},e.direction8=function(t,i,n,s){return e.direction(t,i,n,s,[22.5,67.5,112.5,157.5,202.5,247.5,292.5,337.5,360],[EntityDirection.east,EntityDirection.northeast,EntityDirection.north,EntityDirection.northwest,EntityDirection.west,EntityDirection.southwest,EntityDirection.south,EntityDirection.southeast,EntityDirection.east])},e.direction=function(t,e,i,n,s,a){var r=i-t,o=e-n,h=57.29578049044297*Math.atan2(o,r);0>h&&(h+=360);for(var l=0;l<s.length;l++)if(h<=s[l])return a[l]},e.directionName=function(t){var e=["north","northeast","east","southeast","south","southwest","west","northwest"];return e[t]},e.stateName=function(t){var e=["idle","building","moving","guarding","fighting","dying","dead"];return e[t]},e}(egret.Sprite);egret.registerClass(Entity,"Entity");var EntityDisplays=function(){function t(){this._displays=[],this._suitablities=[],this._default=null}var e=(__define,t),i=e.prototype;return i.addBitmap=function(e,i){var n=t.loadBitmap(e);return this._addAll(n,i),n},i.addClip=function(e,i){var n=t.loadClip(e);return this._addAll(n,i),n},t.loadBitmap=function(t){var e=new egret.Bitmap;return e.texture=RES.getRes(t),e},t.loadClip=function(t){var e=RES.getRes(t+"_json"),i=RES.getRes(t+"_png"),n=new egret.MovieClipDataFactory(e,i),s=new egret.MovieClip,a=n.generateMovieClipData(t);return s.movieClipData=a,s},i._addAll=function(t,e){if(e)if("Array"==egret.getQualifiedClassName(e))for(var i=0;i<e.length;i++)this._addOne(t,this._actionToIndex(e[i]));else this._addOne(t,this._actionToIndex(e));else this._default=t},i._addOne=function(e,i){for(var n=i>>3,s=i%8,a=EntityDirection.north;a<=EntityDirection.northwest;a++){var r=(a<<3)+s,o=this._suitablities[r]||0,h=t.suitablities[n>>1][a];h>o?(this._displays[r]=[e],this._suitablities[r]=h):h==o&&(this._displays[r]?this._displays[r].push(e):this._displays[r]=[e],this._suitablities[r]=h)}},i.has=function(t){for(var e=EntityDirection.north;e<=EntityDirection.northwest;e++){var i=(e<<3)+t;if(this._displays[i])return!0}return!1},i.getDisplay=function(t,e,i){void 0===i&&(i=0);var n=(t<<3)+e;if(!this._displays[n])return this._default;this._displays[n][i]||(i=0);var s=this._displays[n][i];return this._suitablities[n]%2==1?s.scaleX=-1:s.scaleX=1,s},i._actionToIndex=function(t){for(var e={idle:0,building:1,moving:2,guarding:3,fighting:4,dying:5,dead:6,north:0,northeast:1,east:2,southeast:3,south:4,southwest:5,west:6,northwest:7},i=0,n=t.split("-"),s=0;s<n.length;s++)i=(i<<3)+e[n[s]];return i},t.suitablities=[[6,4,2,0,0,0,2,4],[2,4,6,4,2,3,5,3],[0,0,2,4,6,4,2,0],[2,3,5,3,2,4,6,4]],t}();egret.registerClass(EntityDisplays,"EntityDisplays");var EntityPool=function(){function t(){this._entities=[],this._totalEntities=0}var e=(__define,t),i=e.prototype;return i._get=function(t){for(var e=0;e<this._entities.length;e++){var i=this._entities[e];if(t==i.getClaz())return this._entities.splice(e,1),i}return null},i.get=function(t,e){var i=application.characters[t],n=this._get(t);n?console.info("recycle entity "+t):(n=Object.create(window[t].prototype),n.constructor.apply(n),this._totalEntities++,console.info("total entities is "+this._totalEntities+" new entity "+t));var s={};if(i&&(s=i.getProperties()||{}),e)for(var a in e)e.hasOwnProperty(a)&&(s[a]=e[a]);return n.initialize(s),n},i.set=function(t){this._exists(t)||this._entities.push(t)},i._exists=function(t){for(var e=0;e<this._entities.length;e++)if(this._entities[e]==t)return!0;return!1},t}();egret.registerClass(EntityPool,"EntityPool");var EntitySounds=function(){function t(){this._sounds=[]}var e=(__define,t),i=e.prototype;return i.add=function(t,e){this._sounds[e]=t},i.play=function(t){var e=this._sounds[t];if(e){var i=RES.getRes(e);i.type=egret.Sound.EFFECT,i.play()}},t}();egret.registerClass(EntitySounds,"EntitySounds");var GuardRange=function(t){function e(){t.call(this)}__extends(e,t);var i=(__define,e),n=i.prototype;return n.initialize=function(e){t.prototype.initialize.call(this,e),this._guardRadius=this._get(e,"guardRadius",100)},n._idle=function(){this.move()},n.paint=function(){this.graphics.clear();var t=this._guardRadius,e=this._guardRadius/Math.sqrt(2);this.graphics.beginFill(39168,.2),this._drawEllipse(t,t,t,e),this.graphics.endFill(),this.graphics.lineStyle(1,10027008),this._drawEllipse(t,t,t,e),this.graphics.endFill()},n._drawEllipse=function(t,e,i,n){var s=.5522848,a=i*s,r=n*s;this.graphics.moveTo(t-i,e),this.graphics.cubicCurveTo(t-i,e-r,t-a,e-n,t,e-n),this.graphics.cubicCurveTo(t+a,e-n,t+i,e-r,t+i,e),this.graphics.cubicCurveTo(t+i,e+r,t+a,e+n,t,e+n),this.graphics.cubicCurveTo(t-a,e+n,t-i,e+r,t-i,e)},n._drawEllipse2=function(t,e,i,n){this.graphics.drawEllipse(t-i,e-i,i<<1,n<<1)},e}(Entity);egret.registerClass(GuardRange,"GuardRange");var MovableEntity=function(t){function e(){t.call(this)}__extends(e,t);var i=(__define,e),n=i.prototype;return n.initialize=function(e){t.prototype.initialize.call(this,e),this._moveSpeed=this._get(e,"moveSpeed",1),this._idleTicks=this._get(e,"idleTicks",0),this._dyingTicks=this._get(e,"dyingTicks",application.frameRate),this._readyComputeSteps()},n.moveTo=function(t,e){this._targetX=t,this._targetY=e,this._readyComputeSteps(),this._turn(this._directionAt(t,e))},n._readyComputeSteps=function(){this._stepX=0,this._stepY=0,this._totalSteps=-1,this._steps=0},n._moving=function(){return-1!=this._totalSteps||this._computeSteps(this.x,this.y,this._targetX,this._targetY)?void(this._moveOneStep()&&this._arrive()):void this._arrive()},n._moveOneStep=function(){return this._steps++,this._steps>this._totalSteps?!0:(this.x+=this._stepX,this.y+=this._stepY,!1)},n._ahead=function(t){var e=Math.min(this._totalSteps-this._steps,Math.round(t/(this._stepX+this._stepY)));return 0>=e?[this.x,this.y]:[this.x+this._stepX*e,this.y+this._stepY*e]},n._computeSteps=function(t,e,i,n){this._steps=0;var s=Math.abs(t-i),a=Math.abs(e-n);return s>=a?this._totalSteps=Math.floor(s/this._moveSpeed):this._totalSteps=Math.floor(a/this._moveSpeed),this._totalSteps>0?(this._stepX=s/this._totalSteps,t>i&&(this._stepX=0-this._stepX),this._stepY=a/this._totalSteps,e>n&&(this._stepY=0-this._stepY),!0):!1},n._idle=function(){this._ticks++,this._ticks>=this._idleTicks&&(this._displays.has(EntityState.building)?this.build():this.move())},n._dying=function(){this._ticks++,this._ticks>=this._dyingTicks&&this.erase()},e}(Entity);egret.registerClass(MovableEntity,"MovableEntity");var Base=function(t){function e(){t.call(this),this.touchEnabled=!0}__extends(e,t);var i=(__define,e),n=i.prototype;return n.initialize=function(e){t.prototype.initialize.call(this,e),this._guardX=this._get(e,"guardX",0),this._guardY=this._get(e,"guardY",0),this._tower=null,this._unused=!0,this.guard()},n.unused=function(){return this._unused},n.getGuardX=function(){return this._guardX},n.getGuardY=function(){return this._guardY},n.getTower=function(){return this._tower},n.setTower=function(t){this._tower&&(this._tower.erase(),this._parent&&this._parent.addChild(this)),this._tower=t,this._tower&&(this._tower.setCenterX(this.getCenterX()),this._tower.setCenterY(this.getCenterY()),this._tower.setBase(this),application.battle.addTower(this._tower),this.parent&&(this._parent=this.parent,this._parent.removeChild(this)),this._unused=!1)},n.erase=function(){t.prototype.erase.call(this),this._tower&&(this._tower.erase(),this._tower=null)},n.select=function(t){return t?(this.deselect(),!1):(application.showUI(new TowerMenuUI(this),application.battle.getUI(),this.getCenterX(),this.getCenterY()),!0)},n.deselect=function(){},e}(Entity);egret.registerClass(Base,"Base",["Selectable"]);var Base1=function(t){function e(){t.call(this),this.addBitmap("base1_png")}__extends(e,t);var i=(__define,e);i.prototype;return e}(Base);egret.registerClass(Base1,"Base1");var Base3=function(t){function e(){t.call(this),this.addBitmap("base3_png")}__extends(e,t);var i=(__define,e);i.prototype;return e}(Base);egret.registerClass(Base3,"Base3");var Base4=function(t){function e(){t.call(this),this.addBitmap("base4_png")}__extends(e,t);var i=(__define,e);i.prototype;return e}(Base);egret.registerClass(Base4,"Base4");var Base5=function(t){function e(){t.call(this),this.addBitmap("base5_png")}__extends(e,t);var i=(__define,e);i.prototype;return e}(Base);egret.registerClass(Base5,"Base5");var Battle=function(t){function e(){t.call(this),this._layers=[this._addLayer(),this._addLayer(),this._addLayer()],this.touchEnabled=!0,this.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this._touch,this),this._width=800,this._height=480}__extends(e,t);var i=(__define,e),n=i.prototype;return n.loadResource=function(t){var e=this;return e._options=t,Q.Promise(function(i,n,s){TiledMap.load("resource/art/sprites/battles/battle"+t.stage.toString()+".tmx",e._width,e._height).then(function(t){e._map=t,e.addChildAt(e._map,0),e._map.paint(),e._waves=new Waves(e._width,e._height),e._waves.setPaths(e._map.getPaths()),e._addWaves(),e._getEscapeArea(),i(e)},function(t){n(t)})})},n._getEscapeArea=function(){this._escapeX=0,this._escapeY=0,this._escapeHeight=0,this._escapeWidth=0;var t=this._map.getExits();if(t.length>0){var e=t[0][0],i=t[0][1],n=10;n>e?(this._escapeX=0,this._escapeY=0,this._escapeHeight=480,this._escapeWidth=n):e>480-n&&(this._escapeX=480-n,this._escapeY=0,this._escapeHeight=480,this._escapeWidth=n),n>i?(this._escapeX=0,this._escapeY=0,this._escapeHeight=n,this._escapeWidth=800):i>800-n&&(this._escapeX=0,this._escapeY=800-n,this._escapeHeight=n,this._escapeWidth=800)}},n.initialize=function(e){t.prototype.initialize.call(this,e),this._maxLives=this._get(e,"lives",20),this._maxGolds=this._get(e,"golds",1e3),this._heroWinned=this._get(e,"heroWinned",null),this._boss=this._get(e,"boss",null),this._bossLaunching=!1,this._difficulty=this._get(e,"difficulty",1)},n.build=function(){this._lives=this._maxLives,this._golds=this._maxGolds;for(var e=0;e<this._layers.length;e++)this._layers[e].removeChildren();this._soldiers=[],this._enemies=[],this._entities=[],this._bases=[],this._addBases(),this._addHeros(),this._addEffects(),this._result=new Result({customer_id:application.me.attrs.id,stage:this._options.stage,level:this._options.level,result:0,score:0,unused_bases:0,stars:0}),t.prototype.build.call(this)},n.fight=function(){this._waves.launchFirstWave(),t.prototype.fight.call(this)},n.lose=function(){this._result.attrs.result=2,this.erase()},n.win=function(){this._result.attrs.result=1;for(var t=0;t<this._bases.length;t++)this._bases[t].unused()&&this._result.attrs.unused_bases++;this._result.attrs.stars=this._difficulty;var e=this._heroWinned;if(e){var i=Skill.get(application.skills,e,0);i||(i=new Skill({customer_id:application.me.attrs.id,claz:e,skill:0,level:1}),i.save().then(function(){application.skills.push(i),Toast.launch("恭喜您，获得了英雄："+e)}))}this.erase()},n.readyUseTool=function(t){this._toolItem=t},n._touch=function(t){if(this._focus==t.target)this._focus.select(!0)||(this._focus=null);else if(t.target==this&&(this._toolItem||this._focus)){var e=Math.round(t.localX),i=Math.round(t.localY);if(this._map.walkable(e,i)){if(this._toolItem)this._toolItem.use(e,i),this._toolItem=null;else if(this._focus){var n=egret.getQualifiedSuperclassName(this._focus);if("Hero"==n)this._focus.guardAt(e,i);else if("SoldierTower"==n&&0==this._focus.guardAt(e,i))return void this.showDisableTip(e,i);this._focus.deselect(),this._focus=null}}else this.showDisableTip(e,i)}else{this._focus&&this._focus.deselect(),this._focus=t.target;try{this._focus.select(!1)||(this._focus=null)}catch(s){console.error("select failed! "+s.message),this._focus=null}}},n.unselect=function(t){this._focus==t&&(this._focus=null)},n.showDisableTip=function(t,e){var i=application.pool.get("DisableTip");i.setCenterX(t),i.setCenterY(e),this.addEntity(i)},n.getUI=function(){return this._ui},n.setUI=function(t){this._ui=t},n.getResult=function(){return this._result},n.incLives=function(t){this._lives+=t,this._lives<=0?this.lose():application.dao.dispatchEventWith("Battle",!0,{lives:this._lives})},n.getLives=function(){return this._lives},n.incGolds=function(t){this._golds=Math.max(0,this._golds+t),application.dao.dispatchEventWith("Battle",!0,{golds:this._golds})},n.getGolds=function(){return this._golds},n.getDifficulty=function(){return this._difficulty},n.getCurrentWave=function(){return this._waves.getCurrentWave()},n.getTotalWaves=function(){return this._waves.getTotalWaves()},n.getEntrances=function(){return this._map.getEntrances()},n.stain=function(){this.paint()},n._addLayer=function(){var t=new egret.Sprite;return t.x=0,t.y=0,t.width=800,t.height=480,this.addChild(t),t},n._addHeros=function(){var t=Army.getHero(application.armies);if(t)this._addHerosByName(t.attrs.claz);else{var e=Skill.get(application.skills,"Sunwukong",0);e&&this._addHerosByName(e.attrs.claz),t=new Army({customer_id:application.me.attrs.id,claz:"Sunwukong",role:1}),t.save().then(function(){application.armies.push(t)})}},n._addWaves=function(){},n._addBases=function(){this._addBasesByName("Base1")},n._addEffects=function(){},n._addBoss=function(){},n._addWave=function(t,e,i,n){this._waves.add(t,e,i,n)},n._addBasesByName=function(t){for(var e=this._map.getBases(),i=0;i<e.length;i++){var n=application.pool.get(t,{guardX:e[i][2],guardY:e[i][3]});n.setCenterX(e[i][0]),n.setCenterY(e[i][1]),this.addBase(n)}},n._addHerosByName=function(t){for(var e=this._map.getHeros(),i=0;i<e.length;i++){var n=application.pool.get(t,{guardX:e[i][0][0],guardY:e[i][0][1]});n.setCenterX(e[i][0][0]),n.setBottomY(e[i][0][1]),this.addSoldier(n)}},n.addWarriorsByName=function(t,e,i){for(var n=this._map.getHeros(),s=0;s<n.length;s++)for(var a=1;a<n[s].length;a++){i.guardX=n[s][a][0],i.guardY=n[s][a][1];var r=application.pool.get(t,i);r.x=n[s][0][0],r.y=n[s][0][1],this.addSoldier(r)}},n._addEffectByName=function(t,e,i,n){var s=application.pool.get(t,{direction:n});return s.x=e,s.y=i,this.addEntity(s),s},n._addBossByName=function(t,e){var i=application.pool.get(t,{paths:this._map.getPaths()[e],idleTicks:0});return this.addEnemy(i),i},n.erase=function(){t.prototype.erase.call(this),this._eraseEntities(this._bases);for(var e=0;e<this._soldiers.length;e++)this._soldiers[e].setCreator(null);this._eraseEntities(this._soldiers),this._eraseEntities(this._enemies),this._eraseEntities(this._entities)},n._eraseEntities=function(t){for(var e=t.length;e>0;){var i=t[--e];i.erase(),i.parent&&i.parent.removeChild(i)}},n.launchWave=function(t){this._waves.launchWave(t)},n._building=function(){this._updateEntities(this._soldiers),this._updateEntities(this._bases),this._updateEntities(this._entities)},n._fighting=function(){if(this._waves.launch()&&0==this._enemies.length){if(!this._boss)return void this.win();this._bossLaunching||(this._addBoss(),this._bossLaunching=!0)}this._updateEntities(this._soldiers),this._updateEntities(this._enemies),this._updateEntities(this._bases),this._updateEntities(this._entities)},n._updateEntities=function(t){for(var e=t.length;e>0;){var i=t[--e];i.update()&&(i.parent&&i.parent.removeChild(i),t.splice(e,1),application.pool.set(i))}},n.paint=function(){},n.findSoldier=function(t,e,i){for(var n=0;n<this._soldiers.length;n++)if(this._soldiers[n].reachable(t,e,i,[0]))return this._soldiers[n];return null},n.inEscapeArea=function(t){return this._escapeHeight>0?Entity.intersect(t.x,t.y,t.width,t.height,this._escapeX,this._escapeY,this._escapeWidth,this._escapeHeight):!1},n.getEnemies=function(){for(var t=[],e=0;e<this._enemies.length;e++){var i=this._enemies[e];this.inEscapeArea(i)||t.push(i)}return t},n.findEnemies=function(t,e,i,n){for(var s=[],a=0;a<this._enemies.length;a++){var r=this._enemies[a];r.reachable(t,e,i,n)&&!this.inEscapeArea(r)&&s.push(r)}return s},n.findEnemy=function(t,e,i,n){for(var s=0;s<this._enemies.length;s++){var a=this._enemies[s];if(a.reachable(t,e,i,n)&&!this.inEscapeArea(a))return a}return null},n.findSuitableEnemy=function(t,e,i,n){for(var s=null,a=0;a<this._enemies.length;a++){var r=this._enemies[a];if(r.reachable(t,e,i,n)&&!this.inEscapeArea(r)){if(0==r.totalSoldiers())return r;(null==s||s.totalSoldiers()>r.totalSoldiers())&&(s=r)}}return s},n.killAllEnemies=function(){for(var t=0;t<this._enemies.length;t++){var e=this._enemies[t];this.inEscapeArea(e)||this._enemies[t].kill()}},n.findSoldiers=function(t,e,i){for(var n=[],s=0;s<this._soldiers.length;s++){var a=this._soldiers[s];a.reachable(t,e,i,[0])&&n.push(a)}return n},n.findSuitableSoldier=function(t,e,i){for(var n=0;n<this._soldiers.length;n++){var s=this._soldiers[n];if(s.reachable(t,e,i,[0]))return s}return null},n.getMagicTowers=function(){for(var t=[],e=0;e<this._bases.length;e++){var i=this._bases[e],n=i.getTower();n&&"MagicTower"==n.getSuperClaz()&&t.push(n)}return t},n.findTowers=function(t,e,i){for(var n=[],s=0;s<this._bases.length;s++){var a=this._bases[s];a.getTower()&&a.within(t,e,i)&&n.push(a.getTower())}return n},n.addBase=function(t){this._bases.push(t),this._layers[0].addChild(t)},n.addTower=function(t){this._entities.push(t),this._layers[0].addChild(t)},n.addSoldier=function(t){this._soldiers.push(t),this._layers[1].addChild(t)},n.addEnemy=function(t){this._enemies.push(t),this._layers[1].addChild(t)},n.addBullet=function(t){this._entities.push(t),this._layers[2].addChild(t)},n.addEntity=function(t){this._entities.push(t),this._layers[2].addChild(t)},n.createSoldier=function(t){var e=t.clone({idleTicks:10*application.frameRate});return this.addSoldier(e),e},e}(Entity);egret.registerClass(Battle,"Battle",["SoldierCreator"]);var Battle1=function(t){function e(){t.apply(this,arguments)}__extends(e,t);var i=(__define,e),n=i.prototype;return n._addWaves=function(){},e}(Battle);egret.registerClass(Battle1,"Battle1");var Battle10=function(t){function e(){t.apply(this,arguments)}__extends(e,t);var i=(__define,e),n=i.prototype;return n._addEffects=function(){this._addEffectByName("River",0,290,EntityDirection.east),this._addEffectByName("Cock",120,70,EntityDirection.east),this._addEffectByName("Cock",540,400,EntityDirection.west)},n._addWaves=function(){},e}(Battle);egret.registerClass(Battle10,"Battle10");var Battle11=function(t){function e(){t.apply(this,arguments)}__extends(e,t);var i=(__define,e),n=i.prototype;return n._addEffects=function(){this._addEffectByName("River",0,290,EntityDirection.east),this._addEffectByName("Cock",120,70,EntityDirection.east),this._addEffectByName("Cock",540,400,EntityDirection.west)},n._addWaves=function(){},e}(Battle);egret.registerClass(Battle11,"Battle11");var Battle12=function(t){function e(){t.call(this),this._width=800,this._height=640}__extends(e,t);var i=(__define,e),n=i.prototype;return n._addEffects=function(){this._addEffectByName("River",0,290,EntityDirection.east),this._addEffectByName("Cock",120,70,EntityDirection.east),this._addEffectByName("Cock",540,400,EntityDirection.west)},n._addWaves=function(){this._addWave(0,"Wolf",5,0)},e}(Battle);egret.registerClass(Battle12,"Battle12");var Battle13=function(t){function e(){t.apply(this,arguments)}__extends(e,t);var i=(__define,e),n=i.prototype;return n._addEffects=function(){this._addEffectByName("River",0,290,EntityDirection.east),this._addEffectByName("Cock",120,70,EntityDirection.east),this._addEffectByName("Cock",540,400,EntityDirection.west)},n._addStandbys=function(){for(var t=this._map.getPaths(),e=[[0,"Wolf",1,0],[1,"Wolf",10,1],[2,"Hogs",10,0],[3,"Rhino",10,1],[4,"Wolf",10,0],[4,"Wolf",10,1]],i=0;i<e.length;i++){var n=e[i];this._waves.add(n[0],n[1],n[2],t[n[3]])}},e}(Battle);egret.registerClass(Battle13,"Battle13");var Battle14=function(t){function e(){t.apply(this,arguments)}__extends(e,t);var i=(__define,e),n=i.prototype;return n._addEffects=function(){this._addEffectByName("River",0,290,EntityDirection.east),this._addEffectByName("Cock",120,70,EntityDirection.east),this._addEffectByName("Cock",540,400,EntityDirection.west)},n._addStandbys=function(){for(var t=this._map.getPaths(),e=[[0,"Wolf",1,0],[1,"Wolf",10,1],[2,"Hogs",10,0],[3,"Rhino",10,1],[4,"Wolf",10,0],[4,"Wolf",10,1]],i=0;i<e.length;i++){var n=e[i];this._waves.add(n[0],n[1],n[2],t[n[3]])}},e}(Battle);egret.registerClass(Battle14,"Battle14");var Battle15=function(t){function e(){t.apply(this,arguments)
}__extends(e,t);var i=(__define,e),n=i.prototype;return n._addEffects=function(){this._addEffectByName("River",0,290,EntityDirection.east),this._addEffectByName("Cock",120,70,EntityDirection.east),this._addEffectByName("Cock",540,400,EntityDirection.west)},n._addWaves=function(){},e}(Battle);egret.registerClass(Battle15,"Battle15");var Battle2=function(t){function e(){t.apply(this,arguments)}__extends(e,t);var i=(__define,e),n=i.prototype;return n._addEffects=function(){this._addEffectByName("River",0,290,EntityDirection.east),this._addEffectByName("Cock",120,70,EntityDirection.east),this._addEffectByName("Cock",540,400,EntityDirection.west)},n._addWaves=function(){this._addWave(0,"Enemy4",5,0),this._addWave(0,"Enemy4",5,0),this._addWave(0,"Enemy4",10,0),this._addWave(1,"Enemy4",5,1),this._addWave(1,"Enemy4",10,1),this._addWave(1,"Enemy4",15,1),this._addWave(2,"Enemy4",4,0),this._addWave(2,"Enemy14",2,0),this._addWave(2,"Enemy4",4,0),this._addWave(2,"Enemy14",2,0),this._addWave(2,"Enemy14",4,0),this._addWave(2,"Enemy4",5,1),this._addWave(2,"Enemy4",5,1),this._addWave(2,"Enemy4",5,1),this._addWave(3,"Enemy8",3,1),this._addWave(3,"Enemy8",5,1),this._addWave(3,"Enemy8",6,1),this._addWave(3,"Enemy8",6,1),this._addWave(3,"Enemy8",8,1),this._addWave(3,"Enemy8",8,1),this._addWave(4,"Enemy4",2,0),this._addWave(4,"Enemy14",2,0),this._addWave(4,"Enemy4",2,0),this._addWave(4,"Enemy14",2,0),this._addWave(4,"Enemy14",5,0),this._addWave(4,"Enemy8",5,1),this._addWave(4,"Enemy8",5,1),this._addWave(4,"Enemy8",5,1),this._addWave(4,"Enemy8",5,1),this._addWave(5,"Enemy14",2,0),this._addWave(5,"Enemy4",3,0),this._addWave(5,"Enemy14",2,0),this._addWave(5,"Enemy4",9,0),this._addWave(5,"Enemy4",1,0),this._addWave(5,"Enemy14",1,0),this._addWave(5,"Enemy14",2,1),this._addWave(5,"Enemy4",3,1),this._addWave(5,"Enemy14",2,1),this._addWave(5,"Enemy4",9,1),this._addWave(5,"Enemy4",1,1),this._addWave(5,"Enemy14",1,1),this._addWave(6,"Enemy8",6,0),this._addWave(6,"Enemy8",6,0),this._addWave(6,"Enemy8",6,0),this._addWave(6,"Enemy8",6,0),this._addWave(6,"Enemy8",6,0),this._addWave(6,"Enemy8",6,1),this._addWave(6,"Enemy8",6,1),this._addWave(6,"Enemy8",6,1),this._addWave(6,"Enemy8",6,1),this._addWave(6,"Enemy8",6,1),this._addWave(7,"Enemy8",9,0),this._addWave(7,"Enemy8",6,0),this._addWave(7,"Enemy8",6,0),this._addWave(7,"Enemy8",6,0),this._addWave(7,"Enemy8",12,0),this._addWave(7,"Enemy14",5,1),this._addWave(7,"Enemy14",5,1),this._addWave(7,"Enemy4",10,1)},e}(Battle);egret.registerClass(Battle2,"Battle2");var Battle3=function(t){function e(){t.apply(this,arguments)}__extends(e,t);var i=(__define,e),n=i.prototype;return n._addBases=function(){this._addBasesByName("Base3")},n._addEffects=function(){this._addEffectByName("River",0,290,EntityDirection.east),this._addEffectByName("Cock",120,70,EntityDirection.east),this._addEffectByName("Cock",540,400,EntityDirection.west)},n._addWaves=function(){this._addWave(0,"Enemy4",1,0),this._addWave(1,"Enemy4",1,1)},e}(Battle);egret.registerClass(Battle3,"Battle3");var Battle4=function(t){function e(){t.apply(this,arguments)}__extends(e,t);var i=(__define,e),n=i.prototype;return n._addBases=function(){this._addBasesByName("Base4")},n._addEffects=function(){this._addEffectByName("River",0,290,EntityDirection.east),this._addEffectByName("Cock",120,70,EntityDirection.east),this._addEffectByName("Cock",540,400,EntityDirection.west)},n._addWaves=function(){this._addWave(0,"Enemy4",1,0),this._addWave(1,"Enemy4",1,1)},e}(Battle);egret.registerClass(Battle4,"Battle4");var Battle5=function(t){function e(){t.apply(this,arguments)}__extends(e,t);var i=(__define,e),n=i.prototype;return n._addBases=function(){this._addBasesByName("Base5")},n._addEffects=function(){this._addEffectByName("Frog",200,200,EntityDirection.west),this._lawn=this._addEffectByName("Lawn",200,200,EntityDirection.west)},n._addWaves=function(){this._addWave(0,"Enemy4",1,0),this._addWave(1,"Enemy4",1,1)},n._addBoss=function(){var t=this,e=application.pool.get("Boat");e.x=240,e.y=400,e.setCallback(function(e){t._addBossByName(t._boss,0),t._lawn.kill()}),t.addEntity(e)},e}(Battle);egret.registerClass(Battle5,"Battle5");var Battle6=function(t){function e(){t.apply(this,arguments)}__extends(e,t);var i=(__define,e),n=i.prototype;return n._addEffects=function(){this._addEffectByName("River",0,290,EntityDirection.east),this._addEffectByName("Cock",120,70,EntityDirection.east),this._addEffectByName("Cock",540,400,EntityDirection.west)},n._addWaves=function(){},e}(Battle);egret.registerClass(Battle6,"Battle6");var Battle7=function(t){function e(){t.apply(this,arguments)}__extends(e,t);var i=(__define,e),n=i.prototype;return n._addEffects=function(){this._addEffectByName("River",0,290,EntityDirection.east),this._addEffectByName("Cock",120,70,EntityDirection.east),this._addEffectByName("Cock",540,400,EntityDirection.west)},n._addWaves=function(){},e}(Battle);egret.registerClass(Battle7,"Battle7");var Battle8=function(t){function e(){t.apply(this,arguments)}__extends(e,t);var i=(__define,e),n=i.prototype;return n._addEffects=function(){this._addEffectByName("River",0,290,EntityDirection.east),this._addEffectByName("Cock",120,70,EntityDirection.east),this._addEffectByName("Cock",540,400,EntityDirection.west)},n._addWaves=function(){},e}(Battle);egret.registerClass(Battle8,"Battle8");var Battle9=function(t){function e(){t.apply(this,arguments)}__extends(e,t);var i=(__define,e),n=i.prototype;return n._addEffects=function(){this._addEffectByName("River",0,290,EntityDirection.east),this._addEffectByName("Cock",120,70,EntityDirection.east),this._addEffectByName("Cock",540,400,EntityDirection.west)},n._addWaves=function(){},e}(Battle);egret.registerClass(Battle9,"Battle9");var Queue=function(){function t(t,e){this._claz=t,this._count=e}var e=(__define,t),i=e.prototype;return i.launch=function(t,e){for(var i=application.frameRate<<1,n=0;n<this._count;n++){var s=application.pool.get(this._claz,{paths:this._randomPath(t),idleTicks:e+Math.random()*i});application.battle.addEnemy(s)}},i._randomPath=function(t){var e=30,i=30,n=Math.random()*e-e/2,s=Math.random()*e-e/2,a=[],r=Entity.direction4(t[0][0],t[0][1],t[1][0],t[1][1]);switch(r){case EntityDirection.east:a.push([-i,t[0][1]+n]);break;case EntityDirection.west:a.push([800+i,t[0][1]+n]);break;case EntityDirection.south:a.push([t[0][0]+s,-i]);break;case EntityDirection.north:a.push([t[0][0]+s,480+i])}for(var o=1;o<t.length-1;o++)a.push([t[o][0]+s,t[o][1]+n]);switch(r=Entity.direction4(t[t.length-2][0],t[t.length-2][1],t[t.length-1][0],t[t.length-1][1])){case EntityDirection.east:a.push([800,t[t.length-1][1]+n]);break;case EntityDirection.west:a.push([0,t[t.length-1][1]+n]);break;case EntityDirection.north:a.push([t[t.length-1][0]+s,0]);break;case EntityDirection.south:a.push([t[t.length-1][0]+s,480])}return a},t}();egret.registerClass(Queue,"Queue");var TiledMap=function(t){function e(e){t.call(this),this._map=e,this._parse()}__extends(e,t);var i=(__define,e),n=i.prototype;return n.paint=function(){this.addChild(this._map),this._map.render()},e.load=function(t,i,n){return Q.Promise(function(s,a,r){var o=new egret.URLLoader;o.dataFormat=egret.URLLoaderDataFormat.TEXT,o.addEventListener(egret.Event.COMPLETE,function(a){var r=egret.XML.parse(a.target.data),o=new tiled.TMXTilemap(i,n,r,t);o.once(tiled.TMXImageLoadEvent.ALL_IMAGE_COMPLETE,function(){Utility.delay(function(){s(new e(o))},100)},this,!0,0),o.getObjects()},t),o.addEventListener(egret.IOErrorEvent.IO_ERROR,function(t){a("加载地图失败")},this),o.load(new egret.URLRequest(t))})},n._xP2L=function(t){return Math.round(t/this._tileWidth)},n._yP2L=function(t){return Math.round(t/this._tileHeight)},n._markGrid=function(){this._grid=[];for(var t=0;t<=this._width;t++){this._grid[t]=[];for(var e=0;e<=this._height;e++)this._grid[t][e]=0}for(var e=0;e<this._paths.length;e++)for(var i=this._paths[e],t=0;t<i.length-1;t++){var n=this._xP2L(i[t][0]),s=this._yP2L(i[t][1]),a=this._xP2L(i[t+1][0]),r=this._yP2L(i[t+1][1]);if(n>a){var o=n;n=a,a=o}if(s>r){var o=s;s=r,r=o}for(var h=n;a>=h;h++)for(var l=s;r>=l;l++)this._markArea(h,l,1,1)}console.log(JSON.stringify(this._grid))},n._markArea=function(t,e,i,n){for(var s=t-i;t+i>=s;s++)for(var a=e-i;e+i>=a;a++)this._grid[s][a]==n||this._outOfBounds(s,a)||(this._grid[s][a]=n)},n._parse=function(){this._tileWidth=this._map.tilewidth,this._tileHeight=this._map.tileheight,this._width=this._map.width/this._tileWidth,this._height=this._map.height/this._tileHeight,this._paths=[],this._bases=[],this._heros=[],this._entrances=[],this._exits=[];for(var t=this._map.getObjects(),e=0;e<t.length;e++){var i=t[e],n=i.name,s=n.split("-");"path"==s[0]?this._paths.push(this._parsePath(i)):"base"==s[0]?this._bases=this._parseBases(i):"hero"==s[0]&&(this._heros=this._parseHeros(i))}this._markGrid()},n._parsePath=function(t){for(var e=[],i=0;i<t.getObjectCount();i++){var n=t.getObjectByIndex(i),s=n.name,a=[n.x,n.y],r=s.split("-");if("start"==r[0])e[0]=a,this._exists(this._entrances,a)||this._entrances.push(a);else if("end"==r[0])e[t.getObjectCount()-1]=a,this._exists(this._exits,a)||this._exits.push(a);else if(2==r.length&&"waypoint"==r[0]){var o=+r[1];e[o+1]=a}}return e},n._exists=function(t,e){for(var i=0;i<t.length;i++)if(t[i][0]==e[0]&&t[i][1]==e[1])return!0;return!1},n._parseBases=function(t){for(var e=[],i=0;i<t.getObjectCount();i++){var n=t.getObjectByIndex(i),s=n.name,a=s.split("-");if(2==a.length&&("base"==a[0]||"guard"==a[0])){var r=+a[1];e[r]||(e[r]=[]),"base"==a[0]?(e[r][0]=n.x,e[r][1]=n.y):(e[r][2]=n.x,e[r][3]=n.y)}}return e},n._parseHeros=function(t){for(var e=[],i=0,n=0;n<t.getObjectCount();n++){var s=t.getObjectByIndex(n),a=s.name,r=a.split("-");e[0]=e[0]||[],"start"==r[0]?e[0][0]=[s.x,s.y]:"warriors"==r[0]&&(i++,e[0][i]=[s.x,s.y])}return e},n.walkable=function(t,e){return t=this._xP2L(t),e=this._yP2L(e),!this._outOfBounds(t,e)&&1==this._grid[t][e]},n._outOfBounds=function(t,e){return!(t>=0&&t<=this._width&&e>=0&&e<=this._height)},n.getBases=function(){return this._bases},n.getHeros=function(){return this._heros},n.getPaths=function(){return this._paths},n.getEntrances=function(){return this._entrances},n.getExits=function(){return this._exits},e}(egret.Sprite);egret.registerClass(TiledMap,"TiledMap");var Waves=function(){function t(t,e){this._mapWidth=t,this._mapHeight=e,this._running=!1}var e=(__define,t),i=e.prototype;return i.setPaths=function(t){this._paths=t,this._enemies=[],this._currentWave=0,this._rounds=0,this._ticksBetweenWaves=40*application.frameRate,this._ticksBetweenQueues=4*application.frameRate,this._launchTicks=0,this._tips=[]},i.getCurrentWave=function(){return this._rounds*this._enemies.length+this._currentWave+1},i.getTotalWaves=function(){return this._enemies.length},i.add=function(t,e,i,n){this._enemies[t]=this._enemies[t]||[],this._enemies[t][n]=this._enemies[t][n]||[],this._enemies[t][n].push(new Queue(e,i))},i.launchFirstWave=function(){this._currentWave=0,this._running=!0,this.launchWave(this._currentWave),application.dao.dispatchEventWith("Battle",!0,{waves:this.getCurrentWave()})},i.launchWave=function(t){for(var e=0;e<this._tips.length;e++)this._tips[e].erase();this._tips=[],this._launchTicks=0;for(var i=0;i<this._enemies[t].length;i++){var n=0;if(this._enemies[t][i]){for(var s=0;s<this._enemies[t][i].length;s++)this._enemies[t][i][s].launch(this._paths[i],n),n+=this._ticksBetweenQueues;this._launchTicks<n&&(this._launchTicks=n)}}},i.launch=function(t){return this._running?(this._launchTicks--,0!=this._launchTicks?!1:0==this._nextWave(t)?!0:!1):!0},i._addWaveTips=function(t){for(var e=0;e<this._enemies[t].length;e++)if(this._enemies[t][e]){var i=application.pool.get("LaunchTip",{dyingTicks:this._ticksBetweenWaves,wave:t}),n=this._paths[e],s=Entity.direction4(n[0][0],n[0][1],n[1][0],n[1][1]);switch(s){case EntityDirection.east:i.x=20,i.y=n[0][1];break;case EntityDirection.west:i.x=this._mapWidth-i.width-20,i.y=n[0][1];break;case EntityDirection.north:i.x=n[0][0],i.y=this._mapHeight-i.height-20;break;case EntityDirection.south:i.x=n[0][0],i.y=20}application.battle.addEntity(i),this._tips.push(i)}},i._nextWave=function(t){if(this._currentWave<this._enemies.length-1)this._currentWave++;else{if(!t)return this._running=!1,!1;this._currentWave=0,this._rounds+=1}return this._addWaveTips(this._currentWave),application.dao.dispatchEventWith("Battle",!0,{waves:this.getCurrentWave()}),!0},t}();egret.registerClass(Waves,"Waves");var HitType;!function(t){t[t.normal=0]="normal",t[t.magic=1]="magic",t[t.damage=2]="damage"}(HitType||(HitType={}));var Bullet=function(t){function e(){t.apply(this,arguments)}__extends(e,t);var i=(__define,e),n=i.prototype;return e.shoot=function(t,e,i,n){var s=application.pool.get(i,n);return s.setShooter(t),s.setTarget(e),application.battle.addBullet(s),s},e["throw"]=function(t,e,i,n,s,a){var r=application.pool.get(s,a);return r.setCenterX(t),r.setCenterY(e),r.moveTo(i-r.width/2,n-r.height/2),application.battle.addBullet(r),r},e.blast=function(t,e,i){var n=application.pool.get(e,i);return n.setShooter(t),n.fight(),application.battle.addBullet(n),n},n.initialize=function(e){t.prototype.initialize.call(this,e),this._target=null,this._targetX=0,this._targetY=0,this._force=this._get(e,"force",10),this._hitType=this._get(e,"hitType",HitType.normal),this._fightingTicks=this._get(e,"fightingTicks",10),this._shooter=null},n.getForce=function(){return this._force},n.getHitType=function(){return this._hitType},n.setShooter=function(t){this._shooter=t,this.setCenterX(t.getMuzzleX()),this.setCenterY(t.getMuzzleY())},n.setTarget=function(t){this._target=t,this.moveTo(t.getCenterX(),t.getCenterY())},n.targetKilled=function(t){this._shooter&&this._shooter.targetKilled(t)},n._arrive=function(){this._displays.has(EntityState.fighting)?this.fight():this.erase(),this._hitTarget()},n._fighting=function(){this._ticks++,this._ticks>=this._fightingTicks&&this.erase()},e}(MovableEntity);egret.registerClass(Bullet,"Bullet");var CastBullet=function(t){function e(){t.call(this)}__extends(e,t);var i=(__define,e),n=i.prototype;return n.initialize=function(e){t.prototype.initialize.call(this,e),this._startX=0,this._startY=0,this._a=0,this._b=0,this._c=0},n._computeSteps=function(t,e,i,n){this._startX=t,this._startY=e,this._targetX=i,this._targetY=n,this._targetX>this._startX?this._parabola(this._startX,this._startY,this._targetX,this._targetY):this._targetX<this._startX?this._parabola(this._targetX,this._targetY,this._startX,this._startY):(this._a=0,this._b=0,this._c=0);var s=Math.sqrt(Math.pow(this._startY-this._targetY,2)+Math.pow(this._startX-this._targetX,2));return this._totalSteps=Math.ceil(s/this._moveSpeed),this._steps=1,this._totalSteps>0},n._parabola=function(t,e,i,n){this._a=2.5/Math.abs(i-t),this._b=(n-e)/(i-t)-this._a*(i+t),this._c=n-this._a*i*i-this._b*i},n._moveOneStep=function(){if(this._steps<this._totalSteps){var t=this._nextStep();return this.x=t[0],this.y=t[1],this._steps++,!1}return this.x=this._targetX,this.y=this._targetY,!0},n._nextStep=function(){var t=this._startX+(this._targetX-this._startX)*this._steps/this._totalSteps;if(this._a)var e=this._a*t*t+this._b*t+this._c;else var e=this._startY+(this._targetY-this._startY)*this._steps/this._totalSteps;return[t,e]},e}(Bullet);egret.registerClass(CastBullet,"CastBullet");var Arrow=function(t){function e(){t.apply(this,arguments)}__extends(e,t);var i=(__define,e),n=i.prototype;return n.initialize=function(e){t.prototype.initialize.call(this,e),this._missing=!1,this.rotation=-90},n._hitTarget=function(){this._target.active()?this._target.shootBy(this):this._missing=!0},n._fighting=function(){this._missing?t.prototype._fighting.call(this):this.erase()},n._moveOneStep=function(){var e=this.x,i=this.y,n=t.prototype._moveOneStep.call(this);if(this.x!=e||this.y!=i){var s=this.x-e,a=i-this.y;this.rotation=180*-Math.atan2(a,s)/Math.PI}return n},e}(CastBullet);egret.registerClass(Arrow,"Arrow");var Arrow1=function(t){function e(){t.call(this),this.addBitmap("arrow1_png")}__extends(e,t);var i=(__define,e);i.prototype;return e}(Arrow);egret.registerClass(Arrow1,"Arrow1");var Arrow4=function(t){function e(){t.call(this),this.addBitmap("arrow4_png")}__extends(e,t);var i=(__define,e);i.prototype;return e}(Arrow);egret.registerClass(Arrow4,"Arrow4");var Arrow5=function(t){function e(){t.call(this),this.addBitmap("arrow5_png")}__extends(e,t);var i=(__define,e);i.prototype;return e}(Arrow);egret.registerClass(Arrow5,"Arrow5");var Arrow6=function(t){function e(){t.call(this),this.addBitmap("arrow6_png")}__extends(e,t);var i=(__define,e);i.prototype;return e}(Arrow);egret.registerClass(Arrow6,"Arrow6");var Curse=function(t){function e(){t.apply(this,arguments)}__extends(e,t);var i=(__define,e),n=i.prototype;return n.initialize=function(e){t.prototype.initialize.call(this,e),this._hitRadius=this._get(e,"hitRadius",50),this._curseTicks=this._get(e,"curseTicks",application.frameRate<<2)},n._hitTarget=function(){for(var t=this._findEnemeies(),e=0;e<t.length;e++)this._hitEnemy(t[e],this._force,this._curseTicks)},n._findEnemeies=function(){return application.battle.findEnemies(this.getCenterX(),this.getCenterY(),this._hitRadius,[-1,0,1])},n._hitEnemy=function(t,e,i){},n._idle=function(){this.fight()},e}(Bullet);egret.registerClass(Curse,"Curse");var BlackWater=function(t){function e(){t.call(this),this.addClip("blackwater_fighting")}__extends(e,t);var i=(__define,e),n=i.prototype;return n._hitEnemy=function(t,e,i){t.black(e,i)},e}(Curse);egret.registerClass(BlackWater,"BlackWater");var Bomb=function(t){function e(){t.apply(this,arguments)}__extends(e,t);var i=(__define,e),n=i.prototype;return n.initialize=function(e){t.prototype.initialize.call(this,e),this._hitRadius=this._get(e,"hitRadius",50),this._skill=Skill.get(application.skills,"BombTower",0)},n._hitTarget=function(){for(var t=application.battle.findEnemies(this.getCenterX(),this.getBottomY(),this._hitRadius,[0]),e=0;e<t.length;e++)t[e].shootBy(this)},n._act=function(){return this._state==EntityState.building?(this.move(),!1):t.prototype._act.call(this)},e}(CastBullet);egret.registerClass(Bomb,"Bomb");var Bomb1=function(t){function e(){t.call(this),this.addClip("bomb123_fighting","east-fighting").addClip("bomb123_building","east-building").addBitmap("bomb1_moving_png","east-moving")}__extends(e,t);var i=(__define,e);i.prototype;return e}(Bomb);egret.registerClass(Bomb1,"Bomb1");var Bomb2=function(t){function e(){t.call(this),this.addClip("bomb123_fighting","east-fighting").addClip("bomb123_building","east-building").addBitmap("bomb2_moving_png","east-moving")}__extends(e,t);var i=(__define,e);i.prototype;return e}(Bomb);egret.registerClass(Bomb2,"Bomb2");var Bomb3=function(t){function e(){t.call(this),this.addBitmap("bomb3_moving_png","east-moving").addClip("bomb123_fighting","east-fighting").addClip("bomb123_building","east-building").addBitmap("bomb3_dying_png","east-dying")}__extends(e,t);var i=(__define,e),n=i.prototype;return n._fighting=function(){this._ticks++,this._ticks>=this._fightingTicks&&this.kill()},e}(Bomb);egret.registerClass(Bomb3,"Bomb3");var Bomb4=function(t){function e(){t.call(this),this.addClip("bomb4_east_fighting","east-fighting").addClip("bomb4_building","east-building").addClip("bomb4_south_moving","south-moving").addClip("bomb4_east_moving","east-moving")}__extends(e,t);var i=(__define,e);i.prototype;return e}(Bomb);egret.registerClass(Bomb4,"Bomb4");var Fireball=function(t){function e(){t.call(this),this.addClip("fireball_moving","east-moving").addClip("fireball_fighting","east-fighting")}__extends(e,t);var i=(__define,e),n=i.prototype;return n.initialize=function(e){t.prototype.initialize.call(this,e),this._hitRadius=this._get(e,"hitRadius",50),this._skill=Skill.get(application.skills,this.getClaz(),0),this._skill&&(1==this._skill.attrs.level&&(this._force=Math.round(1.05*this._force)),2==this._skill.attrs.level&&(this._fightingTicks=5*application.frameRate),3==this._skill.attrs.level&&(this._force=Math.round(.7*this._force)),4==this._skill.attrs.level&&(this._force=Math.round(1.05*this._force)),5==this._skill.attrs.level&&(this._force=Math.round(.5*this._force)),6==this._skill.attrs.level&&(this._force=Math.round(1.2*this._force)))},n._hitTarget=function(){for(var t=application.battle.findEnemies(this.x,this.y,this._hitRadius,[0]),e=0;e<t.length;e++)this._skill?2==this._skill.attrs.level&&3==this._skill.attrs.level?t[e].burn(20,5,!1,!0):this._skill.attrs.level>=4?t[e].burn(30,5,!1,!0):t[e].shootBy(this):t[e].shootBy(this)},e}(Bullet);egret.registerClass(Fireball,"Fireball");var Freeze=function(t){function e(){t.call(this),this.addClip("freeze_dying")}__extends(e,t);var i=(__define,e),n=i.prototype;return n._hitEnemy=function(t,e,i){t.frozen(e,i)},e}(Curse);egret.registerClass(Freeze,"Freeze");var Magic=function(t){function e(){t.apply(this,arguments)}__extends(e,t);var i=(__define,e),n=i.prototype;return n.initialize=function(e){t.prototype.initialize.call(this,e),this._skill=Skill.get(application.skills,"MagicTower",0),this._skill&&(3==this._skill.attrs.level&&(this._force=Math.round(1.05*this._force)),6==this._skill.attrs.level&&(this._force=Math.round(1.1*this._force)))},n._idle=function(){this._ticks++,this._ticks>=this._idleTicks&&this.build()},n._act=function(){return this._state==EntityState.building?(this.move(),!1):!0},n._hitTarget=function(){this._target.active()&&(this._skill&&3==this._skill.attrs.level&&Math.random()<=.1?this._target.damage(this._force):this._target.shootBy(this))},e}(Bullet);egret.registerClass(Magic,"Magic");var Magic1=function(t){function e(){t.call(this),this.addBitmap("magic_moving_png","east-moving").addClip("magic1_fighting","east-fighting").addClip("magic1_building","east-building")}__extends(e,t);var i=(__define,e);i.prototype;return e}(Magic);egret.registerClass(Magic1,"Magic1");var Magic2=function(t){function e(){t.call(this),this.addBitmap("magic_moving_png","east-moving").addClip("magic2_fighting","east-fighting").addClip("magic2_building","east-building")}__extends(e,t);var i=(__define,e);i.prototype;return e}(Magic);egret.registerClass(Magic2,"Magic2");var Magic3=function(t){function e(){t.call(this),this.addBitmap("magic_moving_png","east-moving").addClip("magic3_fighting","east-fighting").addClip("magic3_building","east-building")}__extends(e,t);var i=(__define,e);i.prototype;return e}(Magic);egret.registerClass(Magic3,"Magic3");var Magic4=function(t){function e(){t.call(this),this.addBitmap("magic_moving_png","east-moving").addClip("magic4_fighting","east-fighting").addClip("magic4_building","east-building")}__extends(e,t);var i=(__define,e);i.prototype;return e}(Magic);egret.registerClass(Magic4,"Magic4");var MiscastCurse=function(t){function e(){t.call(this),this.addClip("miscastcurse_dying","east-fighting")}__extends(e,t);var i=(__define,e),n=i.prototype;return n._hitEnemy=function(t,e,i){t.miscast(e,i)},e}(Curse);egret.registerClass(MiscastCurse,"MiscastCurse");var ScorchedEarth=function(t){function e(){t.call(this),this.addClip("scorchedearth_fighting",["south-moving","north-moving"])}__extends(e,t);var i=(__define,e),n=i.prototype;return n.setTarget=function(t){this._target=t,this.moveTo(this.getCenterX(),this.getCenterY()-100)},n._hitTarget=function(){var t=this._nextStep(),e=t[0]+(this.width>>1),i=t[1]+(this.height>>1),n=this._target.getCenterX(),s=this._target.getCenterY(),a=this._hitRadius>>1;Bullet["throw"](e,i,n,s-a,"ScorchedEarthBomblet",{hitRadius:a}),Bullet["throw"](e,i,n,s+a,"ScorchedEarthBomblet",{hitRadius:a}),Bullet["throw"](e,i,n-a,s,"ScorchedEarthBomblet",{hitRadius:a}),Bullet["throw"](e,i,n+a,s,"ScorchedEarthBomblet",{hitRadius:a})},e}(Bomb);egret.registerClass(ScorchedEarth,"ScorchedEarth");var ScorchedEarthBomblet=function(t){function e(){t.call(this),this.addClip("scorchedearthbomblet_fighting",["south-moving","north-moving"])}__extends(e,t);var i=(__define,e),n=i.prototype;return n._hitTarget=function(){for(var t=application.battle.findEnemies(this.getCenterX(),this.getCenterY(),this._hitRadius,[0,1]),e=0;e<t.length;e++)t[e].burn(this.getForce(),4*application.frameRate)},e}(Bomb);egret.registerClass(ScorchedEarthBomblet,"ScorchedEarthBomblet");var Spike=function(t){function e(){t.call(this),this.addClip("spike_fighting")}__extends(e,t);var i=(__define,e),n=i.prototype;return n._hitTarget=function(){this._target.active()&&this._target.kill()},e}(Bomb);egret.registerClass(Spike,"Spike");var Thunder=function(t){function e(){t.call(this),this.addClip("thunder_fighting","east-fighting")}__extends(e,t);var i=(__define,e),n=i.prototype;return n.initialize=function(e){t.prototype.initialize.call(this,e),this._hitRadius=this._get(e,"hitRadius",200)},n._hitTarget=function(){for(var t=application.battle.findEnemies(this.x,this.y,this._hitRadius,[0,1]),e=0;e<t.length;e++)t[e].shootBy(this)},e}(Bullet);egret.registerClass(Thunder,"Thunder");var WeakCurse=function(t){function e(){t.call(this),this.addClip("weakcurse_dying","east-fighting")}__extends(e,t);var i=(__define,e),n=i.prototype;return n._hitEnemy=function(t,e,i){t.weak(e,i)},e}(Curse);egret.registerClass(WeakCurse,"WeakCurse");var Effect=function(t){function e(){t.apply(this,arguments)}__extends(e,t);var i=(__define,e);i.prototype;return e}(Entity);egret.registerClass(Effect,"Effect");var AnimatingEffect=function(t){function e(){t.apply(this,arguments)}__extends(e,t);var i=(__define,e),n=i.prototype;return n.initialize=function(e){t.prototype.initialize.call(this,e),this._idleTicks=this._get(e,"idleTicks",10*Math.random()*application.frameRate),this._playTimes=0},n._idle=function(){this._ticks>this._idleTicks?this.move():this._ticks++},n._act=function(){return this._playTimes--,this._playTimes<=0?!1:!0},n._moving=function(){this._ticks%(application.frameRate<<3)==0&&(this._playTimes=5,this.stain()),this._ticks++},e}(Effect);egret.registerClass(AnimatingEffect,"AnimatingEffect");var Bird=function(t){function e(){t.call(this),this.addClip("brid_east_moving")}__extends(e,t);var i=(__define,e);i.prototype;return e}(AnimatingEffect);egret.registerClass(Bird,"Bird");var Boat=function(t){function e(){t.call(this),this.addClip("boat_east_moving")}__extends(e,t);var i=(__define,e),n=i.prototype;return n.initialize=function(e){t.prototype.initialize.call(this,e),this._callback=null},n.setCallback=function(t){this._callback=t},n._idle=function(){this.guard()},n._act=function(){return this._callback&&(this._callback(this),this._callback=null),!1},e}(Effect);egret.registerClass(Boat,"Boat");var Cock=function(t){function e(){t.call(this),this.addClip("cock_east_moving")}__extends(e,t);var i=(__define,e);i.prototype;return e}(AnimatingEffect);egret.registerClass(Cock,"Cock");var Frog=function(t){function e(){t.call(this),this.addClip("frog_east_moving")}__extends(e,t);var i=(__define,e);i.prototype;return e}(AnimatingEffect);egret.registerClass(Frog,"Frog");var Lawn=function(t){function e(){t.call(this),this.addBitmap("lawn_guarding_png").addClip("lawn_dying","east-dying")}__extends(e,t);var i=(__define,e),n=i.prototype;return n._idle=function(){this.guard()},n._act=function(){return this._state==EntityState.dying?(this.erase(),!1):!0},e}(Effect);egret.registerClass(Lawn,"Lawn");var River=function(t){function e(){t.call(this),this.addClip("river_east_moving")}__extends(e,t);var i=(__define,e);i.prototype;return e}(AnimatingEffect);egret.registerClass(River,"River");var Star=function(t){function e(){t.call(this),this.addClip("star_guarding")}__extends(e,t);var i=(__define,e);i.prototype;return e}(AnimatingEffect);egret.registerClass(Star,"Star");var Hp=function(t){function e(){t.call(this)}__extends(e,t);var i=(__define,e),n=i.prototype;return n.initialize=function(e){t.prototype.initialize.call(this,e);var i=this._get(e,"hp",[5,10,15]);if("Array"==egret.getQualifiedClassName(i)){var n=application.battle.getDifficulty();n<=i.length?this.setMaxHp(i[n-1]):this.setMaxHp(i[i.length-1])}else this.setMaxHp(i);this._cureSpeed=this._get(e,"cureSpeed",1)},n.setMaxHp=function(t){this._maxHp=t,this._hp=t},n.addMaxHp=function(t){this._maxHp+=t,this._hp+=t},n.getMaxHp=function(){return this._maxHp},n.getHp=function(){return this._hp},n.kill=function(){this.setHp(0)},n.cure=function(){this.setHp(this._hp+this._cureSpeed)},n.damage=function(t){return this.setHp(this._hp-t)},n.setHp=function(t){return t=Math.max(0,Math.min(this._maxHp,t)),t!=this._hp&&(this._hp=t,this.stain()),this._hp<=0},n.paint=function(){this.graphics.clear();var t=this._hp/this._maxHp;t>=.5?this.graphics.beginFill(60416):t>=.1?this.graphics.beginFill(16772503):this.graphics.beginFill(16711680),this.graphics.drawRect(0,0,t*this.width,this.height),this.graphics.endFill()},e}(Entity);egret.registerClass(Hp,"Hp");var NPC=function(t){function e(){t.call(this),this._abnormalDisplays=[new egret.Bitmap(RES.getRes("frozen_png")),new egret.Bitmap(RES.getRes("burn_png"))]}__extends(e,t);var i=(__define,e),n=i.prototype;return n.initialize=function(e){t.prototype.initialize.call(this,e),this._hp=application.pool.get("Hp",e),this._hp.height=3,this._hp.width=20,this._hp.x=0,this._hp.y=0,this.addChild(this._hp),this._hitSpeed=this._get(e,"hitSpeed",Math.round(.9*application.frameRate));var i=this._get(e,"force",10);this._forceHigh=this._get(e,"forceHigh",i),this._forceLow=this._get(e,"forceLow",i),this._armor=this._get(e,"armor",0),this._magicArmor=this._get(e,"magicArmor",0),this._resistance=this._get(e,"_resistance",0),this._altitude=this._get(e,"altitude",0),this._abnormalState=0,this._abnormalTicks=[-1,-1,-1,-1,-1,-1,-1],this._abnormalDamages=[0,0,0,0,0,0,0]},n.stand=function(t,e){this.setCenterX(t),this.setBottomY(e)},n.getForce=function(){return Entity.random(this._forceLow,this._forceHigh)},n.getMaxHp=function(){return this._hp.getMaxHp()},n.addMaxHp=function(t){this._hp.addMaxHp(t)},n.setArmor=function(t){this._armor=t},n.getArmor=function(){return this._armor},n.setMagicArmor=function(t){this._magicArmor=t},n.getMagicArmor=function(){return this._magicArmor},n.erase=function(){this._hp&&(this._hp.erase(),this._hp=null),t.prototype.erase.call(this)},n.shootBy=function(t){var e=this.damage(this._actualDamage(t.getForce(),t.getHitType()));return e&&t.targetKilled(this),e},n.hitBy=function(t){this.fight();var e=t.getForce();return this._resistance>0&&t.damage(Math.round(e*(100-this._resistance)/100)),this.damage(this._actualDamage(e,HitType.normal))},n._actualDamage=function(t,e){return e==HitType.normal?Math.round(t*(100-this._armor)/100):e==HitType.magic?Math.round(t*(100-this._magicArmor)/100):t},n.damage=function(t){return this.active()?this._hp.damage(t)?(this.kill(),!0):!1:!0},n.kill=function(){t.prototype.kill.call(this),this._stopAllAbnormals()},n.frozen=function(t,e,i,n){void 0===i&&(i=!0),void 0===n&&(n=!0),this._startAbnormal(1,t,e,i,n)},n.burn=function(t,e,i,n){void 0===i&&(i=!0),void 0===n&&(n=!0),this._startAbnormal(2,t,e,i,n)},n.weak=function(t,e,i,n){void 0===i&&(i=!0),void 0===n&&(n=!0),this._startAbnormal(3,t,e,i,n)},n.miscast=function(t,e,i,n){void 0===i&&(i=!0),void 0===n&&(n=!0),this._startAbnormal(4,t,e,i,n)},n.black=function(t,e,i,n){void 0===i&&(i=!0),void 0===n&&(n=!0),this._startAbnormal(5,t,e,i,n)},n.dizzy=function(t,e,i,n){void 0===i&&(i=!0),void 0===n&&(n=!0),this._startAbnormal(6,t,e,i,n)},n.attack=function(t,e,i,n){void 0===i&&(i=!0),void 0===n&&(n=!0),this._startAbnormal(7,t,e,i,n)},n._startAbnormal=function(t,e,i,n,s){this._abnormalTicks[t-1]<=0?(this._abnormalState++,this._abnormalTicks[t-1]=i,this._abnormalDamages[t-1]=e,1==t&&this._clip&&this._clip.stop(),s&&this._renderAbnormal(t)):(this._abnormalTicks[t-1]=Math.max(i,this._abnormalTicks[t-1]),n&&(this._abnormalDamages[t-1]+=e))},n._stopAbnormal=function(t){this._abnormalState--,1==t&&this._clip&&this._clip.gotoAndPlay(0,1),this._abnormalTicks[t-1]=-1,this._clearAbnormal(t)},n._clearAbnormal=function(t){var e=this._abnormalDisplays[t-1];if(e)try{this.removeChild(e)}catch(i){}},n._stopAllAbnormals=function(){for(var t=0;t<this._abnormalTicks.length;t++)this._abnormalTicks[t]>0&&(this._clearAbnormal(t+1),this._abnormalTicks[t]=-1);
this._abnormalState=0},n._renderAbnormal=function(t){var e=this._abnormalDisplays[t-1];e&&(e.x=this.width-e.width>>1,e.y=this.height-e.height,this.addChild(e))},n.update=function(){if(0==this._abnormalState)return t.prototype.update.call(this);for(var e=0;e<this._abnormalTicks.length;e++)if(this._abnormalTicks[e]>0){if(this._abnormalTicks[e]%application.frameRate==0&&this.damage(this._abnormalDamages[e]))return t.prototype.update.call(this);this._abnormalTicks[e]--}else 0==this._abnormalTicks[e]&&this._stopAbnormal(e+1);return this._abnormalTicks[0]>0?!1:t.prototype.update.call(this)},n.reachable=function(t,e,i,n){return this.active()&&this._altitude in n&&this.within(t,e,i)},n._face=function(t){this._turn(this._directionAt(t.x,t.y))},n._readyFight=function(){return this._ticks%this._hitSpeed==0},n._idle=function(){this._ticks++,this._ticks>=this._idleTicks&&(this.move(),this._hp&&this._hp.move())},n._fighting=function(){this._readyFight()&&!this._clipPlaying&&this._play(),this._ticks++},n._act=function(){return this._state==EntityState.fighting?(this._hitOpponents(),!1):this._state==EntityState.dying?!1:!0},n._render=function(e,i,n){return void 0===e&&(e=0),void 0===i&&(i=0),void 0===n&&(n=0),this._renderHp(),t.prototype._render.call(this,0,5,0)},n._renderHp=function(){if(this._hp){var t=Math.min(0,this.width-this._hp.width>>1);t!=this._hp.x&&(this._hp.x=t)}},e}(MovableEntity);egret.registerClass(NPC,"NPC");var Enemy=function(t){function e(){t.apply(this,arguments)}__extends(e,t);var i=(__define,e),n=i.prototype;return n.initialize=function(e){t.prototype.initialize.call(this,e),this._bonus=this._get(e,"bonus",10),this._livesTaken=this._get(e,"livesTaken",1),this._soldiers=[null,null,null,null,null,null],this._totalSoldiers=0,this._paths=this._get(e,"paths",10),this._path=0,this._nextPath()},n.addSoldier=function(t){for(var e=0;e<this._soldiers.length;e++)if(this._soldiers[e]==t)return;var i=this._getHitPosition(t);return this._soldiers[i]=t,this._totalSoldiers++,this._state==EntityState.moving&&(this.guard(),this._face(t)),i},n._getHitPosition=function(t){if(t.x<this.x){for(var e=0;3>e;e++)if(null==this._soldiers[e])return e;for(var e=3;6>e;e++)if(null==this._soldiers[e])return e}else{for(var e=3;6>e;e++)if(null==this._soldiers[e])return e;for(var e=0;3>e;e++)if(null==this._soldiers[e])return e}return-1},n.totalSoldiers=function(){return this._totalSoldiers},n.firstSoldier=function(){for(var t=0;t<this._soldiers.length;t++)if(this._soldiers[t])return this._soldiers[t];return null},n.rmvSoldier=function(t){for(var e=0;e<this._soldiers.length;e++)this._soldiers[e]==t&&(this._soldiers[e]=null,this._totalSoldiers--);this._totalSoldiers>0?this._face(this.firstSoldier()):this._moveAgain()},n._nextPath=function(){if(this._path<this._paths.length-1){var t=this._paths[this._path];this.setCenterX(t[0]),this.setBottomY(t[1]),this._path++;var e=this._paths[this._path];return this._computeSteps(t[0],t[1],e[0],e[1]),this._turn(this._directionAt(e[0],e[1])),!0}return!1},n.kill=function(){t.prototype.kill.call(this),application.battle.incGolds(this._bonus)},n._moveAgain=function(){this._turn(this._directionAt(this._paths[this._path][0],this._paths[this._path][1])),this.move()},n._moving=function(){this._moveOneStep()&&!this._nextPath()&&this._arrive()},n._arrive=function(){application.battle.incLives(-this._livesTaken),this.erase()},n._fighting=function(){t.prototype._fighting.call(this);for(var e=0;e<this._soldiers.length;e++)this._soldiers[e]&&!this._soldiers[e].active()&&this.rmvSoldier(this._soldiers[e])},n._hitOpponents=function(){var t=this.firstSoldier();t?t.hitBy(this)&&this.rmvSoldier(t):this._moveAgain()},n._born=function(t,e,i){var n=application.pool.get(t);return n.stand(e,i),application.battle.addEnemy(n),n},e}(NPC);egret.registerClass(Enemy,"Enemy");var Enemy1=function(t){function e(){t.call(this),this.addClip("enemy1_east_moving",["east-moving","east-guarding"]).addClip("enemy1_south_moving",["south-moving","south-guarding"]).addClip("enemy1_north_moving",["north-moving","north-guarding"]).addClip("enemy1_dying","east-dying").addClip("enemy1_east_fighting","east-fighting")}__extends(e,t);var i=(__define,e);i.prototype;return e}(Enemy);egret.registerClass(Enemy1,"Enemy1");var Enemy10=function(t){function e(){t.call(this),this.addClip("enemy10_east_moving",["east-moving","east-guarding"]).addClip("enemy10_south_moving",["south-moving","south-guarding"]).addClip("enemy10_north_moving",["north-moving","north-guarding"]).addClip("enemy10_dying","east-dying").addClip("enemy10_east_fighting","east-fighting")}__extends(e,t);var i=(__define,e);i.prototype;return e}(Enemy);egret.registerClass(Enemy10,"Enemy10");var Enemy11=function(t){function e(){t.call(this),this.addClip("enemy11_east_moving",["east-moving","east-guarding"]).addClip("enemy11_south_moving",["south-moving","south-guarding"]).addClip("enemy11_north_moving",["north-moving","north-guarding"]).addClip("enemy11_dying","east-dying").addClip("enemy11_east_fighting","east-fighting")}__extends(e,t);var i=(__define,e),n=i.prototype;return n.erase=function(){this._born("Enemy10",this.x,this.y),t.prototype.erase.call(this)},e}(Enemy);egret.registerClass(Enemy11,"Enemy11");var Enemy12=function(t){function e(){t.call(this),this.addClip("enemy12_east_moving",["east-moving","east-guarding"]).addClip("enemy12_south_moving",["south-moving","south-guarding"]).addClip("enemy12_north_moving",["north-moving","north-guarding"]).addClip("enemy12_dying","east-dying").addClip("enemy12_east_fighting","east-fighting")}__extends(e,t);var i=(__define,e);i.prototype;return e}(Enemy);egret.registerClass(Enemy12,"Enemy12");var ShootEnemy=function(t){function e(){t.call(this),this._bulletClaz="Arrow1"}__extends(e,t);var i=(__define,e),n=i.prototype;return n.initialize=function(e){t.prototype.initialize.call(this,e),this._shootRadius=this._get(e,"shootRadius",50)},n.targetKilled=function(t){},n.getMuzzleX=function(){return this._targetX>this.x?this.x+this.width:this.x},n.getMuzzleY=function(){return this.y},n._moving=function(){var e=application.battle.findSuitableSoldier(this.getCenterX(),this.getCenterY(),this._shootRadius);e?(this.addSoldier(e),this.fight()):t.prototype._moving.call(this)},n._hitOpponents=function(){var t=this.firstSoldier();t&&t.active()?Bullet.shoot(this,t,this._bulletClaz,{force:this.getForce()}):this.rmvSoldier(t)},e}(Enemy);egret.registerClass(ShootEnemy,"ShootEnemy",["Shooter"]);var Enemy13=function(t){function e(){t.call(this),this.addClip("enemy13_east_moving",["east-moving","east-guarding"]).addClip("enemy13_south_moving",["south-moving","south-guarding"]).addClip("enemy13_north_moving",["north-moving","north-guarding"]).addClip("enemy13_dying","east-dying").addClip("enemy13_east_fighting","east-fighting")}__extends(e,t);var i=(__define,e),n=i.prototype;return n.initialize=function(e){t.prototype.initialize.call(this,e),this._summonTicks=this._get(e,"summonTicks",3*application.frameRate)},n._moving=function(){if(t.prototype._moving.call(this),this._ticks++,this._ticks%this._summonTicks==0){var e=this._ahead(10);this._born("Enemy7",e[0],e[1])}},e}(ShootEnemy);egret.registerClass(Enemy13,"Enemy13");var Enemy14=function(t){function e(){t.call(this),this.addClip("enemy14_dying","east-dying").addClip("enemy14_east_moving",["east-moving","east-guarding"]).addClip("enemy14_north_moving",["north-moving","north-guarding"]).addClip("enemy14_south_moving",["south-moving","south-guarding"]).addClip("enemy14_east_fighting","east-fighting")}__extends(e,t);var i=(__define,e);i.prototype;return e}(Enemy);egret.registerClass(Enemy14,"Enemy14");var Enemy15=function(t){function e(){t.call(this),this.addClip("enemy15_east_moving",["east-moving","east-guarding"]).addClip("enemy15_south_moving",["south-moving","south-guarding"]).addClip("enemy15_north_moving",["north-moving","north-guarding"]).addClip("enemy15_dying","east-dying").addClip("enemy15_east_fighting","east-fighting")}__extends(e,t);var i=(__define,e),n=i.prototype;return n.initialize=function(e){t.prototype.initialize.call(this,e),this._summonTicks=this._get(e,"summonTicks",5*application.frameRate)},n._moving=function(){if(t.prototype._moving.call(this),this._ticks++,this._ticks%this._summonTicks){var e=this._ahead(2);this._born("Enemy36",e[0]+5,e[1]+5),this._born("Enemy36",e[0],e[1]),this._born("Enemy36",e[0]-5,e[1]-5)}},e}(Enemy);egret.registerClass(Enemy15,"Enemy15");var Enemy16=function(t){function e(){t.call(this),this.addClip("enemy16_east_moving",["east-moving","east-guarding"]).addClip("enemy16_south_moving",["south-moving","south-guarding"]).addClip("enemy16_north_moving",["north-moving","north-guarding"]).addClip("enemy16_dying","east-dying").addClip("enemy16_east_fighting","east-fighting")}__extends(e,t);var i=(__define,e),n=i.prototype;return n.update=function(){if(this.active())for(var e=application.battle.findSoldiers(this.getCenterX(),this.getCenterY(),80),i=0;i<e.length;i++)e[i].dead()&&this.addMaxHp(50);return t.prototype.update.call(this)},e}(Enemy);egret.registerClass(Enemy16,"Enemy16");var Enemy17=function(t){function e(){t.call(this),this.addClip("enemy17_east_moving",["east-moving","east-guarding"]).addClip("enemy17_south_moving",["south-moving","south-guarding"]).addClip("enemy17_north_moving",["north-moving","north-guarding"]).addClip("enemy17_dying","east-dying").addClip("enemy17_east_fighting","east-fighting")}__extends(e,t);var i=(__define,e),n=i.prototype;return n._hitOpponents=function(){t.prototype._hitOpponents.call(this);var e=this.firstSoldier();e&&e.black(5,2*application.frameRate,!1)},e}(ShootEnemy);egret.registerClass(Enemy17,"Enemy17");var GroupEnemy=function(t){function e(){t.apply(this,arguments)}__extends(e,t);var i=(__define,e),n=i.prototype;return n.initialize=function(e){t.prototype.initialize.call(this,e),this._group=[]},n._existed=function(t,e){for(var i=0;i<t.length;i++)if(e==t[i])return!0;return!1},n.update=function(){if(this.active()){for(var e=application.battle.findEnemies(this.getCenterX(),this.getCenterY(),80,[-1,0,1]),i=0;i<e.length;i++){var n=e[i];this._existed(this._group,n)||this._enterGroup(n)}for(var i=0;i<this._group.length;i++){var n=this._group[i];this._existed(e,n)||n.active()&&this._leaveGroup(n)}this._group=e}else{for(var i=0;i<this._group.length;i++)this._group[i].active()&&this._leaveGroup(this._group[i]);this._group=[]}return t.prototype.update.call(this)},e}(Enemy);egret.registerClass(GroupEnemy,"GroupEnemy");var Enemy18=function(t){function e(){t.call(this),this.addClip("enemy18_east_moving",["east-moving","east-guarding"]).addClip("enemy18_south_moving",["south-moving","south-guarding"]).addClip("enemy18_north_moving",["north-moving","north-guarding"]).addClip("enemy18_dying","east-dying").addClip("enemy18_east_fighting","east-fighting")}__extends(e,t);var i=(__define,e),n=i.prototype;return n._enterGroup=function(t){t.setArmor(80)},n._leaveGroup=function(t){var e=application.characters[t.getClaz()];t.setArmor(e.arm)},e}(GroupEnemy);egret.registerClass(Enemy18,"Enemy18");var Enemy19=function(t){function e(){t.call(this),this.addClip("enemy19_east_moving",["east-moving","east-guarding"]).addClip("enemy19_south_moving",["south-moving","south-guarding"]).addClip("enemy19_north_moving",["north-moving","north-guarding"]).addClip("enemy19_dying","east-dying").addClip("enemy19_east_fighting","east-fighting")}__extends(e,t);var i=(__define,e),n=i.prototype;return n.initialize=function(e){t.prototype.initialize.call(this,e),this._cureTicks=application.frameRate},n.update=function(){if(this._cureTicks--,this._cureTicks<=0){for(var e=0;e<this._group.length;e++)this._group[e].addMaxHp(20);this._cureTicks=application.frameRate}return t.prototype.update.call(this)},n._enterGroup=function(t){},n._leaveGroup=function(t){},e}(GroupEnemy);egret.registerClass(Enemy19,"Enemy19");var Enemy2=function(t){function e(){t.call(this),this.addClip("enemy1_east_moving",["east-moving","east-guarding"]).addClip("enemy1_south_moving",["south-moving","south-guarding"]).addClip("enemy1_north_moving",["north-moving","north-guarding"]).addClip("enemy1_dying","east-dying").addClip("enemy1_east_fighting","east-fighting")}__extends(e,t);var i=(__define,e);i.prototype;return e}(Enemy);egret.registerClass(Enemy2,"Enemy2");var Enemy20=function(t){function e(){t.call(this),this.addClip("enemy20_east_moving",["east-moving","east-guarding"]).addClip("enemy20_south_moving",["south-moving","south-guarding"]).addClip("enemy20_north_moving",["north-moving","north-guarding"]).addClip("enemy20_dying","east-dying").addClip("enemy20_east_fighting","east-fighting")}__extends(e,t);var i=(__define,e),n=i.prototype;return n._enterGroup=function(t){t.setMagicArmor(80)},n._leaveGroup=function(t){var e=application.characters[t.getClaz()];t.setMagicArmor(e.magicArm)},e}(GroupEnemy);egret.registerClass(Enemy20,"Enemy20");var Enemy21=function(t){function e(){t.call(this),this.addClip("enemy21_east_moving",["east-moving","east-guarding"]).addClip("enemy21_south_moving",["south-moving","south-guarding"]).addClip("enemy21_north_moving",["north-moving","north-guarding"]).addClip("enemy21_dying","east-dying").addClip("enemy21_east_fighting","east-fighting")}__extends(e,t);var i=(__define,e),n=i.prototype;return n._enterGroup=function(t){},n._leaveGroup=function(t){t.active()||this._born("Enemy22",t.getCenterX(),t.getCenterY())},e}(GroupEnemy);egret.registerClass(Enemy21,"Enemy21");var Enemy22=function(t){function e(){t.call(this),this.addClip("enemy22_east_moving",["east-moving","east-guarding"]).addClip("enemy22_south_moving",["south-moving","south-guarding"]).addClip("enemy22_north_moving",["north-moving","north-guarding"]).addClip("enemy22_dying","east-dying").addClip("enemy22_east_fighting","east-fighting")}__extends(e,t);var i=(__define,e);i.prototype;return e}(Enemy);egret.registerClass(Enemy22,"Enemy22");var Enemy23=function(t){function e(){t.call(this),this.addClip("enemy23_east_moving",["east-moving","east-guarding"]).addClip("enemy23_south_moving",["south-moving","south-guarding"]).addClip("enemy23_north_moving",["north-moving","north-guarding"]).addClip("enemy23_dying","east-dying").addClip("enemy23_east_fighting","east-fighting")}__extends(e,t);var i=(__define,e),n=i.prototype;return n._hitOpponents=function(){for(var t=application.battle.findSoldiers(this.getCenterX(),this.getCenterY(),50),e=0;e<t.length;e++){var i=t[e];i.hitBy(this)&&this.rmvSoldier(i)}},e}(Enemy);egret.registerClass(Enemy23,"Enemy23");var Enemy24=function(t){function e(){t.call(this),this.addClip("enemy24_east_moving",["east-moving","east-guarding"]).addClip("enemy24_south_moving",["south-moving","south-guarding"]).addClip("enemy24_north_moving",["north-moving","north-guarding"]).addClip("enemy24_dying","east-dying").addClip("enemy24_east_fighting","east-fighting")}__extends(e,t);var i=(__define,e);i.prototype;return e}(Enemy);egret.registerClass(Enemy24,"Enemy24");var Enemy25=function(t){function e(){t.call(this),this.addClip("enemy25_east_moving",["east-moving","east-guarding"]).addClip("enemy25_south_moving",["south-moving","south-guarding"]).addClip("enemy25_north_moving",["north-moving","north-guarding"]).addClip("enemy25_dying","east-dying").addClip("enemy25_east_fighting","east-fighting")}__extends(e,t);var i=(__define,e),n=i.prototype;return n.initialize=function(e){t.prototype.initialize.call(this,e),this._hitTicks=0},n._hitOpponents=function(){var t=this.firstSoldier();t?(this._hitTicks++,this._hitTicks>=5*application.frameRate?(t.kill(),this._born("Enemy21",t.getCenterX(),t.getBottomY()),this._hitTicks=0):(t.frozen(0,10,!1,!1),t.hitBy(this)&&this.rmvSoldier(t))):this._moveAgain()},e}(Enemy);egret.registerClass(Enemy25,"Enemy25");var Enemy26=function(t){function e(){t.call(this),this.addClip("enemy26_east_moving",["east-moving","east-guarding"]).addClip("enemy26_south_moving",["south-moving","south-guarding"]).addClip("enemy26_north_moving",["north-moving","north-guarding"]).addClip("enemy26_dying","east-dying").addClip("enemy26_east_fighting","east-fighting")}__extends(e,t);var i=(__define,e);i.prototype;return e}(Enemy);egret.registerClass(Enemy26,"Enemy26");var Enemy27=function(t){function e(){t.call(this),this.addClip("enemy27_east_moving",["east-moving","east-guarding"]).addClip("enemy27_south_moving",["south-moving","south-guarding"]).addClip("enemy27_north_moving",["north-moving","north-guarding"]).addClip("enemy27_dying","east-dying").addClip("enemy27_east_fighting","east-fighting")}__extends(e,t);var i=(__define,e);i.prototype;return e}(Enemy);egret.registerClass(Enemy27,"Enemy27");var SummonEnemy=function(t){function e(){t.apply(this,arguments)}__extends(e,t);var i=(__define,e),n=i.prototype;return n.initialize=function(e){t.prototype.initialize.call(this,e),this._summonTicks=this._get(e,"summonTicks",5*application.frameRate),this._summonClaz=this._get(e,"summonClaz","Enemy27")},n._moving=function(){t.prototype._moving.call(this),this._ticks++,this._ticks%this._summonTicks==0&&this._summon(this._summonClaz)},n._summon=function(t){return this._born(t,this.x,this.y)},e}(Enemy);egret.registerClass(SummonEnemy,"SummonEnemy");var Enemy28=function(t){function e(){t.call(this),this.addClip("enemy28_east_moving",["east-moving","east-guarding"]).addClip("enemy28_south_moving",["south-moving","south-guarding"]).addClip("enemy28_north_moving",["north-moving","north-guarding"]).addClip("enemy28_dying","east-dying").addClip("enemy28_east_fighting","east-fighting")}__extends(e,t);var i=(__define,e),n=i.prototype;return n.initialize=function(e){t.prototype.initialize.call(this,e),this._summonTicks=this._get(e,"summonTicks",5*application.frameRate)},n._moving=function(){if(t.prototype._moving.call(this),this._ticks++,this._ticks%this._summonTicks==0){var e=this._ahead(1);this._born("Enemy27",e[0],e[1])}},e}(SummonEnemy);egret.registerClass(Enemy28,"Enemy28");var Enemy29=function(t){function e(){t.call(this),this.addClip("enemy29_east_moving",["east-moving","east-guarding"]).addClip("enemy29_south_moving",["south-moving","south-guarding"]).addClip("enemy29_north_moving",["north-moving","north-guarding"]).addClip("enemy29_dying","east-dying").addClip("enemy29_east_fighting","east-fighting")}__extends(e,t);var i=(__define,e),n=i.prototype;return n.initialize=function(e){t.prototype.initialize.call(this,e),this._initialMoveSpeed=this._moveSpeed},n.damage=function(e){return this._moveSpeed=Math.round(2*(1-this._hp.getHp()/this._hp.getMaxHp())*this._initialMoveSpeed),t.prototype.damage.call(this,e)},e}(Enemy);egret.registerClass(Enemy29,"Enemy29");var Enemy3=function(t){function e(){t.call(this),this.addClip("enemy3_east_moving",["east-moving","east-guarding"]).addClip("enemy3_south_moving",["south-moving","south-guarding"]).addClip("enemy3_north_moving",["north-moving","north-guarding"]).addClip("enemy3_dying","east-dying").addClip("enemy3_east_fighting","east-fighting")}__extends(e,t);var i=(__define,e);i.prototype;return e}(ShootEnemy);egret.registerClass(Enemy3,"Enemy3");var Enemy30=function(t){function e(){t.call(this),this.addClip("enemy30_east_moving",["east-moving","east-guarding"]).addClip("enemy30_south_moving",["south-moving","south-guarding"]).addClip("enemy30_north_moving",["north-moving","north-guarding"]).addClip("enemy30_dying","east-dying").addClip("enemy30_east_fighting","east-fighting")}__extends(e,t);var i=(__define,e),n=i.prototype;return n._hitOpponents=function(){var t=this.firstSoldier();t?(t.hitBy(this)&&this.rmvSoldier(t),this._hp.setHp(this._hp.getHp()+this.getForce())):this._moveAgain()},e}(Enemy);egret.registerClass(Enemy30,"Enemy30");var Enemy31=function(t){function e(){t.call(this),this.addClip("enemy31_east_moving",["east-moving","east-guarding"]).addClip("enemy31_south_moving",["south-moving","south-guarding"]).addClip("enemy31_north_moving",["north-moving","north-guarding"]).addClip("enemy31_dying","east-dying").addClip("enemy31_east_fighting","east-fighting")}__extends(e,t);var i=(__define,e),n=i.prototype;return n._hitOpponents=function(){var t=this.firstSoldier();t?Math.random()<=.1?"Hero"==t.getSuperClaz()?t.damage(100)&&this.rmvSoldier(t):(t.kill(),this.rmvSoldier(t)):t.hitBy(this)&&this.rmvSoldier(t):this._moveAgain()},n.kill=function(){t.prototype.kill.call(this);for(var e=application.battle.findSoldiers(this.getCenterX(),this.getCenterY(),80),i=0;i<e.length;i++)e[i].damage(50)},e}(ShootEnemy);egret.registerClass(Enemy31,"Enemy31");var Enemy32=function(t){function e(){t.call(this),this.addClip("enemy32_east_moving",["east-moving","east-guarding"]).addClip("enemy32_south_moving",["south-moving","south-guarding"]).addClip("enemy32_north_moving",["north-moving","north-guarding"]).addClip("enemy32_dying","east-dying").addClip("enemy32_east_fighting","east-fighting")}__extends(e,t);var i=(__define,e),n=i.prototype;return n.update=function(){if(this._stealthTicks--,this._stealthTicks>0){var e=this._paths[this._paths.length-1],i=(this.x-e[0])*(this.x-e[0])+(this.y-e[1])*(this.y-e[1]);100>=i&&(this._altitude=0)}else 0==this._stealthTicks&&(this._altitude=0);return t.prototype.update.call(this)},n.damage=function(t){if(this.active()){var e=this._hp.getHp();return this._hp.damage(t)?(this.kill(),!0):(e>this._hp.getMaxHp()<<1&&this._hp.getHp()<=this._hp.getMaxHp()<<1&&(this._stealthTicks=8*application.frameRate,this._altitude=-1),!1)}return!0},e}(Enemy);egret.registerClass(Enemy32,"Enemy32");var Enemy33=function(t){function e(){t.call(this),this.addClip("enemy33_east_moving",["east-moving","east-guarding"]).addClip("enemy33_south_moving",["south-moving","south-guarding"]).addClip("enemy33_north_moving",["north-moving","north-guarding"]).addClip("enemy33_dying","east-dying").addClip("enemy33_east_fighting","east-fighting")}__extends(e,t);var i=(__define,e),n=i.prototype;return n.initialize=function(e){t.prototype.initialize.call(this,e),this._flashTicks=application.frameRate},n._moving=function(){if(this._flashTicks--,this._flashTicks<=0){for(var e=0;10>e;e++)this.active()&&t.prototype._moving.call(this);this._flashTicks=5*application.frameRate}},e}(Enemy);egret.registerClass(Enemy33,"Enemy33");var Enemy34=function(t){function e(){t.call(this),this.addClip("enemy34_east_moving",["east-moving","east-guarding"]).addClip("enemy34_south_moving",["south-moving","south-guarding"]).addClip("enemy34_north_moving",["north-moving","north-guarding"]).addClip("enemy34_dying","east-dying").addClip("enemy34_east_fighting","east-fighting")}__extends(e,t);var i=(__define,e),n=i.prototype;return n._hitOpponents=function(){var t=this.firstSoldier();t?(this._skillTicks--,this._skillTicks<=0?(t.damage(3*this.getForce())&&this.rmvSoldier(t),this._skillTicks++):t.hitBy(this)&&this.rmvSoldier(t)):this._moveAgain()},e}(Enemy);egret.registerClass(Enemy34,"Enemy34");var Enemy35=function(t){function e(){t.call(this),this.addClip("enemy35_east_moving",["east-moving","east-guarding"]).addClip("enemy35_south_moving",["south-moving","south-guarding"]).addClip("enemy35_north_moving",["north-moving","north-guarding"]).addClip("enemy35_dying","east-dying").addClip("enemy35_east_fighting","east-fighting")}__extends(e,t);var i=(__define,e),n=i.prototype;return n.initialize=function(e){t.prototype.initialize.call(this,e),this._summonTicks=this._get(e,"summonTicks",5*application.frameRate)},n._moving=function(){if(t.prototype._moving.call(this),this._ticks++,this._ticks%this._summonTicks==0){var e=this._ahead(10);this._born("Enemy29",e[0],e[1]),this._born("Enemy32",e[0],e[1]),this._born("Enemy33",e[0],e[1])}},e}(Enemy);egret.registerClass(Enemy35,"Enemy35");var Enemy36=function(t){function e(){t.call(this),this.addClip("enemy1_east_moving",["east-moving","east-guarding"]).addClip("enemy1_south_moving",["south-moving","south-guarding"]).addClip("enemy1_north_moving",["north-moving","north-guarding"]).addClip("enemy1_dying","east-dying").addClip("enemy1_east_fighting","east-fighting")}__extends(e,t);var i=(__define,e);i.prototype;return e}(Enemy);egret.registerClass(Enemy36,"Enemy36");var Enemy4=function(t){function e(){t.call(this),this.addClip("enemy4_east_moving",["east-moving","east-guarding"]).addClip("enemy4_south_moving",["south-moving","south-guarding"]).addClip("enemy4_north_moving",["north-moving","north-guarding"]).addClip("enemy4_dying","east-dying").addClip("enemy4_east_fighting","east-fighting")}__extends(e,t);var i=(__define,e),n=i.prototype;return n.hitBy=function(e){return Math.random()<.3?(this.fight(),!1):t.prototype.hitBy.call(this,e)},e}(Enemy);egret.registerClass(Enemy4,"Enemy4");var Enemy5=function(t){function e(){t.call(this),this.addClip("enemy5_east_moving",["east-moving","east-guarding"]).addClip("enemy5_south_moving",["south-moving","south-guarding"]).addClip("enemy5_north_moving",["north-moving","north-guarding"]).addClip("enemy5_dying","east-dying").addClip("enemy5_east_fighting","east-fighting")}__extends(e,t);var i=(__define,e),n=i.prototype;return n.hitBy=function(e){return Math.random()<.8?(this.fight(),!1):t.prototype.hitBy.call(this,e)},e}(Enemy);egret.registerClass(Enemy5,"Enemy5");var Enemy6=function(t){function e(){t.call(this),this.addClip("enemy6_east_moving",["east-moving","east-guarding"]).addClip("enemy6_south_moving",["south-moving","south-guarding"]).addClip("enemy6_north_moving",["north-moving","north-guarding"]).addClip("enemy6_dying","east-dying").addClip("enemy6_east_fighting","east-fighting")}__extends(e,t);var i=(__define,e),n=i.prototype;return n.erase=function(){this._born("Enemy7",this.x,this.y),t.prototype.erase.call(this)},e}(Enemy);egret.registerClass(Enemy6,"Enemy6");var Enemy7=function(t){function e(){t.call(this),this.addClip("enemy7_east_moving",["east-moving","east-guarding"]).addClip("enemy7_south_moving",["south-moving","south-guarding"]).addClip("enemy7_north_moving",["north-moving","north-guarding"]).addClip("enemy7_dying","east-dying").addClip("enemy7_east_fighting","east-fighting")}__extends(e,t);var i=(__define,e);i.prototype;return e}(Enemy);egret.registerClass(Enemy7,"Enemy7");var Enemy8=function(t){function e(){t.call(this),this.addClip("enemy8_east_moving","east-moving").addClip("enemy8_north_moving","north-moving").addClip("enemy8_east_guarding","east-guarding").addClip("enemy8_dying","east-dying").addClip("enemy8_east_fighting","east-fighting")}__extends(e,t);var i=(__define,e);i.prototype;return e}(Enemy);egret.registerClass(Enemy8,"Enemy8");var Enemy9=function(t){function e(){t.call(this),this.addClip("enemy9_east_moving",["east-moving","east-guarding"]).addClip("enemy9_south_moving",["south-moving","south-guarding"]).addClip("enemy9_north_moving",["north-moving","north-guarding"]).addClip("enemy9_dying","east-dying").addClip("enemy9_east_fighting","east-fighting")}__extends(e,t);var i=(__define,e),n=i.prototype;return n._hitOpponents=function(){t.prototype._hitOpponents.call(this);var e=this.firstSoldier();e&&e.black(5,2*application.frameRate,!1)},e}(Enemy);egret.registerClass(Enemy9,"Enemy9");var Boss=function(t){function e(){t.apply(this,arguments)}__extends(e,t);var i=(__define,e),n=i.prototype;return n.erase=function(){t.prototype.erase.call(this),Utility.delay(function(){application.battle.getLives()>0?application.battle.win():application.battle.lose()},10)},e}(Enemy);egret.registerClass(Boss,"Boss");var Boss1=function(t){function e(){t.call(this),this.addClip("enemy4_east_moving",["east-moving","east-guarding"]).addClip("enemy4_south_moving",["south-moving","south-guarding"]).addClip("enemy4_north_moving",["north-moving","north-guarding"]).addClip("enemy4_dying","east-dying").addClip("enemy4_east_fighting","east-fighting")}__extends(e,t);var i=(__define,e);i.prototype;return e}(Boss);egret.registerClass(Boss1,"Boss1");var Soldier=function(t){function e(){t.call(this),this.touchEnabled=!0}__extends(e,t);var i=(__define,e),n=i.prototype;return n.getGuardX=function(){return this._guardX},n.getGuardY=function(){return this._guardY},n.select=function(t){return t?(this.deselect(),!1):(this._range=application.pool.get("GuardRange",{guardRadius:this._guardRadius}),this._range.x=this.getCenterX()-this._guardRadius,this._range.y=this.getCenterY()-this._guardRadius,this._range.width=this._guardRadius<<1,this._range.height=this._guardRadius<<1,application.battle.addEntity(this._range),!0)},n.deselect=function(){this._range&&(this._range.erase(),this._range=null)},n.initialize=function(e){t.prototype.initialize.call(this,e),this._guardX=this._get(e,"guardX",0),this._guardY=this._get(e,"guardY",0),this._guardRadius=this._get(e,"guardRadius",20),this._guardAltitudes=this._get(e,"guardAltitude",[-1,0]),this._liveTicks=this._get(e,"liveTicks",3600*application.frameRate),this._enemy=null,this._range=null,this._creator=null},n.update=function(){return this._liveTicks--,this._liveTicks<=0&&this.erase(),t.prototype.update.call(this)},n.setCreator=function(t){this._creator=t},n._idle=function(){this._ticks++,this._ticks>=this._idleTicks&&(this._moveToGuard(),this._hp&&this._hp.move())},n.erase=function(){t.prototype.erase.call(this),this._enemy&&(this._enemy.rmvSoldier(this),this._enemy=null),this._range&&(this._range.erase(),this._range=null),this._creator&&this._creator.createSoldier(this)},n.clone=function(t){return t.guardX=this._guardX,t.guardY=this._guardY,application.pool.get(this.getClaz(),t)},n.guardAt=function(t,e){this._guardX=t,this._guardY=e,null==this._enemy&&this._moveToGuard()},n._moveToGuard=function(){this._enemy=null,this.moveTo(this._guardX,this._guardY),this.move()},n.moveTo=function(e,i){t.prototype.moveTo.call(this,e-(this.width>>1),i-this.height)},n._arrive=function(){this._enemy?this._enemy.active()?(this._face(this._enemy),this.fight()):this._moveToGuard():this.guard()},n._moving=function(){t.prototype._moving.call(this),this._range&&(this._range.x=this.getCenterX()-this._guardRadius,this._range.y=this.getCenterY()-this._guardRadius),this._hp&&this._hp.cure()},n._guarding=function(){var t=this._findEnemy();t&&this._fightWith(t),this._hp&&this._hp.cure()},n._fightWith=function(t){if(this._enemy&&this._enemy.rmvSoldier(this),this._enemy=t,this._enemy){var e=this._enemy.addSoldier(this),i=3;if(3>e)var n=t.x-(this.width>>1)-i;else var n=t.x+t.width+(this.width>>1)+i;var s=e%3,a=t.getCenterY()+(this.height>>1);1==s?a-=this.height+i:2==s&&(a+=this.height+i),this.moveTo(n,a),this.move()}else this._moveToGuard()},n._hitOpponents=function(){if(this._enemy&&this._enemy.active()&&!this._enemy.hitBy(this)){if(this._enemy.totalSoldiers()>1){var t=this._findEnemy();t&&0==t.totalSoldiers()&&this._fightWith(t)}}else this._fightWith(this._findEnemy())},n._findEnemy=function(){var t=application.battle.findSuitableEnemy(this.getCenterX(),this.getCenterY(),this._guardRadius,this._guardAltitudes);return!t||t.totalSoldiers()>=6?null:t},e}(NPC);egret.registerClass(Soldier,"Soldier",["Selectable"]);var BlackImpermanence=function(t){function e(){t.call(this),this.addClip("blackImpermanence_east_fighting","east-fighting").addClip("blackImpermanence_east_moving","east-moving").addClip("blackImpermanence_guarding","east-guarding").addClip("blackImpermanence_building","east-building").addClip("blackImpermanence_dying","east-dying")}__extends(e,t);var i=(__define,e);i.prototype;return e}(Soldier);egret.registerClass(BlackImpermanence,"BlackImpermanence");var Ghost=function(t){function e(){t.call(this),this.addClip("ghost_east_fighting","east-fighting").addClip("ghost_east_moving","east-moving").addClip("ghost_building","east-building").addClip("ghost_guarding","east-guarding").addClip("ghost_dying","east-dying")}__extends(e,t);var i=(__define,e);i.prototype;return e}(Soldier);egret.registerClass(Ghost,"Ghost");var Guard=function(t){function e(){t.apply(this,arguments)}__extends(e,t);var i=(__define,e),n=i.prototype;return n.initialize=function(e){t.prototype.initialize.call(this,e);var i=Skill.get(application.skills,"Guard",0);i&&(1==i.attrs.level&&(this._forceHigh=Math.round(1.05*this._forceHigh),this._forceLow=Math.round(1.05*this._forceLow),this._hp.setMaxHp(Math.round(1.05*this._hp.getMaxHp()))),1==i.attrs.level&&(this._armor=Math.round(1.1*this._armor),this._hp.setMaxHp(Math.round(1.05*this._hp.getMaxHp()))),3==i.attrs.level&&(this._forceHigh=Math.round(1.05*this._forceHigh),this._forceLow=Math.round(1.05*this._forceLow),this._hp.setMaxHp(Math.round(1.05*this._hp.getMaxHp()))),4==i.attrs.level&&(this._forceHigh=Math.round(1.1*this._forceHigh),this._forceLow=Math.round(1.1*this._forceLow),this._hp.setMaxHp(Math.round(1.05*this._hp.getMaxHp()))),6==i.attrs.level&&(this._forceHigh=Math.round(1.2*this._forceHigh),this._forceLow=Math.round(1.2*this._forceLow)))
},n.setCreator=function(e){if(e){var i=e;this.addMaxHp(50*i.getSkillLevel(1))}t.prototype.setCreator.call(this,e)},n.damage=function(t){if(this.active()){if(this._hp.damage(t)){var e=this._creator;return e.getSkillLevel(3)>0&&Math.random()<=.1+.1*e.getSkillLevel(3)?(this._hp.setHp(Math.round(.3*this._hp.getMaxHp())),!1):(this.kill(),!0)}return!1}return!0},n._hitOpponents=function(){if(t.prototype._hitOpponents.call(this),this._enemy&&this._enemy.active()){var e=this._creator;e.getSkillLevel(2)>0&&Math.random()<=.15&&this._enemy.attack(15*e.getSkillLevel(2)+10,3*application.frameRate,!0)}},e}(Soldier);egret.registerClass(Guard,"Guard");var Reinforce=function(t){function e(){t.call(this),this.addClip("reinforce_east_fighting","east-fighting").addClip("reinforce_east_moving",["east-moving","east-guarding"]).addClip("reinforce_dying","east-dying")}__extends(e,t);var i=(__define,e);i.prototype;return e}(Soldier);egret.registerClass(Reinforce,"Reinforce");var Soldier1=function(t){function e(){t.call(this),this.addClip("soldier1_east_fighting","east-fighting").addClip("soldier1_east_moving","east-moving").addClip("soldier1_guarding","east-guarding").addClip("soldier1_dying","east-dying")}__extends(e,t);var i=(__define,e);i.prototype;return e}(Guard);egret.registerClass(Soldier1,"Soldier1");var Soldier2=function(t){function e(){t.call(this),this.addClip("soldier2_east_fighting","east-fighting").addClip("soldier2_east_moving","east-moving").addClip("soldier2_guarding","east-guarding").addClip("soldier2_dying","east-dying")}__extends(e,t);var i=(__define,e);i.prototype;return e}(Guard);egret.registerClass(Soldier2,"Soldier2");var Soldier3=function(t){function e(){t.call(this),this.addClip("soldier3_east_fighting","east-fighting").addClip("soldier3_east_moving","east-moving").addClip("soldier3_guarding","east-guarding").addClip("soldier3_dying","east-dying")}__extends(e,t);var i=(__define,e);i.prototype;return e}(Guard);egret.registerClass(Soldier3,"Soldier3");var Soldier4=function(t){function e(){t.call(this),this.addClip("soldier4_east_fighting","east-fighting").addClip("soldier4_east_moving","east-moving").addClip("soldier4_guarding","east-guarding").addClip("soldier4_dying","east-dying")}__extends(e,t);var i=(__define,e);i.prototype;return e}(Guard);egret.registerClass(Soldier4,"Soldier4");var Warrior=function(t){function e(){t.call(this),this.addClip("warrior_east_fighting",["east-fighting","east-moving","east-guarding"]).addClip("warrior_dying","east-dying")}__extends(e,t);var i=(__define,e);i.prototype;return e}(Soldier);egret.registerClass(Warrior,"Warrior");var WhiteImpermanence=function(t){function e(){t.call(this),this.addClip("whiteImpermanence_east_fighting","east-fighting").addClip("whiteImpermanence_east_moving","east-moving").addClip("whiteImpermanence_guarding","east-guarding").addClip("whiteImpermanence_building","east-building").addClip("whiteImpermanence_dying","east-dying")}__extends(e,t);var i=(__define,e);i.prototype;return e}(Soldier);egret.registerClass(WhiteImpermanence,"WhiteImpermanence");var Hero=function(t){function e(){t.apply(this,arguments)}__extends(e,t);var i=(__define,e),n=i.prototype;return n.initialize=function(e){t.prototype.initialize.call(this,e),this._extraForce=0,this._curSkill=0},n.getForce=function(){return t.prototype.getForce.call(this)+this._extraForce},n._render=function(e,i,n){return void 0===e&&(e=0),void 0===i&&(i=0),void 0===n&&(n=0),this._renderHp(),t.prototype._render.call(this,0,5,this._curSkill)},e}(Soldier);egret.registerClass(Hero,"Hero");var Shaseng=function(t){function e(){t.call(this),this.addClip("sunwukong_east_moving",["east-moving","south-moving","north-moving"]).addBitmap("sunwukong_guarding_png",["east-guarding","west-guarding","south-guarding","north-guarding"]).addClip("sunwukong_west_fighting_1",["west-fighting","south-fighting","north-fighting"]).addClip("sunwukong_east_fighting_2",["east-fighting","south-fighting","north-fighting"]).addClip("sunwukong_east_fighting_3",["east-fighting","south-fighting","north-fighting"]).addClip("sunwukong_dying",["dying"])}__extends(e,t);var i=(__define,e),n=i.prototype;return n._readyFight=function(){return!0},n._hitOpponents=function(){},e}(Hero);egret.registerClass(Shaseng,"Shaseng");var Sunwukong=function(t){function e(){t.call(this),this.addClip("sunwukong_east_moving",["east-moving","south-moving","north-moving"]).addBitmap("sunwukong_guarding_png",["east-guarding","west-guarding","south-guarding","north-guarding"]).addClip("sunwukong_west_fighting_1",["west-fighting","south-fighting","north-fighting"]).addClip("sunwukong_east_fighting_2",["east-fighting","south-fighting","north-fighting"]).addClip("sunwukong_east_fighting_3",["east-fighting","south-fighting","north-fighting"]).addClip("sunwukong_dying",["dying"])}__extends(e,t);var i=(__define,e),n=i.prototype;return n.initialize=function(e){t.prototype.initialize.call(this,e),this._skill0Ticks=this._hitSpeed,this._skill4=2,this._skill4Times=0,this._skill4Ticks=8*application.frameRate,this._skill5=1,this._skill5Ticks=10*application.frameRate;for(var i=0;i<application.skills.length;i++){var n=application.skills[i];if(n.attrs.claz==this.getClaz())if(0==n.attrs.idx){var s=n.attrs.level-1;this._hp.setMaxHp(15*s+30+this._hp.getMaxHp()),this._armor+=5*s,this._forceHigh+=2*s,this._forceLow+=s}else 1==n.attrs.idx?this._extraForce=2*n.attrs.level:2==n.attrs.idx?this._resistance=10+20*(n.attrs.level-1):3==n.attrs.idx?this._hp.setMaxHp(30*(n.attrs.level-1)+this._hp.getMaxHp()):4==n.attrs.idx?(this._skill4=2*n.attrs.level,this._skill4Ticks=(9-n.attrs.level)*application.frameRate):5==n.attrs.idx&&(this._skill5=n.attrs.level)}},n._readyFight=function(){return this._skill0Ticks--,this._skill4Ticks--,this._skill5Ticks--,4==this._curSkill&&this._skill4Times<this._skill4&&this._enemy&&this._enemy.active()?!0:this._skill5Ticks<=0?(this._curSkill=5,this._skill5Ticks=10*application.frameRate,!0):this._skill4Ticks<=0?(this._curSkill=4,this._skill4Ticks=(9-this._skill4/2)*application.frameRate,this._skill4Times=0,!0):this._skill0Ticks<=0?(0==this._curSkill,this._skill0Ticks=this._hitSpeed,!0):!1},n._hitOpponents=function(){if(5==this._curSkill)for(var e=0;e<this._skill5;e++)application.battle.addWarriorsByName("Warrior",this,{maxHp:60+40*(this._skill5-1),guardRadius:this._guardRadius,liveTicks:8*application.frameRate});else 1==this._curSkill&&this._skill4Times++,t.prototype._hitOpponents.call(this)},e}(Hero);egret.registerClass(Sunwukong,"Sunwukong");var Zhubajie=function(t){function e(){t.call(this),this.addClip("sunwukong_east_moving",["east-moving","south-moving","north-moving"]).addBitmap("sunwukong_guarding_png",["east-guarding","west-guarding","south-guarding","north-guarding"]).addClip("sunwukong_west_fighting_1",["west-fighting","south-fighting","north-fighting"]).addClip("sunwukong_east_fighting_2",["east-fighting","south-fighting","north-fighting"]).addClip("sunwukong_east_fighting_3",["east-fighting","south-fighting","north-fighting"]).addClip("sunwukong_dying",["dying"])}__extends(e,t);var i=(__define,e),n=i.prototype;return n._readyFight=function(){return!0},n._hitOpponents=function(){},e}(Hero);egret.registerClass(Zhubajie,"Zhubajie");var Tip=function(t){function e(){t.call(this)}__extends(e,t);var i=(__define,e),n=i.prototype;return n.initialize=function(e){t.prototype.initialize.call(this,e),this._dyingTicks=this._get(e,"dyingTicks",3*application.frameRate),this.kill()},n._dying=function(){this._ticks++,this._ticks>this._dyingTicks&&this.erase()},e}(Entity);egret.registerClass(Tip,"Tip");var DisableTip=function(t){function e(){t.call(this),this.addBitmap("disable_png")}__extends(e,t);var i=(__define,e);i.prototype;return e}(Tip);egret.registerClass(DisableTip,"DisableTip");var FlagTip=function(t){function e(){t.call(this),this.addBitmap("flag_png")}__extends(e,t);var i=(__define,e);i.prototype;return e}(Tip);egret.registerClass(FlagTip,"FlagTip");var LaunchTip=function(t){function e(){t.call(this),this.touchEnabled=!0,this.addBitmap("launch_png"),this._shapeShield=new egret.Shape,this.addChild(this._shapeShield)}__extends(e,t);var i=(__define,e),n=i.prototype;return n.initialize=function(e){t.prototype.initialize.call(this,e),this._wave=this._get(e,"wave",0)},n.select=function(t){application.battle.launchWave(this._wave);var e=Math.round(40*(this._dyingTicks-this._ticks)/this._dyingTicks);application.battle.incGolds(e),this.erase()},n._dying=function(){this._ticks>this._dyingTicks?(application.battle.launchWave(this._wave),this.erase()):this._ticks%3==0&&this.stain(),this._ticks++},n.paint=function(){t.prototype.paint.call(this),this._shapeShield.graphics.clear(),this._shapeShield.graphics.lineStyle(2,16711680),this._shapeShield.graphics.drawArc(this.width/2,this.height/2,this.width/2,0,2*this._ticks/this._dyingTicks*Math.PI,!1),this._shapeShield.graphics.endFill()},e}(Tip);egret.registerClass(LaunchTip,"LaunchTip");var Tower=function(t){function e(){t.call(this),this._displays.addClip("tower_building","building"),this._criticalClip=EntityDisplays.loadClip("critical"),this.touchEnabled=!0}__extends(e,t);var i=(__define,e),n=i.prototype;return n.initialize=function(e){t.prototype.initialize.call(this,e),this._buildingTicks=this._get(e,"buildingTicks",application.frameRate),this._price=this._get(e,"price",100),this._upgradePrice=this._get(e,"upgradePrice",100),this._guardX=this._get(e,"guardX",10),this._guardY=this._get(e,"guardY",10),this._guardRadius=this._get(e,"guardRadius",10);var i=this._get(e,"force",10);this._forceHigh=this._get(e,"forceHigh",i),this._forceLow=this._get(e,"forceLow",i),this._critical=this._get(e,"critical",0),this._range=null,this._base=null,this._skill=Skill.get(application.skills,this.getSuperClaz(),0)},n.setBase=function(t){this._base=t},n.getGuardRadius=function(){return this._guardRadius},n.getPrice=function(){return this._price},n.getSellPrice=function(){return Math.round(this._price/2)},n.upgradable=function(){return!0},n.getUpgradePrice=function(){return this._upgradePrice},n.totalSkills=function(){return 2},n.skillUpgradable=function(t){return!1},n.getSkillUpgradePrice=function(t){return 0},n.upgradeSkill=function(t){},n.useSkill=function(t){},n.getSkillLevel=function(t){return 0},n.getForce=function(){var t=Entity.random(this._forceLow,this._forceHigh);return this._critical>0&&100*Math.random()<=this._critical?t<<1:t},n.incCritical=function(t){0==this._critical?(this._critical=Math.max(0,this._critical+t),this._critical>0&&(this._criticalClip.x=(this._criticalClip.width>>1)+(this.width-this._criticalClip.width)/2,this._criticalClip.y=(this._criticalClip.height>>1)+(this.height-this._criticalClip.height),this.addChild(this._criticalClip),this._criticalClip.gotoAndPlay(0,-1))):(this._critical=Math.max(0,this._critical+t),0==this._critical&&(this._criticalClip.stop(),this.removeChild(this._criticalClip)))},n._idle=function(){this.build(),this._range&&(this._range.erase(),this._range=null),application.battle.incGolds(-this.getPrice())},n._building=function(){if(this._ticks++,this._ticks>this._buildingTicks){this.guard();for(var t=this.findNeighbors(),e=0;e<t.length;e++)t[e].useSkill(this)}},n.findNeighbors=function(){return application.battle.findTowers(this.getCenterX(),this.getCenterY(),100)},n.select=function(t){return t?(this.deselect(),!1):(application.showUI(new TowerMenuUI(this._base),application.battle.getUI(),this.getCenterX(),this.getCenterY()),!0)},n.deselect=function(){this._range&&(this._range.erase(),this._range=null)},e}(Entity);egret.registerClass(Tower,"Tower",["Selectable"]);var ShootTower=function(t){function e(){t.apply(this,arguments)}__extends(e,t);var i=(__define,e),n=i.prototype;return n.initialize=function(e){t.prototype.initialize.call(this,e),this._shootSpeed=this._get(e,"shootSpeed",60)},n._guarding=function(){this._enemy=this._findEnemy(),this._enemy&&this.fight()},n.targetKilled=function(t){},n.getMuzzleX=function(){return this.getCenterX()},n.getMuzzleY=function(){return this.y},n._fighting=function(){this._ticks%this._shootSpeed==0&&(null!=this._enemy&&this._enemy.active()&&this._enemy.within(this.getCenterX(),this.getCenterY(),this._guardRadius)||(this._enemy=this._findEnemy()),this._enemy?this._shoot():this.guard()),this._ticks++},n._shoot=function(){Bullet.shoot(this,this._enemy,this._bulletClaz,{force:this.getForce()})},n._findEnemy=function(){return application.battle.findEnemy(this.getCenterX(),this.getCenterY(),this._guardRadius,[0])},e}(Tower);egret.registerClass(ShootTower,"ShootTower",["Shooter"]);var ArrowTower=function(t){function e(){t.apply(this,arguments)}__extends(e,t);var i=(__define,e),n=i.prototype;return n.initialize=function(e){t.prototype.initialize.call(this,e),this._skill&&(1==this._skill.attrs.level&&(this._guardRadius=Math.round(1.05*this._guardRadius)),3==this._skill.attrs.level&&(this._forceHigh=Math.round(1.05*this._forceHigh),this._forceLow=Math.round(1.05*this._forceLow)),4==this._skill.attrs.level&&(this._guardRadius=Math.round(1.05*this._guardRadius),this._forceHigh=Math.round(1.05*this._forceHigh),this._forceLow=Math.round(1.05*this._forceLow)),6==this._skill.attrs.level&&(this._forceHigh=Math.round(1.1*this._forceHigh),this._forceLow=Math.round(1.1*this._forceLow)))},n._findEnemy=function(){return application.battle.findEnemy(this.getCenterX(),this.getCenterY(),this._guardRadius,[0,1])},e}(ShootTower);egret.registerClass(ArrowTower,"ArrowTower");var ArrowTower1=function(t){function e(){t.call(this),this.addBitmap("arrowtower1_png"),this._bulletClaz="Arrow1"}__extends(e,t);var i=(__define,e),n=i.prototype;return n.initialize=function(e){t.prototype.initialize.call(this,e),this._skill&&2==this._skill.attrs.level&&(this._upgradePrice=this._upgradePrice-10)},n.getMuzzleX=function(){return this.x+25+15},n.getMuzzleY=function(){return this.y+7},e}(ArrowTower);egret.registerClass(ArrowTower1,"ArrowTower1");var ArrowTower2=function(t){function e(){t.call(this),this.addBitmap("arrowtower2_png"),this._bulletClaz="Arrow1"}__extends(e,t);var i=(__define,e),n=i.prototype;return n.getMuzzleX=function(){return this.x+25+15},n.getMuzzleY=function(){return this.y+7},e}(ArrowTower);egret.registerClass(ArrowTower2,"ArrowTower2");var ArrowTower3=function(t){function e(){t.call(this),this.addBitmap("arrowtower3_png"),this._bulletClaz="Arrow1"}__extends(e,t);var i=(__define,e),n=i.prototype;return n.getMuzzleX=function(){return this.x+35+15},n.getMuzzleY=function(){return this.y+0},e}(ArrowTower);egret.registerClass(ArrowTower3,"ArrowTower3");var ArrowTower4=function(t){function e(){t.call(this),this.addBitmap("arrowtower4_png"),this._bulletClaz="Arrow5"}__extends(e,t);var i=(__define,e),n=i.prototype;return n.initialize=function(e){t.prototype.initialize.call(this,e),this._skill1Level=0,this._skill1Ticks=0,this._skill2Level=0},n.upgradeSkill=function(t){if(1==t)this._skill1Level++;else if(2==t){this._skill2Level++;for(var e=this.findNeighbors(),i=0;i<e.length;i++)e[i].incCritical(this._getCritical(this._skill2Level)-this._getCritical(this._skill2Level-1))}},n.useSkill=function(t){this._skill2Level>0&&t.incCritical(this._getCritical(this._skill2Level))},n.skillUpgradable=function(t){return 1==t?this._skill1Level<3:2==t?this._skill2Level<3:!1},n.upgradable=function(){return!1},n.getSkillUpgradePrice=function(t){if(1==t)if(0==this._skill1Level)var e=250;else var e=150;else var e=200;return e},n.getSkillLevel=function(t){return 1==t?this._skill1Level:this._skill2Level},n._fighting=function(){if(t.prototype._fighting.call(this),this._skill1Level>0&&this._enemy&&this._skill1Ticks<0){if(this._skill1Ticks=6*application.frameRate,1==this._skill1Level)var e=6,i="Arrow5";else if(2==this._skill1Level)var e=8,i="Arrow6";else var i="Arrow6",e=10;for(var n=(application.frameRate<<1)/e,s=Entity.random(30,40),a=application.battle.findEnemies(this.getCenterX(),this.getCenterY(),this._guardRadius,[0,1]),r=0;e>=r;r++)Bullet.shoot(this,a[r%a.length],i,{force:s,idleTicks:Math.round(r*n)})}this._skill1Ticks--},n.erase=function(){if(t.prototype.erase.call(this),this._skill2Level>0)for(var e=this.findNeighbors(),i=0;i<e.length;i++)e[i].incCritical(-this._getCritical(this._skill2Level))},n._getCritical=function(t){if(1==t)var e=10;else if(2==t)var e=15;else var e=20;return this._skill&&5==this._skill.attrs.level?Math.round(1.15*e):e},n.getMuzzleX=function(){return this.x+35+15},n.getMuzzleY=function(){return this.y+0},e}(ArrowTower);egret.registerClass(ArrowTower4,"ArrowTower4");var ArrowTower5=function(t){function e(){t.call(this),this.addBitmap("arrowtower5_png"),this._bulletClaz="Arrow4"}__extends(e,t);var i=(__define,e),n=i.prototype;return n.initialize=function(e){t.prototype.initialize.call(this,e),this._skill1Level=0,this._skill1Ticks=0,this._skill2Level=0,this._skill2Ticks=0},n.upgradeSkill=function(t){1==t?this._skill1Level++:this._skill2Level++},n.skillUpgradable=function(t){return 1==t?this._skill1Level<3:2==t?this._skill2Level<3:!1},n.upgradable=function(){return!1},n.getSkillUpgradePrice=function(t){if(1==t)if(0==this._skill1Level)var e=250;else var e=200;else var e=150;return e},n.getSkillLevel=function(t){return 1==t?this._skill1Level:this._skill2Level},n._fighting=function(){if(t.prototype._fighting.call(this),this._skill1Level>0&&this._enemy&&this._skill1Ticks<0){this._skill1Ticks=12*application.frameRate;var e=3*this._skill1Level*application.frameRate,i=this._enemy.getCenterX(),n=this._enemy.getCenterY();Bullet["throw"](i,n,i,n,"WeakCurse",{hitRaduis:this._guardRadius,curseTicks:e,fightingTicks:e})}if(this._skill1Ticks--,this._skill2Level>0&&this._enemy&&this._skill2Ticks<0){this._skill2Ticks=10*application.frameRate;var e=3*this._skill2Level*application.frameRate,i=this._enemy.getCenterX(),n=this._enemy.getCenterY();Bullet["throw"](i,n,i,n,"MiscastCurse",{hitRaduis:this._guardRadius,curseTicks:e,fightingTicks:e})}this._skill2Ticks--},n.getMuzzleX=function(){return this.x+35+15},n.getMuzzleY=function(){return this.y+0},e}(ArrowTower);egret.registerClass(ArrowTower5,"ArrowTower5");var BombTower=function(t){function e(){t.apply(this,arguments)}__extends(e,t);var i=(__define,e),n=i.prototype;return n.initialize=function(e){t.prototype.initialize.call(this,e),this._skill&&(2==this._skill.attrs.level&&(this._shootSpeed=Math.round(1.05*this._shootSpeed)),3==this._skill.attrs.level&&(this._forceHigh=Math.round(1.05*this._forceHigh),this._forceLow=Math.round(1.05*this._forceLow)),4==this._skill.attrs.level&&(this._critical+=10),5==this._skill.attrs.level&&(this._guardRadius=Math.round(1.05*this._guardRadius)),6==this._skill.attrs.level&&(this._forceHigh=Math.round(1.1*this._forceHigh),this._forceLow=Math.round(1.1*this._forceLow)))},n._shoot=function(){this._skill&&1==this._skill.attrs.level&&this._enemy&&this._enemy.active()&&this._enemy.dizzy(0,application.frameRate,!1,!1),t.prototype._shoot.call(this)},e}(ShootTower);egret.registerClass(BombTower,"BombTower");var BombTower1=function(t){function e(){t.call(this),this._bulletClaz="Bomb1",this.addBitmap("bombtower1_png")}__extends(e,t);var i=(__define,e),n=i.prototype;return n.getMuzzleX=function(){return this.x+23},n.getMuzzleY=function(){return this.y+9},e}(BombTower);egret.registerClass(BombTower1,"BombTower1");var BombTower2=function(t){function e(){t.call(this),this._bulletClaz="Bomb2",this.addBitmap("bombtower2_png")}__extends(e,t);var i=(__define,e),n=i.prototype;return n.getMuzzleX=function(){return this.x+32},n.getMuzzleY=function(){return this.y+9},e}(BombTower);egret.registerClass(BombTower2,"BombTower2");var BombTower3=function(t){function e(){t.call(this),this._bulletClaz="Bomb3",this.addBitmap("bombtower3_png")}__extends(e,t);var i=(__define,e),n=i.prototype;return n.getMuzzleX=function(){return this.x+33},n.getMuzzleY=function(){return this.y+7},e}(BombTower);egret.registerClass(BombTower3,"BombTower3");var BombTower4=function(t){function e(){t.call(this),this._bulletClaz="Bomb4",this.addBitmap("bombtower4_png")}__extends(e,t);var i=(__define,e),n=i.prototype;return n.initialize=function(e){t.prototype.initialize.call(this,e),this._skill1Level=0,this._skill1Ticks=0,this._skill2Level=0,this._skill2Ticks=0},n.upgradeSkill=function(t){1==t?this._skill1Level++:this._skill2Level++},n.skillUpgradable=function(t){return 1==t?this._skill1Level<3:2==t?this._skill2Level<3:!1},n.upgradable=function(){return!1},n.getSkillUpgradePrice=function(t){if(1==t)if(0==this._skill1Level)var e=400;else var e=200;else if(0==this._skill1Level)var e=300;else var e=250;return e},n.getSkillLevel=function(t){return 1==t?this._skill1Level:this._skill2Level},n._fighting=function(){if(t.prototype._fighting.call(this),this._skill1Ticks<0&&this._skill1Level>0&&this._enemy&&(1==this._skill1Level?this._skill1Ticks=26*application.frameRate:2==this._skill1Level?this._skill1Ticks=23*application.frameRate:this._skill1Ticks=20*application.frameRate,Bullet.shoot(this,this._enemy,"Spike")),this._skill1Ticks--,this._skill2Ticks<0&&this._skill2Level>0&&this._enemy){if(this._skill2Ticks=12*application.frameRate,1==this._skill2Level)var e=80;else if(2==this._skill2Level)var e=140;else var e=200;Bullet.shoot(this,this._enemy,"ScorchedEarth",{hitRaduis:this._guardRadius,force:e})}this._skill2Ticks--},n.getMuzzleX=function(){return this.x+33},n.getMuzzleY=function(){return this.y+7},e}(BombTower);egret.registerClass(BombTower4,"BombTower4");var MagicTower=function(t){function e(){t.apply(this,arguments)}__extends(e,t);var i=(__define,e),n=i.prototype;return n.initialize=function(e){t.prototype.initialize.call(this,e),this._skill&&5==this._skill.attrs.level&&(this._guardRadius=Math.round(1.05*this._guardRadius))},n.getForce=function(){var e=t.prototype.getForce.call(this);if(this._skill&&1==this._skill.attrs.level){var i=application.battle.getMagicTowers();e+=Math.round(.02*e*i.length)}return e},e}(ShootTower);egret.registerClass(MagicTower,"MagicTower");var MagicTower1=function(t){function e(){t.call(this),this.addBitmap("magictower1_png"),this._bulletClaz="Magic1"}__extends(e,t);var i=(__define,e),n=i.prototype;return n.getMuzzleX=function(){return this.x+30},n.getMuzzleY=function(){return this.y+15},e}(MagicTower);egret.registerClass(MagicTower1,"MagicTower1");var MagicTower2=function(t){function e(){t.call(this),this.addBitmap("magictower2_png"),this._bulletClaz="Magic2"}__extends(e,t);var i=(__define,e),n=i.prototype;return n.getMuzzleX=function(){return this.x+35},n.getMuzzleY=function(){return this.y+15},e}(MagicTower);egret.registerClass(MagicTower2,"MagicTower2");var MagicTower3=function(t){function e(){t.call(this),this.addBitmap("magictower3_png"),this._bulletClaz="Magic3"}__extends(e,t);var i=(__define,e),n=i.prototype;return n.getMuzzleX=function(){return this.x+43},n.getMuzzleY=function(){return this.y+15},e}(MagicTower);egret.registerClass(MagicTower3,"MagicTower3");var MagicTower4=function(t){function e(){t.call(this),this.addBitmap("magictower4_png").addClip("magictower4_guarding","east-guarding").addClip("magictower4_fighting","east-fighting"),this._bulletClaz="Magic4"}__extends(e,t);var i=(__define,e),n=i.prototype;return n.initialize=function(e){t.prototype.initialize.call(this,e),this._skill1Level=0,this._skill1Ticks=0,this._skill2Level=0,this._blackImpermanence=null,this._skill&&2==this._skill.attrs.level&&(this._upgradePrice=Math.round(.8*this._upgradePrice))},n.upgradeSkill=function(t){1==t?this._skill1Level++:(this._skill2Level++,this._blackImpermanence&&this._blackImpermanence.erase(),this._addBlackImpermanence())},n.skillUpgradable=function(t){return 1==t?this._skill1Level<3:2==t?this._skill2Level<3:!1},n.upgradable=function(){return!1},n.getSkillUpgradePrice=function(t){if(1==t)if(0==this._skill1Level)var e=325;else var e=200;else if(0==this._skill1Level)var e=300;else var e=150;return e},n.getSkillLevel=function(t){return 1==t?this._skill1Level:this._skill2Level},n._addBlackImpermanence=function(){if(1==this._skill2Level)var t={hp:250,arm:40,forceHigh:10,forceLow:5,guardX:this._guardX,guardY:this._guardY};else if(2==this._skill2Level)var t={hp:300,arm:45,forceHigh:15,forceLow:10,guardX:this._guardX,guardY:this._guardY};else var t={hp:350,arm:50,forceHigh:20,forceLow:15,guardX:this._guardX,guardY:this._guardY};this._blackImpermanence=application.pool.get("BlackImpermanence",t),this._blackImpermanence.setCenterX(this.getMuzzleX()),this._blackImpermanence.setCenterY(this.getMuzzleY()),this._blackImpermanence.setCreator(this),application.battle.addSoldier(this._blackImpermanence)},n.createSoldier=function(t){return this._blackImpermanence=t.clone({idleTicks:12*application.frameRate}),application.battle.addSoldier(this._blackImpermanence),this._blackImpermanence.setCreator(this),this._blackImpermanence},n._fighting=function(){if(t.prototype._fighting.call(this),this._skill1Level>0&&this._enemy&&this._skill1Ticks<0){this._skill1Ticks=12*application.frameRate;var e=this._skill1Level+3;Bullet.blast(this,"BlackWater",{hitRaduis:this._guardRadius,curseTicks:e*application.frameRate})}this._skill1Ticks--},n.getMuzzleX=function(){return this.x+40},n.getMuzzleY=function(){return this.y+15},n.targetKilled=function(t){if(t.getMaxHp()<500)if(this._blackImpermanence&&this._blackImpermanence.active())var e=application.pool.get("Ghost",{guardX:t.getCenterX(),guardY:t.getBottomY(),forceLow:2,forceHigh:9,arm:20});else var e=application.pool.get("Ghost",{guardX:t.getCenterX(),guardY:t.getBottomY()});else if(this._blackImpermanence&&this._blackImpermanence.active())var e=application.pool.get("WhiteImpermanence",{guardX:t.getCenterX(),guardY:t.getBottomY(),forceLow:3,forceHigh:15,arm:40});else var e=application.pool.get("WhiteImpermanence",{guardX:t.getCenterX(),guardY:t.getBottomY()});e.setCenterX(t.getCenterX()),e.setBottomY(t.getBottomY()),application.battle.addSoldier(e)},e}(MagicTower);egret.registerClass(MagicTower4,"MagicTower4",["SoldierCreator"]);var SoldierTower=function(t){function e(){t.call(this)}__extends(e,t);var i=(__define,e),n=i.prototype;return n.initialize=function(e){t.prototype.initialize.call(this,e),this._soldiers=[]},n.getGuardX=function(){return this._guardX},n.getGuardY=function(){return this._guardY},n.showFlag=function(){this._range=application.pool.get("GuardRange",{guardRadius:this._guardRadius}),this._range.x=this.getCenterX()-this._guardRadius,this._range.y=this.getCenterY()-this._guardRadius,this._range.width=this._guardRadius<<1,this._range.height=this._guardRadius<<1,application.battle.addEntity(this._range),this._flag=application.pool.get("FlagTip"),this._flag.setCenterX(this._guardX),this._flag.setCenterY(this._guardY),application.battle.addEntity(this._flag)},n.deselect=function(){t.prototype.deselect.call(this),this._flag&&(this._flag.erase(),this._flag=null)},n.createSoldier=function(t){var e=t.clone({idleTicks:application.frameRate<<2});return this._addSoldier(e),e},n.guard=function(){t.prototype.guard.call(this);var e=15;this._createSoldier(this._soldierClaz,{forceHigh:this._forceHigh,forceLow:this._forceLow,guardX:this._guardX+e,guardY:this._guardY+e,idleTicks:0}),this._createSoldier(this._soldierClaz,{forceHigh:this._forceHigh,forceLow:this._forceLow,guardX:this._guardX-e,guardY:this._guardY+e,idleTicks:application.frameRate}),this._createSoldier(this._soldierClaz,{forceHigh:this._forceHigh,forceLow:this._forceLow,guardX:this._guardX+e,guardY:this._guardY-e,idleTicks:2*application.frameRate})},n.guardAt=function(t,e){if(this.within(t,e,this._guardRadius)){for(var i=t-this._guardX,n=e-this._guardY,s=0;s<this._soldiers.length;s++)this._soldiers[s].guardAt(this._soldiers[s].getGuardX()+i,this._soldiers[s].getGuardY()+n);return this._guardX=t,this._guardY=e,!0}return!1},n.erase=function(){for(var e=0;e<this._soldiers.length;e++)this._soldiers[e].setCreator(null),this._soldiers[e].erase();this._soldiers=[],t.prototype.erase.call(this)},n._createSoldier=function(t,e){this._addSoldier(application.pool.get(t,e))},n._addSoldier=function(t){for(var e=!1,i=0;i<this._soldiers.length;i++)this._soldiers[i]==t&&(e=!0);e||this._soldiers.push(t),t.stand(this.getMuzzleX(),this.getMuzzleY()),t.setCreator(this),application.battle.addSoldier(t)},n.getMuzzleX=function(){var t=Entity.direction4(this.x,this.y,this._guardX,this._guardY);switch(t){case EntityDirection.east:return this.x+this.width;case EntityDirection.west:return this.x;case EntityDirection.north:case EntityDirection.south:return this.x+(this.width>>1)}},n.getMuzzleY=function(){var t=Entity.direction4(this.x,this.y,this._guardX,this._guardY);switch(t){case EntityDirection.east:case EntityDirection.west:return this.y+(this.height>>1);case EntityDirection.north:return this.y;case EntityDirection.south:return this.y+this.height}},e}(Tower);egret.registerClass(SoldierTower,"SoldierTower",["SoldierCreator"]);var SoldierTower1=function(t){function e(){t.call(this),this.addBitmap("soldiertower1_png"),this._soldierClaz="Soldier1"}__extends(e,t);var i=(__define,e);i.prototype;return e}(SoldierTower);egret.registerClass(SoldierTower1,"SoldierTower1");var SoldierTower2=function(t){function e(){t.call(this),this.addBitmap("soldiertower2_png"),this._soldierClaz="Soldier2"}__extends(e,t);var i=(__define,e);i.prototype;return e}(SoldierTower);egret.registerClass(SoldierTower2,"SoldierTower2");var SoldierTower3=function(t){function e(){t.call(this),this.addBitmap("soldiertower3_png"),this._soldierClaz="Soldier3"}__extends(e,t);var i=(__define,e);i.prototype;return e}(SoldierTower);egret.registerClass(SoldierTower3,"SoldierTower3");var SoldierTower4=function(t){function e(){t.call(this),this.addBitmap("soldiertower4_png"),this._soldierClaz="Soldier4"}__extends(e,t);var i=(__define,e),n=i.prototype;return n.initialize=function(e){t.prototype.initialize.call(this,e),this._skill1Level=0,this._skill2Level=0,this._skill3Level=0},n.totalSkills=function(){return 3},n.upgradeSkill=function(t){if(1==t){this._skill1Level++;for(var e=0;e<this._soldiers.length;e++)this._soldiers[e].addMaxHp(50*this._skill1Level)}else 2==t?this._skill2Level++:this._skill3Level++},n.skillUpgradable=function(t){return 1==t?this._skill1Level<3:2==t?this._skill2Level<3:this._skill3Level<3},n.upgradable=function(){return!1},n.getSkillUpgradePrice=function(t){if(1==t)var e=200;else if(2==t)if(0==this._skill2Level)var e=250;else var e=150;else if(0==this._skill3Level)var e=250;else var e=150;return e},n.getSkillLevel=function(t){return 1==t?this._skill1Level:2==t?this._skill2Level:this._skill3Level},e}(SoldierTower);egret.registerClass(SoldierTower4,"SoldierTower4");var CubicBezier=function(){function t(t){this._m1=new Matrix,this._m2=new Matrix([[1,0,0,0],[-3,3,0,0],[3,-6,3,0],[-1,3,-3,1]]),this._m3=new Matrix([[t[0][0],t[0][1]],[t[1][0],t[1][1]],[t[2][0],t[2][1]],[t[3][0],t[3][1]]])}var e=(__define,t),i=e.prototype;return i.get=function(t){this._m1.set([[1,t*t,t*t*t,t*t*t*t]]);var e=this._m1.mul(this._m2).mul(this._m3);return[e.get()[0][0],e.get()[0][1]]},t.getCtrlPoints=function(t,e,i,n){if(void 0===i&&(i=.5),void 0===n&&(n=.5),1>e)var s=t[0][0]+(t[1][0]-t[0][0])*i,a=t[0][1]+(t[1][1]-t[0][1])*i;else var s=t[e][0]+(t[e+1][0]-t[e-1][0])*i,a=t[e][1]+(t[e+1][1]-t[e-1][1])*i;if(e>t.length-3)var r=t.length-1,o=t[r][0]-(t[r][0]-t[r-1][0])*n,h=t[r][1]-(t[r][1]-t[r-1][1])*n;else var o=t[e+1][0]-(t[e+2][0]-t[e][0])*n,h=t[e+1][1]-(t[e+2][1]-t[e][1])*n;return[[s,a],[o,h]]},t}();egret.registerClass(CubicBezier,"CubicBezier");var Matrix=function(){function t(t){t&&(this._data=t)}var e=(__define,t),i=e.prototype;return i.mul=function(t){var e=[],i=this._data,n=t.get(),s=i[0].length;n.length!=i[0].length&&console.error("矩阵不能相乘");for(var a=0;a<i.length;a++){e[a]=[];for(var r=0;r<n[0].length;r++){e[a][r]=0;for(var o=0;s>o;o++)e[a][r]+=i[a][o]*n[o][r]}}return this._data=e,this},i.set=function(t){this._data=t},i.get=function(){return this._data},t}();egret.registerClass(Matrix,"Matrix");var Utility=function(){function t(){}var e=(__define,t);e.prototype;return t.log10=function(t){for(var e=0;t>=9;)e+=1,t/=10;return e},t.format=function(e){try{if(99999>=e)return new Number(e).toFixed();
for(var i="",n=0;n<t.units.length;n++){if(10>e)return new Number(e).toFixed(2)+i;if(100>e)return new Number(e).toFixed(1)+i;if(1e3>e)return new Number(e).toFixed()+i;i=t.units[n],e/=1e3}return new Number(e).toFixed()+i}catch(s){return console.error("format "+e+" error "+s.message),"0"}},t.delay=function(t,e){var i=new egret.Timer(e,1);i.addEventListener(egret.TimerEvent.TIMER,function(e){t()},this),i.start()},t.takeOverConsole=function(e){var i=window.console;if(i)for(var n=["log","warn","error"],s=0;s<n.length;s++)t.intercept(n[s],e)},t.intercept=function(t,e){var i=console[t];console[t]=function(){try{var n=Array.prototype.slice.apply(arguments).join(" ");"log"===t?e.info(n):"warn"==t?e.warn(n):e.error(n),i.apply?i.apply(console,arguments):i(n)}catch(s){}}},t.require=function(e){return Q.Promise(function(i,n,s){for(var a,r=/(.js)$/i,o=/(.css)$/i,h=0;h<t.loadedFiles.length;h++)if(t.loadedFiles[h]==e)return void i("");if(r.test(e)){var l=new egret.Timer(6e4,1);l.addEventListener(egret.TimerEvent.TIMER,function(t){var i="load file timeout "+e;console.error(i),n(i)},this),l.start(),a=document.createElement("script"),a.src=e,a.onreadystatechange=function(){("loaded"===a.readyState||"complete"===a.readyState)&&(l.stop(),a.onreadystatechange=null,t.loadedFiles.push(e),i(""))},a.onload=function(){l.stop(),t.loadedFiles.push(e),i("")},document.head.appendChild(a)}else if(o.test(e))a=document.createElement("link"),a.rel="stylesheet",a.type="text/css",a.href=e,document.head.appendChild(a),t.loadedFiles.push(e),i("");else{var c="unknown file type to load "+e;console.error(c),n(c)}})},t.loadedFiles=[],t.units=["k","m","b","t","a","A","c","C","d","D","e","E","f","F","g","G","h","H","i","!","j","J","l","L","n","N","o","O","p","P","q","Q","r","R","s","S","u","U","v","V","w","W","x","X","y","Y","z","Z","aa","AA","cc","CC","dd","DD","ee","EE","ff","FF","gg","GG","hh","HH","ii","!!","jj","JJ","ll","LL","nn","NN","oo","OO","pp","PP","qq","QQ","rr","RR","ss","SS","uu","UU","vv","VV","ww","WW","xx","XX","yy","YY","zz","ZZ"],t}();egret.registerClass(Utility,"Utility");var AbstractUI=function(t){function e(e){t.call(this),this.addEventListener(eui.UIEvent.COMPLETE,this._uiCompHandler,this),this.skinName="resource/custom_skins/"+e+".exml"}__extends(e,t);var i=(__define,e),n=i.prototype;return n._uiCompHandler=function(){var t=this;Utility.delay(function(){t.onRefresh()},10)},n.refresh=function(){try{this.onRefreshAgain()}catch(t){console.error("refresh onRefresh failed "+t.message)}},n.onRefresh=function(){},n.onRefreshAgain=function(){this.onRefresh()},n.show=function(t,e){e?(this.hide(),application.showUI(t)):application.showUI(t,this)},n.hide=function(){application.hideUI(this)},e}(eui.Component);egret.registerClass(AbstractUI,"AbstractUI");var BattleItem=function(t){function e(e){var i=this;t.call(this,"battleItemSkin"),this._stage=e,this._locked=!0,this.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){i.show(new BattleLoadingUI(i._stage))},this)}__extends(e,t);var i=(__define,e),n=i.prototype;return n.onRefresh=function(){this.imgBattle.source="map_"+this._stage.toString()+"_png",this.imgLock.visible=this._locked,this.imgLock.x=this.imgBattle.x+(this.imgBattle.width-this.imgLock.width)/2,this.imgLock.y=this.imgBattle.y+(this.imgBattle.height-this.imgLock.height)/2},n.unlock=function(){this._locked&&(this._locked=!1,this.refresh())},e}(AbstractUI);egret.registerClass(BattleItem,"BattleItem");var BattleLoadingUI=function(t){function e(e){t.call(this,"battleLoadingUISkin");var i=this;application.battle=application.pool.get("Battle"+e),application.battle.loadResource({stage:e,level:1}).then(function(){application.hideUI(i),application.showUI(new BattleUI)},function(t){application.hideUI(i),Toast.launch(t.message)})}__extends(e,t);var i=(__define,e);i.prototype;return e}(AbstractUI);egret.registerClass(BattleLoadingUI,"BattleLoadingUI");var BattleOptionUI=function(t){function e(e,i){var n=this;t.call(this,"battleOptionUISkin"),this._result=application.battle.getResult(),this._result.save(),this.imgStart.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){e(),application.hideUI(n)},this),this.imgQuit.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){i(),application.hideUI(n)},this)}__extends(e,t);var i=(__define,e),n=i.prototype;return n.onRefresh=function(){1==this._result.attrs.result?this.imgResult.source="end_win_png":this.imgResult.source="end_defeat_png"},e}(AbstractUI);egret.registerClass(BattleOptionUI,"BattleOptionUI");var BattleToolItem=function(t){function e(e){var i=this;t.call(this,"battleToolItemSkin"),this._tool=e,this._ticks=30,this._maxTicks=30,this._shapeShield=null,this.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){i._ticks==i._maxTicks&&("nectar"==i._tool.category||"mammon"==i._tool.category?i.use(application.battle.getCenterX(),application.battle.getCenterY()):application.battle.readyUseTool(i))},this),application.stopwatch.addEventListener("second",function(t){this._tool.count>0&&this._ticks<this._maxTicks&&(this._ticks++,this._drawProgress(this._ticks,this._maxTicks))},this)}__extends(e,t);var i=(__define,e),n=i.prototype;return n.onRefresh=function(){this.imgTool.source=this._tool.category+"_png",this.lblCount.text=this._tool.count.toString(),this._tool.count<=0&&this._drawProgress(0,this._maxTicks)},n.use=function(t,e){this._tool.count=Math.max(0,this._tool.count-1),application.dao.save("Tool",this._tool),"nectar"==this._tool.category?application.battle.incLives(5):"freeze"==this._tool.category?Bullet["throw"](t,e,t,e,"Freeze"):"thunder"==this._tool.category?Bullet["throw"](t,e,t,e,"Thunder"):"mammon"==this._tool.category&&application.battle.incGolds(500),this._ticks=0,this.refresh()},n._drawProgress=function(t,e){this._shapeShield||(this._shapeShield=new egret.Shape,this._shapeShield.width=this.width,this._shapeShield.height=this.height,this.addChild(this._shapeShield));var i=this.width/2,n=this.height/2,s=this.height/2-5;this._shapeShield.graphics.clear(),this._shapeShield.graphics.beginFill(0,.3),this._shapeShield.graphics.moveTo(i,n),this._shapeShield.graphics.lineTo(i,n-2*s),this._shapeShield.graphics.drawArc(i,n,s,(2*t/e-.5)*Math.PI,1.5*Math.PI,!1),this._shapeShield.graphics.lineTo(i,n),this._shapeShield.graphics.endFill()},e}(AbstractUI);egret.registerClass(BattleToolItem,"BattleToolItem");var BattleSystemToolItem=function(t){function e(e){t.call(this,e),this._ticks=15,this._maxTicks=15;var i=Skill.get(application.skills,"Fireball",0);i&&(1==i.attrs.level&&(this._maxTicks-=5),3==i.attrs.level&&(this._maxTicks-=5))}__extends(e,t);var i=(__define,e),n=i.prototype;return n.onRefresh=function(){"soldier"==this._tool.category?this.imgTool.source="soldier_png":this.imgTool.source="fireball_png",this.lblCount.visible=!1},n.use=function(t,e){if("soldier"==this._tool.category)this._addReinforce(t,e,t-10,e-10),this._addReinforce(t,e,t+10,e+10);else{var i="Fireball",n=Skill.get(application.skills,"Fireball",0);if(n)if(n.attrs.level>=5)for(var s=application.battle.getEntrances(),a=0;a<s.length;a++)Bullet["throw"](s[a][0],s[a][1]-200,s[a][0],s[a][1],i);else n.attrs.level>=3?(Bullet["throw"](t+10,e-200,t+10,e,i),Bullet["throw"](t,e-200,t,e,i)):Bullet["throw"](t,e-200,t,e,i);else Bullet["throw"](t,e-200,t,e,i)}this._ticks=0},n._addReinforce=function(t,e,i,n){var s=application.pool.get("Reinforce",{guardX:i,guardY:n});s.stand(t,e),application.battle.addSoldier(s)},e}(BattleToolItem);egret.registerClass(BattleSystemToolItem,"BattleSystemToolItem");var BattleUI=function(t){function e(){t.call(this,"battleUISkin");var e=this;e._music=RES.getRes("bg_mp3"),e._music.type=egret.Sound.MUSIC,e.grpHeader.touchEnabled=!1,application.dao.fetch("Tool",{customer_id:application.me.attrs.id}).then(function(t){for(var i=["thunder","freeze","nectar","mammon"],n=0;n<i.length;n++){for(var s=null,a=0;a<t.length;a++)t[a].category==i[n]&&(s=t[a],s.count=s.count||0);null==s&&(s={category:i[n],count:1,customer_id:application.me.attrs.id}),e.grpBoughtTools.addChild(new BattleToolItem(s))}}),application.dao.addEventListener("Battle",function(t){parseInt(e.lblGolds.text)!=application.battle.getGolds()&&e._animateStep(e.lblGolds,parseInt(e.lblGolds.text),application.battle.getGolds()),e.lblLives.text=application.battle.getLives().toString(),e.lblWaves.text=application.battle.getCurrentWave().toString()},e),e.imgTool.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){e.grpTools.visible=!e.grpTools.visible},e),e.imgBack.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){e._overBattle()},e),e.imgHelp.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){HelpUI.showMainHelp()},e),e.imgStart.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){application.battle.fight(),e.imgTool.visible=!0,e.grpSystemTools.visible=!0,e.imgStart.visible=!1},e)}__extends(e,t);var i=(__define,e),n=i.prototype;return n.onRefresh=function(){this.grpSystemTools.visible=!1,this.grpSystemTools.addChild(new BattleSystemToolItem({category:"soldier",count:1})),this.grpSystemTools.addChild(new BattleSystemToolItem({category:"fireball",count:1})),this._svBattle=new egret.ScrollView,this._svBattle.width=this.width,this._svBattle.height=this.height,this._svBattle.bounces=!1,this.grpBattle.addChild(this._svBattle),this._buildBattle()},n._animateStep=function(t,e,i){if(e!=i){var n=Math.min(Math.abs(e-i),20),s=(i-e)/n,a=new egret.Timer(50,n);a.addEventListener(egret.TimerEvent.TIMER,function(i){t.text=Math.round(e+s*i.target.currentCount).toString()},this),a.addEventListener(egret.TimerEvent.TIMER_COMPLETE,function(e){t.text=i.toString()},this),a.start()}},n._buildBattle=function(){application.battle.setUI(this),this.imgStart.visible=!0,this.grpTools.visible=!1,this.imgTool.visible=!1,this.grpSystemTools.visible=!1,this.grpHeader.visible=!0,this._running=!0,this.lblLives.text="0",this.lblGolds.text="0",this.lblWaves.text="0",this.lblTotalWaves.text=application.battle.getTotalWaves().toString(),this._svBattle.setContent(application.battle),application.battle.build(),this.addEventListener(egret.Event.ENTER_FRAME,this._onEnterFrame,this)},n._overBattle=function(){var t=this;t.imgStart.visible=!1,t.grpTools.visible=!1,t.imgTool.visible=!1,t.grpSystemTools.visible=!1,t.grpHeader.visible=!1,t._running&&(t._running=!1,t._channel&&t._channel.stop(),t.removeEventListener(egret.Event.ENTER_FRAME,t._onEnterFrame,t),application.showUI(new BattleOptionUI(function(){var e=application.battle.getClaz();t._eraseBattle(),application.battle=application.pool.get(e),t._buildBattle()},function(){t._eraseBattle(),t.hide()})))},n._eraseBattle=function(){application.battle&&(application.battle.erase(),this._svBattle.removeContent(),application.pool.set(application.battle),application.battle=null)},n._onEnterFrame=function(t){application.battle.update()?this._overBattle():application.battle.paint()},e}(AbstractUI);egret.registerClass(BattleUI,"BattleUI");var BlockUI=function(t){function e(){var e=this;t.call(this,"blockUISkin"),this.addEventListener(egret.TouchEvent.TOUCH_TAP,function(t){for(var i=0;i<e.numChildren;i++){var n=e.getChildAt(i);if(n!=e.rcBlock&&n.hitTestPoint(t.stageX,t.stageY))return}application.hideUI(e)},this)}__extends(e,t);var i=(__define,e);i.prototype;return e}(AbstractUI);egret.registerClass(BlockUI,"BlockUI");var BuyToolUI=function(t){function e(e,i){t.call(this),this._name=e,this._price=i,this.addEventListener(eui.UIEvent.COMPLETE,this.uiCompHandler,this),this.skinName="resource/custom_skins/buyToolUISkin.exml",this.lblGold.touchEnabled=!1,this.lblPrice.touchEnabled=!1}__extends(e,t);var i=(__define,e),n=i.prototype;return n.uiCompHandler=function(){var t=this;this.imgBack.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){application.hideUI(t)},this),this.imgBuy.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){t.buy()},this),this.lblGold.text="","time"==this._name?(this.imgIcon.source="timeh_png",this.lblGold.text=Utility.format(3600*application.me.attrs.output*48)):"hit"==this._name?this.imgIcon.source="hith_png":"ticket"==this._name?this.imgIcon.source="ticketh_png":"vip"==this._name&&(this.imgIcon.source="VIPh_png"),"time"==this._name||"hit"==this._name?(application.me.attrs.diamond<this._price?this.imgBuy.source="buttondiano_png":this.imgBuy.source="buttondia_png",this.lblPrice.text=this._price.toString()):(this.imgBuy.source="topupbutton_png",this.lblPrice.text="")},n.buy=function(){"time"==this._name?this.buyTime():"hit"==this._name?this.buyHit():"ticket"==this._name?this.buyTicket():"vip"==this._name&&this.buyVIP()},n.buyTime=function(){application.me.attrs.diamond>this._price?(application.me.attrs.diamond-=this._price,application.me.earnGold(3600*application.me.attrs.output*48),application.me.saveNow(),application.channel.track(TRACK_CATEGORY_DIAMOND,TRACK_ACTION_DEC,"购买了时光沙漏",this._price),Toast.launch("购买了时光沙漏"),application.hideUI(this)):application.showUI(new ChargeTipUI)},n.buyHit=function(){0==application.me.attrs.total_hits?application.me.attrs.diamond>this._price?(application.me.attrs.diamond-=this._price,application.me.attrs.total_hits=3,application.me.saveNow(),application.channel.track(TRACK_CATEGORY_DIAMOND,TRACK_ACTION_DEC,"购买了暴击",this._price),Toast.launch("购买了暴击"),application.hideUI(this)):application.showUI(new ChargeTipUI):Toast.launch("你还有"+application.me.attrs.total_hits+"个暴击，请用完后再购买")},n.buyTicket=function(){2==application.me.attrs.vip?Toast.launch("你已经购买了VIP，终身免费，不需要购买月票"):(Order.buyTicket(application.me),application.hideUI(this))},n.buyVIP=function(){2==application.me.attrs.vip?Toast.launch("你已经购买了VIP，终身免费"):(Order.buyVIP(application.me),application.hideUI(this))},e}(eui.Component);egret.registerClass(BuyToolUI,"BuyToolUI");var ChargeTipUI=function(t){function e(){var e=this;t.call(this),this.skinName="resource/custom_skins/chargeTipUISkin.exml",this.imgBack.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){application.hideUI(e)},this),this.imgCharge1.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){Order.charge(application.me,"diamond",2)},this),this.imgCharge2.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){Order.charge(application.me,"diamond600",5)},this),this.imgCharge3.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){Order.charge(application.me,"diamond1300",10)},this),this.imgCharge4.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){Order.charge(application.me,"diamond4500",30)},this),this.imgCharge5.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){Order.charge(application.me,"diamond18000",100)},this),this.imgCharge6.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){Order.charge(application.me,"diamond100000",500)},this),this.imgCharge7.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){2==application.me.attrs.vip?Toast.launch("你已经购买了VIP，终身免费，不需要购买月票"):Order.buyTicket(application.me)},this),this.imgCharge8.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){2==application.me.attrs.vip?Toast.launch("你已经购买了VIP，终身免费"):Order.buyVIP(application.me)},this)}__extends(e,t);var i=(__define,e);i.prototype;return e}(eui.Component);egret.registerClass(ChargeTipUI,"ChargeTipUI");var FirstChargeBonusUI=function(t){function e(){var e=this;t.call(this),this.skinName="resource/custom_skins/firstChargeBonusUISkin.exml",this.btnCancel.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){application.hideUI(e)},this),this.btnCharge.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){application.hideUI(e),application.showUI(new ChargeTipUI)},this)}__extends(e,t);var i=(__define,e);i.prototype;return e}(eui.Component);egret.registerClass(FirstChargeBonusUI,"FirstChargeBonusUI");var GiftUI=function(t){function e(){t.call(this),this.addEventListener(eui.UIEvent.COMPLETE,this.uiCompHandler,this),this.skinName="resource/custom_skins/giftUISkin.exml",this.imgPicks=[this.imgPick1,this.imgPick2,this.imgPick3,this.imgPick4,this.imgPick5,this.imgPick6,this.imgPick7,this.imgPick8];for(var e=0;e<this.imgPicks.length;e++)this.imgPicks[e].visible=!1;this.imgRet.addEventListener(egret.TouchEvent.TOUCH_BEGIN,function(){application.hideUI(this)},this),this.imgPick1.addEventListener(egret.TouchEvent.TOUCH_BEGIN,function(t){this.pickGift(this.gift(GiftCategory.Login))},this),this.imgPick2.addEventListener(egret.TouchEvent.TOUCH_BEGIN,function(t){this.pickGift(this.gift(GiftCategory.Online))},this),this.imgPick3.addEventListener(egret.TouchEvent.TOUCH_BEGIN,function(t){this.pickBidGift()},this),this.imgPick4.addEventListener(egret.TouchEvent.TOUCH_BEGIN,function(t){this.pickTicketGift()},this),this.imgPick5.addEventListener(egret.TouchEvent.TOUCH_BEGIN,function(t){this.pickShareGift()},this),this.imgPick6.addEventListener(egret.TouchEvent.TOUCH_BEGIN,function(t){this.pickFirstChargeGift()},this),this.imgPick7.addEventListener(egret.TouchEvent.TOUCH_BEGIN,function(t){this.pickOutputGift()},this),this.imgPick8.addEventListener(egret.TouchEvent.TOUCH_BEGIN,function(t){this.pickAttentionGift()},this)}__extends(e,t);var i=(__define,e),n=i.prototype;return n.pickGift=function(t){0==t.locked&&(this.lockGift(t,2),this.updateCustomer(t))},n.pickBidGift=function(){var t=this.gift(GiftCategory.Bid);0==t.locked?this.pickGift(t):1==t.locked&&application.hideUI(this)},n.pickTicketGift=function(){var t=this.gift(GiftCategory.Ticket);0==t.locked?this.pickGift(t):1==t.locked&&application.hideUI(this)},n.pickShareGift=function(){var t=this,e=t.gift(GiftCategory.Share);if(0==e.locked)t.pickGift(e);else if(1==e.locked){var i=application.baseUrl+"headline/bin-release/web/bin-release/index.html?platInfo=open_90359_9166&appId=90359&egret.runtime.spid=9166&appId=90359&channelId=9166&isNewApi=1&egretSdkDomain=http://api.egret-labs.org/v2&egretServerDomain=http://api.egret-labs.org/v2&egretRv=669",n=application.baseUrl+"headline/resource/art/home/icon.png",s={title:"我来上头条，女神任我挑！",description:"最炫最浪的舞蹈经营类游戏，无需下载，点开即送，多重豪礼等你来拿！",url:i,img_url:n,img_title:"头条关注"};application.channel.share(s).then(function(){t.lockGift(e,0)},function(t){Toast.launch(t)})}},n.pickFirstChargeGift=function(){var t=this.gift(GiftCategory.Charge);0==t.locked?this.pickGift(t):1==t.locked&&(application.hideUI(this),application.showUI(new FirstChargeBonusUI))},n.pickOutputGift=function(){var t=this.gift(GiftCategory.Output);if(0==t.locked){var e=10*t.data;t.data=e.toString(),Utility.log10(application.me.attrs.output)>=Utility.log10(e)?this.lockGift(t,0):this.lockGift(t,2),this.lblOutputGift.text=Utility.format(e),this.updateCustomer(t)}},n.pickAttentionGift=function(){var t=this,e=t.gift(GiftCategory.Attention);0==e.locked?t.pickGift(e):1==e.locked&&application.channel.attention({}).then(function(){t.lockGift(e,0)},function(t){Toast.launch(t)})},n.lockGift=function(t,e){t.locked=e,this.renderGift(t),2==e&&(t.last_pick_day=(new Date).toString()),application.dao.save("Gift",t)},n.refresh=function(){this.uiCompHandler()},n.uiCompHandler=function(){var t=this;Gift.check(application.me).then(function(e){t.gifts=e;for(var i=0;i<t.imgPicks.length;i++)t.imgPicks[i].visible=!0;t.renderGift(t.gift(GiftCategory.Login)),t.renderOnlineGift(),t.renderGift(t.gift(GiftCategory.Bid)),t.renderTicketGift(),t.renderGift(t.gift(GiftCategory.Share)),t.renderGift(t.gift(GiftCategory.Charge)),t.renderOutputGift(),t.renderGift(t.gift(GiftCategory.Attention))})},n.renderOnlineGift=function(){var t=this.gift(GiftCategory.Online);if(this.lblOnlineGiftTimeout.text="",1==t.locked){this.onlineGiftTimeout=parseInt(t.data);var e=new egret.Timer(1e3,this.onlineGiftTimeout);e.addEventListener(egret.TimerEvent.TIMER,function(t){this.lblOnlineGiftTimeout.text=Math.floor(this.onlineGiftTimeout/60).toString()+":"+Math.floor(this.onlineGiftTimeout%60).toString(),this.onlineGiftTimeout>0&&(this.onlineGiftTimeout-=1)},this),e.addEventListener(egret.TimerEvent.TIMER_COMPLETE,function(e){this.lockGift(t,0)},this),e.start()}this.renderGift(t)},n.renderTicketGift=function(){var t=this.gift(GiftCategory.Ticket);if(0==application.me.attrs.vip)this.lblTicketGiftTimeout.text="";else{var e=new Date;if(2==application.me.attrs.vip)this.lblTicketGiftTimeout.text="永久";else{var i=new Date(application.me.attrs.ticket),n=i.getTime()-e.getTime(),s=Math.min(30,Math.floor(n/864e5));0>=s?(this.lblTicketGiftTimeout.text="",application.me.resetTicket(0)):this.lblTicketGiftTimeout.text=s.toString()+"天"}}this.renderGift(t)},n.renderOutputGift=function(){var t=this.gift(GiftCategory.Output);this.lblOutputGift.text=Utility.format(t.data),this.renderGift(t)},n.gift=function(t){return this.gifts[t-1]},n.renderGift=function(t){var e=this.imgPicks[t.category-1];1==t.locked?t.category==GiftCategory.Share?e.source="share_png":t.category==GiftCategory.Attention?e.source="att_png":e.source="unpick_png":0==t.locked?e.source="pick_png":e.source="picked_png"},n.updateCustomer=function(t){var e="";t.diamond>0&&(e+="获得"+t.diamond.toString()+"钻石",application.channel.track(TRACK_CATEGORY_DIAMOND,TRACK_ACTION_INC,"礼物奖励",t.diamond)),t.gold>0&&(e+=e.length>0?"，":"获得",e+=t.gold.toString()+"金币"),t.metal>0&&(e+=e.length>0?"，":"获得",e+=t.metal.toString()+"奖章"),Toast.launch(e),application.me.attrs.metal+=t.metal,application.me.attrs.gold+=t.gold,application.me.attrs.diamond+=t.diamond,application.me.saveNow()},e}(eui.Component);egret.registerClass(GiftUI,"GiftUI");var GuideUI=function(t){function e(){var e=this;t.call(this),this.step=0,this.skinName="resource/custom_skins/guideUISkin.exml",this.imgBack.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){e.over()},this);var i=!0,n=0;this.timer=new egret.Timer(100,0),this.timer.addEventListener(egret.TimerEvent.TIMER,function(t){n%5==0&&(i=!i),n+=1,i?"guideconti_png"!=this.imgFinger.source?this.imgFinger.y-=1:this.imgFinger.x-=1:"guideconti_png"!=this.imgFinger.source?this.imgFinger.y+=1:this.imgFinger.x+=1},this),this.timer.start(),this.imgBonus.visible=!1}__extends(e,t);var i=(__define,e),n=i.prototype;return n.setOverCallback=function(t){this.overCallback=t},n.next=function(){switch(this.step){case 1:if(this.click++,5==this.click){this.step++;break}return;default:this.step++}switch(this.step){case 1:this.renderStep1();break;case 2:this.renderStep2();break;case 3:this.renderStep3();break;case 4:this.renderStep4();break;case 5:this.renderStep5();break;case 6:this.renderStep6();break;case 7:this.renderStep7();break;case 8:this.renderStep8()}},n.renderStep1=function(){this.click=0,this.imgSpeak.source="G1_png",this.imgFocus.source="highlight1_png",this.imgFinger.source="guidearr_png",this.renderBlock(121,77,288,350),this.imgFinger.x=354,this.imgFinger.y=281,this.imgFocus.x=78,this.imgFocus.y=315,this.imgSpeak.x=151,this.imgSpeak.y=607,this.imgBg.x=0,this.imgBg.y=523,this.touchEnabled=!1,this.imgFocus.touchEnabled=!1,this.imgBg.touchEnabled=!1},n.renderStep2=function(){this.imgSpeak.source="G2_png",this.imgFocus.source="highlight2_png",this.renderBlock(247,409,156,104),this.imgFinger.x=308,this.imgFinger.y=377,this.imgFocus.x=206,this.imgFocus.y=384,this.imgSpeak.x=140,this.imgSpeak.y=601},n.renderStep3=function(){this.imgSpeak.source="G3_png"},n.renderStep4=function(){this.renderBlock(95,709,143,91),this.imgSpeak.source="G4_png",this.imgFocus.source="highlight3_png",this.imgFinger.x=155,this.imgFinger.y=671,this.imgFocus.x=74,this.imgFocus.y=702,this.imgSpeak.x=139,this.imgSpeak.y=597,this.imgBg.x=0,this.imgBg.y=518},n.renderStep5=function(){this.renderBlock(0,300,480,173),this.imgSpeak.source="G5_png",this.imgFinger.x=44,this.imgFinger.y=300,this.imgFocus.x=-14,this.imgFocus.y=355,this.imgSpeak.x=138,this.imgSpeak.y=505,this.imgBg.x=0,this.imgBg.y=423},n.renderStep6=function(){this.renderBlock(0,540,480,191),this.imgSpeak.source="G6_png",this.imgFocus.source="highlight4_png",this.imgFinger.x=226,this.imgFinger.y=536,this.imgFocus.x=4,this.imgFocus.y=537,this.imgSpeak.x=138,this.imgSpeak.y=390,this.imgBg.x=0,this.imgBg.y=316},n.renderStep7=function(){this.imgSpeak.source="G7_png",this.imgFinger.source="guideconti_png",this.imgFocus.visible=!1,this.renderBlock(0,0,0,0),this.imgFinger.x=395,this.imgFinger.y=679,this.imgSpeak.x=138,this.imgSpeak.y=599,this.imgBg.x=0,this.imgBg.y=523,this.touchEnabled=!0,this.touchChildren=!0,this.imgFinger.addEventListener(egret.TouchEvent.TOUCH_BEGIN,function(){this.next()},this)},n.renderStep8=function(){this.imgSpeak.source="G8_png",this.imgFinger.visible=!1,this.imgBonus.visible=!0,this.renderBlock(0,0,0,0),this.imgBonus.x=376,this.imgBonus.y=653,this.imgBonus.addEventListener(egret.TouchEvent.TOUCH_BEGIN,function(){this.over()},this)},n.renderBlock=function(t,e,i,n){this.rcRight.x=t+i,this.rcRight.y=0,this.rcRight.height=800,this.rcRight.width=480-this.rcRight.x,this.rcTop.x=this.rcTop.y=0,this.rcTop.height=e,this.rcTop.width=this.rcRight.x,this.rcMiddle.x=0,this.rcMiddle.y=e,this.rcMiddle.width=t,this.rcMiddle.height=n,this.rcBottom.x=0,this.rcBottom.y=e+n,this.rcBottom.width=this.rcTop.width,this.rcBottom.height=this.rcRight.height-e-n},n.over=function(){application.hideUI(this),application.guideUI=null,application.me.attrs.metal+=1,application.me.attrs.diamond+=500,application.me.saveNow(),this.timer.stop(),this.overCallback&&this.overCallback()},e}(eui.Component);egret.registerClass(GuideUI,"GuideUI");var HelpUI=function(t){function e(e){var i=this;t.call(this),this.skinName="resource/custom_skins/helpUISkin.exml",this.lblContent.text=e,this.lblVersion.text=application.version,this.imgReport.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){application.hideUI(i),application.showUI(new ReportUI)},this),this.imgBack.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){application.hideUI(i)},this)}__extends(e,t);var i=(__define,e);i.prototype;return e.showMainHelp=function(){var t="玩法\n";t+="1. 点击中间舞者可产生金币，金币用来升级运营项目，而运营项目随等级提高从而产生更多的金币。\n",t+="2. 金币可以用来参加头条拍卖，每天最高出价者会成为头条，获得头条殊荣，勋章和钻石奖励。\n",t+="3. 道具可以帮助玩家快速获得大量金币和永久提高运营项目的每秒产量。\n",t+="4. 排行榜会按照勋章的个数排名，勋章数量一致时则按照金币的总量排名。\n",application.showUI(new e(t))},e}(eui.Component);egret.registerClass(HelpUI,"HelpUI");var HomeUI=function(t){function e(){t.call(this,"homeUISkin"),this._paths=[[[327,95],[337,142],[276,157],[211,189],[143,126]],[[100,92],[40,170]],[[58,242],[131,300]],[[228,297],[303,262]],[[320,186],[486,119]],[[526,152],[474,247]],[[569,272],[636,269]],[[720,239],[777,221],[796,289]],[[898,273],[1031,286]],[[1103,232],[1137,189],[1033,191]],[[1011,147],[1154,139]],[[1212,98],[1169,23],[977,64]],[[881,109],[838,150]],[[727,168],[592,150],[640,96]]],this._battles=[[281,28],[112,55],[7,174],[137,242],[275,187],[490,86],[483,251],[643,194],[809,234],[1041,236],[951,155],[1149,111],[882,38],[736,107],[643,36]],application.dao.addEventListener("Result",function(t){var e=t.data;if(1==e.result){var i=Math.min(this._battles.length,e.stage);this._battleItems[i-1].unlock(),this._drawPathSlowly(i)}},this)}__extends(e,t);var i=(__define,e),n=i.prototype;return n.onRefresh=function(){var t=this;t._battleItems=[];for(var e=0;e<t._battles.length;e++){var i=new BattleItem(e+1);i.x=t._battles[e][0],i.y=t._battles[e][1],t._battleItems.push(i)}t._shapePath=new egret.Shape,t._shapePath.x=t.imgBg.x,t._shapePath.y=t.imgBg.y,t._shapePath.width=t.imgBg.width,t._shapePath.height=t.imgBg.height,application.dao.fetch("Result",{customer_id:application.me.attrs.id,result:1},{order:"stage DESC",limit:1}).then(function(e){if(t.grpMap.addChild(t._shapePath),t._battleItems[0].unlock(),t.grpMap.addChild(t._battleItems[0]),e.length>0)var i=Math.min(t._battles.length,e[0].stage);else var i=Math.min(t._battles.length,1);for(var n=1;n<t._battles.length;n++)t.grpMap.addChild(t._battleItems[n]),i>n?(t._battleItems[n].unlock(),t._drawPathQuckly(n+1,0)):t._drawPathQuckly(n+1,11119017)})},n._drawPathQuckly=function(t,e){var i=this._paths[t-2];if(i)for(var n=0;n<i.length-1;n++){var s=0,a=this._createCubicBezier(i,n);for(0==n&&this._drawPoint(a.get(0),e);1>s;)s=this._drawPathPoint(a,s,e)}},n._drawPathSlowly=function(t){var e=this,i=this._paths[t-2];if(i){var n=0,s=0,a=e._createCubicBezier(i,n);e._drawPoint(a.get(0),0);var r=setInterval(function(){1>s?s=e._drawPathPoint(a,s,0):(n+=1,n>=i.length-1?clearInterval(r):(s=0,a=e._createCubicBezier(i,n)))},100)}},n._createCubicBezier=function(t,e){var i=CubicBezier.getCtrlPoints(t,e);return new CubicBezier([t[e],i[0],i[1],t[e+1]])},n._drawPathPoint=function(t,e,i){for(var n=t.get(e);1>=e;){e+=.01;var s=t.get(e),a=Math.round(Math.pow(n[0]-s[0],2)+Math.pow(n[1]-s[1],2));if(a>=64)return this._drawPoint(s,i),e}return e},n._drawPoint=function(t,e){this._shapePath.graphics.beginFill(e,1),this._shapePath.graphics.drawCircle(t[0],t[1],3),this._shapePath.graphics.endFill()},e}(AbstractUI);egret.registerClass(HomeUI,"HomeUI");var LandingUI=function(t){function e(){t.call(this,"landingUISkin")}__extends(e,t);var i=(__define,e),n=i.prototype;return n.onRefresh=function(){var t=this;t.btnLogin.visible=!1,application.dao.fetch("Notification",{},{order:"action DESC, create_time DESC",limit:1}).then(function(e){e.length>0?(application.showUI(new NotificationUI(e[0],function(){t.loginQuietly()}),t),t.showedNotification=e[0]):t.loginQuietly()},function(e){t.loginQuietly()}),application.stopwatch.addEventListener("hour",function(e){application.dao.fetch("Notification",{},{order:"action DESC, create_time DESC",limit:1}).then(function(e){e.length>0&&(t.showedNotification&&t.showedNotification.id==e[0].id||(application.showUI(new NotificationUI(e[0])),t.showedNotification=e[0]))})},this),t.btnLogin.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){application.channel.login().then(function(e){application.logined(e).then(function(){application.hideUI(t)})},function(t){Toast.launch(t)})},t)},n.loginQuietly=function(){var t=this;egret.getOption("wysj_account_id")?application.dao.fetch("Account",{id:egret.getOption("wysj_account_id")},{limit:1}).then(function(e){e.length>0?application.logined(e[0]).then(function(){application.hideUI(t)}):(Toast.launch("玩家不存在，ID = "+egret.getOption("wysj_account_id")),t.btnLogin.visible=!0)},function(e){Toast.launch(e),t.btnLogin.visible=!0}):application.channel.loginQuietly().then(function(e){application.logined(e).then(function(){application.hideUI(t)})},function(e){t.btnLogin.visible=!0})},e}(AbstractUI);egret.registerClass(LandingUI,"LandingUI");var LoadingUI=function(t){function e(){t.call(this),this.textField=new egret.TextField,this.textField.textColor=16777215,this.textField.y=300,this.textField.width=480,this.textField.height=100,this.textField.textAlign="center",this.addChild(this.textField)}__extends(e,t);var i=(__define,e),n=i.prototype;return n.setProgress=function(t,e){this.textField.text="加载..."+t+"/"+e},e}(egret.Sprite);egret.registerClass(LoadingUI,"LoadingUI");var LoginButton=function(t){function e(e,i){t.call(this),this.type=e,this.url=i,this.addEventListener(eui.UIEvent.COMPLETE,this.uiCompHandler,this),this.skinName="resource/custom_skins/loginButtonSkin.exml"}__extends(e,t);var i=(__define,e),n=i.prototype;return n.uiCompHandler=function(){var t=new eui.Image;if(t.source=this.type+"_png",this.icon_group.addChildAt(t,0),this.url&&""!=this.url){this.right_ui.visible=!0;var e=new egret.DisplayObjectContainer,i=new egret.Shape;i.graphics.beginFill(16711680),i.graphics.drawCircle(100,100,100),i.graphics.endFill(),e.addChild(i);var n=new egret.Bitmap;RES.getResByUrl(this.url,function(t){n.texture=t,n.width=200,n.height=200},this,RES.ResourceItem.TYPE_IMAGE),e.addChild(n),n.mask=i,this.icon_group.addChildAt(e,0)}else this.right_ui.visible=!1;this.name_txt.text=this.getLabelName(this.type,this.url&&""!=this.url)},n.getLabelName=function(t,e){var i="";switch(t){case"qq":i="qq";break;case"wx":i="微信";break;case"wb":i="微博";break;default:i="默认"}return e?i+"--一键登录":i+"登录"},e}(eui.Component);egret.registerClass(LoginButton,"LoginButton");var LoginRewardUI=function(t){function e(){t.call(this,"loginRewardUISkin"),this.rewardData=[300,500,800,1200,2e3,3e3,5e3],this.imgPicks=[this.imgPick1,this.imgPick2,this.imgPick3,this.imgPick4,this.imgPick5,this.imgPick6,this.imgPick7];for(var e=0;e<this.imgPicks.length;e++)this.imgPicks[e].visible=!1;this.imgRet.addEventListener(egret.TouchEvent.TOUCH_BEGIN,function(){application.hideUI(this)
},this),this.imgPick1.addEventListener(egret.TouchEvent.TOUCH_BEGIN,function(t){this.claim(0)},this),this.imgPick2.addEventListener(egret.TouchEvent.TOUCH_BEGIN,function(t){this.claim(1)},this),this.imgPick3.addEventListener(egret.TouchEvent.TOUCH_BEGIN,function(t){this.claim(2)},this),this.imgPick4.addEventListener(egret.TouchEvent.TOUCH_BEGIN,function(t){this.claim(3)},this),this.imgPick5.addEventListener(egret.TouchEvent.TOUCH_BEGIN,function(t){this.claim(4)},this),this.imgPick6.addEventListener(egret.TouchEvent.TOUCH_BEGIN,function(t){this.claim(5)},this),this.imgPick7.addEventListener(egret.TouchEvent.TOUCH_BEGIN,function(t){this.claim(6)},this)}__extends(e,t);var i=(__define,e),n=i.prototype;return n.claim=function(t){for(var e=0;e<this.audits.length;e++)this.audits[e].rewards==this.rewardData[t]&&0==this.audits[e].claimed&&(Audit.claim(this.audits[e]),this.renderAudit(this.audits[e]),application.me.attrs.diamond+=this.rewardData[t],application.me.saveNow(),application.channel.track(TRACK_CATEGORY_DIAMOND,TRACK_ACTION_INC,"连续登录",this.audits[e].rewards))},n.onRefresh=function(){var t=this;Audit.check(application.me).then(function(e){t.audits=e;for(var i=0;i<t.imgPicks.length;i++)t.imgPicks[i].visible=!1;for(var i=0;i<e.length;i++)t.renderAudit(e[i])})},n.renderAudit=function(t){for(var e=this.imgPicks[0],i=0;i<this.rewardData.length;i++)if(t.rewards==this.rewardData[i]){e=this.imgPicks[i];break}e.visible=!0,1==t.claimed?e.source="picked_png":e.source="pick_png"},e}(AbstractUI);egret.registerClass(LoginRewardUI,"LoginRewardUI");var LoginUI=function(t){function e(e,i){t.call(this),this.loginTypes=e,this.onChoose=i,this.addEventListener(eui.UIEvent.COMPLETE,this.uiCompHandler,this),this.skinName="resource/custom_skins/loginUISkin.exml"}__extends(e,t);var i=(__define,e),n=i.prototype;return n.uiCompHandler=function(){for(var t=0;t<this.loginTypes.length;t++){var e=this.loginTypes[t],i="";e.accInfo&&e.accInfo.avatarUrl&&(i=e.accInfo.avatarUrl);var n=new LoginButton(e.loginType,i);n.name=e.loginType,this.btnGroup.addChild(n),n.scaleX=n.scaleY=.5,n.touchEnabled=!0,n.addEventListener(egret.TouchEvent.TOUCH_TAP,function(t){this.onChoose(this.loginTypes[parseInt(t.currentTarget.name)])},this)}},e}(eui.Component);egret.registerClass(LoginUI,"LoginUI");var MessageDetailUI=function(t){function e(e){t.call(this),this.addEventListener(eui.UIEvent.COMPLETE,function(){var t=this;this.lblContent.text=e.content,e.attach_quantity>0?(this.imgAttach.visible=!0,this.lblAttach.visible=!0,"diamond"==e.attach_category?this.imgAttach.source="dia_png":"gold"==e.attach_category?this.imgAttach.source="coin_png":this.imgAttach.source="metal_png",this.lblAttach.text="x"+e.attach_quantity):(this.imgAttach.visible=!1,this.lblAttach.visible=!1),0==e.state&&e.attach_quantity>0?this.imgOperate.source="get_png":this.imgOperate.source="del_png",this.imgBack.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){application.hideUI(t)},this),this.imgOperate.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){"get_png"==t.imgOperate.source?("diamond"==e.attach_category?(application.me.attrs.diamond+=e.attach_quantity,application.channel.track(TRACK_CATEGORY_DIAMOND,TRACK_ACTION_INC,e.title,e.attach_quantity)):"gold"==e.attach_category?application.me.attrs.gold+=e.attach_quantity:application.me.attrs.metal+=e.attach_quantity,e.state=1,application.dao.save("Message",e),application.me.saveNow(),t.imgOperate.source="del_png"):(e.state=2,application.dao.save("Message",e),application.hideUI(t))},this)},this),this.skinName="resource/custom_skins/messageDetailUISkin.exml"}__extends(e,t);var i=(__define,e);i.prototype;return e}(eui.Component);egret.registerClass(MessageDetailUI,"MessageDetailUI");var MessageItem=function(t){function e(e){t.call(this),this.skinName="resource/custom_skins/messageItemSkin.exml",this.refresh(e);var i=new Date(e.create_time);this.lblDay.text=i.getFullYear()+"/"+(i.getMonth()+1)+"/"+i.getDate(),this.lblDay.touchEnabled=!1,this.lblTitle.touchEnabled=!1,this.lblContent.touchEnabled=!1,this.imgAttach.touchEnabled=!1,this.lblAttach.touchEnabled=!1,this.imgBg.addEventListener(egret.TouchEvent.TOUCH_BEGIN,function(){application.showUI(new MessageDetailUI(e))},this),this.imgOperate.addEventListener(egret.TouchEvent.TOUCH_BEGIN,function(){"get_png"==this.imgOperate.source?("diamond"==e.attach_category?(application.me.attrs.diamond+=e.attach_quantity,application.channel.track(TRACK_CATEGORY_DIAMOND,TRACK_ACTION_INC,e.title,e.attach_quantity)):"gold"==e.attach_category?application.me.attrs.gold+=e.attach_quantity:application.me.attrs.metal+=e.attach_quantity,e.state=1,application.dao.save("Message",e),application.me.saveNow(),this.imgOperate.source="del_png"):(e.state=2,application.dao.save("Message",e),this.parent&&this.parent.removeChild(this))},this),application.dao.addEventListener("Message",function(t){t.data.id==e.id&&(2==t.data.state?this.parent&&this.parent.removeChild(this):this.refresh(e))},this)}__extends(e,t);var i=(__define,e),n=i.prototype;return n.refresh=function(t){this.lblTitle.text=t.title,this.lblContent.text=t.content,this.imgAttach.visible=!1,this.lblAttach.visible=!1,0==t.state?(t.attach_quantity>0?(this.imgOperate.source="get_png",this.imgAttach.visible=!0,this.lblAttach.visible=!0,"diamond"==t.attach_category?this.imgAttach.source="dia_png":"gold"==t.attach_category?this.imgAttach.source="coin_png":this.imgAttach.source="metal_png",this.lblAttach.text="x"+t.attach_quantity):this.imgOperate.source="del_png",this.imgBg.source="bar_png"):(this.imgOperate.source="del_png",this.imgBg.source="bargery_png")},e}(eui.Component);egret.registerClass(MessageItem,"MessageItem");var MessageUI=function(t){function e(){t.call(this),this.addEventListener(eui.UIEvent.COMPLETE,this.uiCompHandler,this),this.skinName="resource/custom_skins/messageUISkin.exml"}__extends(e,t);var i=(__define,e),n=i.prototype;return n.refresh=function(){var t=this;t.lstMessage.removeChildren(),application.dao.fetch("Message",{customer_id:application.me.attrs.id,state:0},{order:"create_time ASC"}).then(function(e){e.length>=1&&(t.messages=e,t.renderMessages(e))}),application.dao.fetch("Message",{customer_id:application.me.attrs.id,state:1},{order:"update_time DESC"}).then(function(e){e.length>=1&&(t.messagesPicked=e,t.renderMessages(e))})},n.renderMessages=function(t){for(var e=0;e<t.length;e++)this.lstMessage.addChild(new MessageItem(t[e]))},n.uiCompHandler=function(){var t=this;this.refresh(),this.imgBack.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){application.hideUI(t)},this)},e}(eui.Component);egret.registerClass(MessageUI,"MessageUI");var NotificationUI=function(t){function e(e,i){t.call(this,"notificationUISkin"),this.addEventListener(eui.UIEvent.COMPLETE,function(){var t=this;this.lblContent.text=e.content,this.imgOk.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){application.hideUI(t),1==e.action?window.location.reload(!1):i&&i()},this)},this)}__extends(e,t);var i=(__define,e);i.prototype;return e}(AbstractUI);egret.registerClass(NotificationUI,"NotificationUI");var OfflineGoldUI=function(t){function e(){var e=this;t.call(this),this.skinName="resource/custom_skins/offlineGoldUISkin.exml",this.lblGold.text=Utility.format(application.me.attrs.offline_gold),this.lblHour.text=application.me.attrs.offline_hours,this.lblMinute.text=application.me.attrs.offline_minutes,this.imgOK.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){application.me.earnOfflineGold(),application.hideUI(e)},this)}__extends(e,t);var i=(__define,e);i.prototype;return e}(eui.Component);egret.registerClass(OfflineGoldUI,"OfflineGoldUI");var OptionUI=function(t){function e(e,i,n,s){var a=this;t.call(this,"optionUISkin"),this._iconPath=e,this._content=i,this._cbOk=n,this._cbCancel=s,this.imgOk.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){a._cbOk&&a._cbOk(),a.hide()},this),this.imgCancel.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){a._cbCancel&&a._cbCancel(),a.hide()},this)}__extends(e,t);var i=(__define,e),n=i.prototype;return n.onRefresh=function(){this.imgIcon.source=this._iconPath,this.lblContent.text=this._content},e}(AbstractUI);egret.registerClass(OptionUI,"OptionUI");var RankItem=function(t){function e(e,i,n){if(t.call(this),this.skinName="resource/custom_skins/rankItemSkin.exml",e){if(0==i)return void(this.imgBg.source="RG_png");this.lblRank.text=i.toString(),n.id==application.me.attrs.id?this.imgBg.source="RY_png":this.imgBg.source="RG_png"}else 1==i?this.imgBg.source="RR_png":2==i?this.imgBg.source="RBlue_png":3==i?this.imgBg.source="RGreen_png":(this.imgBg.source="RG_png",this.lblRank.text=i.toString());this.imgAvatar.source=Customer.avatarUrl(n),this.lblName.text=n.name,this.lblMetal.text=new Number(n.metal).toFixed(3),this.lblGold.text=Utility.format(n.accumulated_gold)}__extends(e,t);var i=(__define,e);i.prototype;return e}(eui.Component);egret.registerClass(RankItem,"RankItem");var RankUI=function(t){function e(){t.call(this),this.addEventListener(eui.UIEvent.COMPLETE,this.uiCompHandler,this),this.skinName="resource/custom_skins/rankUISkin.exml"}__extends(e,t);var i=(__define,e),n=i.prototype;return n.refresh=function(){var t=this,e=20;application.dao.fetch("Customer",{},{limit:e+2,order:"metal DESC, accumulated_gold DESC"}).then(function(i){var n=0,s=null,a=null,r=null;t.listRank.removeChildren();for(var o=0;o<Math.min(e+1,i.length);o++){if(e>o){var h=new RankItem(!1,o+1,i[o]);t.listRank.addChild(h)}application.me.attrs.id==i[o].id&&(a=application.me.attrs,n=o+1,o>0&&(s=i[o-1]),r=i[o+1])}a?(t.listMyRank.removeChildren(),s&&t.listMyRank.addChild(new RankItem(!0,n-1,s)),t.listMyRank.addChild(new RankItem(!0,n,a)),t.listMyRank.addChild(new RankItem(!0,n+1,r))):application.dao.fetch("Rank",{customer_id:application.me.attrs.id},{limit:1}).then(function(e){1==e.length&&application.dao.fetch("Rank",{rank:[e[0].rank-1,e[0].rank,e[0].rank+1]},{order:"rank ASC"}).then(function(e){if(e.length>0){for(var i=[],n=0;n<e.length;n++)i.push(e[n].customer_id);application.dao.fetch("Customer",{id:i},{limit:i.length}).then(function(i){if(i.length>0){t.listMyRank.removeChildren();for(var n=0;n<e.length;n++)for(var s=0;s<i.length;s++)if(e[n].customer_id==i[s].id){var a=new RankItem(!0,e[n].rank,i[s]);t.listMyRank.addChild(a)}}})}})})})},n.uiCompHandler=function(){var t=this;this.refresh(),this.imgBack.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){application.hideUI(t)},this)},n.back=function(){this.dispatchEventWith(GameEvents.EVT_RETURN)},e}(eui.Component);egret.registerClass(RankUI,"RankUI");var ReportUI=function(t){function e(){var e=this;t.call(this),this.skinName="resource/custom_skins/reportUISkin.exml",this.imgCancel.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){application.hideUI(e)},this),this.imgOK.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){if(e.txtContent.text.length>0){var t={customer_id:application.me.attrs.id,content:e.txtContent.text,state:0};application.dao.save("Report",t),application.hideUI(e)}else Toast.launch("请填写错误的内容")},this)}__extends(e,t);var i=(__define,e);i.prototype;return e}(eui.Component);egret.registerClass(ReportUI,"ReportUI");var ResetUI=function(t){function e(e,i,n){t.call(this),this.diamond=n,this.myProject=e,this.project=i,this.addEventListener(eui.UIEvent.COMPLETE,this.uiCompHandler,this),this.skinName="resource/custom_skins/resetUISkin.exml"}__extends(e,t);var i=(__define,e),n=i.prototype;return n.uiCompHandler=function(){var t=this;this.imgCancel.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){application.hideUI(t)},this),this.imgOk.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){var e=t.output();t.myProject.tool_ratio=1,application.dao.save("Project",t.myProject),application.me.attrs.diamond+=t.diamond,application.me.attrs.output+=t.output()-e,application.me.saveNow(),application.channel.track(TRACK_CATEGORY_DIAMOND,TRACK_ACTION_INC,"重置了金手指",t.diamond),Toast.launch("成功重置了金手指"),application.hideUI(t)},this),this.lblDiamond.text=Utility.format(this.diamond)},n.output=function(){return application.me.vip.getOutput(this.project.output(this.myProject.level,this.myProject.achieve,this.myProject.tool_ratio))},e}(eui.Component);egret.registerClass(ResetUI,"ResetUI");var Toast=function(t){function e(i,n,s){var a=this;t.call(this),console.log("Toast:",i);var r=new egret.Bitmap(e._txtrToastBg);this.addChild(r);var o=new egret.TextField;o.multiline=!0,o.size=20,o.bold=!0,o.textColor=16777215,o.stroke=2,o.strokeColor=0,o.text=i,o.fontFamily="微软雅黑",o.textAlign=egret.HorizontalAlign.CENTER,o.width=.84*n,o.x=(e._txtrToastBg.textureWidth-o.width)/2,o.y=6,this.addChild(o),r.height=12+o.height,this.anchorOffsetX=.5*this.width,this.anchorOffsetY=.5*this.height,this.x=.5*n,this.y=.618*s,this.alpha=0,egret.Tween.get(this).to({alpha:1},800,egret.Ease.quintOut).wait(1600).to({alpha:0},1200,egret.Ease.quintIn).call(function(){a.parent&&a.parent.removeChild(a)})}__extends(e,t);var i=(__define,e);i.prototype;return e.init=function(t,e){this._cont=t,this._txtrToastBg=e},e.launch=function(t){if(this._cont){var i=new e(t,this._cont.stage.stageWidth,this._cont.stage.stageHeight);this._cont.addChild(i)}},e}(egret.DisplayObjectContainer);egret.registerClass(Toast,"Toast");var ToolItem=function(t){function e(e,i,n,s){var a=this;t.call(this),this._project=i,this._myProject=e,this.skinName="resource/custom_skins/toolItemSkin.exml",this.img100.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){a.buy(100,1)},this),this.img900.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){a.buy(900,10)},this),this.imgReset.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){a.reset()},this),application.dao.addEventListener("Project",function(t){var e=t.data;e.id==this._myProject.id&&(this.myProject=e,this.refresh())},this),this.imgIcon.source=n,this.imgTitle.source=s,this.refresh()}__extends(e,t);var i=(__define,e),n=i.prototype;return n.refresh=function(){this.lbl1.text=Utility.format(this._myProject.tool_ratio),this.lbl100.text=Utility.format(this.ratio(this._myProject.tool_ratio,1)),this.lbl900.text=Utility.format(this.ratio(this._myProject.tool_ratio,10))},n.reset=function(){if(this._myProject.tool_ratio>1){for(var t=0,e=1;e<this._myProject.tool_ratio;)t++,e=this.ratio(1,t);var i=630*Math.floor(t/10)+70*(t%10);application.showUI(new ResetUI(this._myProject,this._project,i))}else Toast.launch("还没有购买过金手指，不能重置")},n.buy=function(t,e){if(application.me.attrs.diamond>=t){var i=this.output();this._myProject.tool_ratio=this.ratio(this._myProject.tool_ratio,e),application.me.buyOutput(0,t,this.output()-i),application.dao.save("Project",this._myProject),application.channel.track(TRACK_CATEGORY_DIAMOND,TRACK_ACTION_DEC,"购买了金手指",t),Toast.launch("成功购买了金手指"),this.refresh()}else application.showUI(new ChargeTipUI)},n.ratioOne=function(t){var e=[1,5,50,200,2e3,1e4,1e5,5e5,5e6,25e6,125e6,625e6,5e9,4e10,2e11],i=Utility.log10(t);if(i<e.length)return t+e[i];for(var n=e[e.length-1],s=0;s<i-e.length;s++)n=10*n;return t+n},n.ratio=function(t,e){for(var i=0;e>i;i++)t=this.ratioOne(t);return t},n.output=function(){return application.me.vip.getOutput(this._project.output(this._myProject.level,this._myProject.achieve,this._myProject.tool_ratio))},e}(eui.Component);egret.registerClass(ToolItem,"ToolItem");var ToolUI=function(t){function e(){t.call(this),this.addEventListener(eui.UIEvent.COMPLETE,this.uiCompHandler,this),this.skinName="resource/custom_skins/toolUISkin.exml"}__extends(e,t);var i=(__define,e),n=i.prototype;return n.refresh=function(){this.lblGold.text=Utility.format(application.me.usableGold()),this.lblDiamond.text=Utility.format(application.me.attrs.diamond);var t=new eui.TileLayout;t.horizontalGap=0,t.verticalGap=0,t.columnAlign=eui.ColumnAlign.JUSTIFY_USING_WIDTH,t.rowAlign=eui.RowAlign.TOP,t.paddingTop=0,t.paddingRight=0,t.paddingLeft=0,t.paddingBottom=0,t.requestedColumnCount=2,this.grpProject.layout=t},n.uiCompHandler=function(){var t=this;this.refresh(),this.imgBack.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){application.hideUI(t)},this),application.dao.addEventListener("Customer",function(t){this.lblGold.text=Utility.format(application.me.usableGold()),this.lblDiamond.text=Utility.format(application.me.attrs.diamond)},this),this.btnAddGold.addEventListener(egret.TouchEvent.TOUCH_BEGIN,function(){application.showUI(new BuyToolUI("time",500))},this),this.btnAddDiamond.addEventListener(egret.TouchEvent.TOUCH_BEGIN,function(){application.showUI(new ChargeTipUI)},this),this.imgHit.addEventListener(egret.TouchEvent.TOUCH_BEGIN,function(){application.showUI(new BuyToolUI("hit",100),this)},this),this.imgTime.addEventListener(egret.TouchEvent.TOUCH_BEGIN,function(){application.showUI(new BuyToolUI("time",500),this)},this),this.imgTicket.addEventListener(egret.TouchEvent.TOUCH_BEGIN,function(){application.showUI(new BuyToolUI("ticket",19),this)},this),this.imgVIP.addEventListener(egret.TouchEvent.TOUCH_BEGIN,function(){application.showUI(new BuyToolUI("vip",49),this)},this)},e}(eui.Component);egret.registerClass(ToolUI,"ToolUI");var TowerItem=function(t){function e(e,i){t.call(this,"towerItemSkin"),this._path=e,this._price=i,this._abnormalColor=16711680,application.dao.addEventListener("Battle",function(t){this.refresh()},this)}__extends(e,t);var i=(__define,e),n=i.prototype;return n.onRefresh=function(){this.imgButton.source=this._path,this.lblPrice.text=this._price.toString(),application.battle.getGolds()>=this._price?this.lblPrice.textColor=65280:this.lblPrice.textColor=this._abnormalColor},n.setAbNormalColor=function(t){this._abnormalColor=t},e.createSellItem=function(t,i,n,s){var a=e.createItem(t,i,n,"remove_png",s.getTower().getSellPrice());return a.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){application.battle.incGolds(s.getTower().getSellPrice()),s.setTower(null),t.hide()},this),a.setAbNormalColor(65280),a},e.createItem=function(t,i,n,s,a){var r=new e(s,a);return r.x=i,r.y=n,t.addChild(r),r},e}(AbstractUI);egret.registerClass(TowerItem,"TowerItem");var TowerMenuUI=function(t){function e(e){var i=this;t.call(this,"towerMenuUISkin"),this._base=e,this._tower=this._base.getTower(),this.imgFlag.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){i._tower.showFlag(),i.hide()},this)}__extends(e,t);var i=(__define,e),n=i.prototype;return n.onRefresh=function(){var t={guardX:this._base.getGuardX(),guardY:this._base.getGuardY()};if(this._tower)if(this.imgFlag.visible="SoldierTower"==this._tower.getSuperClaz(),TowerItem.createSellItem(this,(this.width>>1)-40,120,this._base),this._tower.upgradable()){var e=this._tower.getClaz(),i=parseInt(e.charAt(e.length-1))+1,n=e.slice(0,e.length-1),s=this._getIconPath(e,1);"ArrowTower3"==this._tower.getClaz()?(this._render(10,20,s,n+i.toString(),t),this._render(110,20,"arrowtower5_png",n+(i+1).toString(),t)):this._render((this.width>>1)-40,0,s,n+i.toString(),t)}else{var a=this._getSkillIconPath(this._tower,1),r=this._getSkillIconPath(this._tower,2),o=this._getSkillIconPath(this._tower,3);this._tower.skillUpgradable(1)&&this._tower.skillUpgradable(2)&&this._tower.skillUpgradable(3)?(this._renderSkill((this.width>>1)-40,0,a,1),this._renderSkill(10,40,r,2),this._renderSkill(110,40,o,3)):this._tower.skillUpgradable(1)&&this._tower.skillUpgradable(2)?(this._renderSkill(10,20,a,1),this._renderSkill(110,20,r,2)):this._tower.skillUpgradable(1)&&this._tower.skillUpgradable(3)?(this._renderSkill(10,20,a,1),this._renderSkill(110,20,o,3)):this._tower.skillUpgradable(3)&&this._tower.skillUpgradable(2)?(this._renderSkill(10,20,r,2),this._renderSkill(110,20,o,3)):this._tower.skillUpgradable(1)?this._renderSkill((this.width>>1)-40,0,a,1):this._tower.skillUpgradable(2)?this._renderSkill((this.width>>1)-40,0,r,2):this._tower.skillUpgradable(3)&&this._renderSkill((this.width>>1)-40,0,o,3)}else this.imgFlag.visible=!1,this._render((this.width>>1)-40,0,"soldiertower1_png","SoldierTower1",t),this._render((this.width>>1)-40,120,"magictower1_png","MagicTower1",t),this._render(0,(this.height>>1)-35,"arrowtower1_png","ArrowTower1",t),this._render(120,(this.height>>1)-35,"bombtower1_png","BombTower1",t)},n._renderSkill=function(t,e,i,n){var s=this,a=TowerItem.createItem(this,t,e,i,this._tower.getSkillUpgradePrice(n));a.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){s._upgradeSkill(n)},this)},n._render=function(t,e,i,n,s){var a=this,r=application.pool.get(n,s),o=TowerItem.createItem(this,t,e,i,r.getPrice());o.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){a._build(r)},this)},n._build=function(t){var e=this;application.showUI(new OptionUI(e._getIconPath(t.getClaz(),0),e._getDescription(t),function(){var i=t.getPrice();application.battle.getGolds()>=i?(application.battle.incGolds(-i),e._base.setTower(t),e.hide()):Toast.launch("需要更多的金币")}),application.battle.getUI())},n._upgradeSkill=function(t){var e=this;application.showUI(new OptionUI(e._getSkillIconPath(e._tower,t),e._getSkillDescription(e._tower,t),function(){var i=e._tower.getSkillUpgradePrice(t);application.battle.getGolds()>=i?(application.battle.incGolds(-i),e._tower.upgradeSkill(t),application.battle.unselect(e._tower),e.hide()):Toast.launch("需要更多的金币")}),application.battle.getUI())},n._getIconPath=function(t,e){void 0===e&&(e=1);var i=parseInt(t.charAt(t.length-1))+e,n=t.slice(0,t.length-1);switch(n){case"MagicTower":return"magictower"+i+"_png";case"ArrowTower":return"arrowtower"+i+"_png";case"BombTower":return"bombtower"+i+"_png";case"SoldierTower":return"soldiertower"+i+"_png"}},n._getDescription=function(t){return""},n._getSkillIconPath=function(t,e){switch(t.getClaz()){case"MagicTower4":return 1==e?"magictower4_skill1_png":2==e?"magictower4_skill2_png":null;case"ArrowTower4":return 1==e?"arrowtower4_skill1_png":2==e?"arrowtower4_skill2_png":null;case"ArrowTower5":return 1==e?"arrowtower5_skill1_png":2==e?"arrowtower5_skill2_png":null;case"BombTower4":return 1==e?"bombtower4_skill1_png":2==e?"bombtower4_skill2_png":null;case"SoldierTower4":return 1==e?"soldiertower4_skill1_png":2==e?"soldiertower4_skill2_png":"soldiertower4_skill3_png"}},n._getSkillDescription=function(t,e){return""},e}(AbstractUI);egret.registerClass(TowerMenuUI,"TowerMenuUI");var TrueLoadingUI=function(t){function e(){var e=this;t.call(this),this.addEventListener(egret.Event.REMOVED_FROM_STAGE,function(){e.hasEventListener(egret.Event.ENTER_FRAME)&&e.removeEventListener(egret.Event.ENTER_FRAME,e.runLoading,e)},this),this.addEventListener(egret.Event.ADDED_TO_STAGE,function(){e.setProgress(0,1),e.addEventListener(egret.Event.ENTER_FRAME,e.runLoading,e)},this)}__extends(e,t);var i=(__define,e),n=i.prototype;return n.createChildren=function(){t.prototype.createChildren.call(this),this._imgBg=new eui.Image,this._imgBg.source="loginb_jpg",this.addChild(this._imgBg),this._loadingRun=new egret.Bitmap(RES.getRes("loading_run_png")),this.addChild(this._loadingRun),this._loadingRun.anchorOffsetX=.5*this._loadingRun.width,this._loadingRun.anchorOffsetY=.5*this._loadingRun.height,this._loadingRun.x=.5*this.stage.stageWidth,this._loadingRun.y=.5*this.stage.stageHeight,this._txProgress=new egret.TextField,this._txProgress.textAlign=egret.HorizontalAlign.CENTER,this._txProgress.verticalAlign=egret.VerticalAlign.MIDDLE,this._txProgress.x=.5*this.stage.stageWidth-100,this._txProgress.width=200,this._txProgress.y=.5*this.stage.stageHeight-100,this._txProgress.height=200,this._txProgress.size=14,this._txProgress.stroke=1,this._txProgress.strokeColor=0,this.addChild(this._txProgress)},n.removeBgImage=function(){this.removeChild(this._imgBg)},n.runLoading=function(t){this._loadingRun.rotation+=3},n.setProgress=function(t,e){this._txProgress&&(this._txProgress.text=Math.round(t/e*100)+"%")},e}(eui.Group);egret.registerClass(TrueLoadingUI,"TrueLoadingUI");var VipUI=function(t){function e(){var e=this;t.call(this,"vipUISkin"),this.imgNext.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){e.level++,e.refresh()},this),this.imgLast.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){e.level--,e.refresh()},this),this.imgBack.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){e.hide()},this),this.imgCharge.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){e.show(new ChargeTipUI,!0)},this)}__extends(e,t);var i=(__define,e),n=i.prototype;return n.onRefresh=function(){this.level=application.me.vip.getLevel(),this.onRefreshAgain()},n.onRefreshAgain=function(){0==this.level?(this.lblCharge.visible=!1,this.imgLast.visible=!1,this.imgNext.visible=!0):(this.lblCharge.visible=!0,this.imgLast.visible=!0,15==this.level?this.imgNext.visible=!1:this.imgNext.visible=!0),this.lblCharge.text=application.me.attrs.charge,this.imgTitle.source="vt"+this.level+"_png"},e}(AbstractUI);egret.registerClass(VipUI,"VipUI");var WinUI=function(t){function e(e){var i=this;t.call(this,"winUISkin"),this.imgBack.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){i.hide()},this),this.imgHide.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){1==application.me.attrs.hide_winner?application.me.attrs.hide_winner=0:application.me.attrs.hide_winner=1,i.refresh()},this)}__extends(e,t);var i=(__define,e),n=i.prototype;return n.onRefresh=function(){1==application.me.attrs.hide_winner?(this.imgHide.source="hidecancel_png",this.imgAvatar.source="Ahide_png"):(this.imgHide.source="Awinhide_png",this.imgAvatar.source=Customer.avatarUrl(application.me.attrs))},e}(AbstractUI);egret.registerClass(WinUI,"WinUI");
var esa;!function(e){var a;!function(e){function a(a){if((void 0==a.gameId||void 0==a.chanId)&&console.log("gameId 或 渠道id 为空"),e.$gameId=a.gameId,e.$chanId=a.chanId,a.debug&&(e.$debug=a.debug),e.$localData=e.$getLoadLocalData(),egret.Capabilities.runtimeType==egret.RuntimeType.WEB){var t=window.devicePixelRatio,n=window.screen.height,o=window.screen.width;e.$pixel={height:n,width:o,dp:t}}e.$os=e.$getOs(),e.$sendLoginData()}function t(){var e=(new Date).getFullYear(),a=(new Date).getMonth()+1,t=(new Date).getDate(),n=e+"-"+a+"-"+t;return n}function n(){var e=(new Date).getTime();return e/=1e3,e=+e}function o(){var a=egret.localStorage,t=a.getItem("__EgretSAPlayerInfo"),n=e.$playerInfo.egretId,o=e.$playerInfo.serverId,r=e.$getDate(),i=e.$getTime();return t?(t=JSON.parse(t),t[n]||(t[n]={},t[n][e.$gameId]={},t[n][e.$gameId][o]={},t[n][e.$gameId][o].joinTime=i,t[n][e.$gameId][o].upSec=0,t[n][e.$gameId][o].joinDate=r,t[n][e.$gameId][o].loginDate=r,a.setItem("__EgretSAPlayerInfo",JSON.stringify(t))),t[n][e.$gameId]||(t[n][e.$gameId]={},t[n][e.$gameId][o]={},t[n][e.$gameId][o].joinTime=i,t[n][e.$gameId][o].upSec=0,t[n][e.$gameId][o].joinDate=r,t[n][e.$gameId][o].loginDate=r,a.setItem("__EgretSAPlayerInfo",JSON.stringify(t))),t[n][e.$gameId][o]||(t[n][e.$gameId][o]={},t[n][e.$gameId][o].joinTime=i,t[n][e.$gameId][o].upSec=0,t[n][e.$gameId][o].joinDate=r,t[n][e.$gameId][o].loginDate=r,a.setItem("__EgretSAPlayerInfo",JSON.stringify(t))),t[n][e.$gameId][o]):(t={},t[n]={},t[n][e.$gameId]={},t[n][e.$gameId][o]={},t[n][e.$gameId][o].joinTime=i,t[n][e.$gameId][o].upSec=0,t[n][e.$gameId][o].joinDate=r,t[n][e.$gameId][o].loginDate=r,a.setItem("__EgretSAPlayerInfo",JSON.stringify(t)),t[n][e.$gameId][o])}function r(){var a=egret.localStorage,t=a.getItem("__EgretSALoadingPlayerInfo");if(t){if(t=JSON.parse(t),!t[e.$gameId]){t[e.$gameId]={};var n=e.$getDate();t[e.$gameId].joinDate=n,a.setItem("__EgretSALoadingPlayerInfo",JSON.stringify(t))}return t}t={},t[e.$gameId]={};var o=e.$getUid(),n=e.$getDate();return t.uuid=o,t[e.$gameId].joinDate=n,a.setItem("__EgretSALoadingPlayerInfo",JSON.stringify(t)),t}function i(a,t){(void 0==a||void 0==t)&&console.log("loading顺序 或 loading 名称为空"),a=parseInt(a),e.$sendLoadingData(a,t)}function d(a,t){if(void 0==a||void 0==t)return void console.log("新手引导顺序 或 新手引导名称为空");a=parseInt(a);var n={act:"newUserGuide",item:a,name:t},o=e.$getDate();e.$localPlayerData.joinDate==o&&1!=e.$localPlayerData[a]&&(e.$setLocalGuide(a),e.$setData(n))}function l(a){var t=egret.localStorage,n=t.getItem("__EgretSAPlayerInfo");n=JSON.parse(n);var o=e.$playerInfo.egretId,r=e.$playerInfo.serverId;n[o][e.$gameId][r][a]=1,t.setItem("__EgretSAPlayerInfo",JSON.stringify(n)),e.$localPlayerData[a]=1}function g(a,t){if(void 0==a||void 0==t)return void console.log("任务类型 或 任务名称为空");a=+a||0;var n={act:"taskAccept",type:a,name:t};e.$setData(n)}function s(a,t){if(void 0==a||void 0==t)return void console.log("任务类型 或 任务名称为空");a=+a||0;var n={act:"taskCompleted",type:a,name:t};e.$setData(n)}function $(a,t){if(void 0==a||void 0==t)return void console.log("关卡类型 或 关卡名称为空");a=+a||0;var n={act:"levelDesignCompleted",type:a,name:t};e.$setData(n)}function I(a,t){if(void 0==a||void 0==t)return void console.log("关卡类型 或 关卡名称为空");a=+a;var n={act:"levelDesignFailed",type:a,name:t};e.$setData(n)}function f(a,t,n){if(void 0==a||void 0==t||void 0==n)return void console.log("钻石消耗参数错误");t=+t,n=+n;var o={act:"diamondUse",num:t,item:a,price:n};e.$setData(o)}function c(a,t){if(void 0==a||void 0==t)return void console.log("赠予钻石数字 或 理由为空");a=+a;var n={act:"diamondReward",num:a,reason:t};e.$setData(n)}function v(a,t){if(void 0==a||void 0==t)return void console.log("金币获取数字 或 理由为空");a=+a;var n={act:"goldOutput",num:a,reason:t};e.$setData(n)}function m(a,t,n){if(void 0==a||void 0==t||void 0==n)return void console.log("金币消耗参数错误");t=+t,n=+n;var o={act:"goldUse",num:t,item:a,price:n};e.$setData(o)}function u(a,t,n){if(void 0===n&&(n=""),void 0==a||void 0==t)return void console.log("道具产出参数错误");t=+t;var o={act:"propOutput",num:t,item:a,reason:n};e.$setData(o)}function p(a,t,n){if(void 0===n&&(n=""),void 0==a||void 0==t)return void console.log("道具使用参数错误");t=+t;var o={act:"propUse",num:t,item:a,reason:n};e.$setData(o)}function y(a){if(void 0==a)return void console.log("活动参数错误");var t={act:"activity",item:a};e.$setData(t)}function D(a){void 0!=e.$playerInfo.egretId&&void 0!=e.$chanId&&void 0!=e.$gameId&&(a.egretId=e.$playerInfo.egretId,e.$playerInfo.level&&(a.level=e.$playerInfo.level),a.serverId=e.$playerInfo.serverId,e.$playerInfo.serverName,e.$playerInfo.playerName&&(a.playerName=e.$playerInfo.playerName),e.$playerInfo.diamond&&(a.diamond=e.$playerInfo.diamond),e.$playerInfo.gold&&(a.gold=e.$playerInfo.gold),e.$playerInfo.gender&&(a.gender=e.$playerInfo.gender),e.$playerInfo.age&&(a.age=e.$playerInfo.age),a.chanId=e.$chanId,a.gameId=e.$gameId,a.pixel=e.$pixel,a.os=e.$os,e.$data.push(a))}function S(){function a(){}if(void 0!=e.$chanId&&void 0!=e.$gameId){var t={};t.uid=e.$localData.uuid,t.act="login",t.gameId=e.$gameId,t.chanId=e.$chanId,t.pixel=e.$pixel,t.os=e.$os;var n=e.$loadingUrl,o="data="+JSON.stringify(t);e.$sendUrl(n,o,a)}}function O(a,t){function n(){}if(void 0!=e.$chanId&&void 0!=e.$gameId){var o={};o.uid=e.$localData.uuid;var r=e.$getDate();if(r==e.$localData[e.$gameId].joinDate){o.index=a,o.name=t,o.gameId=e.$gameId,o.chanId=e.$chanId,o.pixel=e.$pixel,o.os=e.$os;var i=e.$loadingUrl,d="data="+JSON.stringify(o);e.$sendUrl(i,d,n)}}}function h(a,t,n){1!=e.$debug&&e.$doPost({url:a,onSuccess:function(e){try{n(e.response)}catch(a){}},param:t,onFail:function(){n(!1)}})}function P(e){var a=e.url,t=e.onSuccess,n=e.param;if(!a)return void console.error("no url");if(!t)return void console.error("no onSuccess");var o=new egret.URLLoader;o.addEventListener(egret.Event.COMPLETE,function(){var e={response:o.data};t(e)},this),o.addEventListener(egret.IOErrorEvent.IO_ERROR,function(){console.error("404:"+a)},this),o.dataFormat=egret.URLLoaderDataFormat.TEXT;var r=new egret.URLRequest(a);r.method=egret.URLRequestMethod.POST,r.data=new egret.URLVariables(n),o.load(r)}function L(){var a=egret.localStorage,t=a.getItem("__EgretSAPlayerInfo");t=JSON.parse(t);var n=e.$playerInfo.egretId,o=e.$playerInfo.serverId;t[n][e.$gameId][o].upSec=0,a.setItem("__EgretSAPlayerInfo",JSON.stringify(t)),e.$localPlayerData.upSec=0}function _(){var a=egret.localStorage,t=a.getItem("__EgretSAPlayerInfo");t=JSON.parse(t);var n=e.$playerInfo.egretId,o=e.$playerInfo.serverId,r=e.$timeSpace/1e3,i=t[n][e.$gameId][o].upSec+r;t[n][e.$gameId][o].upSec=i,e.$localPlayerData.upSec=i,a.setItem("__EgretSAPlayerInfo",JSON.stringify(t))}function N(){var a=e.$getDate();if(e.$localPlayerData.loginDate!=a){e.$localPlayerData.loginDate=a;var t={act:"loginReload"};e.$setData(t)}var n=egret.localStorage,o=n.getItem("__EgretSAPlayerInfo");o=JSON.parse(o);var r=e.$playerInfo.egretId,i=e.$playerInfo.serverId;o[r][e.$gameId][i].loginDate=a,n.setItem("__EgretSAPlayerInfo",JSON.stringify(o))}function E(){e.$sendData()}function x(){function a(){}if(0!=e.$data.length){var t=e.$logUrl,n="data="+JSON.stringify(e.$data);e.$sendUrl(t,n,a)}e.$setUpSec(),e.$data=[],e.$upLoginDate()}function U(){for(var e=[],a="0123456789abcdef",t=0;36>t;t++)e[t]=a.substr(Math.floor(16*Math.random()),1);e[14]="4",e[19]=a.substr(3&e[19]|8,1),e[8]=e[13]=e[18]=e[23]="";var n=e.join("");return n}function A(){var e={};if(null!=egret.getOption("egret.runtime.nest"))return e.os=3,e;if(egret.Capabilities.runtimeType==egret.RuntimeType.NATIVE)return e.os=4,e;var a=window.navigator.appVersion,t=a.indexOf("Android")>-1||a.indexOf("Linux")>-1,n=a.indexOf("iPhone")>-1||a.indexOf("Mac")>-1,o=a.indexOf("Windows")>-1,r=4,i="",d="";if(t!==!1){r=3;var l=a.indexOf("("),g=a.indexOf(")"),s=a.substring(l+1,g),$=s.split(";"),I=$[$.length-1].trim();i=I.substring(0,I.indexOf("Build")-1);for(var f=$.length-1;f>=0;f--)if($[f].indexOf("Android")>-1){d=$[f].trim().substring(8);break}}if(n!==!1){r=1;var l=a.indexOf("("),g=a.indexOf(")"),s=a.substring(l+1,g),$=s.split(";");i=$[0];for(var f=$.length-1;f>=1;f--)if($[f].indexOf("CPU")>-1){for(var c=$[f].trim().split(" "),f=1;f<=c.length-1;f++)if(c[f].indexOf("_")>-1){d=c[f].trim();break}break}}if(o!==!1){r=2;var l=a.indexOf("("),g=a.indexOf(")"),s=a.substring(l+1,g),$=s.split(";");i=$[0];for(var f=1;f<=$.length-1;f++){var v=$[f].indexOf("Phone");if(v>-1){d=$[f].substring(v+6);break}}}return e.os=r,e.brand=i,e.version=d,e}e.$playerInfo={},e.$gameId,e.$chanId,e.$debug=!1,e.$data=[],e.$localData={},e.$localPlayerData={},e.$loadingUrl="http://gameanalysis.egret.com/loadingStat.php",e.$logUrl="http://gameanalysis.egret.com/gameStat.php",e.$timeSpace=2e4,e.$os,e.$pixel={height:0,width:0,dp:0},e.init=a,e.$getDate=t,e.$getTime=n,e.$getLocalPlayerData=o,e.$getLoadLocalData=r,e.loadingSet=i,e.newUsersGuideSet=d,e.$setLocalGuide=l,e.onTaskAccept=g,e.onTaskCompleted=s,e.onLevelDesignCompleted=$,e.onLevelDesignFailed=I,e.onDiamondUse=f,e.onDiamondReward=c,e.onGoldOutput=v,e.onGoldUse=m,e.onPropOutput=u,e.onPropUse=p,e.onJoinActivity=y,e.$setData=D,e.$sendLoginData=S,e.$sendLoadingData=O,e.$sendUrl=h,e.$doPost=P;var w;!function(a){function t(a){void 0!=a.egretId&&null!=a.egretId&&(e.$playerInfo.egretId=a.egretId),void 0!=a.level&&null!=a.level&&(e.$playerInfo.level=parseInt(a.level)),e.$playerInfo.serverId=void 0!=a.serverId&&null!=a.serverId?parseInt(a.serverId):1,void 0!=a.playerName&&null!=a.playerName&&(e.$playerInfo.playerName=a.playerName),void 0!=a.diamond&&null!=a.diamond&&(e.$playerInfo.diamond=parseInt(a.diamond)),void 0!=a.gold&&null!=a.gold&&(e.$playerInfo.gold=parseInt(a.gold)),void 0!=a.age&&null!=a.age&&(e.$playerInfo.age=parseInt(a.age)),void 0!=a.gender&&null!=a.gender&&(e.$playerInfo.gender=parseInt(a.gender)),e.$localPlayerData=e.$getLocalPlayerData();var t={act:"login"};e.$setData(t),egret.setInterval(e.$sendData,e,e.$timeSpace)}function n(a){if(e.$playerInfo.level<a){e.$playerInfo.level=a;var t=e.$localPlayerData.upSec;if(0==t){var n=e.$getTime();t=n-e.$localPlayerData.joinTime;var o=e.$timeSpace/1e3;t>o&&(t=o)}var r={act:"levelChange",num:t};e.$setLevelSec(),e.$setData(r)}}function o(a){e.$playerInfo.playerName=a}function r(a){e.$playerInfo.diamond=parseInt(a)}function i(a){e.$playerInfo.gold=parseInt(a)}a.init=t,a.setLevel=n,a.setPlayerName=o,a.setDiamond=r,a.setGold=i}(w=e.player||(e.player={})),e.$setLevelSec=L,e.$setUpSec=_,e.$upLoginDate=N,e.onLeave=E,e.$sendData=x,e.$getUid=U,e.$getOs=A}(a=e.EgretSA||(e.EgretSA={}))}(esa||(esa={}));
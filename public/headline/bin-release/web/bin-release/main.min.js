var application;!function(e){function t(t){e.main=t,e.router=new Router(t),e.dao=new Dao("http://headlines.leanapp.cn/api/"),e.projects=Project.createAllProjects()}function i(t){if(null==t||"string"==typeof t){var i=t?{loginType:t}:{};nest.user.login(i,e.onLoginCallback)}else e.onLoginCallback(t)}function n(t){e.dao.rest("login",{token:t.token},function(t,i){t?(e.customer=i,e.main.dispatchEventWith(GameEvents.EVT_LOGIN_IN_SUCCESS)):Toast.launch("获取账号信息失败")})}function o(t,i,n,o,r){e.customer.gold-=t,e.customer.diamond-=i,e.customer.output+=n,e.dao.save("Customer",e.customer,function(a,s){a&&e.main.homeUI.animateCustomer(t,i,n,o),r(a,s)})}function r(e){for(var t=["k","m","b","t","a","A","c","C","d","D","e","E","f","F","g","G","h","H","i","I","j","J","l","L","n","N","o","O","p","P","q","Q","r","R","s","S","u","U","v","V","w","W","x","X","y","Y","z","Z","aa","AA","cc","CC","dd","DD","ee","EE","ff","FF","gg","GG","hh","HH","ii","II","jj","JJ","ll","LL","nn","NN","oo","OO","pp","PP","qq","QQ","rr","RR","ss","SS","uu","UU","vv","VV","ww","WW","xx","XX","yy","YY","zz","ZZ"],i="",n=0;n<t.length;n++){if(10>e)return e.toFixed(2)+i;if(100>e)return e.toFixed(1)+i;if(1e3>e)return e.toFixed()+i;i=t[n],e/=1e3}return e.toFixed()+i}e.init=t,e.login=i,e.onLoginCallback=n,e.buyOutput=o,e.format=r}(application||(application={}));var Dao=function(){function e(e){this._baseUrl=e}var t=(__define,e),i=t.prototype;return i.fetch=function(e,t,i,n){this.rest("select/"+e,{conditions:t,filters:i},n)},i.save=function(e,t,i){t.id?this.rest("update/"+e+"/"+t.id,t,i):this.rest("create/"+e,t,i)},i.rest=function(e,t,i){var n=new egret.HttpRequest;n.responseType=egret.HttpResponseType.TEXT,n.open(this._baseUrl+e,egret.HttpMethod.POST),n.setRequestHeader("Content-Type","application/json"),n.addEventListener(egret.Event.COMPLETE,function(e){var t=e.currentTarget;console.log("post data : ",t.response),i&&i(!0,JSON.parse(t.response))},this),n.addEventListener(egret.IOErrorEvent.IO_ERROR,function(e){i&&i(!1,event)},this),n.addEventListener(egret.ProgressEvent.PROGRESS,function(e){console.log("post progress : "+Math.floor(100*e.bytesLoaded/e.bytesTotal)+"%")},this),n.send(JSON.stringify(t))},e}();egret.registerClass(Dao,"Dao");var GameEvents=function(){function e(){}var t=(__define,e);t.prototype;return e.EVT_RETURN="EVT_RETURN",e.EVT_LOAD_PAGE="EVT_LOAD_PAGE",e.EVT_CLOSE_ABOUT="EVT_CLOSE_ABOUT",e.EVT_LOGIN_IN_SUCCESS="EVT_LOGIN_IN_SUCCESS",e.EVT_LOGIN_OUT_SUCCESS="EVT_LOGIN_OUT_SUCCESS",e.EVT_REFRESH_CUSTOMER="EVT_REFRESH_CUSTOMER",e}();egret.registerClass(GameEvents,"GameEvents");var GamePages=function(){function e(){}var t=(__define,e);t.prototype;return e.HOME="home",e.RANK="rank",e.TOOL="tool",e.AUCTION="auction",e}();egret.registerClass(GamePages,"GamePages");var Main=function(e){function t(){e.apply(this,arguments),this._isThemeLoadEnd=!1,this._isResourceLoadEnd=!1}__extends(t,e);var i=(__define,t),n=i.prototype;return n.createChildren=function(){e.prototype.createChildren.call(this),this.stage.registerImplementation("eui.IAssetAdapter",new AssetAdapter),this.stage.registerImplementation("eui.IThemeAdapter",new ThemeAdapter),this._loadingUI=new LoadingUI,this.stage.addChild(this._loadingUI),RES.addEventListener(RES.ResourceEvent.CONFIG_COMPLETE,this.onConfigComplete,this),RES.loadConfig("resource/default.res.json","resource/")},n.onConfigComplete=function(e){RES.removeEventListener(RES.ResourceEvent.CONFIG_COMPLETE,this.onConfigComplete,this),application.init(this);var t=new eui.Theme("resource/default.thm.json",this.stage);t.addEventListener(eui.UIEvent.COMPLETE,this.onThemeLoadComplete,this),RES.addEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.onResourceLoadComplete,this),RES.addEventListener(RES.ResourceEvent.GROUP_LOAD_ERROR,this.onResourceLoadError,this),RES.addEventListener(RES.ResourceEvent.GROUP_PROGRESS,this.onResourceProgress,this),RES.addEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,this.onItemLoadError,this),RES.loadGroup("loading")},n.onThemeLoadComplete=function(){this._isThemeLoadEnd=!0,this.createScene()},n.onResourceLoadComplete=function(e){var t=this,i=this;switch(e.groupName){case"loading":this._loadingUI.parent&&this._loadingUI.parent.removeChild(this._loadingUI),Toast.init(this,RES.getRes("toast-bg_png")),this.addEventListener(GameEvents.EVT_LOGIN_IN_SUCCESS,function(e){t._trueLoadingUI=new TrueLoadingUI,t.loadPage("home")},this),nest.core.startup({egretAppId:90240,version:2,debug:!0},function(e){0==e.result&&nest.easeuser.login(i)});break;case"home":this._isResourceLoadEnd=!0,this.createScene();break;default:console.log("	page["+e.groupName+"]ok:",egret.getTimer()),this.pageLoadedHandler(e.groupName)}},n.clearRESEvents=function(){},n.createScene=function(){this._isThemeLoadEnd&&this._isResourceLoadEnd&&this.startCreateScene()},n.onItemLoadError=function(e){console.warn("Url:"+e.resItem.url+" has failed to load")},n.onResourceLoadError=function(e){console.warn("Group:"+e.groupName+" has failed to load"),this.onResourceLoadComplete(e)},n.onResourceProgress=function(e){switch(e.groupName){case"loading":this._loadingUI.setProgress(e.itemsLoaded,e.itemsTotal);break;default:this._trueLoadingUI.setProgress(e.itemsLoaded,e.itemsTotal)}},n.startCreateScene=function(){var e=this;this.pageLoadedHandler("home"),this.homeUI=new HomeUI,this.homeUI.addEventListener(GameEvents.EVT_LOAD_PAGE,function(t){e.loadPage(t.data)},this),this.addChild(this.homeUI)},n.loadPage=function(e){switch(this.addChild(this._trueLoadingUI),this._idLoading=e,e){case"heros":case"goods":RES.loadGroup("heros_goods");break;default:RES.loadGroup(e)}},n.pageLoadedHandler=function(e){"home"!=e&&this.homeUI.pageReadyHandler(this._idLoading),this._trueLoadingUI.parent&&this._trueLoadingUI.parent.removeChild(this._trueLoadingUI)},n.onCreate=function(e){application.router.changePage(new LoginUI(e))},n.onSuccess=function(e){application.login(e)},n.onFail=function(e){egret.log("log Fail")},t}(eui.UILayer);egret.registerClass(Main,"Main",["nest.easeuser.ILoginCallbacks"]);var Router=function(){function e(e){this._main=e}var t=(__define,e),i=t.prototype;return i.changePage=function(e){this._main.removeChildren(),this._main.addChild(e)},e}();egret.registerClass(Router,"Router");var AssetAdapter=function(){function e(){}var t=(__define,e),i=t.prototype;return i.getAsset=function(e,t,i){function n(n){t.call(i,n,e)}if(RES.hasRes(e)){var o=RES.getRes(e);o?n(o):RES.getResAsync(e,n,this)}else RES.getResByUrl(e,n,this,RES.ResourceItem.TYPE_IMAGE)},e}();egret.registerClass(AssetAdapter,"AssetAdapter",["eui.IAssetAdapter"]);var ThemeAdapter=function(){function e(){}var t=(__define,e),i=t.prototype;return i.getTheme=function(e,t,i,n){function o(e){t.call(n,e)}function r(t){t.resItem.url==e&&(RES.removeEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,r,null),i.call(n))}RES.addEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,r,null),RES.getResByUrl(e,o,this,RES.ResourceItem.TYPE_TEXT)},e}();egret.registerClass(ThemeAdapter,"ThemeAdapter",["eui.IThemeAdapter"]);var Project=function(){function e(e,t,i,n){this._priceLevelOne=e,this._outputLevelOne=t,this._propPrice=i,this._propOutputRatio=n,this._levelRatios=new Array,this._achieves=new Array}var t=(__define,e),i=t.prototype;return i.addLevelRatio=function(e,t,i,n){var o=this._outputLevelOne;this._levelRatios.length>0&&(o=this.output(this._levelRatios[this._levelRatios.length-1].upperLevel,0,0));var r=this._priceLevelOne;this._levelRatios.length>0&&(r=this.priceOf(this._levelRatios[this._levelRatios.length-1].upperLevel)),this._levelRatios.push({lowerLevel:e,upperLevel:t,priceRatio:i,outputRatio:n,outputBase:o,priceBase:r})},i.addAchieve=function(e,t,i,n){this._achieves.push({level:e,outputRatio:t,priceUseGold:i,priceUseDiamond:n})},e.createAllProjects=function(){var t=new Array;return t.push(e.createProjectOne()),t.push(e.createProjectTwo()),t.push(e.createProjectThree()),t.push(e.createProjectFour()),t.push(e.createProjectFive()),t.push(e.createProjectSix()),t.push(e.createProjectSeven()),t.push(e.createProjectEight()),t.push(e.createProjectNine()),t.push(e.createProjectTen()),t.push(e.createProjectEleven()),t.push(e.createProjectTwelve()),t.push(e.createProjectThirteen()),t.push(e.createProjectFourteen()),t.push(e.createProjectFifteen()),t.push(e.createProjectSixteen()),t.push(e.createProjectSeventeen()),t.push(e.createProjectEighteen()),t.push(e.createProjectNinteen()),t.push(e.createProjectTwenty()),t},e.createProjectOne=function(){var t=new e(1,1,100,.1);return t.addLevelRatio(2,99,1.05,1),t.addLevelRatio(100,199,1.05,1),t.addLevelRatio(200,299,1.05,1),t.addLevelRatio(300,399,1.05,1),t.addLevelRatio(400,499,1.03,1),t.addLevelRatio(500,599,1.03,1.01),t.addLevelRatio(600,699,1.03,1.01),t.addLevelRatio(700,799,1.03,1.01),t.addLevelRatio(800,899,1.03,1.01),t.addLevelRatio(900,999,1.03,1.01),t.addLevelRatio(1e3,1199,1.02,1.005),t.addLevelRatio(1200,1399,1.02,1.005),t.addLevelRatio(1400,1599,1.02,1.005),t.addLevelRatio(1600,1799,1.02,1.005),t.addLevelRatio(1800,1999,1.02,1.005),t.addLevelRatio(2e3,2499,1.02,1.005),t.addLevelRatio(2500,2999,1.02,1.005),t.addLevelRatio(3e3,3499,1.02,1.005),t.addLevelRatio(3500,3999,1.02,1.005),t.addLevelRatio(4e3,4499,1.02,1.005),t.addLevelRatio(4500,4999,1.02,1.005),t.addLevelRatio(5e3,5999,1.01,1.005),t.addLevelRatio(6e3,6999,1.01,1.005),t.addLevelRatio(7e3,7999,1.01,1.005),t.addLevelRatio(8e3,8999,1.01,1.005),t.addLevelRatio(9e3,9999,1.01,1.005),t.addLevelRatio(1e4,99999,1.01,1.005),t.addAchieve(50,2,1e3,100),t.addAchieve(100,5,5e3,100),t.addAchieve(200,5,5e3,100),t.addAchieve(300,5,5e3,100),t.addAchieve(500,1e3,1e5,1e3),t.addAchieve(1e3,1e3,1e8,1e3),t.addAchieve(2e3,1e6,1e11,2e3),t.addAchieve(5e3,1e9,1e13,2e3),t.addAchieve(1e4,1e15,1e17,5e3),t.addAchieve(1e5,1e25,1e21,1e4),t},e.createProjectTwo=function(){var t=new e(1,1,100,.1);return t.addLevelRatio(2,99,1.05,1),this.createProjectOne()},e.createProjectThree=function(){var t=new e(1,1,100,.1);return t.addLevelRatio(2,99,1.05,1),this.createProjectOne()},e.createProjectFour=function(){var t=new e(1,1,100,.1);return t.addLevelRatio(2,99,1.05,1),this.createProjectOne()},e.createProjectFive=function(){var t=new e(1,1,100,.1);return t.addLevelRatio(2,99,1.05,1),this.createProjectOne()},e.createProjectSix=function(){var t=new e(1,1,100,.1);return t.addLevelRatio(2,99,1.05,1),this.createProjectOne()},e.createProjectSeven=function(){var t=new e(1,1,100,.1);return t.addLevelRatio(2,99,1.05,1),this.createProjectOne()},e.createProjectEight=function(){var t=new e(1,1,100,.1);return t.addLevelRatio(2,99,1.05,1),this.createProjectOne()},e.createProjectNine=function(){var t=new e(1,1,100,.1);return t.addLevelRatio(2,99,1.05,1),this.createProjectOne()},e.createProjectTen=function(){var t=new e(1,1,100,.1);return t.addLevelRatio(2,99,1.05,1),this.createProjectOne()},e.createProjectEleven=function(){var t=new e(1,1,100,.1);return t.addLevelRatio(2,99,1.05,1),this.createProjectOne()},e.createProjectTwelve=function(){var t=new e(1,1,100,.1);return t.addLevelRatio(2,99,1.05,1),this.createProjectOne()},e.createProjectThirteen=function(){var t=new e(1,1,100,.1);return t.addLevelRatio(2,99,1.05,1),this.createProjectOne()},e.createProjectFourteen=function(){var t=new e(1,1,100,.1);return t.addLevelRatio(2,99,1.05,1),this.createProjectOne()},e.createProjectFifteen=function(){var t=new e(1,1,100,.1);return t.addLevelRatio(2,99,1.05,1),this.createProjectOne()},e.createProjectSixteen=function(){var t=new e(1,1,100,.1);return t.addLevelRatio(2,99,1.05,1),this.createProjectOne()},e.createProjectSeventeen=function(){var t=new e(1,1,100,.1);return t.addLevelRatio(2,99,1.05,1),this.createProjectOne()},e.createProjectEighteen=function(){var t=new e(1,1,100,.1);return t.addLevelRatio(2,99,1.05,1),this.createProjectOne()},e.createProjectNinteen=function(){var t=new e(1,1,100,.1);return t.addLevelRatio(2,99,1.05,1),this.createProjectOne()},e.createProjectTwenty=function(){var t=new e(1,1,100,.1);return t.addLevelRatio(2,99,1.05,1),this.createProjectOne()},i.output=function(e,t,i){for(var n=1,o=1,r=1;r<=this._levelRatios.length;r++){var a=this._levelRatios[r-1];if(e>=a.lowerLevel&&e<=a.upperLevel){n=a.outputBase*Math.pow(a.outputRatio,e-o);break}o=a.upperLevel}for(var s=1,r=1;r<=this._achieves.length&&t>=r;r++)s*=this._achieves[r-1].outputRatio;var c=1+t*this._propOutputRatio;return Math.round(e*this._outputLevelOne*n*s*c)},i.priceOf=function(e){for(var t=1,i=1,n=1;n<=this._levelRatios.length;n++){var o=this._levelRatios[n-1];if(e>=o.lowerLevel&&e<=o.upperLevel){t=o.priceBase*Math.pow(o.priceRatio,e-i);break}i=o.upperLevel}return Math.round(e*this._priceLevelOne*t)},i.price=function(e,t){for(var i=0,n=e;e+t>n;n++)i+=this.priceOf(n);return i},i.diamondPriceOfAchieve=function(e){return this._achieves[e].priceUseDiamond},i.goldPriceOfAchieve=function(e){return this._achieves[e].priceUseGold},i.levelOfAchieve=function(e){return this._achieves[e].level},e}();egret.registerClass(Project,"Project");var AuctionUI=function(e){function t(){e.call(this),this.addEventListener(eui.UIEvent.COMPLETE,this.uiCompHandler,this),this.skinName="resource/custom_skins/auctionUISkin.exml"}__extends(t,e);var i=(__define,t),n=i.prototype;return n.uiCompHandler=function(){var e=this;this.btnClose.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){e.dispatchEventWith(GameEvents.EVT_RETURN)},this)},t}(eui.Component);egret.registerClass(AuctionUI,"AuctionUI");var FirstChargeBonusUI=function(e){function t(){e.call(this),this.addEventListener(eui.UIEvent.COMPLETE,this.uiCompHandler,this),this.skinName="resource/custom_skins/auctionUISkin.exml"}__extends(t,e);var i=(__define,t),n=i.prototype;return n.uiCompHandler=function(){var e=this;this.btnClose.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){e.dispatchEventWith(GameEvents.EVT_RETURN)},this)},t}(eui.Component);egret.registerClass(FirstChargeBonusUI,"FirstChargeBonusUI");var HomeUI=function(e){function t(){e.call(this),this.hit=0,this.addEventListener(eui.UIEvent.COMPLETE,this.uiCompHandler,this),this.skinName="resource/custom_skins/homeUISkin.exml"}__extends(t,e);var i=(__define,t),n=i.prototype;return n.uiCompHandler=function(){var e=this;e.btnHome.addEventListener(egret.TouchEvent.TOUCH_TAP,e.btnHandler,e),e.btnRank.addEventListener(egret.TouchEvent.TOUCH_TAP,e.btnHandler,e),e.btnTool.addEventListener(egret.TouchEvent.TOUCH_TAP,e.btnHandler,e),e.btnAuction.addEventListener(egret.TouchEvent.TOUCH_TAP,e.btnHandler,e),e.btns=[e.btnHome,e.btnRank,e.btnTool,e.btnAuction],e.imgAvatar.source=application.customer.avatar,e.animateCustomer(0-application.customer.gold,0-application.customer.diamond,application.customer.output,null),e.renderTotalHits(),e.renderTotalHitsAllTime(),e.renderProjects(),e.renderBid(),e.renderBeauty(),e.renderOfflineGold(),e.lblHit.addEventListener(egret.TouchEvent.TOUCH_BEGIN,function(){e.onHit()},this),e.btnHit.addEventListener(egret.TouchEvent.TOUCH_BEGIN,function(){e.onHit()},this),e.btnGift.addEventListener(egret.TouchEvent.TOUCH_BEGIN,function(){e.onGift()},this),e.btnHelp.addEventListener(egret.TouchEvent.TOUCH_BEGIN,function(){e.onHelp()},this),e.goHome()},n.onGift=function(){},n.onHelp=function(){},n.renderTotalHitsAllTime=function(){var e=this,t=new egret.Timer(144e5,0);t.addEventListener(egret.TimerEvent.TIMER,function(t){e.renderTotalHits()},this),t.start()},n.renderTotalHits=function(){var e=this;application.dao.rest("hits",{customer_id:application.customer.id},function(t,i){t&&i.hits>0&&(application.customer.total_hits=i.hits,e.lblTotalHits.text="x"+application.customer.total_hits.toString())})},n.renderBid=function(){var e=this;application.dao.fetch("Bid",{succeed:1},{limit:1,order:"create_time desc"},function(t,i){t&&i.length>0&&application.dao.fetch("Customer",{id:i[0].customer_id},{limit:1},function(t,n){t&&n.length>0&&(e.lblBidName.text=n[0].name,e.lblBidGold.text=application.format(i[0].gold),e.imgBidAvatar.source=n[0].avatar)})})},n.renderProjects=function(){var e=this;e.grpProject.removeChildren(),application.dao.fetch("Project",{customer_id:application.customer.id},{order:"sequence asc"},function(t,i){if(t&&i.length>0)for(var n=0;n<i.length;n++)e.addProject(i[n])})},n.renderBeauty=function(){var e=this,t=RES.getRes("animation_json"),i=RES.getRes("animation_png"),n=new egret.MovieClipDataFactory(t,i);e.mcBeauty=new egret.MovieClip(n.generateMovieClipData("")),e.mcBeauty.x=70,e.mcBeauty.y=90,e.addChild(e.mcBeauty),e.mcBeauty.touchEnabled=!0,e.mcBeauty.addEventListener(egret.TouchEvent.TOUCH_BEGIN,function(){e.onBeauty()},this)},n.renderOfflineGold=function(){var e=this;application.dao.rest("offline_gold",{customer_id:application.customer.id},function(t,i){if(t&&i.gold>0){var n="离线"+i.hours.toString()+"小时"+i.minutes.toString()+"分钟，共产生金币收益"+i.gold.toString();Toast.launch(n),application.customer.gold+=i.gold,application.dao.save("Customer",application.customer,null),e.animateStep(e.lblGold,application.customer.gold-i.gold,application.customer.gold)}})},n.onBeauty=function(){var e=this;e.mcBeauty.play(3),application.customer.gold+=e.getOutput(),application.dao.save("Customer",application.customer,null),e.animateStep(e.lblGold,application.customer.gold+application.customer.output,application.customer.gold)},n.onHit=function(){var e=this;if(application.customer.total_hits>0){application.customer.total_hits-=1,application.dao.save("Customer",application.customer,null),e.lblTotalHits.text="x"+application.customer.total_hits.toString(),e.hit=59,e.lblOutput.text=application.format(e.getOutput());var t=new egret.Timer(1e3,60);t.addEventListener(egret.TimerEvent.TIMER,function(t){e.lblHit.text=e.hit.toString(),e.hit=e.hit-1},this),t.addEventListener(egret.TimerEvent.TIMER_COMPLETE,function(t){e.hit=0,e.lblHit.text="59",e.lblOutput.text=application.format(application.customer.output.toString())},this),t.start()}else Toast.launch("暂时没有奋力一击")},n.getOutput=function(){return this.hit>0?99*application.customer.output:application.customer.output},n.animateStep=function(e,t,i){if(t!=i){var n=Math.min(Math.abs(t-i),20),o=(i-t)/n,r=new egret.Timer(50,n);r.addEventListener(egret.TimerEvent.TIMER,function(i){e.text=application.format(Math.round(t+o*i.target.currentCount))},this),r.addEventListener(egret.TimerEvent.TIMER_COMPLETE,function(t){e.text=application.format(i)},this),r.start()}},n.animateCustomer=function(e,t,i,n){this.animateStep(this.lblGold,application.customer.gold+e,application.customer.gold),this.animateStep(this.lblDiamond,application.customer.diamond+t,application.customer.diamond),this.animateStep(this.lblOutput,this.getOutput()-i,this.getOutput()),this.addProject(n)},n.addProject=function(e){if(e){var t=e.sequence,i=new ProjectItem(e,application.projects[t],(t+1).toString()+"_png","t"+(t+1).toString()+"_png");this.grpProject.addChildAt(i,t)}},n.resetFocus=function(){this._uiFocused&&(this._uiFocused.parent&&this._uiFocused.parent.removeChild(this._uiFocused),this._uiFocused=null),null!=this._btnFocused&&(this._btnFocused.selected=!1,this._btnFocused.enabled=!0,this._btnFocused=null)},n.goHome=function(){this._pageFocusedPrev=this._pageFocused=GamePages.HOME,this._btnFocused=this.btnHome,this.btnHome.selected=!0},n.goTool=function(){var e=this;this._toolUI||(this._toolUI=new ToolUI,this._toolUI.addEventListener(GameEvents.EVT_RETURN,function(){e.resetFocus(),e.goHome()},this)),this._uiFocused=this._toolUI,this.btnTool.selected=!0},n.goRank=function(){var e=this;this._rankUI||(this._rankUI=new RankUI,this._rankUI.addEventListener(GameEvents.EVT_RETURN,function(){e.resetFocus(),e.goHome()},this)),this._uiFocused=this._rankUI,this.btnRank.selected=!0},n.goAuction=function(){var e=this;this._auctionUI||(this._auctionUI=new AuctionUI,this._auctionUI.addEventListener(GameEvents.EVT_RETURN,function(){e.resetFocus(),e.goHome()},this)),this._uiFocused=this._auctionUI,this.btnAuction.selected=!0},n.btnHandler=function(e){if(e.currentTarget==this._btnFocused)return void(this._btnFocused.selected=!0);for(var t=this.btns.length-1;t>-1;--t)this.btns[t].enabled=!1;switch(this._btnFocused&&(this._btnFocused.selected=!1,this._btnFocused.enabled=!0),this._uiFocused&&this._uiFocused.parent&&this._uiFocused.parent.removeChild(this._uiFocused),this._btnFocused=e.currentTarget,this._btnFocused.selected=!0,this._uiFocused=null,this._pageFocusedPrev=this._pageFocused,this._btnFocused){case this.btnHome:this._pageFocused=GamePages.HOME;break;case this.btnRank:this._pageFocused=GamePages.RANK;break;case this.btnTool:this._pageFocused=GamePages.TOOL;break;case this.btnAuction:this._pageFocused=GamePages.AUCTION}this.dispatchEventWith(GameEvents.EVT_LOAD_PAGE,!1,this._pageFocused)},n.pageReadyHandler=function(e){for(var t=0;t<this.btns.length;t++)this.btns[t].enabled=!0;switch(e){case GamePages.HOME:this.goHome();break;case GamePages.RANK:this.goRank();break;case GamePages.TOOL:this.goTool();break;case GamePages.AUCTION:this.goAuction()}this.addChild(this._uiFocused)},t}(eui.Component);egret.registerClass(HomeUI,"HomeUI");var LoadingUI=function(e){function t(){e.call(this),this.createView()}__extends(t,e);var i=(__define,t),n=i.prototype;return n.createView=function(){this.textField=new egret.TextField,this.textField.textColor=0,this.textField.y=300,this.textField.width=480,this.textField.height=100,this.textField.textAlign="center",this.addChild(this.textField)},n.setProgress=function(e,t){this.textField.text="Loading..."+e+"/"+t},t}(egret.Sprite);egret.registerClass(LoadingUI,"LoadingUI");var LoginButton=function(e){function t(t,i){e.call(this),this.type=t,this.url=i,this.addEventListener(eui.UIEvent.COMPLETE,this.uiCompHandler,this),this.skinName="resource/custom_skins/loginButtonSkin.exml"}__extends(t,e);var i=(__define,t),n=i.prototype;return n.uiCompHandler=function(){var e=new eui.Image;if(e.source=this.type+"_png",this.icon_group.addChildAt(e,0),this.url&&""!=this.url){this.right_ui.visible=!0;var t=new egret.DisplayObjectContainer,i=new egret.Shape;i.graphics.beginFill(16711680),i.graphics.drawCircle(100,100,100),i.graphics.endFill(),t.addChild(i);var n=new egret.Bitmap;RES.getResByUrl(this.url,function(e){n.texture=e,n.width=200,n.height=200},this,RES.ResourceItem.TYPE_IMAGE),t.addChild(n),n.mask=i,this.icon_group.addChildAt(t,0)}else this.right_ui.visible=!1;this.name_txt.text=this.getLabelName(this.type,this.url&&""!=this.url)},n.getLabelName=function(e,t){var i="";switch(e){case"qq":i="qq";break;case"wx":i="微信";break;case"wb":i="微博";break;default:i="默认"}return t?i+"--一键登录":i+"登录"},t}(eui.Component);egret.registerClass(LoginButton,"LoginButton");var LoginUI=function(e){function t(t){e.call(this),this.loginType=t,this.addEventListener(eui.UIEvent.COMPLETE,this.uiCompHandler,this),this.skinName="resource/custom_skins/loginUISkin.exml"}__extends(t,e);var i=(__define,t),n=i.prototype;return n.uiCompHandler=function(){for(var e=this,t=0;t<this.loginType.loginTypes.length;t++){var i=this.loginType.loginTypes[t],n="";i.accInfo&&i.accInfo.avatarUrl&&(n=i.accInfo.avatarUrl);var o=new LoginButton(i.loginType,n);o.name=i.loginType,this.btnGroup.addChild(o),o.scaleX=o.scaleY=.5,o.touchEnabled=!0,o.addEventListener(egret.TouchEvent.TOUCH_TAP,function(t){e.loginType.onChoose(this.name)},o)}},t}(eui.Component);egret.registerClass(LoginUI,"LoginUI");var OfflineGoldUI=function(e){function t(){e.call(this),this.addEventListener(eui.UIEvent.COMPLETE,this.uiCompHandler,this),this.skinName="resource/custom_skins/auctionUISkin.exml"}__extends(t,e);var i=(__define,t),n=i.prototype;return n.uiCompHandler=function(){var e=this;this.btnClose.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){e.dispatchEventWith(GameEvents.EVT_RETURN)},this)},t}(eui.Component);egret.registerClass(OfflineGoldUI,"OfflineGoldUI");var ProfileUI=function(e){function t(){e.call(this),this.addEventListener(eui.UIEvent.COMPLETE,this.uiCompHandler,this),this.skinName="resource/custom_skins/profileUISkin.exml"}__extends(t,e);var i=(__define,t),n=i.prototype;return n.uiCompHandler=function(){var e=this;console.log("		ProfileUI uiCompHandler"),this.btnReturn.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){e.dispatchEventWith(GameEvents.EVT_RETURN)},this);var t=[{icon:"skillIcon01_png",name:"旋龙幻杀"},{icon:"skillIcon02_png",name:"魔魂天咒"},{icon:"skillIcon03_png",name:"天魔舞"},{icon:"skillIcon04_png",name:"痴情咒"},{icon:"skillIcon05_png",name:"无间寂"},{icon:"skillIcon06_png",name:"霸天戮杀"},{icon:"skillIcon07_png",name:"灭魂狂飙"}];this.listSkills.itemRendererSkinName="profileSkillListIRSkin",this.listSkills.dataProvider=new eui.ArrayCollection(t)},n.createChildren=function(){e.prototype.createChildren.call(this),this.scrListSkills.horizontalScrollBar=null},t}(eui.Component);egret.registerClass(ProfileUI,"ProfileUI");var ProjectItem=function(e){function t(t,i,n,o){e.call(this),this._myProject=t,this._project=i,this.addEventListener(eui.UIEvent.COMPLETE,this.uiCompHandler,this),this.skinName="resource/custom_skins/projectItemSkin.exml",this.imgIcon.source=n,this.imgTitle.source=o}__extends(t,e);var i=(__define,t),n=i.prototype;return n.uiCompHandler=function(){var e=this;1==this._myProject.unlocked?this.renderLocked():this.renderUnlocked(),this.lblPrice.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){e.onUpgrade()},this),this.imgUpgrade.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){e.onUpgrade()},this),this.imgUpgrade10.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){0==e._myProject.unlocked&&e.upgrade(10)},this),this.imgUpgrade100.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){0==e._myProject.unlocked&&e.upgrade(100)},this)},n.onUpgrade=function(){1==this._myProject.unlocked?this.unlock():this.upgrade(1)},n.output=function(){return this._project.output(this._myProject.level,this._myProject.achieve,application.customer.prop)},n.renderAchieves=function(){this.grpAchieve.removeChildren();for(var e=1;10>=e;e++){var t=new eui.Group,i=new eui.Image;if(e<this._myProject.achieve)i.source="acv"+e.toString()+"_png",t.addChild(i),i.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){},this);else{if(this._myProject.level>this._project.levelOfAchieve(e-1)){var n=new eui.Image;n.source="acvnone_png",t.addChild(n),i.source="acv"+e.toString()+"_png",t.addChild(i)}else i.source="acvlock_png",t.addChild(i);i.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){},this)}this.grpAchieve.addChild(t)}},n.renderLocked=function(){this.lblLevel.text="0",this.lblOutput.text="0",this.lblPrice.text=this._project.priceOf(this._myProject.level+1).toString(),this.imgUpgrade10.source="upgrade10G_png",this.imgUpgrade100.source="upgrade100G_png",this.imgUpgrade.source="UpgradeG_png",this.renderAchieves()},n.renderUnlocked=function(){this.lblLevel.text=this._myProject.level,this.lblOutput.text=application.format(this.output()),this.lblPrice.text=application.format(this._project.priceOf(this._myProject.level+1)),this.imgUpgrade10.source="upgrade10_png",this.imgUpgrade100.source="upgrade100_png",this.imgUpgrade.source="upgrade_png",this.renderAchieves()},n.upgrade=function(e){var t=this,i=this._project.price(this._myProject.level+1,e);if(application.customer.gold<i)return void Toast.launch("没有足够的金币");var n=this.output();this._myProject.level+=e,application.dao.save("Project",t._myProject,function(e,o){e?application.buyOutput(i,0,t.output()-n,null,function(e,i){e?t.renderUnlocked():Toast.launch("升级失败")}):Toast.launch("升级失败")})},n.unlock=function(){var e=this,t=this._project.priceOf(1);return application.customer.gold<t?void Toast.launch("没有足够的金币"):(e._myProject.unlocked=0,void application.dao.save("Project",e._myProject,function(i,n){if(i)if(e._myProject.sequence<19){var o={};o.customer_id=application.customer.id,o.sequence=e._myProject.sequence+1,o.unlocked=1,o.achieve=0,o.level=0,application.dao.save("Project",o,function(i,n){i?application.buyOutput(t,0,e.output(),n,function(t,i){t?e.renderUnlocked():Toast.launch("解锁失败")}):Toast.launch("解锁失败")})}else application.buyOutput(t,0,e.output(),null,function(t,i){t?e.renderUnlocked():Toast.launch("解锁失败")});else Toast.launch("解锁失败")}))},n.buyAchieveUseGold=function(){var e=this,t=e._project.goldPriceOfAchieve(e._myProject.acheve+1);if(application.customer.gold<t)return void Toast.launch("没有足够的金币");var i=e.output();e._myProject.achieve+=1,application.dao.save("Project",e._myProject,function(n,o){if(n){var r=e.output();application.buyOutput(t,0,r-i,null,function(t,i){t?e.renderUnlocked():Toast.launch("获得成就失败")})}else Toast.launch("获得成就失败")})},n.buyAchieveUseDiamond=function(){var e=this,t=e._project.diamondPriceOfAchieve(e._myProject.acheve+1);if(application.customer.diamond<t)return void Toast.launch("没有足够的钻石");var i=e.output();e._myProject.achieve+=1,application.dao.save("Project",e._myProject,function(n,o){if(n){var r=e.output();application.buyOutput(0,t,r-i,null,function(t,i){t?e.renderUnlocked():Toast.launch("获得成就失败")})}else Toast.launch("获得成就失败")})},t}(eui.Component);egret.registerClass(ProjectItem,"ProjectItem");var RankUI=function(e){function t(){e.call(this),this.addEventListener(eui.UIEvent.COMPLETE,this.uiCompHandler,this),this.skinName="resource/custom_skins/rankUISkin.exml"}__extends(t,e);var i=(__define,t),n=i.prototype;return n.uiCompHandler=function(){var e=this;application.dao.fetch("Customer",{},{limit:8,order:" DESC"},function(t,i){var n=new Array;if(t)for(var o=0;o<i.length;o++)n.push({icon:i[o].avatar,name:i[o].name,metal:i[o].metal});e.listRank.dataProvider=new eui.ArrayCollection(n),e.listRank.itemRenderer=RankIRSkin})},t}(eui.Component);egret.registerClass(RankUI,"RankUI");var RankIRSkin=function(e){function t(){e.call(this),this.skinName="rankIRSkin"}__extends(t,e);var i=(__define,t);i.prototype;return t}(eui.ItemRenderer);egret.registerClass(RankIRSkin,"RankIRSkin");var Toast=function(e){function t(i,n,o){var r=this;e.call(this),console.log("Toast:",i);var a=new egret.Bitmap(t._txtrToastBg);this.addChild(a);var s=new egret.TextField;s.multiline=!0,s.size=20,s.bold=!0,s.textColor=16777215,s.stroke=2,s.strokeColor=0,s.text=i,s.fontFamily="微软雅黑",s.textAlign=egret.HorizontalAlign.CENTER,s.width=.84*n,s.x=(t._txtrToastBg.textureWidth-s.width)/2,s.y=6,this.addChild(s),a.height=12+s.height,this.anchorOffsetX=.5*this.width,this.anchorOffsetY=.5*this.height,this.x=.5*n,this.y=.618*o,this.alpha=0,egret.Tween.get(this).to({alpha:1},800,egret.Ease.quintOut).wait(1600).to({alpha:0},1200,egret.Ease.quintIn).call(function(){r.parent&&r.parent.removeChild(r)})}__extends(t,e);var i=(__define,t);i.prototype;return t.init=function(e,t){console.log("Toast.init",t),this._cont=e,this._txtrToastBg=t},t.launch=function(e){if(this._cont){var i=new t(e,this._cont.stage.stageWidth,this._cont.stage.stageHeight);this._cont.addChild(i)}},t}(egret.DisplayObjectContainer);egret.registerClass(Toast,"Toast");var ToolUI=function(e){function t(){e.call(this),this.addEventListener(eui.UIEvent.COMPLETE,this.uiCompHandler,this),this.skinName="resource/custom_skins/toolUISkin.exml"}__extends(t,e);var i=(__define,t),n=i.prototype;return n.uiCompHandler=function(){var e=this;this.btnReturn.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){e.dispatchEventWith(GameEvents.EVT_RETURN)},this);var t=[{icon:"goods01_png",goodsName:"魔法石",comment:"法力加成 +3"},{icon:"goods02_png",goodsName:"诅咒娃娃",comment:"咒术加成 +3"},{icon:"goods03_png",goodsName:"万圣戒指",comment:"敏捷加成 +3"},{icon:"goods04_png",goodsName:"斗篷",comment:"耐力加成 +3"},{icon:"goods05_png",goodsName:"鹅毛笔",comment:"精神加成 +3"},{icon:"goods06_png",goodsName:"血滴子",comment:"嗜血加成 +3"},{icon:"goods07_png",goodsName:"屠龙刀",comment:"力量加成 +5"}];this.listTool.dataProvider=new eui.ArrayCollection(t),this.listTool.itemRenderer=ToolIRSkin},t}(eui.Component);egret.registerClass(ToolUI,"ToolUI");var ToolIRSkin=function(e){function t(){e.call(this),this.skinName="toolIRSkin"}__extends(t,e);var i=(__define,t);i.prototype;return t}(eui.ItemRenderer);egret.registerClass(ToolIRSkin,"ToolIRSkin");var TrueLoadingUI=function(e){function t(){var t=this;e.call(this),this.addEventListener(egret.Event.REMOVED_FROM_STAGE,function(){t.hasEventListener(egret.Event.ENTER_FRAME)&&t.removeEventListener(egret.Event.ENTER_FRAME,t.runLoading,t)
},this),this.addEventListener(egret.Event.ADDED_TO_STAGE,function(){t.setProgress(0,1),t.addEventListener(egret.Event.ENTER_FRAME,t.runLoading,t)},this)}__extends(t,e);var i=(__define,t),n=i.prototype;return n.createChildren=function(){e.prototype.createChildren.call(this),this._loadingRun=new egret.Bitmap(RES.getRes("loading_run")),this.addChild(this._loadingRun),this._loadingRun.anchorOffsetX=.5*this._loadingRun.width,this._loadingRun.anchorOffsetY=.5*this._loadingRun.height,this._loadingRun.x=.5*this.stage.stageWidth,this._loadingRun.y=.5*this.stage.stageHeight,this._txProgress=new egret.TextField,this._txProgress.textAlign=egret.HorizontalAlign.CENTER,this._txProgress.verticalAlign=egret.VerticalAlign.MIDDLE,this._txProgress.x=.5*this.stage.stageWidth-100,this._txProgress.width=200,this._txProgress.y=.5*this.stage.stageHeight-100,this._txProgress.height=200,this._txProgress.size=14,this._txProgress.stroke=1,this._txProgress.strokeColor=0,this.addChild(this._txProgress)},n.runLoading=function(e){this._loadingRun.rotation+=3},n.setProgress=function(e,t){this._txProgress&&(this._txProgress.text=Math.round(e/t*100)+"%")},t}(eui.Group);egret.registerClass(TrueLoadingUI,"TrueLoadingUI");
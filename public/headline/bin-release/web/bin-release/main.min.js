var application;!function(t){function e(e){t.main=e;var i=egret.getOption("wysj_server");i&&i.length>1?t.baseUrl=i:t.baseUrl=window.location.protocol+"//"+window.location.hostname+(window.location.port?":"+window.location.port:"")+"/";var n=log4javascript.getLogger("larksoft"),a=new log4javascript.AjaxAppender(t.baseUrl+"logs");a.setWaitForResponse(!1),a.setThreshold(log4javascript.Level.ERROR);var o=new log4javascript.HttpPostDataLayout;o.setCustomField("version",t.version),o.setCustomField("game",t.game),a.setLayout(o),n.addAppender(a),Utility.takeOverConsole(n),t.dao=new Dao(t.baseUrl+"api/",t.game),t.channel=Channel.create(),t.projects=Project.createAll(),t.stopwatch=new egret.EventDispatcher;var r=new egret.Timer(1e3,0);r.addEventListener(egret.TimerEvent.TIMER,function(e){t.ticks++,t.stopwatch.dispatchEventWith("second",!0,t.ticks),t.ticks%60==0&&(t.stopwatch.dispatchEventWith("minute",!0,t.ticks/60),t.ticks%3600==0&&t.stopwatch.dispatchEventWith("hour",!0,t.ticks/3600))},this),r.start(),window.onunload=function(){t.me&&t.me.saveNow()}}function i(e){t.token=e.token,t.dao.fetch("Customer",{id:e.customer_id},{limit:1}).then(function(e){e.length>0?(t.me=new Customer(e[0]),t.channel.track(TRACK_CATEGORY_PLAYER,TRACK_ACTION_ENTER),0==t.me.attrs.metal&&(t.guideUI=new GuideUI),t.me.bid.refresh(t.me).then(function(e){t.main.dispatchEventWith(GameEvents.EVT_LOGIN_IN_SUCCESS)})):Toast.launch("获取账号信息失败,请重新进入")})}function n(){t.main.homeUI.gotoPage(GamePages.HOME,!0)}function a(){t.main.homeUI.gotoPage(GamePages.AUCTION,!1)}function o(){t.main.homeUI.gotoPage(GamePages.TOOL,!1)}function r(e,i){return e.horizontalCenter=0,e.verticalCenter=0,t.blockUI||(t.blockUI=new BlockUI),t.blockUI.addChild(e),t.guideUI?i?i.contains(t.guideUI)?i.addChildAt(t.blockUI,i.getChildIndex(t.guideUI)):i.addChild(t.blockUI):t.main.homeUI.addChildAt(t.blockUI,i.getChildIndex(t.guideUI)):i?i.addChild(t.blockUI):t.main.homeUI.addChild(t.blockUI),e}function s(e){return e&&e.parent&&(e.parent==t.blockUI?(t.blockUI.numChildren<=2&&e.parent.parent&&e.parent.parent.removeChild(t.blockUI),t.blockUI.removeChild(e)):e.parent.removeChild(e)),e}t.ticks=0,t.version="2.5.3",t.game="headline",t.token="",t.init=e,t.logined=i,t.gotoHome=n,t.gotoAuction=a,t.gotoTool=o,t.showUI=r,t.hideUI=s}(application||(application={}));var CHANNEL_1758_IN_EGRET="10016",CHANNEL_HUHUH5="huhuh5",CHANNEL_51H5="51h5",TRACK_CATEGORY_PLAYER="player",TRACK_CATEGORY_DIAMOND="diamond",TRACK_CATEGORY_GOLD="gold",TRACK_CATEGORY_ACTIVITY="activity",TRACK_CATEGORY_GUIDE="guide",TRACK_CATEGORY_RESOURCE="resource",TRACK_ACTION_DEC="dec",TRACK_ACTION_INC="inc",TRACK_ACTION_JOIN="join",TRACK_ACTION_ENTER="enter",TRACK_ACTION_LEAVE="leave",TRACK_ACTION_LOAD="load",Channel=function(){function t(t){this._deferred=null,this._standalone=t}var e=(__define,t),i=e.prototype;return t.create=function(){var t=egret.getOption("wysj_channel")||egret.getOption("channelId")||egret.getOption("egret.runtime.spid")||"egret";return t===CHANNEL_1758_IN_EGRET?(console.info("using channel 1758"),new Channel1758(!1)):t===CHANNEL_HUHUH5?(console.info("using channel huhuh5"),new ChannelHuHuH5(!0)):t===CHANNEL_51H5?(console.info("using channel huhuh5"),new Channel51H5(!0)):(console.info("using default channel"),new ChannelEgret(!0))},i.standalone=function(){return this._standalone},i.require=function(t){return Utility.require(t)},i.rest=function(t,e,i){var n=application.baseUrl+"channels/"+e+"?wysj_channel="+t;return console.log("rest "+n+" "+JSON.stringify(i)),application.dao.restWithUrl(n,i)},i.promise=function(){return this._timer=new egret.Timer(6e4,1),this._timer.addEventListener(egret.TimerEvent.TIMER,function(t){this.reject("操作超时")},this),this._timer.start(),this._promiseWithoutTimeout()},i._promiseWithoutTimeout=function(){return this.reject(""),this._deferred=Q.defer(),this._deferred.promise},i.resolvedPromise=function(){var t=this._promiseWithoutTimeout();return this._deferred.resolve(),t},i.rejectedPromise=function(){var t=this._promiseWithoutTimeout();return this._deferred.reject("目前不支持"),t},i.resolve=function(t){this._deferred&&this._deferred.resolve(t),this._timer&&this._timer.stop(),this._deferred=null},i.reject=function(t){this._deferred&&this._deferred.reject(t),this._timer&&this._timer.stop(),this._deferred=null},i.openScreen=function(t){this._loadingUI=new LoadingUI,t.addChild(this._loadingUI)},i.setOpenScreenProgress=function(t,e,i){this._loadingUI.setProgress(t,e),t==e&&this._loadingUI.parent&&this._loadingUI.parent.removeChild(this._loadingUI)},i.loginQuietly=function(){var t=this;return t.rejectedPromise()},i.login=function(){return this.rejectedPromise()},i.pay=function(t){return this.rejectedPromise()},i.share=function(t){return this.rejectedPromise()},i.attention=function(t){return this.rejectedPromise()},i.track=function(t,e,i,n){switch(t){case TRACK_CATEGORY_PLAYER:return;case TRACK_CATEGORY_DIAMOND:return;case TRACK_CATEGORY_GOLD:return;case TRACK_CATEGORY_ACTIVITY:return;case TRACK_CATEGORY_GUIDE:return;case TRACK_CATEGORY_RESOURCE:return}},t}();egret.registerClass(Channel,"Channel");var Dao=function(t){function e(e,i){t.call(this),this._url=e,this._game=i}__extends(e,t);var i=(__define,e),n=i.prototype;return n.fetch=function(t,e,i){return e=e||{},e.game=this._game,i=i||{},this.rest("select/"+t,{conditions:e,filters:i})},n.save=function(t,e){var i=this;if(e.game=this._game,e.id)var n=this.rest("update/"+t+"/"+e.id,e);else var n=this.rest("create/"+t,e);return n.then(function(n){e=n,i.dispatchEventWith(t,!0,e)},function(t){Toast.launch(t)}),n},n.rest=function(t,e){return this.restWithUrl(this._url+t+"?game="+this._game+"&token="+application.token,e)},n.restWithUrl=function(t,e){var i=this;return Q.Promise(function(n,a,o){var r=new egret.HttpRequest;r.responseType=egret.HttpResponseType.TEXT,r.open(t,egret.HttpMethod.POST),r.setRequestHeader("Content-Type","application/json"),r.addEventListener(egret.Event.COMPLETE,function(t){var e,i=t.currentTarget;try{e=JSON.parse(i.response)}catch(a){e=i.response}n(e)},i),r.addEventListener(egret.IOErrorEvent.IO_ERROR,function(e){console.error("restWithUrl "+t+" failed "+e.$target.response),a(e.$target.response)},i),r.addEventListener(egret.ProgressEvent.PROGRESS,function(t){o(Math.floor(100*t.bytesLoaded/t.bytesTotal))},i),r.send(JSON.stringify(e))})},e}(egret.EventDispatcher);egret.registerClass(Dao,"Dao");var GameEvents=function(){function t(){}var e=(__define,t);e.prototype;return t.EVT_RETURN="EVT_RETURN",t.EVT_LOAD_PAGE="EVT_LOAD_PAGE",t.EVT_CLOSE_ABOUT="EVT_CLOSE_ABOUT",t.EVT_LOGIN_IN_SUCCESS="EVT_LOGIN_IN_SUCCESS",t.EVT_LOGIN_OUT_SUCCESS="EVT_LOGIN_OUT_SUCCESS",t.EVT_REFRESH_CUSTOMER="EVT_REFRESH_CUSTOMER",t}();egret.registerClass(GameEvents,"GameEvents");var GamePages=function(){function t(){}var e=(__define,t);e.prototype;return t.HOME="home",t.RANK="rank",t.TOOL="tool",t.AUCTION="auction",t.HELP="help",t.OFFLINEGOLD="offline gold",t.CHARGEBONUS="charge bonus",t.GIFT="gift",t}();egret.registerClass(GamePages,"GamePages");var Main=function(t){function e(){t.apply(this,arguments),this._isThemeLoadEnd=!1,this._isResourceLoadEnd=!1}__extends(e,t);var i=(__define,e),n=i.prototype;return n.createChildren=function(){t.prototype.createChildren.call(this),egret.TextField.default_fontFamily="STXihei",this.stage.registerImplementation("eui.IAssetAdapter",new AssetAdapter),this.stage.registerImplementation("eui.IThemeAdapter",new ThemeAdapter),application.init(this),application.channel.openScreen(this.stage),application.channel.track(TRACK_CATEGORY_RESOURCE,TRACK_ACTION_LOAD,"开始加载配置文件",1),RES.addEventListener(RES.ResourceEvent.CONFIG_COMPLETE,this.onConfigComplete,this),RES.loadConfig("resource/default.res.json","resource/")},n.onConfigComplete=function(t){application.channel.track(TRACK_CATEGORY_RESOURCE,TRACK_ACTION_LOAD,"开始加载皮肤主题资源",2),RES.removeEventListener(RES.ResourceEvent.CONFIG_COMPLETE,this.onConfigComplete,this);var e=new eui.Theme("resource/default.thm.json",this.stage);e.addEventListener(eui.UIEvent.COMPLETE,this.onThemeLoadComplete,this),RES.addEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.onResourceLoadComplete,this),RES.addEventListener(RES.ResourceEvent.GROUP_LOAD_ERROR,this.onResourceLoadError,this),RES.addEventListener(RES.ResourceEvent.GROUP_PROGRESS,this.onResourceProgress,this),RES.addEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,this.onItemLoadError,this),RES.loadGroup("loading")},n.onThemeLoadComplete=function(){this._isThemeLoadEnd=!0,this.createScene()},n.onResourceLoadComplete=function(t){var e=this;switch(t.groupName){case"loading":Toast.init(this,RES.getRes("toast-bg_png")),this._trueLoadingUI=new TrueLoadingUI,application.channel.track(TRACK_CATEGORY_RESOURCE,TRACK_ACTION_LOAD,"开始加载着陆页面",3),this.loadPage("landing");break;case"landing":this.addChild(new LandingUI),this.addEventListener(GameEvents.EVT_LOGIN_IN_SUCCESS,function(t){e.loadPage("home")},this);break;case"home":this._trueLoadingUI.removeBgImage(),this._isResourceLoadEnd=!0,this.createScene();break;default:console.log("	page["+t.groupName+"]ok:",egret.getTimer()),this.pageLoadedHandler(t.groupName)}},n.clearRESEvents=function(){},n.createScene=function(){this._isThemeLoadEnd&&this._isResourceLoadEnd&&this.startCreateScene()},n.onItemLoadError=function(t){console.warn("Url:"+t.resItem.url+" has failed to load")},n.onResourceLoadError=function(t){console.warn("Group:"+t.groupName+" has failed to load"),this.onResourceLoadComplete(t)},n.onResourceProgress=function(t){switch(t.groupName){case"loading":application.channel.setOpenScreenProgress(t.itemsLoaded,t.itemsTotal,"");break;default:this._trueLoadingUI.setProgress(t.itemsLoaded,t.itemsTotal)}},n.startCreateScene=function(){var t=this;this.pageLoadedHandler("home"),this.homeUI=new HomeUI,this.homeUI.addEventListener(GameEvents.EVT_LOAD_PAGE,function(e){t.loadPage(e.data)},this),this.addChild(this.homeUI)},n.loadPage=function(t){this.addChild(this._trueLoadingUI),this._idLoading=t,RES.loadGroup(t)},n.pageLoadedHandler=function(t){"home"!=t&&this.homeUI.pageReadyHandler(this._idLoading),this._trueLoadingUI.parent&&this._trueLoadingUI.parent.removeChild(this._trueLoadingUI)},e}(eui.UILayer);egret.registerClass(Main,"Main");var Utility=function(){function t(){}var e=(__define,t);e.prototype;return t.log10=function(t){for(var e=0;t>=9;)e+=1,t/=10;return e},t.format=function(e){try{if(99999>=e)return new Number(e).toFixed();for(var i="",n=0;n<t.units.length;n++){if(10>e)return new Number(e).toFixed(2)+i;if(100>e)return new Number(e).toFixed(1)+i;if(1e3>e)return new Number(e).toFixed()+i;i=t.units[n],e/=1e3}return new Number(e).toFixed()+i}catch(a){return console.error("format "+e+" error "+a.message),"0"}},t.delay=function(t,e){var i=new egret.Timer(e,1);i.addEventListener(egret.TimerEvent.TIMER,function(e){t()},this),i.start()},t.takeOverConsole=function(e){var i=window.console;if(i)for(var n=["log","warn","error"],a=0;a<n.length;a++)t.intercept(n[a],e)},t.intercept=function(t,e){var i=console[t];console[t]=function(){try{var n=Array.prototype.slice.apply(arguments).join(" ");"log"===t?e.info(n):"warn"==t?e.warn(n):e.error(n),i.apply?i.apply(console,arguments):i(n)}catch(a){}}},t.require=function(e){return Q.Promise(function(i,n,a){for(var o,r=/(.js)$/i,s=/(.css)$/i,h=0;h<t.loadedFiles.length;h++)if(t.loadedFiles[h]==e)return void i("");if(r.test(e)){var c=new egret.Timer(6e4,1);c.addEventListener(egret.TimerEvent.TIMER,function(t){var i="load file timeout "+e;console.error(i),n(i)},this),c.start(),o=document.createElement("script"),o.src=e,o.onreadystatechange=function(){("loaded"===o.readyState||"complete"===o.readyState)&&(c.stop(),o.onreadystatechange=null,t.loadedFiles.push(e),i(""))},o.onload=function(){c.stop(),t.loadedFiles.push(e),i("")},document.head.appendChild(o)}else if(s.test(e))o=document.createElement("link"),o.rel="stylesheet",o.type="text/css",o.href=e,document.head.appendChild(o),t.loadedFiles.push(e),i("");else{var l="unknown file type to load "+e;console.error(l),n(l)}})},t.loadedFiles=[],t.units=["k","m","b","t","a","A","c","C","d","D","e","E","f","F","g","G","h","H","i","!","j","J","l","L","n","N","o","O","p","P","q","Q","r","R","s","S","u","U","v","V","w","W","x","X","y","Y","z","Z","aa","AA","cc","CC","dd","DD","ee","EE","ff","FF","gg","GG","hh","HH","ii","!!","jj","JJ","ll","LL","nn","NN","oo","OO","pp","PP","qq","QQ","rr","RR","ss","SS","uu","UU","vv","VV","ww","WW","xx","XX","yy","YY","zz","ZZ"],t}();egret.registerClass(Utility,"Utility");var ChannelEgret=function(t){function e(e){t.call(this,e),esa.EgretSA.init({gameId:"536E77465847413D",chanId:egret.getOption("egret.runtime.spid"),debug:!1})}__extends(e,t);var i=(__define,e),n=i.prototype;return n.login=function(){var t=this;return nest.easyuser.startup({egretAppId:90359,version:2,debug:!0},function(e){if(0==e.result){var i=nest.easyuser.getLoginTypes();if(i.length>0){var n=new LoginUI(i,function(e){nest.easyuser.login(e,function(e){0==e.result?t.rest("egret","login",{token:e.token}).then(function(e){t.resolve(e)},function(e){t.reject("登录失败")}):t.reject("登录失败")})});application.showUI(n)}else nest.easyuser.login({},function(e){0==e.result?t.rest("egret","login",{token:e.token}).then(function(e){t.resolve(e)},function(e){t.reject("登录失败")}):t.reject("登录失败")})}else t.reject("初始化失败")}),t.promise()},n.pay=function(t){var e=this,i={goodsId:t.goodsId,goodsNumber:t.goodsNumber,serverId:"1",ext:t.orderId};return nest.iap.pay(i,function(t){0==t.result?e.resolve(t):-1==t.result?e.reject("用户取消了支付"):e.reject("支付失败")}),e.promise()},n.share=function(t){var e=this;return nest.share.isSupport({},function(i){1==i.share?nest.share.share(t,function(t){0==t.result?e.resolve(""):-1==t.result?e.reject("取消了分享"):e.reject("分享失败")}):e.reject("当前平台不支持分享")}),e.promise()},n.attention=function(t){var e=this;return nest.app.isSupport({},function(t){1==t.attention?nest.app.attention({},function(t){0==t.result?e.resolve():-1==t.result?e.reject("取消了关注"):e.reject("关注失败")}):e.reject("当前平台不支持关注")}),e.promise()},n.track=function(e,i,n,a){switch(t.prototype.track.call(this,e,i,n,a),e){case TRACK_CATEGORY_PLAYER:return void(i==TRACK_ACTION_ENTER?esa.EgretSA.player.init({egretId:application.me.attrs.uid,level:1,serverId:1,playerName:application.me.attrs.name}):esa.EgretSA.onLeave());case TRACK_CATEGORY_DIAMOND:return void(i==TRACK_ACTION_INC?esa.EgretSA.onDiamondReward(a,n):esa.EgretSA.onDiamondUse(n,1,a));case TRACK_CATEGORY_GOLD:return void(i==TRACK_ACTION_INC?esa.EgretSA.onGoldOutput(a,n):esa.EgretSA.onGoldUse(n,1,a));case TRACK_CATEGORY_ACTIVITY:return void esa.EgretSA.onJoinActivity(n);case TRACK_CATEGORY_GUIDE:return void esa.EgretSA.newUsersGuideSet(a,n);case TRACK_CATEGORY_RESOURCE:return void esa.EgretSA.loadingSet(a,n)}},e}(Channel);egret.registerClass(ChannelEgret,"ChannelEgret"),window.onShareTimeline=function(){console.log("onShareTimeline"),application.channel.resolve()};var Channel1758=function(t){function e(e){t.call(this,e),this.url="http://wx.1758.com/static/common/js/hlmy1758.js"}__extends(e,t);var i=(__define,e),n=i.prototype;return n.share=function(t){var e=this;return e.require(e.url).then(function(){hlmy.setShareInfo({state:"",tipInfo:!0,reward:["100钻石"]})}),e.promise()},e}(ChannelEgret);egret.registerClass(Channel1758,"Channel1758");var Channel51H5=function(t){function e(e){t.call(this,e),this.appId="fg40249b"}__extends(e,t);var i=(__define,e),n=i.prototype;return n.loginQuietly=function(){var t=this;return egret.getOption("code")?(t.rest("51h5","login",{token:egret.getOption("code")}).then(function(e){t.resolve(e)},function(e){t.reject("登录失败")}),t.promise()):t.rejectedPromise()},n.login=function(){var t=this;return location.href="http://web.51h5.com/sso.html?appid="+this.appId+"&redirect="+encodeURIComponent(application.baseUrl+"/headline/bin-release/web/bin-release/index.html?wysj_channel=51h5"),t.promise()},n.pay=function(t){var e=this;return t.customerId=application.me.attrs.id,e.rest("51h5","51h5_pay_url",t).then(function(t){location.href=t},function(t){e.reject("支付失败")}),e.promise()},e}(Channel);egret.registerClass(Channel51H5,"Channel51H5"),window.huhuh5_loginCallBcak=function(t,e,i,n,a){var o={token:a,userId:t,userName:e,userImage:i,userPosition:n};console.log("huhuh5_loginCallBcak"+JSON.stringify(o));var r=application.channel;r.rest("huhuh5","login",o).then(function(t){r.resolve(t)},function(t){console.error("huhuh5_loginCallBcak login failed "),r.reject("登录失败")})},window.huhuh5_shareCallBcak=function(){application.channel.resolve()},window.huhuh5_payCallBcak=function(t,e){console.log("huhuh5_payCallBcak"+t+" "+e);var i=application.channel;"SUCCESS"==e?i.resolve():"CANCEL"==e?i.reject("取消了支付"):i.reject("支付失败")};var ChannelHuHuH5=function(t){function e(e){t.call(this,e),this.url="http://server.huhuh5.com:8081/3HGame/jsFile/h5Game.js"}__extends(e,t);var i=(__define,e),n=i.prototype;return n.login=function(){var t=this;return t.require(t.url).then(function(){h5Game.login("huhuh5_loginCallBcak")}),t.promise()},n.pay=function(t){var e=this,i={goodsId:t.goodsId,goodsName:t.goodsName,goodsNum:t.goodsNumber,money:t.money,orderId:t.orderId};return h5Game.pay(i,"huhuh5_payCallBcak"),e.promise()},n.share=function(t){var e=this;return h5Game.share("huhuh5_shareCallBcak"),e.promise()},n.track=function(e,i,n,a){switch(t.prototype.track.call(this,e,i,n,a),e){case TRACK_CATEGORY_PLAYER:return void(i==TRACK_ACTION_ENTER?h5Game.gameStart():h5Game.setGameStatus());case TRACK_CATEGORY_DIAMOND:return;case TRACK_CATEGORY_GOLD:return;case TRACK_CATEGORY_ACTIVITY:return;case TRACK_CATEGORY_GUIDE:return;case TRACK_CATEGORY_RESOURCE:return}},e}(Channel);egret.registerClass(ChannelHuHuH5,"ChannelHuHuH5");var AssetAdapter=function(){function t(){}var e=(__define,t),i=e.prototype;return i.getAsset=function(t,e,i){function n(n){e.call(i,n,t)}if(RES.hasRes(t)){var a=RES.getRes(t);a?n(a):RES.getResAsync(t,n,this)}else RES.getResByUrl(t,n,this,RES.ResourceItem.TYPE_IMAGE)},t}();egret.registerClass(AssetAdapter,"AssetAdapter",["eui.IAssetAdapter"]);var ThemeAdapter=function(){function t(){}var e=(__define,t),i=e.prototype;return i.getTheme=function(t,e,i,n){function a(t){e.call(n,t)}function o(e){e.resItem.url==t&&(RES.removeEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,o,null),i.call(n))}RES.addEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,o,null),RES.getResByUrl(t,a,this,RES.ResourceItem.TYPE_TEXT)},t}();egret.registerClass(ThemeAdapter,"ThemeAdapter",["eui.IThemeAdapter"]);var Audit=function(){function t(){}var e=(__define,t);e.prototype;return t.claim=function(t){return t.claimed=1,application.dao.save("Audit",t)},t.hasRewards=function(t){for(var e=0;e<t.length;e++)if(t[e].rewards>0&&0==t[e].claimed)return!0;return!1},t.check=function(t){return Q.Promise(function(e,i,n){application.dao.fetch("Audit",{customer_id:t.attrs.id,category:"users",operator:"login",rewards:{$ne:0}},{order:"create_time DESC",limit:7}).then(function(t){var i=[];if(t.length>0){i.push(t[0]);for(var n=1;n<t.length&&t[n].rewards<t[n-1].rewards;n++)i.push(t[n])}e(i)},function(t){i(t)})})},t}();egret.registerClass(Audit,"Audit");var Bid=function(){function t(){this.attrs=null}var e=(__define,t),i=e.prototype;return t.day=function(){var t=new Date;return t.getHours()>=12&&(t=new Date(t.getTime()+864e5)),t.getFullYear()+"/"+(t.getMonth()+1)+"/"+t.getDate()},i.refresh=function(e){var i=this;return Q.Promise(function(n,a,o){application.dao.fetch("Bid",{succeed:0,day:t.day(),customer_id:e.attrs.id},{limit:1}).then(function(t){t.length>0?i.attrs=t[0]:i.attrs=null,n(i)},function(t){a(t)})})},t.earn=function(t){application.dao.fetch("Bid",{customer_id:t.attrs.id,succeed:{$gte:1},claimed:0},{}).then(function(e){if(e.length>0){for(var i=0;i<e.length;i++)t.attrs.gold-=e[i].gold,e[i].claimed=1,application.dao.save("Bid",e[i]);t.saveNow()}})},t}();egret.registerClass(Bid,"Bid");var Customer=function(){function t(t){this.saveSeconds=0,this.attrs=t,this.attrs.earned_gold||(this.attrs.earned_gold=0),this.vip=Vip.create(this.attrs.charge),this.bid=new Bid,this.checkTicket()}var e=(__define,t),i=e.prototype;return i.resetTicket=function(t){if(this.attrs.vip=t,0==t||2==t)this.attrs.ticket="";else{var e=new Date;e=new Date(e.getTime()+2592e6),this.attrs.ticket=e.toString()}this.saveNow()},i.checkTicket=function(){if(1==this.attrs.vip)if(this.attrs.ticket&&this.attrs.ticket.length>1){var t=new Date(this.attrs.ticket),e=new Date;t.getTime()<e.getTime()&&this.resetTicket(0)}else this.resetTicket(1)},i.save=function(){var t=(new Date).getTime()/1e3;t-this.saveSeconds>=120?this.saveNow():application.dao.dispatchEventWith("Customer",!0,this.attrs)},i.saveNow=function(){var t=this;t.saveSeconds=(new Date).getTime()/1e3;var e=t.attrs.charge;t.attrs.version=application.version,t.attrs.gold=Math.max(0,t.attrs.gold),t.attrs.earned_gold=Math.max(0,t.attrs.earned_gold),t.attrs.accumulated_gold=Math.max(t.attrs.accumulated_gold,t.attrs.gold),t.attrs.diamond=Math.max(0,t.attrs.diamond),t.attrs.metal=0+new Number(t.attrs.metal).toFixed(3),application.dao.save("Customer",t.attrs).then(function(i){i.charge!=e&&(t.vip=Vip.create(i.charge))})},i.earnOfflineGold=function(){this.attrs.offline_gold>0&&(this.earnGold(this.attrs.offline_gold),this.saveNow())},i.earnGold=function(t){this.attrs.earned_gold+=t;var e=this.attrs.gold;this.attrs.gold+=this.attrs.earned_gold,e!=this.attrs.gold&&(this.attrs.accumulated_gold+=this.attrs.earned_gold,this.attrs.earned_gold=0),this.save()},i.useGold=function(t){this.attrs.earned_gold>t?this.attrs.earned_gold-=t:(this.attrs.gold=this.attrs.gold+this.attrs.earned_gold-t,this.attrs.earned_gold=0),this.saveNow()},i.usableGold=function(){return this.bid.attrs?Math.max(0,this.attrs.gold+this.attrs.earned_gold-this.bid.attrs.gold):Math.max(0,this.attrs.gold+this.attrs.earned_gold)},i.buyOutput=function(t,e,i){t=Math.abs(t),e=Math.abs(e),i=Math.abs(i),this.attrs.diamond-=e,this.attrs.output+=i,this.useGold(t),this.attrs.output>=100&&Utility.log10(this.attrs.output)>Utility.log10(this.attrs.output-i)&&application.dao.fetch("Gift",{customer_id:this.attrs.id,category:7},{limit:1}).then(function(t){if(t.length>0){var e=t[0];e.locked=0,application.dao.save("Gift",e)}})},t.avatarUrl=function(t){if(t.avatar&&t.avatar.length>1)return t.avatar;var e=application.baseUrl+"headline/resource/art/";return 1==t.sex?e+"headM.png":2==t.sex?e+"headF.png":e+"head.png"},t}();egret.registerClass(Customer,"Customer");var GiftCategory;!function(t){t[t.Login=1]="Login",t[t.Online=2]="Online",t[t.Bid=3]="Bid",t[t.Ticket=4]="Ticket",t[t.Share=5]="Share",t[t.Charge=6]="Charge",t[t.Output=7]="Output",t[t.Attention=8]="Attention"}(GiftCategory||(GiftCategory={}));var Gift=function(){function t(){}var e=(__define,t);e.prototype;return t.notify=function(){application.dao.dispatchEventWith("Gift",!0,null)},t.hasGift=function(t){for(var e=0;e<t.length;e++)if(0==t[e].locked)return!0;return!1},t.check=function(t){return Q.Promise(function(e,i,n){application.dao.fetch("Gift",{customer_id:t.attrs.id},{order:"category ASC"}).then(function(n){if(n.length>0){for(var a=864e5,o=new Date,r=o.getDate(),s=0;s<n.length;s++){var h=n[s];if(0!=h.locked){if(h.last_pick_day)var c=new Date(h.last_pick_day).getDate();else{var l=new Date;l.setTime(o.getTime()-a);var c=l.getDate()}if(h.category!=GiftCategory.Charge&&h.category!=GiftCategory.Attention&&r!=c)if(h.category==GiftCategory.Online){var d=new Date(t.attrs.last_login),u=Math.floor((o.getTime()-d.getTime())/1e3);u>=3600?h.locked=0:(h.data=(3600-u).toString(),h.locked=1)}else if(h.category==GiftCategory.Ticket)t.checkTicket(),t.attrs.vip>0?h.locked=0:h.locked=1;else if(h.category==GiftCategory.Output){var p=+h.data,g=Utility.log10(p),m=Utility.log10(t.attrs.output);m>=g&&(h.locked=0)}else h.locked=1}}e(n)}else i("没有礼物")},function(t){i(t)})})},t}();egret.registerClass(Gift,"Gift");var Order=function(){function t(){}var e=(__define,t);e.prototype;return t.buy=function(e,i,n,a,o){var r=0==e.attrs.charge,s={customer_id:e.attrs.id,product:i,price:o,state:0};application.dao.save("Order",s).then(function(i){e.saveNow(),application.channel.pay({goodsId:n,goodsName:a,goodsNumber:"1",money:o,orderId:i.id}).then(function(t){},function(t){Toast.launch(t)}),t.checkOrderPayed(e,i,20,r)},function(t){Toast.launch("保存订单失败，请稍后再试")})},t.checkOrderPayed=function(e,i,n,a){Utility.delay(function(){application.dao.fetch("Order",{id:i.id,state:1},{}).then(function(o){if(o.length>0){var r=o[0];if("Diamond"==r.product){var s=400;5==r.price?s=1200:10==r.price?s=2600:30==r.price?s=9e3:100==r.price?s=36e3:500==r.price&&(s=2e5),e.attrs.diamond+=s,e.saveNow(),a?(Toast.launch("购买了"+s.toString()+"钻石,并获得了1500钻，1000k金币和1个奖章的首充礼物"),Gift.notify()):Toast.launch("购买了"+s.toString()+"钻石")}else application.dao.fetch("Order",{customer_id:e.attrs.id,product:"Ticket",state:1},{}).then(function(t){if("Ticket"==r.product){if(t.length>=2)var i=0;else var i=1;e.attrs.diamond+=2e3,e.attrs.metal+=i,e.resetTicket(1),a?(Toast.launch("购买了月票,并获得了1500钻，1000k金币和1个奖章的首充礼物"),Gift.notify()):Toast.launch("购买了月票")}else{if(t.length>=1)var i=2;else var i=3;e.attrs.diamond+=5e3,e.attrs.metal+=i,e.resetTicket(2),a?(Toast.launch("购买了VIP,并获得了1500钻，1000k金币和1个奖章的首充礼物"),Gift.notify()):Toast.launch("购买了VIP")}})}else n-=1,n>0?t.checkOrderPayed(e,i,n,a):Toast.launch("支付超时，请稍后再试")})},1e3)},t.charge=function(e,i,n){var a="200钻石";"diamond600"==i?a="600钻石":"diamond1300"==i?a="1300钻石":"diamond4500"==i?a="4500钻石":"diamond18000"==i?a="18000钻石":"diamond100000"==i&&(a="100000钻石"),t.buy(e,"Diamond",i,a,n)},t.buyTicket=function(e){t.buy(e,"Ticket","ticket","月票",19)},t.buyVIP=function(e){t.buy(e,"VIP","vip","终生VIP",49)},t}();egret.registerClass(Order,"Order");var Project=function(){function t(t,e){this._priceLevelOne=t,this._outputLevelOne=e,this._levelRatios=new Array,this._achieves=new Array}var e=(__define,t),i=e.prototype;return i.addLevelRatio=function(t,e,i,n){var a=1,o=1;if(this._levelRatios.length>0){var r=this._levelRatios[this._levelRatios.length-1],s=r.upperLevel-r.lowerLevel+1;a=r.outputRatioBase*Math.pow(r.outputRatio,s),o=r.priceRatioBase*Math.pow(r.priceRatio,s)}this._levelRatios.push({lowerLevel:t,upperLevel:e,priceRatioBase:o,outputRatioBase:a,priceRatio:i,outputRatio:n})},i.addAchieve=function(t,e,i,n){this._achieves.push({level:t,outputRatio:e,priceUseGold:n,priceUseDiamond:i})},t.createAll=function(){for(var e=new Array,i=[[1,1,2,1e3],[10,5,2,1e3],[300,25,2,1e3],[6e3,160,2,1e3],[3e5,3200,2,1e3],[45e6,64e3,4,1e3],[675e7,32e4,4,1e3],[135e10,64e5,4,1e3],[27e13,32e6,4,1e3],[54e15,64e7,4,1e3],[108e17,32e8,8,1e4],[2.16e21,64e9,8,1e4],[4.32e23,32e10,8,1e4],[8.64e25,64e11,8,1e4],[1.73e28,32e12,8,1e4],[3.46e30,64e13,16,1e4],[6.91e32,32e14,16,1e4],[1.38e35,64e15,16,1e4],[2.76e37,128e15,16,1e4],[5.53e39,256e15,16,1e4]],n=[[119,1190,157e3,603e4,1e10,1e17,5e25,8e50,4e64,1e200],[1190,11900,157e4,603e5,5e13,1e19,2.5e27,8e52,6e66,1e200],[35800,358e3,471e5,181e7,4e14,2e20,1.25e29,4e54,9e68,1e200],[716e3,716e4,941e6,362e8,2e15,1e21,6.25e30,4e55,1.35e71,1e200],[358e5,358e6,471e8,181e10,4e16,5e21,3.13e32,4e56,2.03e73,1e200],[537e7,537e8,706e10,271e12,16e17,2.5e23,6.25e34,4e57,3.04e75,1e200],[805e9,805e10,106e13,407e14,16e18,5e25,1.25e37,4e58,4.56e77,1e200],[161e12,161e13,212e15,814e16,1.6e21,1e28,2.5e39,4e59,6.83e79,1e200],[322e14,322e15,423e17,1.63e21,8e22,2e30,5e41,4e60,1.37e82,1e200],[644e16,644e17,8.47e21,3.26e23,1.6e25,4e32,1e44,4e61,2.73e84,1e200],[1.29e21,1.29e22,1.69e24,6.51e25,3.2e27,8e34,2e46,4e62,5.47e86,1e200],[2.58e23,2.58e24,3.39e26,1.3e28,6.4e29,1.6e37,4e48,4e63,1.09e89,1e200],[5.15e25,5.15e26,6.78e28,2.6e30,1.28e32,3.2e39,8e50,4e64,2.19e91,1e200],[1.03e28,1.03e29,1.36e31,5.21e32,2.56e34,6.4e41,1.6e53,4e65,4.37e93,1e200],[2.06e30,2.06e31,2.71e33,1.04e35,5.12e36,1.28e44,3.2e55,4e66,8.75e95,1e200],[4.12e32,4.12e33,5.42e35,2.08e37,1.02e39,2.56e46,6.4e57,8e68,1.75e98,1e200],[8.24e34,8.24e35,1.08e38,4.17e39,2.05e41,5.12e48,1.28e60,1.6e72,3.5e100,1e200],[1.65e37,1.65e38,2.17e40,8.33e41,4.1e43,1.02e51,2.56e62,3.2e75,7e102,1e200],[3.3e39,3.3e40,4.34e42,1.67e44,8.19e45,2.05e53,5.12e64,6.4e78,1.4e105,1e200],[6.6e41,6.6e42,8.67e44,3.33e46,1.64e48,4.1e55,1.02e67,1.28e82,2.8e107,1e200]],a=0;a<i.length;a++){var o=new t(i[a][0],i[a][1]);t.addProjectLevelRatio(o,a+1),t.addProjectAchieves(o,i[a][2],i[a][3],n[a]),e.push(o)}return e},t.addProjectLevelRatio=function(t,e){for(var i=[[[2,99],[1,20,1.05,1]],[[100,199],[1,20,1.05,1]],[[200,299],[1,20,1.03,1]],[[300,399],[1,20,1.03,1]],[[400,499],[1,20,1.03,1]],[[500,599],[1,20,1.05,1.01]],[[600,699],[1,20,1.03,1.01]],[[700,799],[1,17,1.02,1.01],[18,18,1.04,1.01],[19,20,1.05,1.01]],[[800,899],[1,17,1.02,1.01],[18,18,1.04,1.01],[19,20,1.05,1.01]],[[900,999],[1,17,1.02,1.01],[18,18,1.04,1.01],[19,20,1.05,1.01]],[[1e3,1199],[1,20,1.03,1.005]],[[1200,1399],[1,17,1.02,1.005],[18,20,1.03,1.005]],[[1400,1599],[1,17,1.02,1.005],[18,20,1.03,1.005]],[[1600,1799],[1,17,1.02,1.005],[18,20,1.03,1.005]],[[1800,1999],[1,17,1.02,1.005],[18,20,1.03,1.005]],[[2e3,2499],[1,17,1.01,1.005],[10,20,1.03,1.005]],[[2500,2999],[1,17,1.02,1.005],[18,18,1.04,1.005],[19,20,1.05,1.005]],[[3e3,3499],[1,17,1.01,1.005],[18,20,1.03,1.005]],[[3500,3999],[1,17,1.01,1.005],[18,20,1.03,1.005]],[[4e3,4499],[1,13,1.01,1.005],[14,15,1.02,1.005],[16,20,1.03,1.005]],[[4500,4999],[1,13,1.01,1.005],[14,20,1.03,1.005]],[[5e3,5999],[1,17,1.01,1.005],[18,20,1.03,1.005]],[[6e3,6999],[1,16,1.01,1.005],[17,20,1.03,1.005]],[[7e3,7999],[1,15,1.02,1.005],[16,20,1.03,1.005]],[[8e3,8999],[1,17,1.03,1.003],[18,18,1.04,1.003],[19,20,1.05,1.003]],[[9e3,9999],[1,17,1.03,1.003],[18,18,1.04,1.003],[19,20,1.05,1.003]],[[1e4,99999],[1,20,1.01,1.002]]],n=0;n<i.length;n++)for(var a=i[n],o=1;o<a.length;o++)if(a[o][0]<=e&&a[o][1]>=e){t.addLevelRatio(a[0][0],a[0][1],a[o][2],a[o][3]);break}},t.addProjectAchieves=function(t,e,i,n){t.addAchieve(50,e,100,n[0]),t.addAchieve(100,2*e,100,n[1]),t.addAchieve(200,4*e,100,n[2]),t.addAchieve(300,8*e,100,n[3]),t.addAchieve(500,i,1e3,n[4]),t.addAchieve(1e3,i,2e3,n[5]),t.addAchieve(2e3,i,3e3,n[6]),t.addAchieve(5e3,1e4,4e3,n[7]),t.addAchieve(1e4,1e6,5e3,n[8]),t.addAchieve(1e5,1e10,1e4,n[8])},i.output=function(t,e,i){for(var n=1,a=1,o=1;o<=this._levelRatios.length;o++){var r=this._levelRatios[o-1];if(t>=r.lowerLevel&&t<=r.upperLevel){n=r.outputRatioBase*Math.pow(r.outputRatio,t-a);break}a=r.upperLevel}for(var s=1,o=1;o<=this._achieves.length&&e>=o;o++)s*=this._achieves[o-1].outputRatio;return Math.round(t*this._outputLevelOne*n*s*i)},i.priceOf=function(t){for(var e=1,i=1,n=1;n<=this._levelRatios.length;n++){var a=this._levelRatios[n-1];if(t>=a.lowerLevel&&t<=a.upperLevel){e=a.priceRatioBase*Math.pow(a.priceRatio,t-i);break}i=a.upperLevel}return Math.round(this._priceLevelOne*e)},i.price=function(t,e){for(var i=0,n=t;t+e>n;n++)i+=this.priceOf(n);return i},i.achieve=function(t){return this._achieves[t-1]},t}();egret.registerClass(Project,"Project");var Vip=function(){function t(t,e,i,n,a,o,r){this._level=0,this._charge=0,this._output=0,this._hit=10,this._time=0,this._upgrade=0,this._patch=0,this._level=t,this._charge=e,this._output=i,this._hit=n,this._time=a,this._upgrade=o,this._patch=r}var e=(__define,t),i=e.prototype;return t.create=function(e){for(var i=[[0,0,0,10,0,0,0],[1,2,.2,10,0,0,0],[2,10,.5,10,0,0,0],[3,20,1,15,0,0,.03],[4,30,2,20,0,0,.05],[5,50,5,25,.5,0,.1],[6,100,10,30,.7,.9,.12],[7,200,50,35,1,.99,.15],[8,300,100,40,1.2,.999,.17],[9,500,500,45,1.5,.9999,.2],[10,800,800,50,1.7,.99999,.23],[11,1e3,1e3,55,2,.999999,.25],[12,2e3,5e3,60,2.2,.9999999,.3],[13,5e3,5e4,65,2.5,.99999999,.4],[14,1e4,1e6,70,3,.999999999,.5],[15,15e3,1e7,75,3.5,.9999999999,.65]],n=null,a=0;a<i.length&&e>=i[a][1];a++)n=i[a];return new t(n[0],n[1],n[2],n[3],n[4],n[5],n[6])},i.getOutput=function(t){return t*(1+this._output)},i.getHit=function(t){return t*this._hit},i.getHitRatio=function(){return this._hit},i.getTime=function(t){return t*(1+this._time)},i.getUpgrade=function(t){return t*(1-this._upgrade)},i.getLevel=function(){return this._level},t}();egret.registerClass(Vip,"Vip");
var AbstractUI=function(t){function e(e){t.call(this),this.addEventListener(eui.UIEvent.COMPLETE,this._uiCompHandler,this),this.skinName="resource/custom_skins/"+e+".exml"}__extends(e,t);var i=(__define,e),n=i.prototype;return n._uiCompHandler=function(){var t=this;Utility.delay(function(){try{t.onRefresh()}catch(e){console.error("_uiCompHandler onRefresh failed "+e.message)}},10)},n.refresh=function(){try{this.onRefreshAgain()}catch(t){console.error("refresh onRefresh failed "+t.message)}},n.onRefresh=function(){},n.onRefreshAgain=function(){this.onRefresh()},n.show=function(t,e){e?(this.hide(),application.showUI(t)):application.showUI(t,this)},n.hide=function(){application.hideUI(this)},e}(eui.Component);egret.registerClass(AbstractUI,"AbstractUI");var AuctionUI=function(t){function e(){t.call(this,"auctionUISkin"),this.imgBack.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){application.gotoHome()},this),application.dao.addEventListener("Customer",function(t){this.lblGold.text=Utility.format(application.me.usableGold()),this.lblDiamond.text=Utility.format(application.me.attrs.diamond)},this),this.imgBid.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onBid,this),this.grpTrack.touchEnabled=!0,this.grpTrack.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onBeginChangeBid,this),this.grpTrack.addEventListener(egret.TouchEvent.TOUCH_MOVE,this.onChangeBid,this),this.btnAddGold.addEventListener(egret.TouchEvent.TOUCH_BEGIN,function(){application.showUI(new BuyToolUI("time",500))},this),this.btnAddDiamond.addEventListener(egret.TouchEvent.TOUCH_BEGIN,function(){application.showUI(new ChargeTipUI)},this),this.btnHelp.addEventListener(egret.TouchEvent.TOUCH_BEGIN,function(){HelpUI.showAuctionHelp()},this)}__extends(e,t);var i=(__define,e),n=i.prototype;return n.onRefresh=function(){this.lblGold.text=Utility.format(application.me.usableGold()),this.lblDiamond.text=Utility.format(application.me.attrs.diamond);var t=Bid.day();this.renderLastBid(t),this.renderMaxBid(t),this.grpTrack.x=this.imgThumb.x,this.lblTrack.text="0%",this.imgFront.x=this.imgThumb.x,this.imgFront.y=this.imgThumb.y,this.imgFront.width=0,this.addGold=0,this.bid={gold:0,day:t,customer_id:application.me.attrs.id,claimed:0},this.renderBid(0)},n.renderLastBid=function(t){var e=this;application.dao.fetch("Bid",{succeed:0,day:t,customer_id:application.me.attrs.id},{limit:1}).then(function(t){t.length>0&&(e.bid=t[0],application.me.bid.attrs=e.bid,e.renderBid(e.addGold))})},n.renderMaxBid=function(t){var e=this;application.dao.fetch("MaxBid",{day:t},{limit:1}).then(function(t){t.length>0?(e.lblMaxBid.text=Utility.format(t[0].gold),e.lblMaxBidName.text=t[0].name,e.imgMaxBidAvatar.source=t[0].avatar):(e.lblMaxBid.text="0",e.lblMaxBidName.text="",e.imgMaxBidAvatar.source="")})},n.renderBid=function(t){this.addGold=Math.floor(t),this.lblCurrentBid.text=Utility.format(this.addGold),this.lblLastBid.text=Utility.format(this.addGold+this.bid.gold)},n.onBid=function(){var t=this;t.bid.day==Bid.day()?(t.bid.gold+=t.addGold,t.bid.gold>0?application.dao.fetch("Blacklist",{customer_id:application.me.attrs.id},{limit:1}).then(function(e){1==e.length?Toast.launch("对不起，您由于下列原因被封号："+e[0].reason+"。"):(t.bid.claimed=0,application.dao.save("Bid",t.bid),Gift.notify(),application.channel.track(TRACK_CATEGORY_ACTIVITY,TRACK_ACTION_JOIN,"投标"),Toast.launch("投标成功"),application.me.bid.attrs=t.bid,application.guideUI&&application.guideUI.next(),t.back())}):Toast.launch("投标的金币数量不能是0")):(Toast.launch("今天投标已经结束"),application.me.bid.attrs=null,t.refresh())},n.back=function(){application.gotoHome()},n.onBeginChangeBid=function(t){this.startX=t.stageX},n.onChangeBid=function(t){var e=t.stageX-this.startX;this.startX=t.stageX;var i=Math.max(this.imgThumb.x,this.grpTrack.x+e);i=Math.min(this.imgThumb.width+this.imgThumb.x-this.grpTrack.width,i),this.grpTrack.x=i;var n=Math.round(100*(this.grpTrack.x-this.imgThumb.x)/(this.imgThumb.width-this.grpTrack.width));this.lblTrack.text=n.toString()+"%",this.renderBid(Math.max(0,application.me.attrs.gold-this.bid.gold)*n/100),this.imgFront.width=this.grpTrack.x-this.imgThumb.x+20,this.nextStep()},n.nextStep=function(){application.guideUI&&this.bid.gold+this.addGold>0&&application.guideUI.next()},e}(AbstractUI);egret.registerClass(AuctionUI,"AuctionUI");var BlockUI=function(t){function e(){t.call(this,"blockUISkin")}__extends(e,t);var i=(__define,e);i.prototype;return e}(AbstractUI);egret.registerClass(BlockUI,"BlockUI");var BuyAchieveUI=function(t){function e(e,i,n){t.call(this),this._myProject=e,this._project=i,this._achieve=n,this.addEventListener(eui.UIEvent.COMPLETE,this.uiCompHandler,this),this.skinName="resource/custom_skins/buyAchieveUISkin.exml",this.imgIcon.source="b"+n.toString()+"_png",this.imgProject.source="t"+(e.sequence+1).toString()+"_png",this.lblRatio.text=Utility.format(i.achieve(n).outputRatio),this.lblLevel.text=i.achieve(n).level.toString(),this.lblGold.touchEnabled=!1,this.lblDiamond.touchEnabled=!1}__extends(e,t);var i=(__define,e),n=i.prototype;return n.uiCompHandler=function(){var t=this;if(this.imgBack.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){application.hideUI(t)},this),this._myProject.level<this._project.achieve(this._achieve).level||this._achieve>this._myProject.achieve+1||this._achieve<=this._myProject.achieve)this.imgBuyUseGold.source="",this.imgBuyUseDiamond.source="",this.lblGold.text="",this.lblDiamond.text="";else{var e=this._project.achieve(this._achieve).priceUseGold;this.lblGold.text=Utility.format(e);var i=this._project.achieve(this._achieve).priceUseDiamond;this.lblDiamond.text=i,application.me.usableGold()<e?(this.imgBuyUseGold.source="buttoncoinno_png",this.imgBuyUseGold.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){application.showUI(new BuyToolUI("time",500),t)},this)):this.imgBuyUseGold.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){t._buy(e,0)},this),application.me.attrs.diamond<i?(this.imgBuyUseDiamond.source="buttondiano_png",this.imgBuyUseDiamond.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){application.showUI(new ChargeTipUI,t)},this)):this.imgBuyUseDiamond.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){t._buy(0,i),application.channel.track(TRACK_CATEGORY_DIAMOND,TRACK_ACTION_DEC,"购买了成就",i)},this)}},n._buy=function(t,e){var i=application.me.vip.getOutput(this._project.output(this._myProject.level,this._achieve,this._myProject.tool_ratio)),n=application.me.vip.getOutput(this._project.output(this._myProject.level,this._myProject.achieve,this._myProject.tool_ratio));this._myProject.achieve=this._achieve,application.me.buyOutput(t,e,i-n),Toast.launch("获得成就成功"),application.dao.save("Project",this._myProject),application.hideUI(this)},e}(eui.Component);egret.registerClass(BuyAchieveUI,"BuyAchieveUI");var BuyToolUI=function(t){function e(e,i){t.call(this),this._name=e,this._price=i,this.addEventListener(eui.UIEvent.COMPLETE,this.uiCompHandler,this),this.skinName="resource/custom_skins/buyToolUISkin.exml",this.lblGold.touchEnabled=!1,this.lblPrice.touchEnabled=!1}__extends(e,t);var i=(__define,e),n=i.prototype;return n.uiCompHandler=function(){var t=this;this.imgBack.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){application.hideUI(t)},this),this.imgBuy.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){t.buy()},this),this.lblGold.text="","time"==this._name?(this.imgIcon.source="timeh_png",this.lblGold.text=Utility.format(3600*application.me.attrs.output*48)):"hit"==this._name?this.imgIcon.source="hith_png":"ticket"==this._name?this.imgIcon.source="ticketh_png":"vip"==this._name&&(this.imgIcon.source="VIPh_png"),"time"==this._name||"hit"==this._name?(application.me.attrs.diamond<this._price?this.imgBuy.source="buttondiano_png":this.imgBuy.source="buttondia_png",this.lblPrice.text=this._price.toString()):(this.imgBuy.source="topupbutton_png",this.lblPrice.text="")},n.buy=function(){"time"==this._name?this.buyTime():"hit"==this._name?this.buyHit():"ticket"==this._name?this.buyTicket():"vip"==this._name&&this.buyVIP()},n.buyTime=function(){application.me.attrs.diamond>this._price?(application.me.attrs.diamond-=this._price,application.me.earnGold(3600*application.me.attrs.output*48),application.me.saveNow(),application.channel.track(TRACK_CATEGORY_DIAMOND,TRACK_ACTION_DEC,"购买了时光沙漏",this._price),Toast.launch("购买了时光沙漏"),application.hideUI(this)):application.showUI(new ChargeTipUI)},n.buyHit=function(){0==application.me.attrs.total_hits?application.me.attrs.diamond>this._price?(application.me.attrs.diamond-=this._price,application.me.attrs.total_hits=3,application.me.saveNow(),application.channel.track(TRACK_CATEGORY_DIAMOND,TRACK_ACTION_DEC,"购买了暴击",this._price),Toast.launch("购买了暴击"),application.hideUI(this)):application.showUI(new ChargeTipUI):Toast.launch("你还有"+application.me.attrs.total_hits+"个暴击，请用完后再购买")},n.buyTicket=function(){2==application.me.attrs.vip?Toast.launch("你已经购买了VIP，终身免费，不需要购买月票"):(Order.buyTicket(application.me),application.hideUI(this))},n.buyVIP=function(){2==application.me.attrs.vip?Toast.launch("你已经购买了VIP，终身免费"):(Order.buyVIP(application.me),application.hideUI(this))},e}(eui.Component);egret.registerClass(BuyToolUI,"BuyToolUI");var ChargeTipUI=function(t){function e(){var e=this;t.call(this),this.skinName="resource/custom_skins/chargeTipUISkin.exml",this.imgBack.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){application.hideUI(e)},this),this.imgCharge1.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){Order.charge(application.me,"diamond",2)},this),this.imgCharge2.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){Order.charge(application.me,"diamond600",5)},this),this.imgCharge3.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){Order.charge(application.me,"diamond1300",10)},this),this.imgCharge4.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){Order.charge(application.me,"diamond4500",30)},this),this.imgCharge5.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){Order.charge(application.me,"diamond18000",100)},this),this.imgCharge6.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){Order.charge(application.me,"diamond100000",500)},this),this.imgCharge7.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){2==application.me.attrs.vip?Toast.launch("你已经购买了VIP，终身免费，不需要购买月票"):Order.buyTicket(application.me)},this),this.imgCharge8.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){2==application.me.attrs.vip?Toast.launch("你已经购买了VIP，终身免费"):Order.buyVIP(application.me)},this)}__extends(e,t);var i=(__define,e);i.prototype;return e}(eui.Component);egret.registerClass(ChargeTipUI,"ChargeTipUI");var FirstChargeBonusUI=function(t){function e(){var e=this;t.call(this),this.skinName="resource/custom_skins/firstChargeBonusUISkin.exml",this.btnCancel.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){application.hideUI(e)},this),this.btnCharge.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){application.hideUI(e),application.showUI(new ChargeTipUI)},this)}__extends(e,t);var i=(__define,e);i.prototype;return e}(eui.Component);egret.registerClass(FirstChargeBonusUI,"FirstChargeBonusUI");var GiftUI=function(t){function e(){t.call(this),this.addEventListener(eui.UIEvent.COMPLETE,this.uiCompHandler,this),this.skinName="resource/custom_skins/giftUISkin.exml",this.imgPicks=[this.imgPick1,this.imgPick2,this.imgPick3,this.imgPick4,this.imgPick5,this.imgPick6,this.imgPick7,this.imgPick8];for(var e=0;e<this.imgPicks.length;e++)this.imgPicks[e].visible=!1;this.imgRet.addEventListener(egret.TouchEvent.TOUCH_BEGIN,function(){application.hideUI(this)},this),this.imgPick1.addEventListener(egret.TouchEvent.TOUCH_BEGIN,function(t){this.pickGift(this.gift(GiftCategory.Login))},this),this.imgPick2.addEventListener(egret.TouchEvent.TOUCH_BEGIN,function(t){this.pickGift(this.gift(GiftCategory.Online))},this),this.imgPick3.addEventListener(egret.TouchEvent.TOUCH_BEGIN,function(t){this.pickBidGift()},this),this.imgPick4.addEventListener(egret.TouchEvent.TOUCH_BEGIN,function(t){this.pickTicketGift()},this),this.imgPick5.addEventListener(egret.TouchEvent.TOUCH_BEGIN,function(t){this.pickShareGift()},this),this.imgPick6.addEventListener(egret.TouchEvent.TOUCH_BEGIN,function(t){this.pickFirstChargeGift()},this),this.imgPick7.addEventListener(egret.TouchEvent.TOUCH_BEGIN,function(t){this.pickOutputGift()},this),this.imgPick8.addEventListener(egret.TouchEvent.TOUCH_BEGIN,function(t){this.pickAttentionGift()},this)}__extends(e,t);var i=(__define,e),n=i.prototype;return n.pickGift=function(t){0==t.locked&&(this.lockGift(t,2),this.updateCustomer(t))},n.pickBidGift=function(){var t=this.gift(GiftCategory.Bid);0==t.locked?this.pickGift(t):1==t.locked&&(application.hideUI(this),application.gotoAuction())},n.pickTicketGift=function(){var t=this.gift(GiftCategory.Ticket);0==t.locked?this.pickGift(t):1==t.locked&&(application.hideUI(this),application.gotoTool())},n.pickShareGift=function(){var t=this,e=t.gift(GiftCategory.Share);if(0==e.locked)t.pickGift(e);else if(1==e.locked){var i=application.baseUrl+"headline/bin-release/web/bin-release/index.html?platInfo=open_90359_9166&appId=90359&egret.runtime.spid=9166&appId=90359&channelId=9166&isNewApi=1&egretSdkDomain=http://api.egret-labs.org/v2&egretServerDomain=http://api.egret-labs.org/v2&egretRv=669",n=application.baseUrl+"headline/resource/art/home/icon.png",a={title:"我来上头条，女神任我挑！",description:"最炫最浪的舞蹈经营类游戏，无需下载，点开即送，多重豪礼等你来拿！",url:i,img_url:n,img_title:"头条关注"};application.channel.share(a).then(function(){t.lockGift(e,0)},function(t){Toast.launch(t)})}},n.pickFirstChargeGift=function(){var t=this.gift(GiftCategory.Charge);0==t.locked?this.pickGift(t):1==t.locked&&(application.hideUI(this),application.showUI(new FirstChargeBonusUI))},n.pickOutputGift=function(){var t=this.gift(GiftCategory.Output);if(0==t.locked){var e=10*t.data;t.data=e.toString(),Utility.log10(application.me.attrs.output)>=Utility.log10(e)?this.lockGift(t,0):this.lockGift(t,2),this.lblOutputGift.text=Utility.format(e),this.updateCustomer(t)}},n.pickAttentionGift=function(){var t=this,e=t.gift(GiftCategory.Attention);0==e.locked?t.pickGift(e):1==e.locked&&application.channel.attention({}).then(function(){t.lockGift(e,0)},function(t){Toast.launch(t)})},n.lockGift=function(t,e){t.locked=e,this.renderGift(t),2==e&&(t.last_pick_day=(new Date).toString()),application.dao.save("Gift",t)},n.refresh=function(){this.uiCompHandler()},n.uiCompHandler=function(){var t=this;Gift.check(application.me).then(function(e){t.gifts=e;for(var i=0;i<t.imgPicks.length;i++)t.imgPicks[i].visible=!0;t.renderGift(t.gift(GiftCategory.Login)),t.renderOnlineGift(),t.renderGift(t.gift(GiftCategory.Bid)),t.renderTicketGift(),t.renderGift(t.gift(GiftCategory.Share)),t.renderGift(t.gift(GiftCategory.Charge)),t.renderOutputGift(),t.renderGift(t.gift(GiftCategory.Attention))})},n.renderOnlineGift=function(){var t=this.gift(GiftCategory.Online);if(this.lblOnlineGiftTimeout.text="",1==t.locked){this.onlineGiftTimeout=parseInt(t.data);var e=new egret.Timer(1e3,this.onlineGiftTimeout);e.addEventListener(egret.TimerEvent.TIMER,function(t){this.lblOnlineGiftTimeout.text=Math.floor(this.onlineGiftTimeout/60).toString()+":"+Math.floor(this.onlineGiftTimeout%60).toString(),this.onlineGiftTimeout>0&&(this.onlineGiftTimeout-=1)},this),e.addEventListener(egret.TimerEvent.TIMER_COMPLETE,function(e){this.lockGift(t,0)},this),e.start()}this.renderGift(t)},n.renderTicketGift=function(){var t=this.gift(GiftCategory.Ticket);if(0==application.me.attrs.vip)this.lblTicketGiftTimeout.text="";else{var e=new Date;if(2==application.me.attrs.vip)this.lblTicketGiftTimeout.text="永久";else{var i=new Date(application.me.attrs.ticket),n=i.getTime()-e.getTime(),a=Math.min(30,Math.floor(n/864e5));0>=a?(this.lblTicketGiftTimeout.text="",application.me.resetTicket(0)):this.lblTicketGiftTimeout.text=a.toString()+"天"}}this.renderGift(t)},n.renderOutputGift=function(){var t=this.gift(GiftCategory.Output);this.lblOutputGift.text=Utility.format(t.data),this.renderGift(t)},n.gift=function(t){return this.gifts[t-1]},n.renderGift=function(t){var e=this.imgPicks[t.category-1];1==t.locked?t.category==GiftCategory.Share?e.source="share_png":t.category==GiftCategory.Attention?e.source="att_png":e.source="unpick_png":0==t.locked?e.source="pick_png":e.source="picked_png"},n.updateCustomer=function(t){var e="";t.diamond>0&&(e+="获得"+t.diamond.toString()+"钻石",application.channel.track(TRACK_CATEGORY_DIAMOND,TRACK_ACTION_INC,"礼物奖励",t.diamond)),t.gold>0&&(e+=e.length>0?"，":"获得",e+=t.gold.toString()+"金币"),t.metal>0&&(e+=e.length>0?"，":"获得",e+=t.metal.toString()+"奖章"),Toast.launch(e),application.me.attrs.metal+=t.metal,application.me.attrs.gold+=t.gold,application.me.attrs.diamond+=t.diamond,application.me.saveNow()},e}(eui.Component);egret.registerClass(GiftUI,"GiftUI");var GuideUI=function(t){function e(){var e=this;t.call(this),this.step=0,this.skinName="resource/custom_skins/guideUISkin.exml",this.imgBack.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){e.over()},this);var i=!0,n=0;this.timer=new egret.Timer(100,0),this.timer.addEventListener(egret.TimerEvent.TIMER,function(t){n%5==0&&(i=!i),n+=1,i?"guideconti_png"!=this.imgFinger.source?this.imgFinger.y-=1:this.imgFinger.x-=1:"guideconti_png"!=this.imgFinger.source?this.imgFinger.y+=1:this.imgFinger.x+=1},this),this.timer.start(),this.imgBonus.visible=!1}__extends(e,t);var i=(__define,e),n=i.prototype;return n.setOverCallback=function(t){this.overCallback=t},n.next=function(){switch(this.step){case 1:if(this.click++,5==this.click){this.step++;break}return;default:this.step++}switch(this.step){case 1:this.renderStep1();break;case 2:this.renderStep2();break;case 3:this.renderStep3();break;case 4:this.renderStep4();break;case 5:this.renderStep5();break;case 6:this.renderStep6();break;case 7:this.renderStep7();break;case 8:this.renderStep8()}},n.renderStep1=function(){this.click=0,this.imgSpeak.source="G1_png",this.imgFocus.source="highlight1_png",this.imgFinger.source="guidearr_png",this.renderBlock(121,77,288,350),this.imgFinger.x=354,this.imgFinger.y=281,this.imgFocus.x=78,this.imgFocus.y=315,this.imgSpeak.x=151,this.imgSpeak.y=607,this.imgBg.x=0,this.imgBg.y=523,this.touchEnabled=!1,this.imgFocus.touchEnabled=!1,this.imgBg.touchEnabled=!1},n.renderStep2=function(){this.imgSpeak.source="G2_png",this.imgFocus.source="highlight2_png",this.renderBlock(247,409,156,104),this.imgFinger.x=308,this.imgFinger.y=377,this.imgFocus.x=206,this.imgFocus.y=384,this.imgSpeak.x=140,this.imgSpeak.y=601},n.renderStep3=function(){this.imgSpeak.source="G3_png"},n.renderStep4=function(){this.renderBlock(95,709,143,91),this.imgSpeak.source="G4_png",this.imgFocus.source="highlight3_png",this.imgFinger.x=155,this.imgFinger.y=671,this.imgFocus.x=74,this.imgFocus.y=702,this.imgSpeak.x=139,this.imgSpeak.y=597,this.imgBg.x=0,this.imgBg.y=518},n.renderStep5=function(){this.renderBlock(0,300,480,173),this.imgSpeak.source="G5_png",this.imgFinger.x=44,this.imgFinger.y=300,this.imgFocus.x=-14,this.imgFocus.y=355,this.imgSpeak.x=138,this.imgSpeak.y=505,this.imgBg.x=0,this.imgBg.y=423},n.renderStep6=function(){this.renderBlock(0,540,480,191),this.imgSpeak.source="G6_png",this.imgFocus.source="highlight4_png",this.imgFinger.x=226,this.imgFinger.y=536,this.imgFocus.x=4,this.imgFocus.y=537,this.imgSpeak.x=138,this.imgSpeak.y=390,this.imgBg.x=0,this.imgBg.y=316},n.renderStep7=function(){this.imgSpeak.source="G7_png",this.imgFinger.source="guideconti_png",this.imgFocus.visible=!1,this.renderBlock(0,0,0,0),this.imgFinger.x=395,this.imgFinger.y=679,this.imgSpeak.x=138,this.imgSpeak.y=599,this.imgBg.x=0,this.imgBg.y=523,this.touchEnabled=!0,this.touchChildren=!0,this.imgFinger.addEventListener(egret.TouchEvent.TOUCH_BEGIN,function(){this.next()},this)},n.renderStep8=function(){this.imgSpeak.source="G8_png",this.imgFinger.visible=!1,this.imgBonus.visible=!0,this.renderBlock(0,0,0,0),this.imgBonus.x=376,this.imgBonus.y=653,this.imgBonus.addEventListener(egret.TouchEvent.TOUCH_BEGIN,function(){this.over()},this)},n.renderBlock=function(t,e,i,n){this.rcRight.x=t+i,this.rcRight.y=0,this.rcRight.height=800,this.rcRight.width=480-this.rcRight.x,this.rcTop.x=this.rcTop.y=0,this.rcTop.height=e,this.rcTop.width=this.rcRight.x,this.rcMiddle.x=0,this.rcMiddle.y=e,this.rcMiddle.width=t,this.rcMiddle.height=n,this.rcBottom.x=0,this.rcBottom.y=e+n,this.rcBottom.width=this.rcTop.width,this.rcBottom.height=this.rcRight.height-e-n},n.over=function(){application.hideUI(this),application.guideUI=null,application.me.attrs.metal+=1,application.me.attrs.diamond+=500,application.me.saveNow(),this.timer.stop(),this.overCallback&&this.overCallback()},e}(eui.Component);egret.registerClass(GuideUI,"GuideUI");var HelpUI=function(t){function e(e){var i=this;t.call(this),this.skinName="resource/custom_skins/helpUISkin.exml",this.lblContent.text=e,this.lblVersion.text=application.version,this.imgReport.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){application.hideUI(i),application.showUI(new ReportUI)},this),this.imgBack.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){application.hideUI(i)},this)}__extends(e,t);var i=(__define,e);i.prototype;return e.showAuctionHelp=function(){var t="1： 拍卖每天中午12点结束。\n";t+="2： 前10名将获得钻石和勋章奖励，其余玩家的拍卖金币自动返还。\n",t+="3： 拍卖期间，系统显示截至上个小时的最高出价，为新出价的玩家提供参考。\n",t+="4： 玩家在拍卖结束前可以反复加价，每次加价最高为当前拥有的所有金币。\n",t+="5： 每天首次参加拍卖可以在礼物页面中领取100钻石奖励。（每天12:00刷新）\n",t+="－－－－－拍卖奖励 －－－－－\n",t+="第1名 2000钻，1枚勋章\n",t+="第2名 1500钻，500勋章碎片\n",t+="第3名 1200钻，400勋章碎片\n",t+="第4名 1000钻，300勋章碎片\n",t+="第5-10名 1000钻，200勋章碎片\n",application.showUI(new e(t))},e.showMainHelp=function(){var t="玩法\n";t+="1. 点击中间舞者可产生金币，金币用来升级运营项目，而运营项目随等级提高从而产生更多的金币。\n",t+="2. 金币可以用来参加头条拍卖，每天最高出价者会成为头条，获得头条殊荣，勋章和钻石奖励。\n",t+="3. 道具可以帮助玩家快速获得大量金币和永久提高运营项目的每秒产量。\n",t+="4. 排行榜会按照勋章的个数排名，勋章数量一致时则按照金币的总量排名。\n";var i=Math.round(egret.sys.measureText(" ","Arial",24,!1,!1)),n=Math.round(egret.sys.measureText("276个0          zz","Arial",24,!1,!1)),a=[];a.push("金币单位");for(var o=0;o<Utility.units.length;o++){for(var r=(3*(o+1)).toString()+"个0",s=Math.round((n-egret.sys.measureText(r+Utility.units[o],"Arial",24,!1,!1))/i),h=0;s>h;h++)r+=" ";a.push(r+Utility.units[o])}for(var c=Math.floor((380-n)/(2*i)),l="",h=0;c>h;h++)l+=" ";for(var o=0;o<a.length;o++)t+=l+a[o]+"\n";application.showUI(new e(t))},e}(eui.Component);egret.registerClass(HelpUI,"HelpUI");var HomeUI=function(t){function e(){t.call(this),this.gold=0,this.diamond=0,this.output=0,this.hit=0,this.addEventListener(eui.UIEvent.COMPLETE,this.uiCompHandler,this),this.skinName="resource/custom_skins/homeUISkin.exml"}__extends(e,t);var i=(__define,e),n=i.prototype;return n.uiCompHandler=function(){var t=this;t.lblAddGold.visible=!1,t.imgAddGold.visible=!1,t.lblAddGold.backgroundColor=16777215,t.imgHit.visible=!1,t.imgGift.visible=!1,t.imgReward.visible=!1,t.imgHasMessage.visible=!1,t.imgVip.source="VIP"+application.me.vip.getLevel().toString()+"_png",t.btnHome.addEventListener(egret.TouchEvent.TOUCH_TAP,t.btnHandler,t),t.btnRank.addEventListener(egret.TouchEvent.TOUCH_TAP,t.btnHandler,t),t.btnTool.addEventListener(egret.TouchEvent.TOUCH_TAP,t.btnHandler,t),t.btnAuction.addEventListener(egret.TouchEvent.TOUCH_TAP,t.btnHandler,t),t.btns=[t.btnHome,t.btnRank,t.btnTool,t.btnAuction],t.imgAvatar.source=Customer.avatarUrl(application.me.attrs),t.renderCustomer(),t.lblTotalHits.text="x"+application.me.attrs.total_hits.toString(),t.renderTotalHits(),t.renderProjects(),t.renderBeauty(),t.lblHit.addEventListener(egret.TouchEvent.TOUCH_BEGIN,function(){t.onHit()},this),t.btnHit.addEventListener(egret.TouchEvent.TOUCH_BEGIN,function(){t.onHit()},this),t.btnGift.addEventListener(egret.TouchEvent.TOUCH_BEGIN,function(){application.showUI(new GiftUI,this)},this),t.btnReward.addEventListener(egret.TouchEvent.TOUCH_BEGIN,function(){application.showUI(new LoginRewardUI,this)},this),t.btnHelp.addEventListener(egret.TouchEvent.TOUCH_BEGIN,function(){HelpUI.showMainHelp()},this),t.btnAddGold.addEventListener(egret.TouchEvent.TOUCH_BEGIN,function(){application.showUI(new BuyToolUI("time",500))},this),t.btnAddDiamond.addEventListener(egret.TouchEvent.TOUCH_BEGIN,function(){application.showUI(new ChargeTipUI,this)},this),t.imgCharge.addEventListener(egret.TouchEvent.TOUCH_BEGIN,function(){0==application.me.attrs.charge?application.showUI(new FirstChargeBonusUI,this):application.showUI(new ChargeTipUI,this)},this),t.imgMessage.addEventListener(egret.TouchEvent.TOUCH_BEGIN,function(){application.showUI(new MessageUI,this)},this),t.imgVip.addEventListener(egret.TouchEvent.TOUCH_BEGIN,function(){application.showUI(new VipUI,this)},this),application.dao.addEventListener("Project",function(t){var e=t.data;this.renderProject(e)},this),application.dao.addEventListener("Customer",function(t){this.renderCustomer()},this),application.dao.addEventListener("Bid",function(t){this.renderCustomer()},this),application.dao.addEventListener("Gift",function(t){this.renderGift()},this),application.dao.addEventListener("Audit",function(t){this.renderReward()},this),application.dao.addEventListener("Message",function(t){this.renderMessage()},this),t.renderGiftDynamically(),t.renderReward(),t.gotoHome(),application.guideUI?(application.guideUI.setOverCallback(function(){t.earnGoldDynamically(),t.renderBid(),t.refreshBidAtNoon(),t.refreshMessageTimely()}),this.addChild(application.guideUI),application.guideUI.next()):(t.earnGoldDynamically(),t.renderBid(),t.refreshBidAtNoon(),t.refreshMessageTimely())},n.renderGiftDynamically=function(){this.renderGift(),application.stopwatch.addEventListener("hour",function(t){this.renderGift()},this)},n.renderGift=function(){var t=this;Gift.check(application.me).then(function(e){t.imgGift.visible=Gift.hasGift(e)})},n.renderReward=function(){var t=this;Audit.check(application.me).then(function(e){t.imgReward.visible=Audit.hasRewards(e)})},n.earnGoldDynamically=function(){var t=5;application.stopwatch.addEventListener("second",function(e){e.data%t==0&&this.earnGold(t)},this)},n.renderTotalHits=function(){var t=this;application.stopwatch.addEventListener("hour",function(e){e.data%4==0&&application.dao.rest("hits",{customer_id:application.me.attrs.id}).then(function(e){application.me.attrs.total_hits=e.hits,t.lblTotalHits.text="x"+application.me.attrs.total_hits.toString()})},this)},n.refreshBidAtNoon=function(){var t=this;application.stopwatch.addEventListener("minute",function(e){var i=Bid.day();t.bid&&i==t.bid.day||t.renderBid(),application.me.bid.attrs&&i==application.me.bid.attrs.day||application.me.bid.refresh(application.me).then(function(e){t.renderCustomer()})},this)},n.refreshMessageTimely=function(){this.renderMessage(),application.stopwatch.addEventListener("hour",function(t){this.renderMessage()},this)},n.renderMessage=function(){var t=this;t.imgHasMessage.visible=!1,application.dao.fetch("Message",{customer_id:application.me.attrs.id,state:0},{limit:1}).then(function(e){1==e.length&&(t.imgHasMessage.visible=!0)})},n.renderBid=function(){var t=this;application.dao.fetch("Bid",{succeed:1},{limit:1,order:"create_time desc"}).then(function(e){e.length>0&&(!t.bid||t.bid.id!=e[0].id)&&(t.bid=e[0],application.me.attrs.id==t.bid.customer_id?(0==t.bid.claimed?(application.showUI(new WinUI(t.bid),t),application.me.earnOfflineGold()):(t.renderOfflineGold(),Bid.earn(application.me)),t.renderBidCustomer(application.me.attrs)):(application.dao.fetch("Customer",{id:t.bid.customer_id},{limit:1}).then(function(e){e.length>0&&t.renderBidCustomer(e[0])}),t.renderOfflineGold(),Bid.earn(application.me)))})},n.renderOfflineGold=function(){application.me.attrs.offline_gold>0&&application.showUI(new OfflineGoldUI,this)},n.renderBidCustomer=function(t){this.lblBidName.text=t.name,this.lblBidGold.text=Utility.format(this.bid.gold),1==t.hide_winner?this.imgBidAvatar.source="Ahide_png":this.imgBidAvatar.source=Customer.avatarUrl(t)},n.renderProjects=function(){var t=this;t.projectItems=new Array,t.grpProject.removeChildren(),application.dao.fetch("Project",{customer_id:application.me.attrs.id},{order:"sequence asc"}).then(function(e){if(e.length>0){for(var i=1,n=0;n<e.length;n++){var a=e[n];t.renderProject(a),0==a.unlocked&&(i+=application.projects[a.sequence].output(a.level,a.achieve,a.tool_ratio))}i=application.me.vip.getOutput(i),i!=application.me.attrs.output&&(application.me.attrs.output=i,application.me.saveNow(),t.lblOutput.text=Utility.format(t.getOutput()))}})},n.renderBeauty=function(){var t=this,e=RES.getRes("animation_json"),i=RES.getRes("animation_png"),n=new egret.MovieClipDataFactory(e,i);t.mcBeauty=new egret.MovieClip(n.generateMovieClipData("")),t.mcBeauty.x=70,t.mcBeauty.y=90,t.addChildAt(t.mcBeauty,3),t.mcBeauty.touchEnabled=!0,t.mcBeauty.addEventListener(egret.TouchEvent.TOUCH_BEGIN,function(){t.onBeauty()},this)},n.onBeauty=function(){this.mcBeauty.play(3),this.earnGold(1),application.guideUI&&application.guideUI.next()},n.earnGold=function(t){var e=this.getOutput()*t;application.me.earnGold(e),this.grpAddGold.y=370,this.imgAddGold.visible=!0,this.lblAddGold.visible=!0,this.lblAddGold.text="+"+Utility.format(e);var i=new egret.Timer(100,20);i.addEventListener(egret.TimerEvent.TIMER,function(t){this.grpAddGold.y-=10},this),i.addEventListener(egret.TimerEvent.TIMER_COMPLETE,function(t){this.lblAddGold.visible=!1,this.imgAddGold.visible=!1},this),i.start()},n.onHit=function(){var t=this;if(!(t.hit>0))if(application.me.attrs.total_hits>0){application.me.attrs.total_hits-=1,application.me.saveNow(),t.lblTotalHits.text="x"+application.me.attrs.total_hits.toString(),t.hit=59,t.lblOutput.text=Utility.format(t.getOutput()),Toast.launch("获得"+application.me.vip.getHitRatio()+"倍收益，持续60秒"),t.imgHit.visible=!0;var e=new egret.Timer(1e3,59);e.addEventListener(egret.TimerEvent.TIMER,function(e){t.lblHit.text=t.hit.toString(),t.hit>0&&(t.hit=t.hit-1)},this),e.addEventListener(egret.TimerEvent.TIMER_COMPLETE,function(e){t.hit=0,t.lblHit.text="59",t.lblOutput.text=Utility.format(t.getOutput()),t.imgHit.visible=!1},this),e.start()}else application.showUI(new BuyToolUI("hit",100),this)},n.getOutput=function(){return this.hit>0?application.me.vip.getHit(application.me.attrs.output):application.me.attrs.output},n.animateStep=function(t,e,i){if(e!=i){var n=Math.min(Math.abs(e-i),20),a=(i-e)/n,o=new egret.Timer(50,n);o.addEventListener(egret.TimerEvent.TIMER,function(i){t.text=Utility.format(Math.round(e+a*i.target.currentCount))},this),o.addEventListener(egret.TimerEvent.TIMER_COMPLETE,function(e){t.text=Utility.format(i)},this),o.start()}},n.renderCustomer=function(){this.gold!=application.me.usableGold()&&(this.animateStep(this.lblGold,this.gold,application.me.usableGold()),this.gold=application.me.usableGold()),this.diamond!=application.me.attrs.diamond&&(this.animateStep(this.lblDiamond,this.diamond,application.me.attrs.diamond),this.diamond=application.me.attrs.diamond),this.output!=this.getOutput()&&(this.animateStep(this.lblOutput,this.output,this.getOutput()),this.output=this.getOutput()),this.lblTotalHits.text="x"+application.me.attrs.total_hits.toString(),application.me.attrs.charge>0&&(this.imgCharge.source="charge_png"),this.lblName.text=application.me.attrs.name},n.renderProject=function(t){if(t){var e=t.sequence;if(e>=this.projectItems.length){var i=new ProjectItem(t,application.projects[e]);this.projectItems[e]=i,this.grpProject.addChildAt(i,e)}}},n.gotoHome=function(){this._uiFocused=null,this.selectFooter(this.btnHome)},n.gotoTool=function(){var t=this;this._toolUI?this._toolUI.refresh():(this._toolUI=new ToolUI,this._toolUI.addEventListener(GameEvents.EVT_RETURN,function(){t.gotoPage(GamePages.HOME,!0)},this)),this._uiFocused=this._toolUI,this.selectFooter(this.btnTool)},n.gotoRank=function(){var t=this;this._rankUI?this._rankUI.refresh():(this._rankUI=new RankUI,this._rankUI.addEventListener(GameEvents.EVT_RETURN,function(){t.gotoPage(GamePages.HOME,!0)},this)),this._uiFocused=this._rankUI,this.selectFooter(this.btnRank)},n.gotoAuction=function(){var t=this;this._auctionUI?this._auctionUI.refresh():(this._auctionUI=new AuctionUI,this._auctionUI.addEventListener(GameEvents.EVT_RETURN,function(){t.gotoPage(GamePages.HOME,!0)
},this)),this._uiFocused=this._auctionUI,this.selectFooter(this.btnAuction),application.guideUI&&application.guideUI.next()},n.btnHandler=function(t){if(t.currentTarget==this._btnFocused)return void(this._btnFocused.selected=!0);switch(t.currentTarget){case this.btnHome:this.gotoPage(GamePages.HOME,!0);break;case this.btnRank:this.gotoPage(GamePages.RANK,!1);break;case this.btnTool:this.gotoPage(GamePages.TOOL,!1);break;case this.btnAuction:this.gotoPage(GamePages.AUCTION,!1)}},n.resetFocus=function(){this._uiFocused&&(this._uiFocused.parent&&this._uiFocused.parent.removeChild(this._uiFocused),this._uiFocused=null),this._btnFocused&&(this._btnFocused.selected=!1,this._btnFocused.enabled=!0,this._btnFocused=null)},n.gotoPage=function(t,e){switch(this._pageFocused=t,this.resetFocus(),t){case GamePages.HOME:return void this.gotoHome();case GamePages.RANK:this._rankUI||e?this.gotoRank():this.loadPage();break;case GamePages.TOOL:this._toolUI||e?this.gotoTool():this.loadPage();break;case GamePages.AUCTION:this._auctionUI||e?this.gotoAuction():this.loadPage()}this._uiFocused&&(this._uiFocused.horizontalCenter=0,this._uiFocused.verticalCenter=0,application.guideUI?this.addChildAt(this._uiFocused,this.getChildIndex(application.guideUI)):this.addChild(this._uiFocused))},n.loadPage=function(){this.enableFooter(!1),this.dispatchEventWith(GameEvents.EVT_LOAD_PAGE,!1,this._pageFocused)},n.pageReadyHandler=function(t){this.enableFooter(!0),this.gotoPage(t,!0)},n.selectFooter=function(t){this._btnFocused&&(this._btnFocused.selected=!1),this._btnFocused=t,this._btnFocused.selected=!0},n.enableFooter=function(t){for(var e=0;e<this.btns.length;e++)this.btns[e].enabled=t},e}(eui.Component);egret.registerClass(HomeUI,"HomeUI");var LandingUI=function(t){function e(){t.call(this,"landingUISkin")}__extends(e,t);var i=(__define,e),n=i.prototype;return n.onRefresh=function(){var t=this;t.btnLogin.visible=!1,application.dao.fetch("Notification",{},{order:"action DESC, create_time DESC",limit:1}).then(function(e){e.length>0?(application.showUI(new NotificationUI(e[0],function(){t.loginQuietly()}),t),t.showedNotification=e[0]):t.loginQuietly()},function(e){t.loginQuietly()}),application.stopwatch.addEventListener("hour",function(e){application.dao.fetch("Notification",{},{order:"action DESC, create_time DESC",limit:1}).then(function(e){e.length>0&&(t.showedNotification&&t.showedNotification.id==e[0].id||(application.showUI(new NotificationUI(e[0])),t.showedNotification=e[0]))})},this),t.btnLogin.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){application.channel.login().then(function(e){application.logined(e),application.hideUI(t)},function(t){Toast.launch(t)})},t)},n.loginQuietly=function(){var t=this;egret.getOption("wysj_account_id")?application.dao.fetch("Account",{id:egret.getOption("wysj_account_id")},{limit:1}).then(function(e){e.length>0?(application.logined(e[0]),application.hideUI(t)):(Toast.launch("玩家不存在，ID = "+egret.getOption("wysj_account_id")),t.btnLogin.visible=!0)},function(e){Toast.launch(e),t.btnLogin.visible=!0}):application.channel.loginQuietly().then(function(e){application.logined(e),application.hideUI(t)},function(e){t.btnLogin.visible=!0})},e}(AbstractUI);egret.registerClass(LandingUI,"LandingUI");var LoadingUI=function(t){function e(){t.call(this),this.textField=new egret.TextField,this.textField.textColor=16777215,this.textField.y=300,this.textField.width=480,this.textField.height=100,this.textField.textAlign="center",this.addChild(this.textField)}__extends(e,t);var i=(__define,e),n=i.prototype;return n.setProgress=function(t,e){this.textField.text="加载..."+t+"/"+e},e}(egret.Sprite);egret.registerClass(LoadingUI,"LoadingUI");var LoginButton=function(t){function e(e,i){t.call(this),this.type=e,this.url=i,this.addEventListener(eui.UIEvent.COMPLETE,this.uiCompHandler,this),this.skinName="resource/custom_skins/loginButtonSkin.exml"}__extends(e,t);var i=(__define,e),n=i.prototype;return n.uiCompHandler=function(){var t=new eui.Image;if(t.source=this.type+"_png",this.icon_group.addChildAt(t,0),this.url&&""!=this.url){this.right_ui.visible=!0;var e=new egret.DisplayObjectContainer,i=new egret.Shape;i.graphics.beginFill(16711680),i.graphics.drawCircle(100,100,100),i.graphics.endFill(),e.addChild(i);var n=new egret.Bitmap;RES.getResByUrl(this.url,function(t){n.texture=t,n.width=200,n.height=200},this,RES.ResourceItem.TYPE_IMAGE),e.addChild(n),n.mask=i,this.icon_group.addChildAt(e,0)}else this.right_ui.visible=!1;this.name_txt.text=this.getLabelName(this.type,this.url&&""!=this.url)},n.getLabelName=function(t,e){var i="";switch(t){case"qq":i="qq";break;case"wx":i="微信";break;case"wb":i="微博";break;default:i="默认"}return e?i+"--一键登录":i+"登录"},e}(eui.Component);egret.registerClass(LoginButton,"LoginButton");var LoginRewardUI=function(t){function e(){t.call(this,"loginRewardUISkin"),this.rewardData=[300,500,700,900,1100,1300,1500],this.imgPicks=[this.imgPick1,this.imgPick2,this.imgPick3,this.imgPick4,this.imgPick5,this.imgPick6,this.imgPick7];for(var e=0;e<this.imgPicks.length;e++)this.imgPicks[e].visible=!1;this.imgRet.addEventListener(egret.TouchEvent.TOUCH_BEGIN,function(){application.hideUI(this)},this),this.imgPick1.addEventListener(egret.TouchEvent.TOUCH_BEGIN,function(t){this.claim(0)},this),this.imgPick2.addEventListener(egret.TouchEvent.TOUCH_BEGIN,function(t){this.claim(1)},this),this.imgPick3.addEventListener(egret.TouchEvent.TOUCH_BEGIN,function(t){this.claim(2)},this),this.imgPick4.addEventListener(egret.TouchEvent.TOUCH_BEGIN,function(t){this.claim(3)},this),this.imgPick5.addEventListener(egret.TouchEvent.TOUCH_BEGIN,function(t){this.claim(4)},this),this.imgPick6.addEventListener(egret.TouchEvent.TOUCH_BEGIN,function(t){this.claim(5)},this),this.imgPick7.addEventListener(egret.TouchEvent.TOUCH_BEGIN,function(t){this.claim(6)},this)}__extends(e,t);var i=(__define,e),n=i.prototype;return n.claim=function(t){for(var e=0;e<this.audits.length;e++)this.audits[e].rewards==this.rewardData[t]&&0==this.audits[e].claimed&&(Audit.claim(this.audits[e]),this.renderAudit(this.audits[e]),application.me.attrs.diamond+=this.rewardData[t],application.me.saveNow(),application.channel.track(TRACK_CATEGORY_DIAMOND,TRACK_ACTION_INC,"连续登录",this.audits[e].rewards))},n.onRefresh=function(){var t=this;Audit.check(application.me).then(function(e){t.audits=e;for(var i=0;i<t.imgPicks.length;i++)t.imgPicks[i].visible=!1;for(var i=0;i<e.length;i++)t.renderAudit(e[i])})},n.renderAudit=function(t){for(var e=this.imgPicks[0],i=0;i<this.rewardData.length;i++)if(t.rewards==this.rewardData[i]){e=this.imgPicks[i];break}e.visible=!0,1==t.claimed?e.source="picked_png":e.source="pick_png"},e}(AbstractUI);egret.registerClass(LoginRewardUI,"LoginRewardUI");var LoginUI=function(t){function e(e,i){t.call(this),this.loginTypes=e,this.onChoose=i,this.addEventListener(eui.UIEvent.COMPLETE,this.uiCompHandler,this),this.skinName="resource/custom_skins/loginUISkin.exml"}__extends(e,t);var i=(__define,e),n=i.prototype;return n.uiCompHandler=function(){for(var t=0;t<this.loginTypes.length;t++){var e=this.loginTypes[t],i="";e.accInfo&&e.accInfo.avatarUrl&&(i=e.accInfo.avatarUrl);var n=new LoginButton(e.loginType,i);n.name=e.loginType,this.btnGroup.addChild(n),n.scaleX=n.scaleY=.5,n.touchEnabled=!0,n.addEventListener(egret.TouchEvent.TOUCH_TAP,function(t){this.onChoose(this.loginTypes[parseInt(t.currentTarget.name)])},this)}},e}(eui.Component);egret.registerClass(LoginUI,"LoginUI");var MessageDetailUI=function(t){function e(e){t.call(this),this.addEventListener(eui.UIEvent.COMPLETE,function(){var t=this;this.lblContent.text=e.content,e.attach_quantity>0?(this.imgAttach.visible=!0,this.lblAttach.visible=!0,"diamond"==e.attach_category?this.imgAttach.source="dia_png":"gold"==e.attach_category?this.imgAttach.source="coin_png":this.imgAttach.source="metal_png",this.lblAttach.text="x"+e.attach_quantity):(this.imgAttach.visible=!1,this.lblAttach.visible=!1),0==e.state&&e.attach_quantity>0?this.imgOperate.source="get_png":this.imgOperate.source="del_png",this.imgBack.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){application.hideUI(t)},this),this.imgOperate.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){"get_png"==t.imgOperate.source?("diamond"==e.attach_category?(application.me.attrs.diamond+=e.attach_quantity,application.channel.track(TRACK_CATEGORY_DIAMOND,TRACK_ACTION_INC,e.title,e.attach_quantity)):"gold"==e.attach_category?application.me.attrs.gold+=e.attach_quantity:application.me.attrs.metal+=e.attach_quantity,e.state=1,application.dao.save("Message",e),application.me.saveNow(),t.imgOperate.source="del_png"):(e.state=2,application.dao.save("Message",e),application.hideUI(t))},this)},this),this.skinName="resource/custom_skins/messageDetailUISkin.exml"}__extends(e,t);var i=(__define,e);i.prototype;return e}(eui.Component);egret.registerClass(MessageDetailUI,"MessageDetailUI");var MessageItem=function(t){function e(e){t.call(this),this.skinName="resource/custom_skins/messageItemSkin.exml",this.refresh(e);var i=new Date(e.create_time);this.lblDay.text=i.getFullYear()+"/"+(i.getMonth()+1)+"/"+i.getDate(),this.lblDay.touchEnabled=!1,this.lblTitle.touchEnabled=!1,this.lblContent.touchEnabled=!1,this.imgAttach.touchEnabled=!1,this.lblAttach.touchEnabled=!1,this.imgBg.addEventListener(egret.TouchEvent.TOUCH_BEGIN,function(){application.showUI(new MessageDetailUI(e))},this),this.imgOperate.addEventListener(egret.TouchEvent.TOUCH_BEGIN,function(){"get_png"==this.imgOperate.source?("diamond"==e.attach_category?(application.me.attrs.diamond+=e.attach_quantity,application.channel.track(TRACK_CATEGORY_DIAMOND,TRACK_ACTION_INC,e.title,e.attach_quantity)):"gold"==e.attach_category?application.me.attrs.gold+=e.attach_quantity:application.me.attrs.metal+=e.attach_quantity,e.state=1,application.dao.save("Message",e),application.me.saveNow(),this.imgOperate.source="del_png"):(e.state=2,application.dao.save("Message",e),this.parent&&this.parent.removeChild(this))},this),application.dao.addEventListener("Message",function(t){t.data.id==e.id&&(2==t.data.state?this.parent&&this.parent.removeChild(this):this.refresh(e))},this)}__extends(e,t);var i=(__define,e),n=i.prototype;return n.refresh=function(t){this.lblTitle.text=t.title,this.lblContent.text=t.content,this.imgAttach.visible=!1,this.lblAttach.visible=!1,0==t.state?(t.attach_quantity>0?(this.imgOperate.source="get_png",this.imgAttach.visible=!0,this.lblAttach.visible=!0,"diamond"==t.attach_category?this.imgAttach.source="dia_png":"gold"==t.attach_category?this.imgAttach.source="coin_png":this.imgAttach.source="metal_png",this.lblAttach.text="x"+t.attach_quantity):this.imgOperate.source="del_png",this.imgBg.source="bar_png"):(this.imgOperate.source="del_png",this.imgBg.source="bargery_png")},e}(eui.Component);egret.registerClass(MessageItem,"MessageItem");var MessageUI=function(t){function e(){t.call(this),this.addEventListener(eui.UIEvent.COMPLETE,this.uiCompHandler,this),this.skinName="resource/custom_skins/messageUISkin.exml"}__extends(e,t);var i=(__define,e),n=i.prototype;return n.refresh=function(){var t=this;t.lstMessage.removeChildren(),application.dao.fetch("Message",{customer_id:application.me.attrs.id,state:0},{order:"create_time ASC"}).then(function(e){e.length>=1&&(t.messages=e,t.renderMessages(e))}),application.dao.fetch("Message",{customer_id:application.me.attrs.id,state:1},{order:"update_time DESC"}).then(function(e){e.length>=1&&(t.messagesPicked=e,t.renderMessages(e))})},n.renderMessages=function(t){for(var e=0;e<t.length;e++)this.lstMessage.addChild(new MessageItem(t[e]))},n.uiCompHandler=function(){var t=this;this.refresh(),this.imgBack.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){application.hideUI(t)},this)},e}(eui.Component);egret.registerClass(MessageUI,"MessageUI");var NotificationUI=function(t){function e(e,i){t.call(this),this.addEventListener(eui.UIEvent.COMPLETE,function(){var t=this;this.lblContent.text=e.content,this.imgOk.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){application.hideUI(t),1==e.action?window.location.reload(!1):i&&i()},this)},this),this.skinName="resource/custom_skins/notificationUISkin.exml"}__extends(e,t);var i=(__define,e);i.prototype;return e}(eui.Component);egret.registerClass(NotificationUI,"NotificationUI");var OfflineGoldUI=function(t){function e(){var e=this;t.call(this),this.skinName="resource/custom_skins/offlineGoldUISkin.exml",this.lblGold.text=Utility.format(application.me.attrs.offline_gold),this.lblHour.text=application.me.attrs.offline_hours,this.lblMinute.text=application.me.attrs.offline_minutes,this.imgOK.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){application.me.earnOfflineGold(),application.hideUI(e)},this)}__extends(e,t);var i=(__define,e);i.prototype;return e}(eui.Component);egret.registerClass(OfflineGoldUI,"OfflineGoldUI");var ProjectItem=function(t){function e(e,i){t.call(this),this._myProject=e,this._project=i,this.addEventListener(eui.UIEvent.COMPLETE,this.uiCompHandler,this),this.skinName="resource/custom_skins/projectItemSkin.exml",this.imgIcon.source=(e.sequence+1).toString()+"_png",this.imgTitle.source="t"+(e.sequence+1).toString()+"_png"}__extends(e,t);var i=(__define,e),n=i.prototype;return n.uiCompHandler=function(){var t=this;this.renderProject(),this.renderAchieves(),this.lblPrice.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){t.onUpgrade()},this),this.imgUpgrade.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){t.onUpgrade()},this),this.imgUpgrade10.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){0==t._myProject.unlocked&&t.upgrade(10)},this),this.imgUpgrade100.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){0==t._myProject.unlocked&&t.upgrade(100)},this),application.dao.addEventListener("Project",function(t){var e=t.data;e.id==this._myProject.id&&(this._myProject=e,this.renderProject(),this.renderAchieves())},this),application.dao.addEventListener("Customer",function(t){this.renderProject()},this)},n.onUpgrade=function(){1==this._myProject.unlocked?this.unlock():this.upgrade(1)},n.output=function(){return application.me.vip.getOutput(this._project.output(this._myProject.level,this._myProject.achieve,this._myProject.tool_ratio))},n.renderProject=function(){if(1==this._myProject.unlocked){var t=this._project.priceOf(1);this.lblLevel.text="0",this.lblOutput.text="0",this.lblPrice.text=Utility.format(t),application.me.usableGold()>t?this.imgUpgrade.source="updatedp2_png":this.imgUpgrade.source="upgradeg_png",this.imgUpgrade10.source="upgrade10g_png",this.imgUpgrade100.source="upgrade100g_png"}else{var t=application.me.vip.getUpgrade(this._project.priceOf(this._myProject.level)),e=application.me.vip.getUpgrade(this._project.price(this._myProject.level,10)),i=application.me.vip.getUpgrade(this._project.price(this._myProject.level,100));this.lblLevel.text=this._myProject.level,this.lblOutput.text=Utility.format(this.output()),this.lblPrice.text=Utility.format(t),this._myProject.sequence%2==0?(application.me.usableGold()>e?this.imgUpgrade10.source="upgrade10_png":this.imgUpgrade10.source="upgrade10g_png",application.me.usableGold()>i?this.imgUpgrade100.source="upgrade100_png":this.imgUpgrade100.source="upgrade100g_png",application.me.usableGold()>t?this.imgUpgrade.source="upgrade_png":this.imgUpgrade.source="upgradeg2_png"):(application.me.usableGold()>e?this.imgUpgrade10.source="upgrade10b_png":this.imgUpgrade10.source="upgrade10g_png",application.me.usableGold()>i?this.imgUpgrade100.source="upgrade100b_png":this.imgUpgrade100.source="upgrade100g_png",application.me.usableGold()>t?this.imgUpgrade.source="upgradeb_png":this.imgUpgrade.source="upgradeg2_png")}},n.renderAchieves=function(){var t=this;t.grpAchieve.removeChildren();for(var e=1;10>=e;e++)this.grpAchieve.addChild(this.renderAchieve(e))},n.renderAchieve=function(t){var e=this,i=new eui.Group,n=new eui.Image,a="acv"+t.toString()+"_png";return t<=this._myProject.achieve?(n.source=a,i.addChild(n)):this._myProject.level>=this._project.achieve(t).level&&t==this._myProject.achieve+1?(n.source=a,i.addChild(n),n=new eui.Image,n.source="acvnone_png",i.addChild(n)):(n.source="acvlock_png",i.addChild(n)),n.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){application.showUI(new BuyAchieveUI(e._myProject,e._project,t))},this),i},n.upgrade=function(t){var e=this,i=application.me.vip.getUpgrade(this._project.price(this._myProject.level,t));if(application.me.usableGold()<i)return void Toast.launch("没有足够的金币");var n=this.output();this._myProject.level+=t,application.dao.save("Project",e._myProject),application.me.buyOutput(i,0,e.output()-n),application.guideUI&&application.guideUI.next()},n.unlock=function(){var t=this,e=this._project.priceOf(1);if(application.me.usableGold()<e)return void Toast.launch("没有足够的金币");if(t._myProject.unlocked=0,application.dao.save("Project",t._myProject),t._myProject.sequence<19){var i={};i.customer_id=application.me.attrs.id,i.sequence=t._myProject.sequence+1,i.unlocked=1,i.achieve=0,i.level=1,application.dao.save("Project",i),application.me.buyOutput(e,0,t.output())}else application.me.buyOutput(e,0,t.output());application.guideUI&&application.guideUI.next()},e}(eui.Component);egret.registerClass(ProjectItem,"ProjectItem");var RankItem=function(t){function e(e,i,n){if(t.call(this),this.skinName="resource/custom_skins/rankItemSkin.exml",e){if(0==i)return void(this.imgBg.source="RG_png");this.lblRank.text=i.toString(),n.id==application.me.attrs.id?this.imgBg.source="RY_png":this.imgBg.source="RG_png"}else 1==i?this.imgBg.source="RR_png":2==i?this.imgBg.source="RBlue_png":3==i?this.imgBg.source="RGreen_png":(this.imgBg.source="RG_png",this.lblRank.text=i.toString());this.imgAvatar.source=Customer.avatarUrl(n),this.lblName.text=n.name,this.lblMetal.text=new Number(n.metal).toFixed(3),this.lblGold.text=Utility.format(n.accumulated_gold)}__extends(e,t);var i=(__define,e);i.prototype;return e}(eui.Component);egret.registerClass(RankItem,"RankItem");var RankUI=function(t){function e(){t.call(this),this.addEventListener(eui.UIEvent.COMPLETE,this.uiCompHandler,this),this.skinName="resource/custom_skins/rankUISkin.exml"}__extends(e,t);var i=(__define,e),n=i.prototype;return n.refresh=function(){var t=this,e=20;application.dao.fetch("Customer",{},{limit:e+2,order:"metal DESC, accumulated_gold DESC"}).then(function(i){var n=0,a=null,o=null,r=null;t.listRank.removeChildren();for(var s=0;s<Math.min(e+1,i.length);s++){if(e>s){var h=new RankItem(!1,s+1,i[s]);t.listRank.addChild(h)}application.me.attrs.id==i[s].id&&(o=application.me.attrs,n=s+1,s>0&&(a=i[s-1]),r=i[s+1])}o?(t.listMyRank.removeChildren(),a&&t.listMyRank.addChild(new RankItem(!0,n-1,a)),t.listMyRank.addChild(new RankItem(!0,n,o)),t.listMyRank.addChild(new RankItem(!0,n+1,r))):application.dao.fetch("Rank",{customer_id:application.me.attrs.id},{limit:1}).then(function(e){1==e.length&&application.dao.fetch("Rank",{rank:[e[0].rank-1,e[0].rank,e[0].rank+1]},{order:"rank ASC"}).then(function(e){if(e.length>0){for(var i=[],n=0;n<e.length;n++)i.push(e[n].customer_id);application.dao.fetch("Customer",{id:i},{limit:i.length}).then(function(i){if(i.length>0){t.listMyRank.removeChildren();for(var n=0;n<e.length;n++)for(var a=0;a<i.length;a++)if(e[n].customer_id==i[a].id){var o=new RankItem(!0,e[n].rank,i[a]);t.listMyRank.addChild(o)}}})}})})})},n.uiCompHandler=function(){this.refresh(),this.imgBack.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){application.gotoHome()},this)},n.back=function(){this.dispatchEventWith(GameEvents.EVT_RETURN)},e}(eui.Component);egret.registerClass(RankUI,"RankUI");var ReportUI=function(t){function e(){var e=this;t.call(this),this.skinName="resource/custom_skins/reportUISkin.exml",this.imgCancel.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){application.hideUI(e)},this),this.imgOK.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){if(e.txtContent.text.length>0){var t={customer_id:application.me.attrs.id,content:e.txtContent.text,state:0};application.dao.save("Report",t),application.hideUI(e)}else Toast.launch("请填写错误的内容")},this)}__extends(e,t);var i=(__define,e);i.prototype;return e}(eui.Component);egret.registerClass(ReportUI,"ReportUI");var ResetUI=function(t){function e(e,i,n){t.call(this),this.diamond=n,this.myProject=e,this.project=i,this.addEventListener(eui.UIEvent.COMPLETE,this.uiCompHandler,this),this.skinName="resource/custom_skins/resetUISkin.exml"}__extends(e,t);var i=(__define,e),n=i.prototype;return n.uiCompHandler=function(){var t=this;this.imgCancel.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){application.hideUI(t)},this),this.imgOk.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){var e=t.output();t.myProject.tool_ratio=1,application.dao.save("Project",t.myProject),application.me.attrs.diamond+=t.diamond,application.me.attrs.output+=t.output()-e,application.me.saveNow(),application.channel.track(TRACK_CATEGORY_DIAMOND,TRACK_ACTION_INC,"重置了金手指",t.diamond),Toast.launch("成功重置了金手指"),application.hideUI(t)},this),this.lblDiamond.text=Utility.format(this.diamond)},n.output=function(){return application.me.vip.getOutput(this.project.output(this.myProject.level,this.myProject.achieve,this.myProject.tool_ratio))},e}(eui.Component);egret.registerClass(ResetUI,"ResetUI");var Toast=function(t){function e(i,n,a){var o=this;t.call(this),console.log("Toast:",i);var r=new egret.Bitmap(e._txtrToastBg);this.addChild(r);var s=new egret.TextField;s.multiline=!0,s.size=20,s.bold=!0,s.textColor=16777215,s.stroke=2,s.strokeColor=0,s.text=i,s.fontFamily="微软雅黑",s.textAlign=egret.HorizontalAlign.CENTER,s.width=.84*n,s.x=(e._txtrToastBg.textureWidth-s.width)/2,s.y=6,this.addChild(s),r.height=12+s.height,this.anchorOffsetX=.5*this.width,this.anchorOffsetY=.5*this.height,this.x=.5*n,this.y=.618*a,this.alpha=0,egret.Tween.get(this).to({alpha:1},800,egret.Ease.quintOut).wait(1600).to({alpha:0},1200,egret.Ease.quintIn).call(function(){o.parent&&o.parent.removeChild(o)})}__extends(e,t);var i=(__define,e);i.prototype;return e.init=function(t,e){this._cont=t,this._txtrToastBg=e},e.launch=function(t){if(this._cont&&t&&t.length>0){var i=new e(t,this._cont.stage.stageWidth,this._cont.stage.stageHeight);this._cont.addChild(i)}},e}(egret.DisplayObjectContainer);egret.registerClass(Toast,"Toast");var ToolItem=function(t){function e(e,i,n,a){var o=this;t.call(this),this._project=i,this._myProject=e,this.skinName="resource/custom_skins/toolItemSkin.exml",this.img100.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){o.buy(100,1)},this),this.img900.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){o.buy(900,10)},this),this.imgReset.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){o.reset()},this),application.dao.addEventListener("Project",function(t){var e=t.data;e.id==this._myProject.id&&(this.myProject=e,this.refresh())},this),this.imgIcon.source=n,this.imgTitle.source=a,this.refresh()}__extends(e,t);var i=(__define,e),n=i.prototype;return n.refresh=function(){this.lbl1.text=Utility.format(this._myProject.tool_ratio),this.lbl100.text=Utility.format(this.ratio(this._myProject.tool_ratio,1)),this.lbl900.text=Utility.format(this.ratio(this._myProject.tool_ratio,10))},n.reset=function(){if(this._myProject.tool_ratio>1){for(var t=0,e=1;e<this._myProject.tool_ratio;)t++,e=this.ratio(1,t);var i=630*Math.floor(t/10)+70*(t%10);application.showUI(new ResetUI(this._myProject,this._project,i))}else Toast.launch("还没有购买过金手指，不能重置")},n.buy=function(t,e){if(application.me.attrs.diamond>=t){var i=this.output();this._myProject.tool_ratio=this.ratio(this._myProject.tool_ratio,e),application.me.buyOutput(0,t,this.output()-i),application.dao.save("Project",this._myProject),application.channel.track(TRACK_CATEGORY_DIAMOND,TRACK_ACTION_DEC,"购买了金手指",t),Toast.launch("成功购买了金手指"),this.refresh()}else application.showUI(new ChargeTipUI)},n.ratioOne=function(t){var e=[1,5,50,200,2e3,1e4,1e5,5e5,5e6,25e6,125e6,625e6,5e9,4e10,2e11],i=Utility.log10(t);if(i<e.length)return t+e[i];for(var n=e[e.length-1],a=0;a<i-e.length;a++)n=10*n;return t+n},n.ratio=function(t,e){for(var i=0;e>i;i++)t=this.ratioOne(t);return t},n.output=function(){return application.me.vip.getOutput(this._project.output(this._myProject.level,this._myProject.achieve,this._myProject.tool_ratio))},e}(eui.Component);egret.registerClass(ToolItem,"ToolItem");var ToolUI=function(t){function e(){t.call(this),this.addEventListener(eui.UIEvent.COMPLETE,this.uiCompHandler,this),this.skinName="resource/custom_skins/toolUISkin.exml"}__extends(e,t);var i=(__define,e),n=i.prototype;return n.refresh=function(){var t=this;this.lblGold.text=Utility.format(application.me.usableGold()),this.lblDiamond.text=Utility.format(application.me.attrs.diamond);var e=new eui.TileLayout;e.horizontalGap=0,e.verticalGap=0,e.columnAlign=eui.ColumnAlign.JUSTIFY_USING_WIDTH,e.rowAlign=eui.RowAlign.TOP,e.paddingTop=0,e.paddingRight=0,e.paddingLeft=0,e.paddingBottom=0,e.requestedColumnCount=2,this.grpProject.layout=e,t.grpProject.removeChildren(),application.dao.fetch("Project",{customer_id:application.me.attrs.id},{order:"sequence asc"}).then(function(e){for(var i=0;i<e.length;i++)t.addProject(e[i])})},n.uiCompHandler=function(){this.refresh(),this.imgBack.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){application.gotoHome()},this),application.dao.addEventListener("Customer",function(t){this.lblGold.text=Utility.format(application.me.usableGold()),this.lblDiamond.text=Utility.format(application.me.attrs.diamond)},this),this.btnAddGold.addEventListener(egret.TouchEvent.TOUCH_BEGIN,function(){application.showUI(new BuyToolUI("time",500))},this),this.btnAddDiamond.addEventListener(egret.TouchEvent.TOUCH_BEGIN,function(){application.showUI(new ChargeTipUI)},this),this.imgHit.addEventListener(egret.TouchEvent.TOUCH_BEGIN,function(){application.showUI(new BuyToolUI("hit",100),this)},this),this.imgTime.addEventListener(egret.TouchEvent.TOUCH_BEGIN,function(){application.showUI(new BuyToolUI("time",500),this)},this),this.imgTicket.addEventListener(egret.TouchEvent.TOUCH_BEGIN,function(){application.showUI(new BuyToolUI("ticket",19),this)},this),this.imgVIP.addEventListener(egret.TouchEvent.TOUCH_BEGIN,function(){application.showUI(new BuyToolUI("vip",49),this)},this)},n.addProject=function(t){if(t&&0==t.unlocked){var e=t.sequence,i=new ToolItem(t,application.projects[e],(e+1).toString()+"_png","t"+(e+1).toString()+"_png");this.grpProject.addChildAt(i,e)}},e}(eui.Component);egret.registerClass(ToolUI,"ToolUI");var TrueLoadingUI=function(t){function e(){var e=this;t.call(this),this.addEventListener(egret.Event.REMOVED_FROM_STAGE,function(){e.hasEventListener(egret.Event.ENTER_FRAME)&&e.removeEventListener(egret.Event.ENTER_FRAME,e.runLoading,e)},this),this.addEventListener(egret.Event.ADDED_TO_STAGE,function(){e.setProgress(0,1),e.addEventListener(egret.Event.ENTER_FRAME,e.runLoading,e)},this)}__extends(e,t);var i=(__define,e),n=i.prototype;return n.createChildren=function(){t.prototype.createChildren.call(this),this._imgBg=new eui.Image,this._imgBg.source="Loginb_png",this.addChild(this._imgBg),this._loadingRun=new egret.Bitmap(RES.getRes("loading_run_png")),this.addChild(this._loadingRun),this._loadingRun.anchorOffsetX=.5*this._loadingRun.width,this._loadingRun.anchorOffsetY=.5*this._loadingRun.height,this._loadingRun.x=.5*this.stage.stageWidth,this._loadingRun.y=.5*this.stage.stageHeight,this._txProgress=new egret.TextField,this._txProgress.textAlign=egret.HorizontalAlign.CENTER,this._txProgress.verticalAlign=egret.VerticalAlign.MIDDLE,this._txProgress.x=.5*this.stage.stageWidth-100,this._txProgress.width=200,this._txProgress.y=.5*this.stage.stageHeight-100,this._txProgress.height=200,this._txProgress.size=14,this._txProgress.stroke=1,this._txProgress.strokeColor=0,this.addChild(this._txProgress)},n.removeBgImage=function(){this.removeChild(this._imgBg)},n.runLoading=function(t){this._loadingRun.rotation+=3},n.setProgress=function(t,e){this._txProgress&&(this._txProgress.text=Math.round(t/e*100)+"%")},e}(eui.Group);egret.registerClass(TrueLoadingUI,"TrueLoadingUI");var VipUI=function(t){function e(){var e=this;t.call(this,"vipUISkin"),this.imgNext.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){e.level++,e.refresh()},this),this.imgLast.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){e.level--,e.refresh()},this),this.imgBack.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){e.hide()},this),this.imgCharge.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){e.show(new ChargeTipUI,!0)},this)}__extends(e,t);var i=(__define,e),n=i.prototype;return n.onRefresh=function(){this.level=application.me.vip.getLevel(),this.onRefreshAgain()},n.onRefreshAgain=function(){0==this.level?(this.lblCharge.visible=!1,this.imgLast.visible=!1,this.imgNext.visible=!0):(this.lblCharge.visible=!0,this.imgLast.visible=!0,15==this.level?this.imgNext.visible=!1:this.imgNext.visible=!0),this.lblCharge.text=application.me.attrs.charge,this.imgTitle.source="vt"+this.level+"_png"},e}(AbstractUI);egret.registerClass(VipUI,"VipUI");var WinUI=function(t){function e(e){var i=this;t.call(this,"winUISkin"),this.imgBack.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){Bid.earn(application.me),i.hide()},this),this.imgHide.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){1==application.me.attrs.hide_winner?application.me.attrs.hide_winner=0:application.me.attrs.hide_winner=1,i.refresh()},this)}__extends(e,t);var i=(__define,e),n=i.prototype;return n.onRefresh=function(){1==application.me.attrs.hide_winner?(this.imgHide.source="hidecancel_png",this.imgAvatar.source="Ahide_png"):(this.imgHide.source="Awinhide_png",this.imgAvatar.source=Customer.avatarUrl(application.me.attrs))},e}(AbstractUI);egret.registerClass(WinUI,"WinUI");